###############################################################################
## Templates - Climacell
###############################################################################
- binary_sensor:
    - name: "Climacell Connected"
      unique_id: climacell_connected
      icon: "{{ 'mdi:weather-partly-snowy-rainy' if is_state('binary_sensor.climacell_connected','on') else 'mdi:alert-circle' }}"
      device_class: connectivity
      state: "{{ states('weather.climacell_daily')|lower not in ['unknown','unavailable','none'] }}"

    - name: "Climacell Connected Alert"
      unique_id: climacell_connected_alert
      icon: mdi:weather-partly-snowy-rainy
      state: >
        {{ is_state('binary_sensor.climacell_connected','off')
            and is_state('input_boolean.weather_alerts','on')
            and is_state('input_boolean.startup_pending','off') }}

- sensor:
    - name: "Climacell Current Condition"
      unique_id: climacell_current_condition
      icon: mdi:weather-partly-snowy-rainy
      state: >
        {% if state_attr('weather.climacell_nowcast','forecast')[0] is defined %}
          {{ state_attr('weather.climacell_nowcast','forecast')[0].condition }}
        {% endif %}
      availability: "{{ states('weather.climacell_nowcast')|lower not in ['unknown','unavailable','none'] }}"

    - name: "Climacell Temperature"
      unique_id: climacell_temperature
      icon: mdi:thermometer
      device_class: temperature
      unit_of_measurement: °C
      state: "{{ state_attr('weather.climacell_nowcast','temperature') }}"

    - name: "Climacell Humidity"
      unique_id: climacell_humidity
      icon: mdi:water-percent
      device_class: humidity
      unit_of_measurement: '%'
      state: "{{ state_attr('weather.climacell_nowcast','humidity') }}"

    - name: "Climacell Visibility"
      unique_id: climacell_visibility
      icon: mdi:weather-cloudy
      unit_of_measurement: km
      state: "{{ state_attr('weather.climacell_nowcast','visibility') }}"

    - name: "Climacell Precipitation Intensity"
      unique_id: climacell_precipitation_intensity
      icon: mdi:weather-rainy
      unit_of_measurement: mm/hr
      state: >
        {% if state_attr('weather.climacell_nowcast','forecast')[0] is defined %}
          {{ state_attr('weather.climacell_nowcast','forecast')[0].precipitation }}
        {% endif %}
      availability: "{{ states('weather.climacell_nowcast')|lower not in ['unknown','unavailable','none'] }}"

    - name: "Climacell Precipitation Probability"
      unique_id: climacell_precipitation_probability
      icon: mdi:weather-rainy
      unit_of_measurement: '%'
      state: >
        {% if state_attr('weather.climacell_nowcast','forecast')[0] is defined %}
          {{ state_attr('weather.climacell_nowcast','forecast')[0].precipitation_probability }}
        {% endif %}
      availability: "{{ states('weather.climacell_nowcast')|lower not in ['unknown','unavailable','none'] }}"

    - name: "Climacell Wind Speed"
      unique_id: climacell_wind_speed
      icon: mdi:weather-windy
      unit_of_measurement: km/h
      state: "{{ state_attr('weather.climacell_nowcast','wind_speed') }}"

    - name: "Climacell Wind Bearing"
      unique_id: climacell_wind_bearing
      icon: mdi:weather-windy
      unit_of_measurement: °
      state: "{{ state_attr('weather.climacell_nowcast','wind_bearing') }}"
