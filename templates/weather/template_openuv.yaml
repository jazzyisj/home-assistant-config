###############################################################################
## Templates - OpenUV # https://www.openuv.io/uvindex
###############################################################################
- binary_sensor:
    - name: 'OpenUV Connected'
      unique_id: openuv_connected
      icon: "{{ 'mdi:weather-sunny-alert' if is_state('binary_sensor.openuv_connected','on') else 'mdi:alert-circle' }}"
      device_class: connectivity
      state: "{{ is_number(states('sensor.current_uv_index')) }}"

    - name: 'OpenUV Connected Alert'
      unique_id: openuv_connected_alert
      icon: mdi:weather-sunny-alert
      state: >
        {{ is_state('binary_sensor.openuv_connected','off')
            and is_state('input_boolean.weather_alerts','on')
            and is_state('input_boolean.startup_pending','off') }}

    - name: 'UV Risk Alert'
      unique_id: uv_risk_alert
      state: >
        {{ states('sensor.uv_risk_today') in ['Very High','High']
            and is_state('input_boolean.weather_alerts','on')
            and is_state('input_boolean.startup_pending','off') }}
      availability: "{{ states('sensor.uv_risk_today')|lower not in ['unknown','unavailable','none'] }}"

- sensor:
    - name: 'UV Risk Today'
      unique_id: uv_risk_today
      icon: mdi:weather-sunny
      state: >
        {% set level = states('sensor.max_uv_index')|int(0) %}
        {% if is_number(level) %}
          {% if level < 3 %} Low
          {% elif level < 7 %} Moderate
          {% elif level < 9 %} High
          {% else %} Very High
          {% endif %}
        {% endif %}
      availability: "{{ is_number(states('sensor.max_uv_index')) }}"

    - name: 'UV Index'
      unique_id: uv_index
      icon: mdi:brightness-6
      state_class: measurement
      state: "{{ states('sensor.current_uv_index')|float('unknown') }}"
      availability: "{{ is_number(states('sensor.current_uv_index')) }}"
