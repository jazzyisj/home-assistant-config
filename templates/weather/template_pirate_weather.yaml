###############################################################################
## Templates -  Pirate Weather
###############################################################################
- trigger:
    - platform: homeassistant
      event: start

    - platform: event
      event_type: event_template_reloaded

    - platform: state
      entity_id: sensor.pirateweather_summary
      from:
        - unknown
        - unavailable

    - platform: state
      entity_id: sensor.pirateweather_summary
      to:
        - unknown
        - unavailable
  binary_sensor:
    - name: "PirateWeather Connected"
      unique_id: pirateweather_connected
      icon: mdi:weather-partly-snowy-rainy
      device_class: connectivity
      state: >
        {{ expand(integration_entities('pirateweather'))
            |rejectattr('state','in',['unknown','unavailable'])|list|count > 0 }}

- trigger:
    - platform: homeassistant
      event: start

    - platform: event
      event_type: event_template_reloaded

    - platform: state
      entity_id:
        - binary_sensor.pirateweather_connected
        - input_boolean.weather_alerts
      to:
        - "on"
        - "off"
  binary_sensor:
    - name: "PirateWeather Connected Alert"
      unique_id: pirateweather_connected_alert
      icon: mdi:weather-partly-snowy-rainy
      device_class: problem
      delay_on: 60
      state: >
        {{ is_state('binary_sensor.pirateweather_connected','off')
            and is_state('input_boolean.weather_alerts','on') }}
