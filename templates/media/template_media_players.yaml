###############################################################################
## Templates - Media Players
###############################################################################
- binary_sensor:
    - name: 'Volume Override'
      unique_id: volume_override
      icon: mdi:volume-vibrate
      state: >
        {{ is_state('input_boolean.volume_override','on')
            or is_state('binary_sensor.scene_active','on') }}

    - name: 'Media LED Alert'
      unique_id: media_led_alert
      state: >
        {{ is_state('switch.system_mute','on')
            or states('variable.tts_saved_messages')|int(0) > 0
            or is_state('binary_sensor.scene_active','on') }}

- sensor:
    - name: 'Media Light Color'
      unique_id: media_light_color
      state: >
        {% if is_state('input_boolean.media_color_light_sync','on') %}
            {% if is_state('light.dining_room_rgb_light','on') %}
              rgb{{ state_attr('light.dining_room_rgb_light','rgb_color') }}
            {% else %} var(--state-icon-color)
            {% endif %}
        {% else %} var(--state-icon-color)
        {% endif %}

    - name: 'Media Players'
      unique_id: media_players
      state: "{{ states.media_player|selectattr('attributes.type','in',['single','group'])|list|count }}"
      attributes:
        players: "{{ states.media_player|selectattr('attributes.type','in',['single','group'])|map(attribute='entity_id')|list }}"
        single: "{{ states.media_player|selectattr('attributes.type','eq','single')|map(attribute='entity_id')|list }}"
        group: "{{ states.media_player|selectattr('attributes.type','eq','group')|map(attribute='entity_id')|list }}"

    - name: 'All Speakers'
      unique_id: all_speakers # used by conditional media player display cards
      state:
        > # media player is on and is active radio/tts/alarm clock player or in player speaker group
        {% set media = 'media_player.all_speakers' %}
        {% if states(media) in ['playing','paused'] %}
          {% if media == states('sensor.tts_media_player') and is_state('input_boolean.tts_playing','on') %} tts
          {% elif media == states('sensor.alarm_clock_media_player') and is_state('binary_sensor.alarm_clock','on') %} alarm_clock
          {% elif media == states('sensor.spotify_media_player') and is_state('binary_sensor.spotify','on') %} spotify_hassio
          {% elif media == states('sensor.spotify_jason_media_player') and is_state('binary_sensor.spotify_jason','on') %} spotify_jason
          {% elif media == states('sensor.spotify_sheri_media_player') and is_state('binary_sensor.spotify_sheri','on') %} spotify_sheri
          {% elif media == states('sensor.radio_media_player') and is_state('binary_sensor.radio','on') %} radio
          {% elif media == states('sensor.youtube_media_player') and is_state('binary_sensor.youtube','on') %} youtube
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players','single'))|selectattr('attributes.all_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - name: 'Broadcast Speakers'
      unique_id: broadcast_speakers
      state: >
        {% set media = 'media_player.broadcast_speakers' %}
        {% if states(media) in ['playing','paused'] %}
          {% if media == states('sensor.tts_media_player') and is_state('input_boolean.tts_playing','on') %} tts
          {% elif media == states('sensor.alarm_clock_media_player') and is_state('binary_sensor.alarm_clock','on') %} alarm_clock
          {% elif media == states('sensor.spotify_media_player') and is_state('binary_sensor.spotify','on') %} spotify_hassio
          {% elif media == states('sensor.spotify_jason_media_player') and is_state('binary_sensor.spotify_jason','on') %} spotify_jason
          {% elif media == states('sensor.spotify_sheri_media_player') and is_state('binary_sensor.spotify_sheri','on') %} spotify_sheri
          {% elif media == states('sensor.radio_media_player') and is_state('binary_sensor.radio','on') %} radio
          {% elif media == states('sensor.youtube_media_player') and is_state('binary_sensor.youtube','on') %} youtube
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players','single'))|selectattr('attributes.broadcast_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - name: 'Music Speakers'
      unique_id: music_speakers
      state: >
        {% set media = 'media_player.music_speakers' %}
        {% if states(media) in ['playing','paused'] %}
          {% if media == states('sensor.tts_media_player') and is_state('input_boolean.tts_playing','on') %} tts
          {% elif media == states('sensor.alarm_clock_media_player') and is_state('binary_sensor.alarm_clock','on') %} alarm_clock
          {% elif media == states('sensor.spotify_media_player') and is_state('binary_sensor.spotify','on') %} spotify_hassio
          {% elif media == states('sensor.spotify_jason_media_player') and is_state('binary_sensor.spotify_jason','on') %} spotify_jason
          {% elif media == states('sensor.spotify_sheri_media_player') and is_state('binary_sensor.spotify_sheri','on') %} spotify_sheri
          {% elif media == states('sensor.radio_media_player') and is_state('binary_sensor.radio','on') %} radio
          {% elif media == states('sensor.youtube_media_player') and is_state('binary_sensor.youtube','on') %} youtube
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players','single'))|selectattr('attributes.music_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - name: 'Quiet Speakers'
      unique_id: quiet_speakers
      state: >
        {% set media = 'media_player.quiet_speakers' %}
        {% if states(media) in ['playing','paused'] %}
          {% if media == states('sensor.tts_media_player') and is_state('input_boolean.tts_playing','on') %} tts
          {% elif media == states('sensor.alarm_clock_media_player') and is_state('binary_sensor.alarm_clock','on') %} alarm_clock
          {% elif media == states('sensor.spotify_media_player') and is_state('binary_sensor.spotify','on') %} spotify_hassio
          {% elif media == states('sensor.spotify_jason_media_player') and is_state('binary_sensor.spotify_jason','on') %} spotify_jason
          {% elif media == states('sensor.spotify_sheri_media_player') and is_state('binary_sensor.spotify_sheri','on') %} spotify_sheri
          {% elif media == states('sensor.radio_media_player') and is_state('binary_sensor.radio','on') %} radio
          {% elif media == states('sensor.youtube_media_player') and is_state('binary_sensor.youtube','on') %} youtube
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players','single'))|selectattr('attributes.quiet_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - name: 'Night Speakers'
      unique_id: night_speakers
      state: >
        {% set media = 'media_player.night_speakers' %}
        {% if states(media) in ['playing','paused'] %}
          {% if media == states('sensor.tts_media_player') and is_state('input_boolean.tts_playing','on') %} tts
          {% elif media == states('sensor.alarm_clock_media_player') and is_state('binary_sensor.alarm_clock','on') %} alarm_clock
          {% elif media == states('sensor.spotify_media_player') and is_state('binary_sensor.spotify','on') %} spotify_hassio
          {% elif media == states('sensor.spotify_jason_media_player') and is_state('binary_sensor.spotify_jason','on') %} spotify_jason
          {% elif media == states('sensor.spotify_sheri_media_player') and is_state('binary_sensor.spotify_sheri','on') %} spotify_sheri
          {% elif media == states('sensor.radio_media_player') and is_state('binary_sensor.radio','on') %} radio
          {% elif media == states('sensor.youtube_media_player') and is_state('binary_sensor.youtube','on') %} youtube
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players','single'))|selectattr('attributes.night_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - name: 'Inside Speakers'
      unique_id: inside_speakers
      state: >
        {% set media = 'media_player.inside_speakers' %}
        {% if states(media) in ['playing','paused'] %}
          {% if media == states('sensor.tts_media_player') and is_state('input_boolean.tts_playing','on') %} tts
          {% elif media == states('sensor.alarm_clock_media_player') and is_state('binary_sensor.alarm_clock','on') %} alarm_clock
          {% elif media == states('sensor.spotify_media_player') and is_state('binary_sensor.spotify','on') %} spotify_hassio
          {% elif media == states('sensor.spotify_jason_media_player') and is_state('binary_sensor.spotify_jason','on') %} spotify_jason
          {% elif media == states('sensor.spotify_sheri_media_player') and is_state('binary_sensor.spotify_sheri','on') %} spotify_sheri
          {% elif media == states('sensor.radio_media_player') and is_state('binary_sensor.radio','on') %} radio
          {% elif media == states('sensor.youtube_media_player') and is_state('binary_sensor.youtube','on') %} youtube
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players','single'))|selectattr('attributes.inside_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - name: 'Living Room Speaker'
      unique_id: living_room_speaker
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.living_room_speaker' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Dining Room Hub'
      unique_id: dining_room_hub
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.dining_room_hub' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Bedroom Hub'
      unique_id: bedroom_hub
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.bedroom_hub' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Bathroom Speaker'
      unique_id: bathroom_speaker
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.bathroom_speaker' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Laundry Room Speaker'
      unique_id: laundry_room_speaker
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.laundry_room_speaker' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Garage Speaker'
      unique_id: garage_speaker
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.garage_speaker' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Living Room TV'
      unique_id: living_room_tv
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.living_room_tv' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Bedroom TV'
      unique_id: bedroom_tv
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.bedroom_tv' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Office TV'
      unique_id: office_tv
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.office_tv' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set youtube = states('sensor.youtube_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set youtube_group = state_attr('sensor.youtube_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = is_state('binary_sensor.spotify','on') %}
        {% set spotify_jason_on = is_state('binary_sensor.spotify_jason','on') %}
        {% set spotify_sheri_on = is_state('binary_sensor.spotify_sheri','on') %}
        {% set youtube_on = is_state('binary_sensor.youtube','on') %}

        {% if states(media) in ['on','home','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif youtube_on and youtube == media %}{% set on_value.value = 'youtube' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif youtube_on and is_state_attr(youtube,'type','group') %}
            {% for item in youtube_group %}
              {% if item == media %}{% set on_value.value = 'youtube_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Living Room Chromecast'
      unique_id: living_room_chromecast
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.living_room_chromecast' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_jason_media_player','off') %}
        {% set spotify_sheri_on = not is_state('spotify_sheri_media_player','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Office Chromecast'
      unique_id: office_chromecast
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.office_chromecast' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_jason_media_player','off') %}
        {% set spotify_sheri_on = not is_state('spotify_sheri_media_player','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - name: 'Deck Chromecast'
      unique_id: deck_chromecast
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.deck_chromecast' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_jason_media_player') %}
        {% set spotify_sheri = states('sensor.spotify_sheri_media_player') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set spotify_jason_group = state_attr('sensor.spotify_jason_media_player','players') %}
        {% set spotify_sheri_group = state_attr('sensor.spotify_sheri_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set tts_on = is_state('input_boolean.tts_playing','on') %}
        {% set alarm_on = is_state('binary_sensor.alarm_clock','on') %}
        {% set radio_on = is_state('binary_sensor.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_jason_media_player','off') %}
        {% set spotify_sheri_on = not is_state('spotify_sheri_media_player','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if tts_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif alarm_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif radio_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif tts_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif alarm_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_jason_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_sheri_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif radio_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}
