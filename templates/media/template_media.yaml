###############################################################################
## Templates - Media
###############################################################################
- binary_sensor:
    - name: 'Media On'
      unique_id: media_on
      icon: mdi:music-circle
      state: >
        {% set media_on = state_attr('binary_sensor.media_on','media_types') %}
        {% if media_on != none %}
          {{ media_on|count > 0 }}
        {% endif %}
      attributes:
        media_types: >
          {% set media_types = namespace(value=[]) %}
          {% if state_attr('sensor.media_types','media_types') != none %}
            {% for item in state_attr('sensor.media_types','media_types') %}
              {% if is_state('binary_sensor.' ~ item,'on') %}
                {% set media_types.value = media_types.value + [item] %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {{ media_types.value }}

    - name: 'Media LED Alert'
      unique_id: media_led_alert
      state: >
        {{ is_state('switch.system_mute','on')
            or states('variable.tts_saved_messages')|int(0) > 0
            or is_state('binary_sensor.scene_active','on') }}

    - name: 'Volume Override'
      unique_id: volume_override
      icon: mdi:volume-vibrate
      state: >
        {{ is_state('input_boolean.volume_override','on')
            or is_state('binary_sensor.scene_active','on') }}

- sensor:
    - name: 'Media Types'
      unique_id: media_types
      state: >
        {% set media_types = state_attr('sensor.media_types','media_types') %}
        {% if media_types != none %}
          {{ media_types|count }}
        {% else %} 0
        {% endif %}
      attributes:
        master_media_players: "{{ state_attr('group.master_media_players','entity_id') }}"
        media_types: >
          {% set media_types = namespace(value=[]) %}
          {% if state_attr('sensor.media_types','master_media_players') != none %}
            {% set media_players = state_attr('sensor.media_types','master_media_players') %}
            {% for item in media_players %}
              {% set media_types.value = media_types.value + [item.split('.')[1]] %}
            {% endfor %}
          {% endif %}
          {{ media_types.value }}

    - name: 'Media Light Color'
      unique_id: media_light_color
      state: >
        {% if is_state('input_boolean.media_color_light_sync','on') %}
            {% if is_state('light.dining_room_rgb_light','on') %}
              rgb{{ state_attr('light.dining_room_rgb_light','rgb_color') }}
            {% else %} var(--state-icon-color)
            {% endif %}
        {% else %} var(--state-icon-color)
        {% endif %}
