###############################################################################
## Templates - Media
###############################################################################
- binary_sensor:
    - name: "Media LED Alert"
      unique_id: media_led_alert
      state: >
        {{ is_state('switch.system_mute','on')
            or states('sensor.tts_saved_messages')|int(0) > 0
            or is_state('binary_sensor.scene_active','on') }}

    - name: "MASS Media"
      unique_id: mass_media
      icon: mdi:music-circle
      state: >
        {% set entities = expand(state_attr('binary_sensor.mass_media','entity_id'))
            |selectattr('state','in',['playing','paused','buffering'])
            |map(attribute='entity_id')|list %}
        {{ iif(is_state('input_boolean.resume_mass','on'),true,
            false if entities == none else entities|count > 0 ) }}
      attributes:
        entity_id: > #MASS
          {{ states.media_player
              |selectattr('attributes.app_id','defined')
              |selectattr('attributes.app_id','eq','mass')
              |map(attribute='entity_id')|list|sort }}

- sensor:
    - name: "Media Light Color"
      unique_id: media_light_color
      state: >
        {% if is_state('input_boolean.media_color_light_sync','on') %}
            {% if is_state('light.dining_room_light_rgb','on') %}
              rgb{{ state_attr('light.dining_room_light_rgb','rgb_color') }}
            {% else %} var(--state-icon-color)
            {% endif %}
        {% else %} var(--state-icon-color)
        {% endif %}
