###############################################################################
## Templates - Media
###############################################################################
- binary_sensor:
    - name: 'Media On'
      unique_id: media_on
      icon: mdi:music-circle
      state: >
        {% set media_on = state_attr('binary_sensor.media_on','media_types') %}
        {% if media_on != none %}
          {{ media_on|count > 0 }}
        {% endif %}
      attributes:
        media_types: >
          {% set media_types = namespace(value=[]) %}
          {% if state_attr('sensor.media_types','media_types') != none %}
            {% for item in state_attr('sensor.media_types','media_types') %}
              {% if is_state('binary_sensor.' ~ item,'on') %}
                {% set media_types.value = media_types.value + [item] %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {{ media_types.value }}

- sensor:
    - name: 'Media Types'
      unique_id: media_types
      state: >
        {% set media_types = state_attr('sensor.media_types','media_types') %}
        {% if media_types != none %}
          {{ media_types|count }}
        {% else %} 0
        {% endif %}
      attributes:
        master_media_players: >
          {{ states.media_player|selectattr('attributes.type','eq','master')
              |map(attribute='entity_id')|list }}
        media_types: >
          {% set media_types = namespace(value=[]) %}
          {% if state_attr('sensor.media_types','master_media_players') != none %}
            {% set players = state_attr('sensor.media_types','master_media_players') %}
            {% for item in players %}
              {% set media_types.value = media_types.value + [item.split('.')[1]] %}
            {% endfor %}
          {% endif %}
          {{ media_types.value }}
