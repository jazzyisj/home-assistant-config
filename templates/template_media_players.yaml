#NEW_MEDIA_PLAYER

- binary_sensor:
    - unique_id: media_led_alert
      state: >
        {{ is_state('input_boolean.mute_all','on')
            or is_state('switch.movie_mode','on')
            or is_state('switch.company_mode','on') }}

- sensor:
    - unique_id: media_players
      state: "{{ states.media_player|selectattr('attributes.type','in',['single','group'])|list|count }}"
      attributes:
        players: "{{ states.media_player|selectattr('attributes.type','in',['single','group'])|map(attribute='entity_id')|list }}"

    - unique_id: media_players_single
      state: "{{ states.media_player|selectattr('attributes.type','eq','single')|list|count }}"
      attributes:
        players: "{{ states.media_player|selectattr('attributes.type','eq','single')|map(attribute='entity_id')|list }}"

    - unique_id: media_player_groups
      state: "{{ states.media_player|selectattr('attributes.type','eq','group')|list|count }}"
      attributes:
        players: "{{ states.media_player|selectattr('attributes.type','eq','group')|map(attribute='entity_id')|list }}"

    - unique_id: all_speakers # used by conditional media player display cards
      state: > # media player is on and is active radio/tts/alarm clock player or in player speaker group
        {% set media = 'media_player.all_speakers' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% if states(media) in ['playing','paused'] %}
          {% if tts == media and is_state('input_boolean.tts_playing','on') %} tts
          {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
          {% elif spotify == media %} spotify_hassio
          {% elif spotify_jason == media %} spotify_jason
          {% elif spotify_sheri == media %} spotify_sheri
          {% elif radio == media and is_state('switch.radio','on') %} radio
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players_single','players'))|selectattr('attributes.all_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - unique_id: broadcast_speakers
      state: >
        {% set media = 'media_player.broadcast_speakers' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% if states(media) in ['playing','paused'] %}
          {% if tts == media and is_state('input_boolean.tts_playing','on') %} tts
          {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
          {% elif spotify == media %} spotify_hassio
          {% elif spotify_jason == media %} spotify_jason
          {% elif spotify_sheri == media %} spotify_sheri
          {% elif radio == media and is_state('switch.radio','on') %} radio
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players_single','players'))|selectattr('attributes.broadcast_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - unique_id: music_speakers
      state: >
        {% set media = 'media_player.music_speakers' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% if states(media) in ['playing','paused'] %}
          {% if tts == media and is_state('input_boolean.tts_playing','on') %} tts
          {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
          {% elif spotify == media %} spotify_hassio
          {% elif spotify_jason == media %} spotify_jason
          {% elif spotify_sheri == media %} spotify_sheri
          {% elif radio == media and is_state('switch.radio','on') %} radio
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players_single','players'))|selectattr('attributes.music_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - unique_id: quiet_speakers
      state: >
        {% set media = 'media_player.quiet_speakers' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% if states(media) in ['playing','paused'] %}
          {% if tts == media and is_state('input_boolean.tts_playing','on') %} tts
          {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
          {% elif spotify == media %} spotify_hassio
          {% elif spotify_jason == media %} spotify_jason
          {% elif spotify_sheri == media %} spotify_sheri
          {% elif radio == media and is_state('switch.radio','on') %} radio
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players_single','players'))|selectattr('attributes.quiet_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - unique_id: night_speakers
      state: >
        {% set media = 'media_player.night_speakers' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% if states(media) in ['playing','paused'] %}
          {% if tts == media and is_state('input_boolean.tts_playing','on') %} tts
          {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
          {% elif spotify == media %} spotify_hassio
          {% elif spotify_jason == media %} spotify_jason
          {% elif spotify_sheri == media %} spotify_sheri
          {% elif radio == media and is_state('switch.radio','on') %} radio
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players_single','players'))|selectattr('attributes.night_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - unique_id: inside_speakers
      state: >
        {% set media = 'media_player.inside_speakers' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% if states(media) in ['playing','paused'] %}
          {% if tts == media and is_state('input_boolean.tts_playing','on') %} tts
          {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
          {% elif spotify == media %} spotify_hassio
          {% elif spotify_jason == media %} spotify_jason
          {% elif spotify_sheri == media %} spotify_sheri
          {% elif radio == media and is_state('switch.radio','on') %} radio
          {% else %} on
          {% endif %}
        {% else %} off
        {% endif %}
      attributes:
        players: "{{ expand(state_attr('sensor.media_players_single','players'))|selectattr('attributes.inside_speakers','eq',true)|map(attribute='entity_id')|list }}"

    - unique_id: living_room_speaker
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.living_room_speaker' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: dining_room_display
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.dining_room_display' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: bedroom_display
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.bedroom_display' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: bathroom_speaker
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.bathroom_speaker' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: laundry_room_speaker
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.laundry_room_speaker' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: garage_speaker
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.garage_speaker' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: living_room_tv
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.living_room_tv' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: bedroom_tv
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.bedroom_tv' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: office_tv
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.office_tv' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: living_room_chromecast
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.living_room_chromecast' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: office_chromecast
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.office_chromecast' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}

    - unique_id: deck_chromecast
      state: >
        {% set on_value = namespace(value='on') %}
        {% set media = 'media_player.deck_chromecast' %}
        {% set radio = states('sensor.radio_media_player') %}
        {% set alarm = states('sensor.alarm_clock_media_player') %}
        {% set spotify_hassio = states('sensor.spotify_media_player') %}
        {% set spotify_jason = states('sensor.spotify_media_player_jazzyisj') %}
        {% set spotify_sheri = states('sensor.spotify_media_player_sherigagnon') %}
        {% set tts = states('sensor.tts_media_player') %}

        {% set radio_group = state_attr('sensor.radio_media_player','players') %}
        {% set spotify_hassio_group = state_attr('sensor.spotify_media_player','players') %}
        {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
        {% set tts_group = state_attr('sensor.tts_media_player','players') %}

        {% set t_on = is_state('input_boolean.tts_playing','on') %}
        {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
        {% set r_on = is_state('switch.radio','on') %}
        {% set spotify_hassio_on = not is_state('spotify_media_player_hassio','off') %}
        {% set spotify_jason_on = not is_state('spotify_media_player_jazzyisj','off') %}
        {% set spotify_sheri_on = not is_state('spotify_media_player_sherigagnon','off') %}

        {% if states(media) in ['on','playing','paused'] %}
          {% if t_on and tts == media %}{% set on_value.value = 'tts' %}
          {% elif a_on and alarm == media %}{% set on_value.value = 'alarm_clock' %}
          {% elif spotify_hassio_on and spotify_hassio == media %}{% set on_value.value = 'spotify_hassio' %}
          {% elif spotify_jason_on and spotify_jason == media %}{% set on_value.value = 'spotify_jason' %}
          {% elif spotify_sheri_on and spotify_sheri == media %}{% set on_value.value = 'spotify_sheri' %}
          {% elif r_on and radio == media %}{% set on_value.value = 'radio' %}
          {% elif t_on and is_state_attr(tts,'type','group') %}
            {% for item in tts_group %}
              {% if item == media %}{% set on_value.value = 'tts_group' %}{% endif %}
            {% endfor %}
          {% elif a_on and is_state_attr(alarm,'type','group') %}
            {% for item in alarm_group %}
              {% if item == media %}{% set on_value.value = 'alarm_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_hassio_on and is_state_attr(spotify_hassio,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_hassio_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_jason_on and is_state_attr(spotify_jason,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_jason_group' %}{% endif %}
            {% endfor %}
          {% elif spotify_sheri_on and is_state_attr(spotify_sheri,'type','group') %}
            {% for item in spotify_hassio_group %}
              {% if item == media %}{% set on_value.value = 'spotify_sheri_group' %}{% endif %}
            {% endfor %}
          {% elif r_on and is_state_attr(radio,'type','group') %}
            {% for item in radio_group %}
              {% if item == media %}{% set on_value.value = 'radio_group' %}{% endif %}
            {% endfor %}
          {% elif is_state('sensor.all_speakers','on') and media in state_attr('sensor.all_speakers','players')
              or is_state('sensor.broadcast_speakers','on') and media in state_attr('sensor.broadcast_speakers','players')
              or is_state('sensor.music_speakers','on') and media in state_attr('sensor.music_speakers','players')
              or is_state('sensor.quiet_speakers','on') and media in state_attr('sensor.quiet_speakers','players')
              or is_state('sensor.night_speakers','on') and media in state_attr('sensor.night_speakers','players')
              or is_state('sensor.inside_speakers','on') and media in state_attr('sensor.inside_speakers','players') %} group
          {% endif %}
          {{ on_value.value }}
        {% else %} off
        {% endif %}








