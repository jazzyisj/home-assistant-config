###############################################################################
## Template - ZWave
###############################################################################
- binary_sensor:
    - name: 'ZWave Network'
      unique_id: zwave_network
      icon: mdi:z-wave
      state: >
        {{ is_state('binary_sensor.z_wave_js_running','on')
            or is_state('binary_sensor.z_wave_js_to_mqtt_running','on') }}

    - name: 'ZWave Network Alert'
      unique_id: zwave_network_alert
      icon: mdi:z-wave
      delay_on: "{{ iif(is_state('binary_sensor.zwave_network_alert','unknown'),0,300) }}"
      state: "{{ is_state('binary_sensor.zwave_network','off') }}"
      availability: "{{ states('binary_sensor.zwave_network') in ['off','on'] }}"

    - name: 'ZWave Device Alert'
      unique_id: zwave_device_alert
      icon: mdi:z-wave
      delay_on: "{{ iif(is_state('binary_sensor.zwave_device_alert','unknown'),0,300) }}"
      state: "{{ states('sensor.offline_zwave_devices')|int(-1) > 0 }}"

- sensor:
    - name: 'ZWave Status'
      unique_id: zwave_status
      icon: mdi:z-wave
      state: >
        {% if is_state('binary_sensor.zwave_netowrk','off') %} severe
        {% else %} {{ iif(states('sensor.offline_zwave_devices')|int(-1) > 0,'warning','ok') }}
        {% endif %}

    - name: 'ZWave Devices'
      unique_id: zwave_devices
      icon: mdi:z-wave
      unit_of_measurement: devices
      state: >
        {% if state_attr('sensor.zwave_devices','entity_id')|lower not in ['unknown','unavailable','none'] %}
          {{ state_attr('sensor.zwave_devices','entity_id')|count }}
        {% endif %}
      attributes:
        entity_id: >
          {{ states.sensor|selectattr('attributes.type','eq','zwave_node_status')
              |map(attribute='entity_id')|list }}

    - name: 'Offline ZWave Devices'
      unique_id: offline_zwave_devices
      icon: mdi:z-wave
      unit_of_measurement: devices
      state: >
        {% if state_attr('sensor.offline_zwave_devices','entity_id')|lower not in ['unknown','unavailable','none'] %}
          {{ state_attr('sensor.offline_zwave_devices','entity_id')|count }}
        {% endif %}
      attributes:
        entity_id: >
          {{ states.sensor|selectattr('attributes.type','eq','zwave_node_status')
              |selectattr('state','ne','alive')|map(attribute='entity_id')|list }}
