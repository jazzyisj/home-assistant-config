###############################################################################
## Templates - Lock
###############################################################################
- binary_sensor:
    - name: 'Door Lock Jammed'
      unique_id: door_lock_jammed
      icon: "{{ iif(is_state('binary_sensor.door_lock_jammed','on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state: >
        {{ is_state('input_boolean.back_door_lock_jammed','on')
          or is_state('input_boolean.front_door_lock_jammed','on')
          or is_state('input_boolean.garage_door_lock_jammed','on')
          or is_state('input_boolean.side_door_lock_jammed','on') }}
    #BUG - lock jammed sensors don't reset
    #BUGFIX - use input booleans
    # {{ is_state('binary_sensor.back_door_lock_lock_jammed','on')
    #   or is_state('binary_sensor.front_door_lock_lock_jammed','on')
    #   or is_state('binary_sensor.garage_door_lock_lock_jammed','on')
    #   or is_state('binary_sensor.side_door_lock_lock_jammed','on') }}

    - name: 'Door Lock Failed' #BUG - lock failed sensors don't reset
      unique_id: door_lock_failed
      icon: "{{ iif(is_state('binary_sensor.door_lock_failed','on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state:
        '{{ false }}' #ISSUE how can we reset these sensors? >
        # {{ is_state('binary_sensor.back_door_lock_hardware_failure','on')
        #   or is_state('binary_sensor.front_door_lock_hardware_failure','on')
        #   or is_state('binary_sensor.garage_door_lock_hardware_failure','on')
        #   or is_state('binary_sensor.side_door_lock_hardware_failure','on') }}

    - name: 'Lock Keypad Disabled'
      unique_id: lock_keypad_disabled
      icon: "{{ iif(is_state('binary_sensor.lock_keypad_disabled','on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state: >
        {{ is_state('binary_sensor.back_door_lock_keypad_disabled','on')
            or is_state('binary_sensor.front_door_lock_keypad_disabled','on')
            or is_state('binary_sensor.garage_door_lock_keypad_disabled','on')
            or is_state('binary_sensor.side_door_lock_keypad_disabled','on') }}

    - name: 'Unavailable Lock'
      unique_id: unavailable_lock
      icon: "{{ iif(is_state('binary_sensor.unavailable_lock','on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state: >
        {{ not states('lock.back_door_lock') in ['locked','unlocked']
            or not states('lock.front_door_lock') in ['locked','unlocked']
            or not states('lock.side_door_lock') in ['locked','unlocked']
            or not states('lock.garage_door_lock') in ['locked','unlocked'] }}
- sensor:
    - name: 'Door Locks'
      unique_id: door_locks
      icon: >
        {% if is_state('binary_sensor.door_lock_jammed','on') %} mdi:lock-alert
        {% elif state_attr('sensor.door_locks','unlocked') != none %}
          {{ iif(state_attr('sensor.door_locks','unlocked')|count > 0,'mdi:home-lock-open','mdi:home-lock') }}
        {% else %} mdi:home-lock
        {% endif %}
      state: >
        {{ iif(expand('group.door_locks')|selectattr('state','in',
            ['unknown','unavailable'])|list|count > 0,'error','ok') }}
      attributes:
        unlocked: "{{ expand('group.door_locks')|selectattr('state','eq','unlocked')|map(attribute='entity_id')|list }}"
        locked: "{{ expand('group.door_locks')|selectattr('state','eq','locked')|map(attribute='entity_id')|list }}"

    - name: 'Side Door Lock Status'
      unique_id: mdi:account-lock
      icon: mdi:lock-smart
      state: "{{ states('input_text.side_door_lock_status') }}"
      availability: "{{ states('lock.side_door_lock') not in ['unknown','unavailable'] }}"

    - name: 'Back Door Lock Status'
      unique_id: back_door_lock_status
      icon: mdi:account-lock
      state: "{{ states('input_text.back_door_lock_status') }}"
      availability: "{{ states('lock.back_door_lock') not in ['unknown','unavailable'] }}"

    - name: 'Front Door Lock Status'
      unique_id: front_door_lock_status
      icon: mdi:account-lock
      state: "{{ states('input_text.front_door_lock_status') }}"
      availability: "{{ states('lock.front_door_lock') not in ['unknown','unavailable'] }}"

    - name: 'Garage Door Lock Status'
      unique_id: garage_door_lock_status
      icon: mdi:account-lock
      state: "{{ states('input_text.garage_door_lock_status') }}"
      availability: "{{ states('lock.garage_door_lock') not in ['unknown','unavailable'] }}"
