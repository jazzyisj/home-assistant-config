###############################################################################
## Templates - Lock
###############################################################################
- binary_sensor:
    #ISSUE this is not triggered if lock is locked by keypad or individually in UI
    #https://github.com/jazzyisj/home-assistant-config/issues/19
    #BUGFIX for jammed sensors not resetting
    - name: "Door Lock Malfunction"
      unique_id: door_lock_malfunction
      icon: "{{ iif(is_state(this.entity_id,'on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state: >
        {{ states.input_boolean|selectattr('entity_id','search','_door_lock_malfunction')
              |selectattr('state','eq','on')|list|count > 0
            or is_state('binary_sensor.unavailable_lock','on') }}

    - name: "Door Lock Jammed"
      unique_id: door_lock_jammed
      icon: "{{ iif(is_state(this.entity_id,'on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state:
        "{{ false }}" #BUG - lock jammed sensors don't reset? >
        # {{ states.binary_sensor|selectattr('entity_id','search','_door_lock_jammed')
        #     |selectattr('state','eq','on')|list|count > 0 }}

    - name: "Door Lock Failed" #BUG - lock failed sensors don't reset
      unique_id: door_lock_failed
      icon: "{{ iif(is_state(this.entity_id,'on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state:
        "{{ false }}" #BUG - lock failed sensors don't reset? >
        # {{ states.binary_sensor|selectattr('entity_id','search','_door_lock_hardware_failure')
        #     |selectattr('state','eq','on')|list|count > 0 }}

    - name: "Lock Keypad Disabled"
      unique_id: lock_keypad_disabled
      icon: "{{ iif(is_state('binary_sensor.lock_keypad_disabled','on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state: >
        {{ states.binary_sensor|selectattr('entity_id','search','_door_lock_keypad_disabled')
            |selectattr('state','eq','on')|list|count > 0 }}

    - name: "Unavailable Lock"
      unique_id: unavailable_lock
      icon: "{{ iif(is_state('binary_sensor.unavailable_lock','on'),'mdi:lock-alert','mdi:lock') }}"
      device_class: problem
      state: >
        {{ not states('lock.back_door_lock') in ['locked','unlocked']
            or not states('lock.front_door_lock') in ['locked','unlocked']
            or not states('lock.side_door_lock') in ['locked','unlocked']
            or not states('lock.garage_door_lock') in ['locked','unlocked'] }}
- sensor:
    - name: "Side Door Lock Status"
      unique_id: mdi:account-lock
      icon: mdi:lock-smart
      state: "{{ states('input_text.side_door_lock_status') }}"
      availability: "{{ states('lock.side_door_lock') not in ['unknown','unavailable'] }}"

    - name: "Back Door Lock Status"
      unique_id: back_door_lock_status
      icon: mdi:account-lock
      state: "{{ states('input_text.back_door_lock_status') }}"
      availability: "{{ states('lock.back_door_lock') not in ['unknown','unavailable'] }}"

    - name: "Front Door Lock Status"
      unique_id: front_door_lock_status
      icon: mdi:account-lock
      state: "{{ states('input_text.front_door_lock_status') }}"
      availability: "{{ states('lock.front_door_lock') not in ['unknown','unavailable'] }}"

    - name: "Garage Door Lock Status"
      unique_id: garage_door_lock_status
      icon: mdi:account-lock
      state: "{{ states('input_text.garage_door_lock_status') }}"
      availability: "{{ states('lock.garage_door_lock') not in ['unknown','unavailable'] }}"
