###############################################################################
## Templates - Device Tracker
###############################################################################
- binary_sensor:
    - name: 'Unknown Network Device Alert'
      unique_id: unknown_network_device_alert
      state: >
        {{ states('sensor.unknown_network_devices')|int(0) > 0
            and is_state('input_boolean.network_alerts','on')
            and is_state('input_boolean.startup_pending','off') }}

    - name: 'Bluetooth Alert' #NOTE this doesn't really detect if bluetooth actually running
      unique_id: bluetooth_alert
      icon: mdi:bluetooth-off
      state: >
        {{ state_attr('device_tracker.jlaptop_bt','source_type')|lower == 'none'
            and state_attr('device_tracker.jphone_bt','source_type')|lower == 'none'
            and state_attr('device_tracker.sphone_bt','source_type')|lower == 'none'
            and state_attr('device_tracker.stablet_bt','source_type')|lower == 'none'
            and is_state('input_boolean.startup_pending','off') }}

- sensor:
    - name: 'Unknown Network Devices'
      unique_id: unknown_network_devices
      icon: mdi:devices
      unit_of_measurement: devices
      state: "{{ states.device_tracker|selectattr('attributes.device_type','eq',null)|selectattr('state','eq','home')|list|count }}"
      attributes:
        total: "{{ states.device_tracker|selectattr('attributes.device_type','eq',null)|list|count }}"
        entities: "{{ states.device_tracker|selectattr('attributes.device_type','eq',null)|map(attribute='entity_id')|list }}"

    - name: 'Wireless Network Devices'
      unique_id: wireless_network_devices
      icon: mdi:access-point-network
      unit_of_measurement: devices
      state: "{{ states.device_tracker|selectattr('attributes.source_type','eq','router')|selectattr('attributes.device_type','eq','wireless')|selectattr('state','eq','home')|list|count }}"
      attributes:
        total: "{{ states.device_tracker|selectattr('attributes.source_type','eq','router')|selectattr('attributes.device_type','eq','wireless')|list|count }}"
        entities: "{{ states.device_tracker|selectattr('attributes.source_type','eq','router')|selectattr('attributes.device_type','eq','wireless')|map(attribute='entity_id')|list }}"

    - name: 'Wired Network Devices'
      unique_id: wired_network_devices
      icon: mdi:router-network
      unit_of_measurement: devices
      state: "{{ states.device_tracker|selectattr('attributes.source_type','eq','router')|selectattr('attributes.device_type','eq','wired')|selectattr('state','eq','home')|list|count }}"
      attributes:
        total: "{{ states.device_tracker|selectattr('attributes.source_type','eq','router')|selectattr('attributes.device_type','eq','wired')|list|count }}"
        entities: "{{ states.device_tracker|selectattr('attributes.source_type','eq','router')|selectattr('attributes.device_type','eq','wired')|map(attribute='entity_id')|list }}"

    - name: 'Bluetooth Devices'
      unique_id: bluetooth_devices
      icon: mdi:bluetooth-settings
      unit_of_measurement: devices
      state: "{{ states.device_tracker|selectattr('attributes.device_type','eq','bluetooth')|selectattr('state','eq','home')|list|count }}"
      attributes:
        total: "{{ states.device_tracker|selectattr('attributes.device_type','eq','bluetooth')|list|count }}"
        entities: "{{ states.device_tracker|selectattr('attributes.device_type','eq','bluetooth')|map(attribute='entity_id')|list }}"
