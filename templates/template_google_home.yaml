###############################################################################
## Templates - Google Home
###############################################################################
- sensor:
    - name: 'Bathroom Speaker Timer'
      unique_id: bathroom_speaker_timer
      icon: mdi:timer
      state: >
        {% set entity = 'sensor.bathroom_speaker_timers' %}
        {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
          {% set status = state_attr(entity,'timers')[0].status %}
          {% if status == 'set' %} active
          {% elif status == 'paused' %} paused
          {% elif status == 'waiting' %} waiting
          {% else %} idle
          {% endif %}
        {% endif %}
      attributes:
        duration: >
          {% set entity = 'sensor.bathroom_speaker_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].duration }}
          {% endif %}
        end_time: >
          {% set entity = 'sensor.bathroom_speaker_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].local_time_iso }}
          {% endif %}
        integration: google_home

    - name: 'Bedroom Display Timer'
      unique_id: bedroom_display_timer
      icon: mdi:timer
      state: >
        {% set entity = 'sensor.bedroom_display_timers' %}
        {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
          {% set status = state_attr(entity,'timers')[0].status %}
          {% if status == 'set' %} active
          {% elif status == 'paused' %} paused
          {% elif status == 'waiting' %} waiting
          {% else %} idle
          {% endif %}
        {% endif %}
      attributes:
        duration: >
          {% set entity = 'sensor.bedroom_display_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].duration }}
          {% endif %}
        end_time: >
          {% set entity = 'sensor.bedroom_display_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].local_time_iso }}
          {% endif %}
        integration: google_home

    - name: 'Dining Room Display Timer'
      unique_id: dining_room_display_timer
      icon: mdi:timer
      state: >
        {% set entity = 'sensor.dining_room_display_timers' %}
        {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
          {% set status = state_attr(entity,'timers')[0].status %}
          {% if status == 'set' %} active
          {% elif status == 'paused' %} paused
          {% elif status == 'waiting' %} waiting
          {% else %} idle
          {% endif %}
        {% endif %}
      attributes:
        duration: >
          {% set entity = 'sensor.dining_room_display_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].duration }}
          {% endif %}
        end_time: >
          {% set entity = 'sensor.dining_room_display_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].local_time_iso }}
          {% endif %}
        integration: google_home

    - name: 'Garage Speaker Timer'
      unique_id: garage_speaker_timer
      icon: mdi:timer
      state: >
        {% set entity = 'sensor.garage_speaker_timers' %}
        {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
          {% set status = state_attr(entity,'timers')[0].status %}
          {% if status == 'set' %} active
          {% elif status == 'paused' %} paused
          {% elif status == 'waiting' %} waiting
          {% else %} idle
          {% endif %}
        {% endif %}
      attributes:
        duration: >
          {% set entity = 'sensor.garage_speaker_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].duration }}
          {% endif %}
        end_time: >
          {% set entity = 'sensor.garage_speaker_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].local_time_iso }}
          {% endif %}
        integration: google_home

    - name: 'Laundry Room Speaker Timer'
      unique_id: laundry_room_speaker_timer
      icon: mdi:timer
      state: >
        {% set entity = 'sensor.laundry_room_speaker_timers' %}
        {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
          {% set status = state_attr(entity,'timers')[0].status %}
          {% if status == 'set' %} active
          {% elif status == 'paused' %} paused
          {% elif status == 'waiting' %} waiting
          {% else %} idle
          {% endif %}
        {% endif %}
      attributes:
        duration: >
          {% set entity = 'sensor.laundry_room_speaker_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].duration }}
          {% endif %}
        end_time: >
          {% set entity = 'sensor.laundry_room_speaker_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].local_time_iso }}
          {% endif %}
        integration: google_home

    - name: 'Living Room Speaker Timer'
      unique_id: living_room_speaker_timer
      icon: mdi:timer
      state: >
        {% set entity = 'sensor.living_room_speaker_timers' %}
        {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
          {% set status = state_attr(entity,'timers')[0].status %}
          {% if status == 'set' %} active
          {% elif status == 'paused' %} paused
          {% elif status == 'waiting' %} waiting
          {% else %} idle
          {% endif %}
        {% endif %}
      attributes:
        duration: >
          {% set entity = 'sensor.living_room_speaker_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].duration }}
          {% endif %}
        end_time: >
          {% set entity = 'sensor.living_room_speaker_timers' %}
          {% if state_attr(entity,'timers')|lower not in ['','[]','unknown','unavailable','none'] %}
            {{ state_attr(entity,'timers')[0].local_time_iso }}
          {% endif %}
        integration: google_home

    ###############################################################################
    ## Google Home - Next Alarm Sensors
    ###############################################################################
    - name: 'Dining Room Display Next Alarm'
      unique_id: dining_room_display_next_alarm
      icon: mdi:alarm
      state: > # > 24 hour away == 'off'
        {% if is_state('input_boolean.dining_room_display_alarm_enabled','off') %} off
        {% elif state_attr('sensor.dining_room_display_alarms','alarms')
            |lower not in ['','[]','unknown','unavailable','none'] %}
          {% set is_set = state_attr('sensor.dining_room_display_alarms','alarms')[0].status == 'set' %}
          {% set alm_ts = state_attr('sensor.dining_room_display_alarms','alarms')[0].fire_time %}
          {{ alm_ts|timestamp_custom('%Y-%m-%dT%H:%M:%S%z','unknown')
              if is_set and alm_ts - now().timestamp() < 86400 else 'off' }}
        {% else %} off
        {% endif %}
      attributes:
        12hour: >
          {% if states('sensor.dining_room_display_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.dining_room_display_next_alarm'))
              |as_timestamp('unknown')|timestamp_custom('%-I:%M %p','unknown') }}
          {% endif %}
        24hour: >
          {% if states('sensor.dining_room_display_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.dining_room_display_next_alarm'))
              |timestamp_custom('%H:%M','unknown') }}
          {% endif %}

    - name: 'Bedroom Display Next Alarm'
      unique_id: bedroom_display_next_alarm
      icon: mdi:alarm
      state: > # > 24 hour away == 'off'
        {% if is_state('input_boolean.bedroom_display_alarm_enabled','off') %} off
        {% elif state_attr('sensor.bedroom_display_alarms','alarms')
            |lower not in ['','[]','unknown','unavailable','none'] %}
          {% set is_set = state_attr('sensor.bedroom_display_alarms','alarms')[0].status == 'set' %}
          {% set alm_ts = state_attr('sensor.bedroom_display_alarms','alarms')[0].fire_time %}
          {{ alm_ts|timestamp_custom('%Y-%m-%dT%H:%M:%S%z','unknown')
              if is_set and alm_ts - now().timestamp() < 86400 else 'off' }}
        {% else %} off
        {% endif %}
      attributes:
        12hour: >
          {% if states('sensor.bedroom_display_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.bedroom_display_next_alarm'))
              |as_timestamp('unknown')|timestamp_custom('%-I:%M %p','unknown') }}
          {% endif %}
        24hour: >
          {% if states('sensor.bedroom_display_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.bedroom_display_next_alarm'))
              |timestamp_custom('%H:%M','unknown') }}
          {% endif %}

    - name: 'Living Room Speaker Next Alarm'
      unique_id: living_room_speaker_next_alarm
      icon: mdi:alarm
      state: > # > 24 hour away == 'off'
        {% if is_state('input_boolean.living_room_speaker_alarm_enabled','off') %} off
        {% elif state_attr('sensor.living_room_speaker_alarms','alarms')
            |lower not in ['','[]','unknown','unavailable','none'] %}
          {% set is_set = state_attr('sensor.living_room_speaker_alarms','alarms')[0].status == 'set' %}
          {% set alm_ts = state_attr('sensor.living_room_speaker_alarms','alarms')[0].fire_time %}
          {{ alm_ts|timestamp_custom('%Y-%m-%dT%H:%M:%S%z','unknown')
              if is_set and alm_ts - now().timestamp() < 86400 else 'off' }}
        {% else %} off
        {% endif %}
      attributes:
        12hour: >
          {% if states('sensor.living_room_speaker_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.living_room_speaker_next_alarm'))
              |as_timestamp('unknown')|timestamp_custom('%-I:%M %p','unknown') }}
          {% endif %}
        24hour: >
          {% if states('sensor.living_room_speaker_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.living_room_speaker_next_alarm'))
              |timestamp_custom('%H:%M','unknown') }}
          {% endif %}

    - name: 'Bathroom Speaker Next Alarm'
      unique_id: bathroom_speaker_next_alarm
      icon: mdi:alarm
      state: > # > 24 hour away == 'off'
        {% if is_state('input_boolean.bathroom_speaker_alarm_enabled','off') %} off
        {% elif state_attr('sensor.bathroom_speaker_alarms','alarms')
            |lower not in ['','[]','unknown','unavailable','none'] %}
          {% set is_set = state_attr('sensor.bathroom_speaker_alarms','alarms')[0].status == 'set' %}
          {% set alm_ts = state_attr('sensor.bathroom_speaker_alarms','alarms')[0].fire_time %}
          {{ alm_ts|timestamp_custom('%Y-%m-%dT%H:%M:%S%z','unknown')
              if is_set and alm_ts - now().timestamp() < 86400 else 'off' }}
        {% else %} off
        {% endif %}
      attributes:
        12hour: >
          {% if states('sensor.bathroom_speaker_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.bathroom_speaker_next_alarm'))
              |as_timestamp('unknown')|timestamp_custom('%-I:%M %p','unknown') }}
          {% endif %}
        24hour: >
          {% if states('sensor.bathroom_speaker_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.bathroom_speaker_next_alarm'))
              |timestamp_custom('%H:%M','unknown') }}
          {% endif %}

    - name: 'Garage Speaker Next Alarm'
      unique_id: garage_speaker_next_alarm
      icon: mdi:alarm
      state: > # > 24 hour away == 'off'
        {% if is_state('input_boolean.garage_speaker_alarm_enabled','off') %} off
        {% elif state_attr('sensor.garage_speaker_alarms','alarms')
            |lower not in ['','[]','unknown','unavailable','none'] %}
          {% set is_set = state_attr('sensor.garage_speaker_alarms','alarms')[0].status == 'set' %}
          {% set alm_ts = state_attr('sensor.garage_speaker_alarms','alarms')[0].fire_time %}
          {{ alm_ts|timestamp_custom('%Y-%m-%dT%H:%M:%S%z','unknown')
              if is_set and alm_ts - now().timestamp() < 86400 else 'off' }}
        {% else %} off
        {% endif %}
      attributes:
        12hour: >
          {% if states('sensor.garage_speaker_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.garage_speaker_next_alarm'))
              |as_timestamp('unknown')|timestamp_custom('%-I:%M %p','unknown') }}
          {% endif %}
        24hour: >
          {% if states('sensor.garage_speaker_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.garage_speaker_next_alarm'))
              |timestamp_custom('%H:%M','unknown') }}
          {% endif %}

    - name: 'Laundry Room Speaker Next Alarm'
      unique_id: laundry_room_speaker_next_alarm
      icon: mdi:alarm
      state: > # > 24 hour away == 'off'
        {% if is_state('input_boolean.laundry_room_speaker_alarm_enabled','off') %} off
        {% elif state_attr('sensor.laundry_room_speaker_alarms','alarms')
            |lower not in ['','[]','unknown','unavailable','none'] %}
          {% set is_set = state_attr('sensor.laundry_room_speaker_alarms','alarms')[0].status == 'set' %}
          {% set alm_ts = state_attr('sensor.laundry_room_speaker_alarms','alarms')[0].fire_time %}
          {{ alm_ts|timestamp_custom('%Y-%m-%dT%H:%M:%S%z','unknown')
              if is_set and alm_ts - now().timestamp() < 86400 else 'off' }}
        {% else %} off
        {% endif %}
      attributes:
        12hour: >
          {% if states('sensor.laundry_room_speaker_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.laundry_room_speaker_next_alarm'))
              |as_timestamp('unknown')|timestamp_custom('%-I:%M %p','unknown') }}
          {% endif %}
        24hour: >
          {% if states('sensor.laundry_room_speaker_next_alarm')
              |lower in ['','off','unknown','unavailable','none'] %} off
          {% else %}{{ as_datetime(states('sensor.laundry_room_speaker_next_alarm'))
              |timestamp_custom('%H:%M','unknown') }}
          {% endif %}
