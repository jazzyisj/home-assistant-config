###############################################################################
## ZWave Template Sensors
###############################################################################
- binary_sensor:
    - name: 'ZWave Network'
      unique_id: zwave_network
      icon: mdi:z-wave
      state: "{{ states('sensor.zwave_hub_node_status') == 'alive' }}"

    - name: 'Z-Wave Network Alert'
      unique_id: zwave_network_alert
      icon: mdi:z-wave
      delay_on:
        minutes: 5 # prevent triggers for temporary disconnections
      state: >
        {{ is_state('binary_sensor.zwave_hub_node_status','off')
            or states('sensor.offline_zwave_devices')|int(-1) > 0 }}

- sensor:
    # use zwave device group - zwave_node_status not available when entity is unavailable
    - name: 'Offline ZWave Devices'
      unique_id: offline_zwave_devices
      icon: mdi:z-wave
      state: >
        {% if state_attr('sensor.offline_zwave_devices','entities')|lower not in ['unknown','unavailable','none'] %}
          {{ state_attr('sensor.offline_zwave_devices','entities')|count }}
        {% endif %}
      attributes:
        entities: >
          {%- set devices = state_attr('group.zwave_devices','entity_id') %}
          {% set dead_devices = namespace(value=[]) %}
          {%- for item in devices %}
            {%- if states(item)|lower in ['unknown','unavailable','none'] %}
            {%- set dead_devices.value = dead_devices.value + [item] %}
          {%- endif %}
          {%- endfor %}
          {{ dead_devices.value }}
        total_devices: "{{ state_attr('group.zwave_devices','entity_id')|count }}"
