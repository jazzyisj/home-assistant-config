- binary_sensor:
    - unique_id: zwave_device_alert
      delay_on:
        minutes: 5 # prevent triggers for temporary disconnections
      state: "{{ states('sensor.offline_zwave_devices')|int > 0 }}"

- sensor:
    - unique_id: offline_zwave_devices
      name: Offline ZWave Devices
      icon: mdi:z-wave
      state: "{{ states.sensor|selectattr('attributes.type','eq','zwave_node_status')|selectattr('state','ne','alive')|list|count }}"
      attributes:
        entities: "{{ states.sensor|selectattr('attributes.type','eq','zwave_node_status')|selectattr('state','ne','alive')|map(attribute='entity_id')|list }}"
        total_devices: "{{ states.sensor|selectattr('attributes.type','eq','zwave_node_status')|list|count }}"