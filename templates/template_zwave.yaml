#######################################################################################################################
## ZWave Template Sensors
#######################################################################################################################
- binary_sensor:
    - unique_id: zwave_device_alert
      delay_on:
        minutes: 15 # prevent triggers for temporary disconnections
      state: > # total == 0, zwave network/integration down
        {{ states('sensor.offline_zwave_devices')|int > 0
            or state_attr('sensor.offline_zwave_devices','total_devices')| int == 0 }}

- sensor:
    - name: "Offline ZWave Devices"
      unique_id: offline_zwave_devices
      icon: mdi:z-wave
      state: "{{ states.sensor|selectattr('attributes.type','eq','zwave_node_status')|selectattr('state','ne','alive')|list|count }}"
      attributes:
        entities: "{{ states.sensor|selectattr('attributes.type','eq','zwave_node_status')|selectattr('state','ne','alive')|map(attribute='entity_id')|list }}"
        total_devices: "{{ states.sensor|selectattr('attributes.type','eq','zwave_node_status')|list|count }}"
