###############################################################################
## Templates - Spa
###############################################################################
- binary_sensor:
    - name: 'Balboa Connected'
      unique_id: balboa_connected
      icon: "{{ 'mdi:hot-tub' if is_state('binary_sensor.balboa_connected','on') else 'mdi:alert-circle' }}"
      device_class: connectivity
      #NOTE also device tracker, balboa controller goes off line periodically by design
      delay_off: 600
      state: >
        {{ not states('climate.spa')|lower in ['unknown','unavailable','none']
            or is_state('device_tracker.balboa_spa','home') }}

    - name: 'Balboa Connected Alert'
      unique_id: balboa_connected_alert
      icon: mdi:hot-tub
      state: >
        {{ is_state('binary_sensor.balboa_connected','off')
            and is_state('input_boolean.spa_alerts','on')
            and is_state('input_boolean.startup_pending','off') }}

    - name: 'Spa Low Temperature Alert'
      unique_id: spa_low_temperature_alert
      delay_on: 600 
      state: >
        {{ states('sensor.spa_temperature')|int(0) < states('input_number.spa_low_temperature_threshold')|int(0)
            and is_state('input_boolean.spa_alerts','on')
            and is_state('input_boolean.startup_pending','off') }}
      availability: "{{ is_number(states('sensor.spa_temperature')) }}"

- sensor:
    - name: 'Spa Temperature'
      unique_id: spa_temperature
      icon: mdi:thermometer
      device_class: temperature
      unit_of_measurement: 'Â°C'
      state: "{{ state_attr('climate.spa','current_temperature') }}"
      availability: "{{ is_number(state_attr('climate.spa','current_temperature')) }}"

    - name: 'Spa Target Temperature'
      unique_id: spa_target_temperature
      icon: mdi:thermometer
      device_class: temperature
      unit_of_measurement: 'Â°C'
      state: "{{ state_attr('climate.spa','temperature') }}"
      availability: "{{ is_number(state_attr('climate.spa','temperature')) }}"
