#######################################################################################################################
## Garage Climate Binary Sensors
#######################################################################################################################

- platform: template
  sensors:
#######################################################################################################################
## Garage Climate Extended Heat
#######################################################################################################################
    garage_extended_heat_alert:
      unique_id: garage_extended_heat_alert
      delay_on:
        minutes: 30
      value_template: >
        {{ is_state('input_boolean.garage_heat','on')
           or is_state('climate.garage_thermostat_mode','heating')
           and is_state('binary_sensor.alerts_enabled','on') }}

#######################################################################################################################
## Garage Climate Low Temp Alert
## - freeze protection on and less than freeze temp or heat on and less than set temp
## - + 5 buffer to reduce false alerts
## - sensor always on when heat first turned on (if outside temp < set temp)
#######################################################################################################################
    garage_low_temperature_alert: #OPTION use thermostat temp
      unique_id: garage_low_temperature_alert
      delay_on:
        minutes: 15 # let temp stabalize
      value_template: >
        {{ (is_state('input_boolean.garage_freeze_protection','on')
              and (states('sensor.garage_temperature')|int < states('input_number.garage_freeze_temperature')|int - 5 ))
            or (is_state('input_boolean.garage_heat','on')
              and (states('sensor.garage_temperature')|int < states('input_number.garage_heat_temperature')|int - 5 ))
            and is_state('binary_sensor.alerts_enabled','on') }}
      availability_template: "{{ states('sensor.garage_temperature') not in ['unknown','unavailable','none'] }}"

#######################################################################################################################
## Garage Climate High Temp Alert
## - heat on, furnace on, current temp > thermostat max_temp (+5)
## - heat off, freeze protection on, furnace on, current temp >  freeze temp (+ 5)
## - + 5 buffer to reduce false alerts
#######################################################################################################################
    garage_high_temperature_alert: #OPTION use thermostat temp
      unique_id: garage_high_temperature_alert
      delay_on:
        minutes: 5 # let temp stabalize
      value_template: >
        {{ (is_state('input_boolean.garage_heat','on')
              and is_state('climage.garage_thermostat','heating')
              and states('sensor.garage_temperature')|int > states('input_number.garage_heat_temperature')|int + 5 )
            or (is_state('input_boolean.garage_heat','off')
              and is_state('input_boolean.garage_freeze_protection','on')
              and is_state('climage.garage_thermostat','heating')
              and states('sensor.garage_temperature')|int > states('input_number.garage_freeze_temperature')|int + 5 )
            and is_state('binary_sensor.alerts_enabled','on') }}
      availability_template: "{{ states('sensor.garage_temperature') not in ['unknown','unavailable','none'] }}"