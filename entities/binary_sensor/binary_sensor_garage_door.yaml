#######################################################################################################################
## Garage Door Binary Sensors
#######################################################################################################################

- platform: template
  sensors:
#######################################################################################################################
## Garage Door Connected
#######################################################################################################################
    garage_door_connected:
      friendly_name: MyQ Garage Door
      unique_id: garage_door_connected
      icon_template: "{{ 'mdi:garage' if is_state('binary_sensor.garage_door_connected','on') else 'mdi:alert-circle' }}"
      device_class: connectivity
      value_template: >
        {{ is_state('binary_sensor.home_myq_gateway','on') and not states('cover.garage_door_opener') in ['unknown','unavailable','none'] }}

    garage_door_connected_alert:
      friendly_name: MyQ
      unique_id: garage_door_connected_alert
      icon_template: mdi:garage-alert
      value_template: "{{ is_state('binary_sensor.garage_door_connected','off') and is_state('binary_sensor.alerts_enabled','on') }}"

#######################################################################################################################
## Garage Door Open - if disconnected unknown state will default to false
#######################################################################################################################
    garage_door_open:
      friendly_name: Garage Door Open
      unique_id: garage_door_open
      icon_template: >
        {{ ('mdi:garage-alert' if is_state('binary-sensor.garage_door_open_alert','on')
             else 'mdi:garage-open') if is_state('binary_sensor.garage_door_open','on') else 'mdi:garage' }}
      device_class: garage_door
      value_template: "{{ states('cover.garage_door_opener') in ['opening','open','closing'] }}"
      availability_template: "{{ is_state('binary_sensor.garage_door_connected','on') and states('cover.garage_door_opener') not in ['unknown','unavailable','none'] }}"

    garage_door_open_alert:
      unique_id: garage_door_open_alert
      delay_on:
        minutes: 20
      value_template: "{{ is_state('binary_sensor.garage_door_open','on') and is_state('binary_sensor.alerts_enabled','on') }}"
