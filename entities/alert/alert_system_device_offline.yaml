#######################################################################################################################
## Alert - Device Offline
#######################################################################################################################
system_device_offline:
  name: "Device Offline"
  title: "Device Offline Alert"
  message: >
    {%- if states.sensor.offline_devices.attributes.entities is defined -%}
      {%- if states('sensor.offline_devices')|int == 0 -%}
        No offline devices.
      {%- else -%}
        {%- for device in state_attr('sensor.offline_devices','entities') -%}
        - {{ state_attr(device,'friendly_name')}}{%- if not loop.last -%}<bt>{%- endif -%}
        {%- endfor -%}
      {%- endif -%}
    {%- endif -%}
  entity_id: binary_sensor.device_offline_alert
  state: 'on'
  repeat: 1440
  can_acknowledge: true
  skip_first: false
  notifiers: jason
  data:
    tag: device_offline
    group: System
    channel: Alert
    importance: high
    vibrationPattern: '200, 200, 200, 200, 200, 200, 200'
    ledColor: !secret WARNING_COLOR
    priority: high
    ttl: 0
    timeout: 3600
    persistent: false
    sticky: false
    clickAction: /lovelace/system
    color: !secret WARNING_COLOR
    icon_url: !secret OFFLINE_ICON
    actions:
      - action: pause_device_offline
        title: Pause
      - action: close_device_offline
        title: Close

    # additional parameters for html5 push
    timestamp: "{{ as_timestamp(now()) }}"
    renotify: true
    silent: true
    requireInteraction: false
    url: /lovelace/system
    icon: !secret OFFLINE_ICON
    badge: !secret OFFLINE_BADGE

