#######################################################################################################################
## Alert - Occupancy Mode
#######################################################################################################################
presence_occupancy_mode:
  name: Occupancy Mode
  title: Occupancy Mode
  message: >-
    {%- if ( is_state('binary_sensor.someone_home','on') and is_state('alarm_control_panel.house','armed_away') )
      or ( is_state('binary_sensor.someone_home','off') and states('alarm_control_panel.house') in ['disarmed','armed_home'] ) %}
        {{ 'Someone' if is_state('binary_sensor.someone_home','on')  else  'Nobody' }} is home but the house alarm is {{ states('sensor.alarm_status') }}.
    {%- elif ( states('input_select.occupancy_mode') not in ['Night','Override'] and is_state('alarm_control_panel.house','armed_night') ) %}
       The house is in {{ states('input_select.occupancy_mode') }} mode but the alarm is {{ states('sensor.alarm_status') }}.
    {%- elif ( is_state('binary_sensor.someone_home','on') and states('input_select.occupancy_mode') in ['Away','Vacation'] )
      or ( is_state('binary_sensor.someone_home','off') and states('input_select.occupancy_mode') in ['Home','Guest','Night'] ) %}
        {{ 'Someone' if is_state('binary_sensor.someone_home','on') else 'Nobody' }} is home but the house is in {{ states('input_select.occupancy_mode') }} mode.
    {% endif %}
    Did you forget to
    {{- ' disarm ' if states('alarm_control_panel.house') in ['armed_night','armed_away']
      or is_state('binary_sensor.someone_home','on')  else  ' arm ' -}} the alarm,
    {{- ' or has your phone not connected to the network' if is_state('binary_sensor.someone_home','off') }}?
  entity_id: binary_sensor.occupancy_mode_alert
  state: 'on'
  repeat: 30
  can_acknowledge: true
  skip_first: false
  notifiers: mobile_app_jphone
  data:
    tag: occupancy_mode
    group: Alert
    channel: Alert
    importance: high
    timeout: 3600
    persistent: false
    sticky: false
    clickAction: /lovelace/presence
    color: !secret WARNING_COLOR
    icon_url: !secret HOME_ICON
    image: !secret HOME_IMAGE
    actions:
      - action: set_home_mode
        title: Home
      - action: set_away_mode
        title: Away