#######################################################################################################################
## Waste Collection Alert Off
#######################################################################################################################
waste_collection_alert_off:
  alias: 'Waste Collection Alert Off'
  description: 'Turn off next waste collection day alert.'
  icon: mdi:trash-can
  sequence:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_boolean.garbage_alert
              state: 'on'
          sequence:
            - service: input_boolean.turn_off
              target:
                entity_id: input_boolean.garbage_alert

        - conditions:
            - condition: state
              entity_id: input_boolean.recycle_alert
              state: 'on'
          sequence:
            - service: input_boolean.turn_off
              target:
                entity_id: input_boolean.recycle_alert

        - conditions:
            - condition: state
              entity_id: input_boolean.yardwaste_alert
              state: 'on'
          sequence:
            - service: input_boolean.turn_off
              target:
                entity_id: input_boolean.yardwaste_alert

#######################################################################################################################
## Waste Collection Alert
#######################################################################################################################
waste_collection_alert:
  alias: 'Waste Collection Alert'
  description: 'Send waste collection day notification.'
  icon: mdi:trash-can
  fields:
    waste_type:
      description: 'Waste type (garbage, recycle, yardwaste).'
      example: 'garbage'
    warning:
      description: 'Early warning for yard waste day.'
      example: 'true'
  variables:
    waste_title: "{{ waste_type|replace('_',' ')|title }}"
    warning: '{{ warning|default(false) }}'
  sequence:
    - service: notify.mobile
      data:
        title: '{{ waste_title }} Day'
        message: "{{  waste_title ~' Day is this week!' if warning else  waste_title ~' Day is tomorrow!' }}"
        data:
          tag: '{{ waste_type }}_collection'
          group: General
          channel: General
          importance: max
          ttl: 0
          priority: high
          timeout: 86400
          persistent: '{{ false if warning else true }}'
          clickAction: /lovelace/schedule
          color: !secret NOTIFY_COLOR
          icon_url: !secret WASTE_ICON_TEMPLATE
          image: !secret WASTE_IMAGE_TEMPLATE
          actions:
            - title: '{{ waste_title }} Done'
              action: '{{ waste_type }}_done'
