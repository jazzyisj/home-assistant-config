###############################################################################
## Reminder LED
###############################################################################
reminder_led:
  alias: 'Reminder LED'
  description: 'Set led notification.'
  mode: queued
  fields:
    reset:
      description: 'Reset LED'
      example: 'true'
  variables:
    reset: '{{ reset|default(false) }}'
    entities: "{{ state_attr('group.reminder_led','entity_id') }}"
    quiet: "{{ is_state('binary_sensor.quiet_time','on') }}"
    alert_state: >
      {% if is_state('alert.late_for_work_jason','on') %} late_work
      {% elif is_state('alert.late_for_work_sheri','on') %} late_work
      {% elif is_state('binary_sensor.workday_rain','on') %} rain_work
      {% elif is_state('alert.work_commute_jason','on') %} commute
      {% elif is_state('alert.work_commute_sheri','on') %} commute
      {% elif is_state('input_boolean.dexter_medication_active','on') %} dexter
      {% elif is_state('input_boolean.jason_medication_active','on') %} jason
      {% elif is_state('input_boolean.maddie_mealtime_active','on') %} maddie
      {% elif is_state('input_boolean.hot_tub_maintenance_active','on') %} hot_tub
      {% elif is_state('input_boolean.garbage_alert','on') %} garbage
      {% elif is_state('input_boolean.recycle_alert','on') %} recycle
      {% elif is_state('input_boolean.yardwaste_alert','on') %} yardwaste
      {% else %} off
      {% endif %}
    duration: 255
    color: > # change color confused with garage
      {% if alert_state == 'late_work' %} 5
      {% elif alert_state == 'rain_work' %} 170
      {% elif alert_state == 'commute' %} 20
      {% elif alert_state == 'dexter' %} 110
      {% elif alert_state == 'jason' %} 110
      {% elif alert_state == 'maddie' %} 110
      {% elif alert_state == 'hot_tub' %} 110
      {% elif alert_state == 'garbage' %} 35
      {% elif alert_state == 'recycle' %} 145
      {% elif alert_state == 'yardwaste' %} 85
      {% else %} blue
      {% endif %}
    brightness: "{{ 10 if alert_state != 'off' else 3 }}"
    effect: "{{ 'pulse' if alert_state != 'off' else 'off' }}"
  sequence:
    - if: "{{ alert_state == 'off' and not reset }}"
      then:
        - service: script.turn_on
          target:
            entity_id: script.led_reset
          data:
            variables:
              entities: '{{ entities }}'
      else:
        - service: script.turn_on
          target:
            entity_id: script.inovelli_led_control
          data:
            variables:
              entities: '{{ entities }}'
              duration: '{{ duration }}'
              color: '{{ color }}'
              brightness: '{{ brightness }}'
              effect: '{{ effect }}'
