###############################################################################
## Turn Light On
###############################################################################
turn_light_on:
  alias: "Turn Light On"
  description: "Turn light on."
  icon: mdi:lightbulb
  mode: parallel
  fields:
    light:
      description: "Light entity id"
      example: "light.dining_room_rgb_light"
  variables:
    switch: >
      {% set groups = states.group|selectattr('entity_id','search','group.adaptive_lighting_')|map(attribute='entity_id')|list %}
      {% for item in groups %}
        {% if light in state_attr(item,'entity_id') %}
          switch.adaptive_lighting_{{ item[24:] }}
        {% endif %}
      {% endfor %}
  sequence:
    - if:
        - condition: template
          value_template: "{{ switch != '' and is_state(switch,'on') }}"
      then:
        - service: adaptive_lighting.apply
          data:
            entity_id: "{{ switch }}"
            lights: "{{ light }}"
            transition: 2
            adapt_brightness: true
            adapt_color: true
            prefer_rgb_color: true
            turn_on_lights: true
      else:
        - service: light.turn_on
          target:
            entity_id: "{{ light }}"
          data:
            profile: "{{ iif(is_state('input_select.occupancy_mode','Night'),'default_dim','default') }}"
