###############################################################################
## Morning Lights #TODO
###############################################################################
morning_lights:
  alias: "Morning Lights"
  description: "Adjust lighting to morning settings."
  icon: mdi:home-lightbulb-outline
  max_exceeded: silent
  sequence:
    # - service: adaptive_lighting.set_manual_control
    #   data:
    #     entity_id: switch.adaptive_lighting_main_lights
    #     lights: &main_lights
    #       - light.bedroom_fan_light
    #       - light.dining_room_potlights
    #       - light.hallway_potlights
    #       - light.kitchen_potlights
    #       - light.living_room_fan_light
    #       - light.living_room_potlights
    #       - light.office_fan_light
    #       - light.office_potlights
    #     manual_control: true

    # - service: adaptive_lighting.set_manual_control
    #   data:
    #     entity_id: switch.adaptive_lighting_rgb_lights
    #     lights: &rgb_lights
    #       - light.bathroom_vanity_rgb_light
    #       - light.dining_room_rgb_light
    #     manual_control: true

    # - delay: 5 # allow manual to turn on

    - if:
        - condition: state
          entity_id: timer.bedroom_fan_light
          state: idle
      then:
        - if:
            - condition: state
              entity_id: switch.adaptive_lighting_bedroom_lights
              state: "on"
          then:
            - service: adaptive_lighting.apply
              data:
                entity_id: switch.adaptive_lighting_bedroom_lights
                lights: light.bedroom_fan_light
                transition: 2
                adapt_brightness: true
                turn_on_lights: true
          else:
            - service: light.turn_on
              target:
                entity_id: light.bedroom_fan_light
              data:
                profile: default_dim
                transition: 120

    - if:
        - condition: state
          entity_id: timer.dining_room_light
          state: idle
      then:
        - if:
            - condition: state
              entity_id: switch.adaptive_lighting_rgb_lights
              state: "on"
          then:
            - service: adaptive_lighting.apply
              data:
                entity_id: switch.adaptive_lighting_rgb_lights
                lights: light.dining_room_rgb_light
                transition: 2
                adapt_brightness: true
                adapt_color: true
                prefer_rgb_color: true
                turn_on_lights: true
          else:
            - service: light.turn_on
              target:
                entity_id: light.dining_room_rgb_light
              data:
                profile: default_dim
                transition: 120

    - if:
        - condition: state
          entity_id: timer.kitchen_potlights
          state: idle
      then:
        - if:
            - condition: state
              entity_id: switch.adaptive_lighting_main_lights
              state: "on"
          then:
            - service: adaptive_lighting.apply
              data:
                entity_id: switch.adaptive_lighting_main_lights
                lights: light.kitchen_potlights
                transition: 2
                adapt_brightness: true
                turn_on_lights: true
          else:
            - service: light.turn_on
              target:
                entity_id: light.kitchen_potlights
              data:
                profile: default_min
                transition: 120

    # delay before next set of lights
    - delay:
        minutes: 15

    - if: 
        - condition: state
          entity_id: timer.bedroom_fan_light
          state: idle

        - condition: state
          entity_id: switch.adaptive_lighting_bedroom_lights
          state: "off"
      then:
        - service: light.turn_on
          target:
            entity_id: light.bedroom_fan_light
          data:
            profile: default_low
            transition: 120

    - if:
        - condition: state
          entity_id: timer.living_room_fan_light
          state: idle
      then:
        - if:
            - condition: state
              entity_id: switch.adaptive_lighting_main_lights
              state: "on"
          then:
            - service: adaptive_lighting.apply
              data:
                entity_id: switch.adaptive_lighting_main_lights
                lights: light.living_room_fan_light
                transition: 2
                adapt_brightness: true
                turn_on_lights: true
          else:
            - service: light.turn_on
              target:
                entity_id: light.living_room_fan_light
              data:
                profile: default_dim
                transition: 120

        # - service: light.turn_on
        #   target:
        #     entity_id: light.living_room_fan_light
        #   data:
        #     brightness: 5

    - if:
        - condition: state
          entity_id: timer.kitchen_potlights
          state: idle
      then:
        - if:
            - condition: state
              entity_id: switch.adaptive_lighting_main_lights
              state: "on"
          then:
            - service: adaptive_lighting.apply
              data:
                entity_id: switch.adaptive_lighting_main_lights
                lights: light.kitchen_potlights
                transition: 2
                adapt_brightness: true
                turn_on_lights: true
          else:
            - service: light.turn_on
              target:
                entity_id: light.kitchen_potlights
              data:
                profile: default_low
                transition: 120

    - service: light.turn_on
      target:
        entity_id: light.kitchen_sink_light

    #SHERI - if:
    #     - condition: state
    #       entity_id: timer.office_potlights
    #       state: idle

    #     - condition: state
    #       entity_id: binary_sensor.work_today
    #       state: 'on'
    #   then:
    #     - service: light.turn_on
    #       target:
    #         entity_id: light.office_potlights
    #       data:
    #         profile: default_max

    # delay before next set of lights
    - delay:
        minutes: 15

    - if:
        - condition: state
          entity_id: timer.bedroom_fan_light
          state: idle

        - condition: state
          entity_id: switch.adaptive_lighting_bedroom_lights
          state: "off"
      then:
        - service: light.turn_on
          target:
            entity_id: light.bedroom_fan_light
          data:
            profile: default
            transition: 120

    - if:
        - condition: state
          entity_id: timer.living_room_fan_light
          state: idle

        - condition: state
          entity_id: switch.adaptive_lighting_main_lights
          state: "off"
      then:
        - service: light.turn_on
          target:
            entity_id: light.living_room_fan_light
          data:
            profile: default
            transition: 120

    - if:
        - condition: state
          entity_id: timer.kitchen_potlights
          state: idle

        - condition: state
          entity_id: switch.adaptive_lighting_main_lights
          state: "off"
      then:
        - service: light.turn_on
          target:
            entity_id: light.kitchen_potlights
          data:
            profile: default
            transition: 120

    # keep on until wake up is done
    - wait_template: "{{ is_state('script.waketime','off') }}"
      timeout:
        minutes: 60

    # - service: adaptive_lighting.set_manual_control
    #   data:
    #     entity_id: switch.adaptive_lighting_main_lights
    #     lights: *main_lights
    #     manual_control: false

    # - service: adaptive_lighting.set_manual_control
    #   data:
    #     entity_id: switch.adaptive_lighting_rgb_lights
    #     lights: *rgb_lights
    #     manual_control: false
