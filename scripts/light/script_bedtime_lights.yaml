###############################################################################
## Bedtime Lights
###############################################################################
bedtime_lights:
  alias: 'Bedtime Lights'
  description: 'Adjust lighting for bedtime.'
  sequence:
    - choose:
        - conditions:
            - condition: state
              entity_id: timer.living_room_light
              state: idle

            - condition: template
              value_template: > # light is off if brightness not a number
                {% if is_number(state_attr('light.living_room_light','brightness')) %}
                  {{ state_attr('light.living_room_light','brightness')|int(0) < 15 }}
                {% else %} true
                {% endif %}
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.living_room_light
              data:
                brightness: 100 #TEMP until new light
                transition: 3

    - choose:
        - conditions:
            - condition: state
              entity_id: timer.kitchen_potlights
              state: idle

            - condition: template
              value_template: >
                {% if is_number(state_attr('light.kitchen_potlights','brightness')) %}
                  {{ state_attr('light.kitchen_potlights','brightness')|int(0) < 10 }}
                {% else %} true
                {% endif %}
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.kitchen_potlights
              data:
                brightness: 10
                transition: 3

    - choose:
        - conditions:
            - condition: state
              entity_id: timer.dining_room_potlights
              state: idle

            - condition: template
              value_template: >
                {% if is_number(state_attr('light.dining_room_potlights','brightness')) %}
                  {{ state_attr('light.dining_room_potlights','brightness')|int(0) < 10 }}
                {% else %} true
                {% endif %}
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.dining_room_potlights
              data:
                brightness: 10
                transition: 3

    - choose:
        - conditions:
            - condition: state
              entity_id: timer.hallway_potlights
              state: idle

            - condition: template
              value_template: >
                {% if is_number(state_attr('light.hallway_potlights','brightness')) %}
                  {{ state_attr('light.hallway_potlights','brightness')|int(0) < 10 }}
                {% else %} true
                {% endif %}
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.hallway_potlights
              data:
                brightness: 10
                transition: 3
