#######################################################################################################################
## Arm Alarm
#######################################################################################################################
arm_alarm:
  alias: Arm Alarm
  description: Arm alarm.
  icon: mdi:alarm-bell
  fields:
    mode:
      description: Alarm arm mode.
      example: 'away'
    code:
      description: Alarm arm code.
      example: '1111'
    override:
      description: Bypass open sensors.
      example: 'true'
  sequence:
    - condition: template
      alias: Alarm not already armed
      value_template: "{{ not is_state('alarm_control_panel.master',mode) }}"

    - choose:
        - conditions:
            - condition: not
              alias: Alarm is not disarmed
              conditions:
                - condition: state
                  entity_id: alarm_control_panel.master
                  state: disarmed
          sequence:
            - service: script.disarm_alarm
              data:
                person: temp

    - choose:
        - conditions: "{{ override|default(false) }}"
          sequence:
            - service: alarmo.arm
              target:
                entity_id: alarm_control_panel.master
              data:
                mode: "{{ mode }}"
                code: !secret ALARMO_HA #ALARMO
                force: true # replaces code ALARMO_OVERRIDE so we can use HA user
                skip_delay: true

        - conditions: "{{ code is defined }}"
          sequence:
            - service: alarmo.arm
              data:
                entity_id: alarm_control_panel.master
                mode: "{{ mode }}"
                code: "{{ code }}"
      default:
        - service: alarmo.arm
          target:
            entity_id: alarm_control_panel.master
          data:
            mode: "{{ mode }}"
            code: !secret ALARMO_HA #ALARMO


