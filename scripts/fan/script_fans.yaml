#######################################################################################################################
## Fans Off - Ceiling Fans Only
#######################################################################################################################
fans_off:
  alias: "Fans Off"
  description: "Turn all ceiling fans off."
  icon: mdi:fan-off
  sequence:
    - service: browser_mod.toast
      data:
        message: "Turning off all ceiling fans."
        duration: 30000

    # turn off automation so we don't trigger device in use timers
    - service: automation.turn_off
      entity_id: group.ceiling_fan_in_use_automations

    - service: fan.turn_off
      target:
        entity_id: >
          {{ states.fan|selectattr('attributes.type','eq','ceiling_fan')
            |selectattr('state','eq','on')|map(attribute='entity_id')|list }}

    - delay: 2 # delay to allow devices to change state #ZWAVE fans are slow to report

    - service: automation.turn_on
      entity_id: group.ceiling_fan_in_use_automations

#######################################################################################################################
## Fans On - Ceiling Fans Only
#######################################################################################################################
fans_on:
  alias: "Fans On"
  description: "Turn all ceiling fans on to full speed."
  icon: mdi:fan
  sequence:
    - service: browser_mod.toast
      data:
        message: "Turning on all ceiling fans."
        duration: 30000

    # turn off automation so we don't trigger device in use timers
    - service: automation.turn_off
      entity_id: group.ceiling_fan_in_use_automations

    # state on/off to ensure speed set #ZWAVE device ready (state on/off)
    - service: fan.turn_on
      target:
        entity_id: >
          {{ states.fan|selectattr('attributes.type','eq','ceiling_fan')
            |selectattr('state','in',['on','off'])|map(attribute='entity_id')|list }}
      data:
        percentage: 100

    - delay: 2 # delay to allow devices to change state #ZWAVE fans are slow to report

    - service: automation.turn_on
      entity_id: group.ceiling_fan_in_use_automations
