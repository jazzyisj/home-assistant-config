#######################################################################################################################
## Waste Collection Alert
## - do not dismiss on all devices when closed - everyone must see it
#######################################################################################################################
waste_collection_alert:
  alias: "Waste Collection Alert"
  description: "Send waste collection day notification."
  icon: mdi:trash-can
  fields:
    pickup_type:
      description: "Waste type (garbage,recycle,yardwaste)."
      example: 'garbage'
  mode: single
  max_exceeded: silent
  sequence:
    - service: notify.everyone
      data:
        title: &waste_title "{{ pickup_type }} Day"
        message: &waste_message "{{ pickup_type }} Day is tomorrow!."
        data:
          tag: &waste_tag waste_collection
          group: General
          channel: General
          importance: normal
          vibrationPattern: '100, 100, 100'
          ledColor: !secret NOTIFY_COLOR
          priority: &waste_priority high
          ttl: &waste_ttl 0
          timeout: 86400
          persistent: true
          clickAction: &waste_url /lovelace/schedule
          color: !secret NOTIFY_COLOR
          icon_url: &waste_icon !secret WASTE_ICON_TEMPLATE
          image: &waste_image !secret WASTE_IMAGE_TEMPLATE
          actions:
            - title: "{{ pickup_type }} Done"
              action: close_waste_collection

    - choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.jason_home
              state: 'on'

            - condition: state
              entity_id: input_select.occupancy_mode
              state: Home

          sequence:
            - service: notify.push
              data:
                title: *waste_title
                message: *waste_message
                target: jlaptop
                data:
                  tag: *waste_tag
                  timestamp: "{{ as_timestamp(now()) }}"
                  priority: *waste_priority
                  ttl: *waste_ttl
                  renotify: true
                  silent: true
                  requireInteraction: false
                  url: *waste_url
                  image: *waste_image
                  icon: *waste_icon
                  badge: !secret WASTE_BADGE_TEMPLATE
                  actions:
                    - title: "{{ pickup_type }} Done"
                      action: close_waste_collection