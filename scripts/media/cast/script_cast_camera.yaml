cast_camera:
  alias: "Cast Camera"
  mode: restart
  fields:
    camera:
      description: "Camera slug"
      example: "front_door"
  trace:
    stored_traces: 20
  sequence:
    - enabled: false #DISABLED cuts out playing media
      service: cast.show_lovelace_view
      data:
        dashboard_path: lovelace-cast
        entity_id: media_player.dining_room_hub
        view_path: "{{ camera }}"

    - enabled: false #DISABLED cuts out playing media
      service: cast.show_lovelace_view
      data:
        dashboard_path: lovelace-cast
        entity_id: media_player.bedroom_hub
        view_path: "{{ camera }}"

    # turn kiosk screen on, turn off screensaver
    - service: switch.turn_on
      target:
        entity_id: switch.fire_tablet_screen

    - service: switch.turn_off
      target:
        entity_id: switch.fire_tablet_screensaver

    - service: button.press
      target:
        entity_id: button.fire_tablet_bring_to_foreground

    - service: browser_mod.navigate
      data:
        path: "/lovelace/{{ camera|replace('_','-') }}-camera"
        browser_id:
          - kiosk_internal
          - jlaptop_chrome_internal

    - delay: 60

    - wait_template: "{{ is_state('binary_sensor.' ~ camera ~ '_frigate_all_occupancy','off') }}"
      timeout: 300

    - if: "{{ states('sensor.kiosk_internal_browser_path') == '/lovelace/' ~ camera|replace('_','-') ~ '-camera' }}"
      then:
        - service: browser_mod.navigate
          data:
            path: /ui-kiosk/home
            browser_id: kiosk_internal

    - if: "{{ states('sensor.jlaptop_chrome_internal_browser_path') == '/lovelace/' ~ camera|replace('_','-') ~ '-camera' }}"
      then:
        - service: browser_mod.navigate
          data:
            path: /lovelace/home
            browser_id: jlaptop_chrome_internal

    # stop casting
    - enabled: false #DISABLED cuts out playing media
      service: media_player.turn_off
      target:
        entity_id:
          - media_player.dining_room_hub
          - media_player.bedroom_hub
