#######################################################################################################################
## Radio Play
#######################################################################################################################
radio_play:
  alias: "Radio Play"
  description: "Play streaming radio."
  icon: mdi:radio
  max_exceeded: error
  fields:
    playlist:
      description: ""
      example: ""
    media_player:
      description: ""
      example: ""
    title:
      description: ""
      example: ""
    thumb:
      description: ""
      example: ""
  variables:
    playlist: "{{ playlist|default(states('input_select.radio_playlist')) }}"
    media_player: "{{ media_player|default(states('sensor.radio_media_player')) }}"
    content_id: >
      {% for item in state_attr('sensor.streaming_radio_stations','stations') -%}
        {% if is_state('input_select.radio_playlist',item.name) %}
          {{ item.url }}
        {% endif %}
      {% endfor %}
    title: "{{ title if title not in ['',empty] else playlist }}"
    thumb: >
      {% if thumb not in ['',empty] %}{{ thumb }}
      {% else %}
        {% set img = namespace(url='') %}
        {% for item in state_attr('sensor.streaming_radio_stations','stations') -%}
          {% if is_state('input_select.radio_playlist',item.name) %}
            {% set img.url = item.image_url %}
          {% else %}
          {% endif %}
        {% endfor %}
        {{ img.url if img.url != '' else '/local/images/media/radio.png' }}
      {% endif %}
  sequence:
    - service: media_player.play_media
      target:
        entity_id: "{{ media_player }}"
      data:
        media_content_id: "{{ content_id }}"
        media_content_type: music
        extra:
          title: "{{ playlist }}"
          thumb: "{{ thumb }}"
