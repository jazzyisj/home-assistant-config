###############################################################################
## Pause Media Players
###############################################################################
media_players_pause:
  alias: 'Media Players Pause'
  description: 'Pause media players.'
  icon: mdi:play-box-multiple-outline
  mode: restart
  fields:
    entity_id:
      description: 'Media players to pause.'
      example: 'media_player.dining_room_hub'
  variables:
    media_players: > #BITWISE
      {% set media_players = entity_id|default(state_attr('group.media_play_media_players','entity_id')) %}
      {% set media_players = expand(media_players)|map(attribute='entity_id')|list %}
      {% set players = namespace(entity_id=[]) %}
      {% for item in states.media_player|selectattr('state','eq','playing') %}
        {% if item.attributes.supported_features|bitwise_and(1) %}
          {% set players.entity_id = players.entity_id + [item.entity_id] %}
        {% endif %}
      {% endfor %}
      {{ players.entity_id }}
  sequence:
    - condition: template
      value_template: '{{ media_players|count > 0 }}'

    - service: media_player.media_pause
      target:
        entity_id: '{{ media_players }}'
