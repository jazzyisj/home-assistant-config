###############################################################################
## Pause Media Players
###############################################################################
media_players_pause:
  alias: 'Media Players Pause'
  description: 'Pause media players.'
  icon: mdi:play-box-multiple-outline
  mode: restart
  fields:
    media_players:
      description: 'Media players to pause.'
      example: 'media_player.dining_room_hub'
  sequence:
    #2022.4
    # 2022-03-31 23:48:37 ERROR (MainThread) [homeassistant.components.script.media_players_pause] Media Players Pause: Error executing script. Error for call_service at pos 3: Entity media_player.living_room_chromecast does not support this service.
    # 2022-03-31 23:48:37 ERROR (MainThread) [homeassistant.components.automation.media_player_auto_pause] [Media Player] Auto Pause: Error executing script. Error for call_service at pos 1: Entity media_player.living_room_chromecast does not support this service.
    # 2022-03-31 23:48:37 ERROR (MainThread) [homeassistant.components.automation.media_player_auto_pause] Error while executing automation automation.media_player_auto_pause: Entity media_player.living_room_chromecast does not support this service.
    - variables: #VAR variables in sequence to override field
        media_players: >
          {% set media_players = media_players|default(state_attr('group.media_play_media_players','entity_id')) %}
          {% if media_players != none and (media_players is iterable and (media_players is not string and media_players is not mapping)) %}
            {% set media_players = [media_players] %}
          {% endif %}
          {{ expand(media_players)|selectattr('state','eq','playing')|map(attribute='entity_id')|list }}

    - condition: template
      value_template: '{{ media_players|count > 0 }}'

    - service: media_player.media_pause
      target:
        entity_id: '{{ media_players }}'
