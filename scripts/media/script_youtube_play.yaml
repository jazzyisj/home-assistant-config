###############################################################################
## Youtube Play

# media_content_id:
#   playlist <- normal
#   channel
#   vid_channel
#   album
#   track
#   history
#   user_tracks
#   user_album
#   user_artist

###############################################################################
youtube_play:
  alias: 'Youtube Play'
  description: 'Play Youtube media.'
  icon: mdi:youtube
  max_exceeded: error
  fields:
    playlist:
      description: 'Playlist to play on Youtube.'
      example: 'Epic Classic Rock'
    media_player:
      description: 'Youtube play media player entity_id.'
      example: 'media_player.dining_room_hub'
    resume:
      description: 'Resume media play option.'
      example: 'playlist'
  variables:
    playlist: "{{ playlist|default(states('select.youtube_playlist')) }}"
    media_player: "{{ media_player|default(states('sensor.youtube_media_player')) }}"
    resume: '{{ resume|default(false) }}'
    content_id: >
      {% for item in state_attr('sensor.youtube_playlists','playlists') -%}
        {% if item.name == playlist %}
          {{ item.uri }}
        {% endif %}
      {% endfor %}
    content_type: >
      {% for item in state_attr('sensor.youtube_playlists','playlists') -%}
        {% if item.name == playlist %}
          {{ item.type }}
        {% endif %}
      {% endfor %}
  sequence:
    - choose:
        - conditions: "{{ resume in ['tts','alarm_clock'] }}"
          sequence:
            - service: ytube_music_player.call_method
              target:
                entity_id: media_player.ytube_music_player
              data:
                command: interrupt_resume
      default:
        - condition: template
          alias: 'Valid content id and content type'
          value_template: "{{ content_id != '' and content_type != '' }}"

        - service: media_player.select_source
          target:
            entity_id: media_player.ytube_music_player
          data:
            source: '{{ media_player }}'

        - service: media_player.play_media
          target:
            entity_id: media_player.ytube_music_player
          data:
            media_content_id: '{{ content_id }}'
            media_content_type: '{{ content_type }}'
