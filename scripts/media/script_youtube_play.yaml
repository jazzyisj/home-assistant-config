#######################################################################################################################
## Youtube Play
#######################################################################################################################
youtube_play:
  alias: "Youtube Play"
  description: "Play Youtube media."
  icon: mdi:youtube
  max_exceeded: error
  fields:
    playlist:
      description: "Playlist to play on Youtube."
      example: "Epic Classic Rock"
    device:
      description: "Device name to play Youtube on."
      example: "Dining Room Display"
    resume:
      description: "Resume media play option."
      example: "playlist"
  variables:
    playlist: "{{ playlist|default(states('input_select.youtube_playlist')) }}"
    device: "{{ device|default(states('input_select.youtube_player_source')) }}"
    resume: "{{ resume|default(false) }}"
    content_id: >
      {% for item in state_attr('sensor.youtube_playlists','playlists') -%}
        {% if item.name == playlist %}
          {{ item.uri }}
        {% endif %}
      {% endfor %}
    content_type: >
      {% for item in state_attr('sensor.youtube_playlists','playlists') -%}
        {% if item.name == playlist %}
          {{ item.type }}
        {% endif %}
      {% endfor %}
  sequence:
    - choose:
        - conditions: "{{ resume in ['tts','alarm_clock'] }}"
          sequence:
            - service: ytube_music_player.call_method
              target:
                entity_id: media_player.youtube
              data:
                command: interrupt_resume
      default:
        - service: media_player.play_media #ISSUE STOP command requested but no session is active
          target:
            entity_id: media_player.youtube
          data:
            media_content_id: "{{ content_id }}"
            media_content_type:  "{{ content_type }}"
