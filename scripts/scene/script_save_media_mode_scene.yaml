#######################################################################################################################
## Save Media Mode Scene #NEW_LIGHT
#######################################################################################################################
save_media_mode_scene:
  alias: "Save Media Mode Scene"
  description: "Save scene to restore when media mode turns off."
  icon: mdi:home-lightbulb-outline
  fields:
    media_mode:
      description: "Media mode name."
      example: movie_mode
  sequence:
    - service: scene.create
      data:
        scene_id: "before_{{ media_mode }}"
        entities:
          media_player.living_room_tv:
            state: >
              {% set state = states('media_player.living_room_tv') %}
              {{ 'off' if state|lower in ['unknown','unavailable','none'] else state }}
            source: "{{ state_attr('media_player.living_room_tv','source') }}"
            volume_level: "{{ state_attr('media_player.living_room_tv','volume_level') }}"

          switch.radio:
            state: "{{ states('switch.radio') }}"

          switch.spotify:
            state: "{{ states('switch.spotify') }}"

          input_boolean.bedtime_delayed:
            state: "{{ states('input_boolean.bedtime_delayed') }}"

          input_boolean.volume_override:
            state: "{{ states('input_boolean.volume_override') }}"

          input_boolean.mute_all:
            state: "{{ states('input_boolean.mute_all') }}"

          light.living_room_pot_lights:
            state: >
              {% set state = states('light.living_room_pot_lights') %}
              {{ 'off' if state|lower in ['unknown','unavailable','none'] else state }}
            brightness: "{{ state_attr('light.living_room_pot_lights','brightness')|int }}"

          light.living_room_cove_light:
            state: >
              {% set state = states('light.living_room_cove_light') %}
              {{ 'off' if state|lower in ['unknown','unavailable','none'] else state }}
            brightness: "{{ state_attr('light.living_room_cove_light','brightness')|int }}"

          light.kitchen_potlights:
            state: >
              {% set state = states('light.kitchen_potlights') %}
              {{ 'off' if state|lower in ['unknown','unavailable','none'] else state }}
            brightness: "{{ state_attr('light.kitchen_potlights','brightness')|int }}"

          light.kitchen_sink_light:
            state:  >
              {% set state = states('light.kitchen_sink_light') %}
              {{ 'off' if state|lower in ['unknown','unavailable','none'] else state }}

          light.dining_room_potlights:
            state:  >
              {% set state = states('light.dining_room_potlights') %}
              {{ 'off' if state|lower in ['unknown','unavailable','none'] else state }}
            brightness: "{{ state_attr('light.dining_room_potlights','brightness')|int }}"

          light.dining_room_rgb_light:
            state:  >
              {% set state = states('light.dining_room_rgb_light') %}
              {{ 'off' if state|lower in ['unknown','unavailable','none'] else state }}
            brightness: "{{ state_attr('light.dining_room_rgb_light','brightness')|int }}"
            rgb_color: "{{ state_attr('light.dining_room_rgb_light','rgb_color') }}"

          light.upstairs_hallway_potlights:
            state:  >
              {% set state = states('light.upstairs_hallway_potlights') %}
              {{ 'off' if state|lower in ['unknown','unavailable','none'] else state }}
            brightness: "{{ state_attr('light.upstairs_hallway_potlights','brightness')|int }}"

