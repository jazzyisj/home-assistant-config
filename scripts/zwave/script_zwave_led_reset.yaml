##################################################################################################
## ZWave LED Reset
##################################################################################################
zwave_led_reset:
  alias: "ZWave LED Reset"
  description: "Clear LED notifications."
  icon: mdi:home-lightbulb-outline
  mode: restart
  variables:
    led_entities: "{{ states.zwave|selectattr('attributes.notify_led','eq',true)|map(attribute='entity_id')|list }}"
    entity: none
  sequence:
    - repeat:
        while:
          - condition: template
            value_template: "{{ repeat.index <= led_entities|count }}"

        sequence:
          - variables:
              entity: "{{ led_entities[repeat.index-1] }}"

          - condition: template
            value_template: "{{ is_state(entity,'ready') }}"

          - service: zwave.set_config_parameter
            data:
              node_id: "{{ state_attr(entity,'node_id')|int }}"
              parameter: "{{ 8 if is_state_attr(entity,'attributes.type','switch') else 16 }}"
              size: 4
              value: 16714241 # clear notification