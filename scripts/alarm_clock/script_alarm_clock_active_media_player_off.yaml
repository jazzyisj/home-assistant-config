#######################################################################################################################
## Active Alarm Clock Media Player Off
## active_media_player_alarm_clock populated during alarm_clock_play
## stores active playing alarm clock media player
## used for media player display sensors and turning off current media player before starting new media player
## media player sensor will have already changed to new value if changed
# #######################################################################################################################
alarm_clock_active_media_player_off:
  alias: Alarm Clock Active Media Player Off
  description: Turn the current alarm clock media player off.
  icon: mdi:alarm-note-off
  mode: restart
  sequence:
    # make sure active_media_player_alarm_clock is a valid media player
    - condition: template
      value_template: "{{ states('input_text.active_media_player_alarm_clock') in state_attr('group.media_players','entity_id') }}"

    #NOTE broswer players/chromecast don't turn off so stop play first
    - choose:
        - conditions:
            - condition: template
              value_template:  "{{ is_state(states('input_text.active_media_player_alarm_clock'), 'playing') }}"

          sequence:
            - service:  media_player.media_stop
              data:
                entity_id: "{{ states('input_text.active_media_player_alarm_clock') }}"

    # turn off the active media player
    - service: media_player.turn_off
      data:
        entity_id: "{{ states('input_text.active_media_player_alarm_clock') }}"

    - service: input_text.set_value
      data:
        entity_id: input_text.active_media_player_alarm_clock
        value: cleared