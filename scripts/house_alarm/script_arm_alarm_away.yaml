#######################################################################################################################
## Arm Alarm Away
#######################################################################################################################
arm_alarm_away:
  alias: Arm Alarm Away
  description: Arm alarm in away mode.
  icon: mdi:alarm-bell
  fields:
    set_mode:
      description: Set occupancy mode
      example: 'true'
  mode: single
  sequence:
    - choose:
        - conditions:
            - condition: state
              entity_id: alarm_control_panel.house
              state: triggered

          sequence:
            - service: browser_mod.toast
              data:
                duration: 30000
                message: Alarm could not be armed.

      default:
        - service: lock.lock #VIRTUAL
          entity_id: all

        - choose:
            - conditions:
                - condition: not
                  conditions:
                    - condition: state
                      entity_id: alarm_control_panel.house
                      state: disarmed

              sequence:
                - service: script.disarm_alarm_temp

        - service: alarm_control_panel.alarm_arm_away
          data:
            entity_id: alarm_control_panel.house
            #OPTION code: override # prevents pending mode

        - condition: state
          entity_id: input_boolean.alarm_auto_arming
          state: 'off'

        - condition: template
          value_template: "{{ set_mode }}"

        - service: input_select.select_option
          data:
            entity_id: input_select.occupancy_mode
            option: Away