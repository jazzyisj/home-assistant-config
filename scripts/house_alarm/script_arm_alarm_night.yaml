#######################################################################################################################
## Arm Alarm Night
#######################################################################################################################
arm_alarm_night:
  alias: Arm Alarm Night
  description: Arm alarm in night mode.
  icon: mdi:alarm-bell
  mode: single
  fields:
    set_mode:
      description: Flag to set occupancy mode
      example: 'true'
  sequence:
    - choose:
        - conditions:
            - condition: state
              entity_id: alarm_control_panel.house
              state: triggered

            - condition: state
              entity_id: binary_sensor.someone_home
              state: 'off'

          sequence:
            - service: browser_mod.toast
              data:
                duration: 30000
                message: Alarm could not be armed.

      default:
        - service: lock.lock #VIRTUAL
          entity_id: all

        - choose:
            - conditions:
                - condition: not
                  conditions:
                    - condition: state
                      entity_id: alarm_control_panel.house
                      state: disarmed

              sequence:
                - service: script.disarm_alarm_temp

        - service: alarm_control_panel.alarm_arm_night
          data:
            entity_id: alarm_control_panel.house
            code: override

        - condition: state
          entity_id: input_boolean.alarm_auto_arming
          state: 'off'

        - condition: template
          value_template: "{{ set_mode }}"

        - service: input_select.select_option
          data:
            entity_id: input_select.occupancy_mode
            option: Night
