#######################################################################################################################
## Media Preset Stop
#######################################################################################################################
media_preset_stop:
  alias: Media Preset Stop
  description: Stop preset media players, turn off booleans.
  mode: restart
  fields:
    preset:
      description: Play media preset.
      example: sleep
  variables:
    media_type: >
      {% if preset == 'wake' %}{{ states('input_select.media_preset_type_wake') }}
      {% elif preset == 'morning' %}{{ states('input_select.media_preset_type_morning') }}
      {% elif preset == 'sleep' %}{{ states('input_select.media_preset_type_sleep') }}
      {% elif preset == 'jason' %}{{ states('input_select.media_preset_type_jason') }}
      {% elif preset == 'sheri' %}{{ states('input_select.media_preset_type_sheri') }}
      {% elif preset == 'shower' %}{{ states('input_select.media_preset_type_shower') }}
      {% elif preset == 'company' %}{{ states('input_select.media_preset_type_company') }}
      {% endif %}
  sequence: 
    - choose:
        - conditions: "{{ preset == 'sleep' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id: input_boolean.media_preset_sleep

            - service: timer.cancel
              entity_id: timer.media_preset_sleep


        - conditions: "{{ preset == 'wake' }}"
          sequence:
            - service: input_boolean.turn_on
              entity_id: input_boolean.media_preset_wake

            - service: timer.cancel
              entity_id: timer.media_preset_wake

    - choose:
        - conditions: "{{ media_type == 'radio' }}"
          sequence:
            # turn radio power button on to keep in sync if radio_play was called by script
            - service: script.radio_stop
              data:
                preset: sleep

            - wait_template: "{{ is_state(states('sensor.radio_media_player','playing')) }}"
              timeout:
                seconds: 60
              continue_on_timeout: false

        - conditions: "{{ media_type == 'spotify' }}"
          sequence:
            - service: script.spotify_stop
              data:
                preset: sleep

            - wait_template: "{{ is_state(states('sensor.spotify_media_player','playing')) }}"
              timeout:
                seconds: 60
              continue_on_timeout: false

        #IDEA add netflix, youtube