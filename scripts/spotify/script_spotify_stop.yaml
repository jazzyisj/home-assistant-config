######################################################################################################################
# Spotify Stop
######################################################################################################################
spotify_stop:
  alias: Spotify Stop
  description: Turn off spotify media players, reset booleans and timers.
  mode: single
  variables:
    player: "{{ states('input_text.active_spotify_player') }}"
  sequence:
    - service: script.turn_off
      entity_id: script.spotify_play

    - service: input_boolean.turn_off
      entity_id: input_boolean.spotify_on

    #NOTE broswer players/chromecast don't turn off so stop play first
    - choose:
      - conditions: "{{ is_state(player,'playing') }}"
        sequence:
          - service: media_player.media_stop
            data:
              entity_id: "{{ player }}"

    # turn off spotify media player (media players in lovelace don't close in idle state)
    - service: media_player.turn_off
      data:
        entity_id: "{{ player }}"

    - service: script.set_media_player_volumes
      data:
        media_player: "{{ player }}"
        source: radio_off

    #TEST - service: input_text.set_value
    #   data:
    #     entity_id: input_text.active_spotify_player
    #     value: cleared