###############################################################################
## Someone Heading Home
###############################################################################
someone_heading_home:
  alias: "Someone Heading Home"
  description: "Preheat/cool house, location updates when someone heading home."
  icon: mdi:home-account
  mode: parallel
  fields:
    person:
      description: "Person heading home."
      example: "jason"
  sequence:
    - if:
        - condition: state
          entity_id: binary_sensor.someone_home
          state: "off"
      then:
        - service: input_boolean.turn_on
          entity_id: input_boolean.hvac_presence_override

    - if:
        - condition: state
          entity_id: input_boolean.presence_alerts
          state: "on"
      then:
        - service: notify.jason
          data:
            title: "{{ person|title }} Heading Home"
            message: >
              {% if person == 'jason' %} Get a beer ready for him!
              {% endif %}
            data:
              tag: "{{ person }}_heading_home"
              group: General
              channel: General
              importance: max
              ttl: 0
              priority: high
              visibility: public
              timeout: 600
              notification_icon: "{{ states.script.arriving_home_notification.attributes.icon }}"
              icon_url: !secret ARRIVE_HOME_ICON
              ledColor: !secret NOTIFY_COLOR
              color: !secret NOTIFY_COLOR
              vibrationPattern: !secret GENERAL_VIBRATION
              clickAction: /lovelace/presence
