#######################################################################################################################
## Arrived Home Notification
#######################################################################################################################
arrived_home_notification:
  alias: Arrived Home Notification
  description: Send notification to person who just arrived home.
  icon: mdi:home
  fields:
    person:
      description: Person who arrived home.
      example: jason
  variables:
    mobile: >
      {% if person == 'jason' %} jphone
      {% elif person == 'sheri' %} sphone
      {% endif %}
  mode: parallel
  max: 5
  sequence:
    - condition: state
      entity_id: binary_sensor.alerts_enabled
      state: 'on'

    - condition: template
      value_template: "{{ mobile in ['jphone','sphone'] }}"

    - service: "{{ 'notify.mobile_app_jphone' if mobile == 'jphone' else 'notify.mobile' }}" #NOTIFY "notify.mobile_app_{{ mobile }}"
      data:
        title: "{{ person|title }} Arriving Home."
        message: Disarm the house alarm.
        data:
          tag: someone_almost_home
          group: Alarm
          channel: General
          importance: max
          timeout: 300
          persistent: true
          clickAction: /lovelace/alarm
          color: !secret NOTIFY_COLOR
          icon_url: !secret HASSIO_ICON
          actions:
            - title: Disarm
              action: "disarm_alarm_{{ mobile }}"
            - title: Garage
              action: "open_garage_{{ mobile }}"
            - title: Panic
              action: panic_alarm