###################################################################################################
## Presence Override
###################################################################################################
presence_override:
  alias: "Presence Override"
  description: "Turn on presence override, turn presence boolean to desired state."
  icon: mdi:home-account
  mode: parallel
  fields:
    home:
      description: "Home state to set [turn_on, turn_off, toggle]."
      example: "on"
    people:
      description: "People to toggle presence for [list]."
      example: "jason"
  sequence:
    - variables:
        home: "{{ home | default('toggle') }}"
        people: >
          {%- if people is iterable and (people is string and people is not mapping) %}
            {%- set people = [people] %}
          {%- endif %}
          {{ people}}

    - condition: "{{ people | count > 0 }}"

    - repeat:
        count: "{{ people | count }}"
        sequence:
          - variables:
              person: "{{ people[repeat.index - 1] }}"

          - if: "{{ person != 'guest' }}"
            then:
              - action: input_boolean.turn_on
                target:
                  entity_id: "input_boolean.home_override_{{ person }}"

          - action: "input_boolean.{{ home }}"
            target:
              entity_id: "input_boolean.{{ person }}_home"