###############################################################################
## NOAA Weather Alert Markdown
###############################################################################
type: custom:html-template-card
ignore_line_breaks: true
entities: sensor.noaa_alerts_miz076
content: >
  {% if states('sensor.noaa_alerts_miz076')|lower in ['unknown','unavailable','none'] %}
    NOAA service not connected.
  {% elif is_state('sensor.noaa_alerts_miz076','0') %}
    No Active Alerts
  {% else %}
    {%- if state_attr('sensor.noaa_alerts_miz076','alerts')|lower not in ['unknown','unavailable','none'] -%}
      {% for alert in state_attr('sensor.noaa_alerts_miz076','alerts') %}
        <p style='font-size:22px;font-weight:bold;'><ha-icon icon="mdi:weather-sunny"></ha-icon>{{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].event }}</p>
        <p>The National Weather Service has issued a
        {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].event }} in effect from
        {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].effective|as_timestamp(none)|timestamp_custom('%-I:%M %p %A',true,none) }} until
        {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].expires|as_timestamp(none)|timestamp_custom('%-I:%M %p %A',true,none) }}.
        {% if not state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].instruction == None %}
          {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].instruction }}
        {% endif %}</p>
        <p>{{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].parameters.NWSheadline[0] }}</p>
        <p>{{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].description|replace('*', '<br/>') }}</p>
        <p style="font-size:12px;">
        Headline: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].headline }}
        <br/>Response: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].response }}
        <br/>Issued: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].effective|as_timestamp(none)|timestamp_custom('%a %D %-I:%M %p',true,none) }}
        <br/>Onset: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].onset|as_timestamp(none)|timestamp_custom('%a %D %-I:%M %p',true,none) }}
        <br/>Expires: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].expires|as_timestamp(none)|timestamp_custom('%a %D %-I:%M %p',true,none) }}
        <br/>Ends: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].ends|as_timestamp(none)|timestamp_custom('%a %D %-I:%M %p',true,none) }}
        <br/>Status: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].status }}
        <br/>Type: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].messageType }}
        <br/>Category: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].category }}
        <br/>Severity: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].severity }}
        <br/>Certainty: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].certainty }}
        <br/>Urgency: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].urgency }}
        <br/>Event: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].event }}
        <br/>Sender: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].sender }}
        <br/>Name: {{ state_attr('sensor.noaa_alerts_miz076','alerts')[loop.index0].senderName }}</p>
      {% endfor %}
    {% else %} Error
    {% endif %}
  {% endif %}
card_mod:
  class: popup
