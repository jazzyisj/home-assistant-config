###############################################################################
## Weather Card
###############################################################################
type: vertical-stack #STYLE weather alert backgrounds getting wiped out by stack-in-card
cards:
  - type: custom:state-switch
    entity: binary_sensor.envcan_weather_alert
    states:
      'on': !include /config/lovelace/button/weather/envcan_alert_button.yaml

  - type: custom:state-switch
    entity: binary_sensor.noaa_weather_alert
    states:
      'on': !include /config/lovelace/button/weather/noaa_alert_button.yaml

  - type: custom:state-switch
    entity: template
    template: >
      {{ 'display' if is_state('binary_sensor.gdacs_alert_active','on')
          and is_state('input_boolean.display_gdacs','on') else 'no' }}
    states:
      'display': !include /config/lovelace/button/weather/gdacs_alert_button.yaml

  - type: custom:stack-in-card
    cards:
      - type: weather-forecast
        entity: weather.home_hourly
        card_mod:
          class: sub_card
          style: |
            ha-card .temp-attribute .temp {
              color:
                {% if is_state('binary_sensor.outdoor_high_temperature_alert','on') %} var(--entity-high-temp-color)
                {% elif is_state('binary_sensor.outdoor_low_temperature_alert','on') %} var(--entity-low-temp-color)
                {% else %} var(--primary-text-color)
                {% endif %}
              ;
            }

      - type: conditional
        conditions:
          - entity: weather.home_daily
            state_not: unavailable
          - entity: weather.home_daily
            state_not: unknown
        card:
          type: custom:weather-chart-card # https://github.com/Yevgenium/weather-chart-card
          entity: weather.home_daily
          show_main: false
          show_attributes: false

      - !include /config/lovelace/card/weather/weather_card_sensors.yaml
card_mod:
  class: basic
