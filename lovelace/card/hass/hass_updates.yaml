###############################################################################
## Hass Updates
###############################################################################
type: custom:auto-entities
filter:
  include:
    - domain: update
      options:
        secondary_info: last-changed
        card_mod:
          style: |
            :host {
              --paper-item-icon-color: var(--entity-warning-color);
            }

    - group: group.other_update_entities
  exclude:
    - state: 'off'
    - state: unknown
    - state: unavailable
sort:
  method: state
  ignore_case: true
card:
  type: entities
  card_mod:
    class: basic
entities:
  - type: conditional
    conditions:
      - entity: update.home_assistant_core_update
        state: 'on'
    row:
      type: custom:fold-entity-row
      head:
        entity: sensor.breaking_change_warnings
        double_tap_action:
          action: url
          url_path: !secret HASS_RELEASE_NOTES
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {%- if states('sensor.breaking_change_warnings')|int(0) > 0 %} var(--entity-critical-color)
                {%- else %} var(--state-icon-color)
                {%- endif -%}
                ;
              --secondary-text-color: var(--entity-warning-color);
            }
    entities:
      - type: custom:hui-element
        card_type: markdown
        content: |
          {%- if states('sensor.breaking_change_warnings')|int(0) == 0 %}
            No breaking changes.
          {%- else -%}
            {%- for change in state_attr('sensor.breaking_change_warnings','changes') %}
              [{{ state_attr('sensor.breaking_change_warnings','changes')[loop.index0].title }}]({{ state_attr('sensor.breaking_change_warnings','changes')[loop.index0].doclink }})
              [{{ state_attr('sensor.breaking_change_warnings','changes')[loop.index0].integration }}]({{ state_attr('sensor.breaking_change_warnings','changes')[loop.index0].prlink }})
              {{ state_attr('sensor.breaking_change_warnings','changes')[loop.index0].description }}

            {%- endfor -%}
          {%- endif -%}
        card_mod:
          class: sub_card

      - type: custom:template-entity-row
        entity: binary_sensor.jason_phone_app_update_alert
        name: "Jason Mobile Version: {{ states('sensor.jphone_current_version')[:-5] }}"
        state: ' '
        secondary: >
          {%- if is_state('binary_sensor.jason_phone_app_update_alert','on') -%}
          Version {{ states('sensor.home_assistant_android_latest_release') }} is available.
          {%- endif -%}
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {%- if is_state('binary_sensor.jason_phone_app_update_alert','on') %} var(--entity-warning-color)
                {%- else %} var(--state-icon-color)
                {%- endif -%}
                ;
              --secondary-text-color: var(--entity-warning-color);
            }

      - type: custom:template-entity-row
        entity: binary_sensor.sheri_phone_app_update_alert
        name: "Sheri Mobile Version: {{ states('sensor.sphone_current_version')[:-5] }}"
        state: ' '
        secondary: >
          {%- if is_state('binary_sensor.sheri_phone_app_update_alert','on') -%}
          Version {{ states('sensor.home_assistant_android_latest_release') }} is available.
          {%- endif -%}
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {%- if is_state('binary_sensor.sheri_phone_app_update_alert','on') %} var(--entity-warning-color)
                {%- else %} var(--state-icon-color)
                {%- endif -%}
                ;
              --secondary-text-color: var(--entity-warning-color);
            }
