###############################################################################
## RPi Monitor - PiHole https://github.com/ironsheep/RPi-Reporter-MQTT2HA-Daemon

#IDEA https://github.com/Sennevds/system_sensors
# CPU usage
# CPU temperature
# CPU Clock Speed
# Disk usage
# Memory usage
# Power status of the RPI
# Last boot
# Last message received timestamp
# Swap usage
# Wifi signal strength
# Wifi connected SSID
# Amount of upgrades pending
# Disk usage of external drives
# Hostname
# Host local IP
# Host OS distro and version
# CPU Load (1min, 5min and 15min)
# Network Download & Upload throughput
###############################################################################
type: vertical-stack
cards:
  - type: entities
    title: 'RPi Monitor'
    icon: mdi:raspberry-pi
    entities:
      - type: attribute
        entity: sensor.rpi_monitor_raspberrypi
        attribute: rpi_model
        name: 'Model'
        icon: mdi:raspberry-pi

      - type: custom:template-entity-row
        name: 'Processor'
        icon: mdi:cpu-32-bit
        state: "{{ state_attr('sensor.rpi_monitor_raspberrypi','cpu')['model'] }}"

      - type: custom:bar-card
        name: 'Processor Use'
        entity: sensor.rpi_cpu_use_raspberrypi
        entity_row: true
        icon: mdi:cpu-32-bit
        positions:
          icon: outside
          name: outside
          indicator: inside
          value: outside
        direction: right
        height: 15px
        width: 275px
        decimal: 0
        min: 0
        max: 100
        severity:
          - from: 0
            to: 40
            color: rgb(0, 153, 51)

          - from: 40
            to: 50
            color: rgb(57, 145, 18)

          - from: 50
            to: 60
            color: rgb(81, 137, 0)

          - from: 60
            to: 65
            color: rgb(100, 128, 0)

          - from: 65
            to: 70
            color: rgb(116, 119, 0)

          - from: 70
            to: 75
            color: rgb(131, 108, 0)

          - from: 75
            to: 80
            color: rgb(144, 95, 0)

          - from: 80
            to: 85
            color: rgb(155, 81, 0)

          - from: 85
            to: 90
            color: rgb(165, 65, 0)

          - from: 90
            to: 100
            color: rgb(173, 43, 0)

          - from: 100
            color: rgb(179, 0, 0)
        card_mod:
          style: |
            bar-card-card { margin-left: 5px; }

      - type: custom:bar-card
        name: 'Processor Temp'
        entity: sensor.rpi_temp_raspberrypi
        entity_row: true
        icon: mdi:thermometer
        positions:
          icon: outside
          name: outside
          indicator: inside
          value: outside
        direction: right
        height: 15px
        width: 275px
        decimal: 0
        min: 0
        max: 100
        severity:
          - from: 0
            to: 50
            color: rgb(0, 204, 15)
          - from: 5
            to: 55
            color: rgb(25, 208, 0)
          - from: 55
            to: 60
            color: rgb(68, 212, 0)
          - from: 56
            to: 60
            color: rgb(112, 216, 0)
          - from: 61
            to: 65
            color: rgb(158, 219, 0)
          - from: 66
            to: 70
            color: rgb(205, 224, 0)
          - from: 71
            to: 75
            color: rgb(238, 215, 0)
          - from: 76
            to: 80
            color: rgb(231, 159, 0)
          - from: 81
            to: 85
            color: rgb(236, 115, 0)
          - from: 86
            to: 90
            color: rgb(239, 69, 0)
          - from: 91
            to: 100
            color: rgb(239, 69, 0)
        card_mod:
          style: |
            bar-card-card { margin-left: 5px; }

      - type: custom:template-entity-row
        name: 'Power Status'
        icon: mdi:flash-alert
        state: "{{ state_attr('sensor.rpi_monitor_raspberrypi','throttle')[1]|title }}"

      - type: custom:template-entity-row
        name: 'Memory'
        icon: mdi:memory
        state: "{{ state_attr('sensor.rpi_monitor_raspberrypi','memory')['size_mb'] }} MB"

      - type: custom:bar-card
        name: 'Memory Used'
        entity: sensor.rpi_memory_use_percent
        entity_row: true
        icon: mdi:thermometer
        positions:
          icon: outside
          name: outside
          indicator: inside
          value: outside
        direction: right
        height: 15px
        width: 275px
        decimal: 0
        min: 0
        max: 100
        severity:
          - from: 0
            to: 50
            color: rgb(0, 204, 15)
          - from: 5
            to: 55
            color: rgb(25, 208, 0)
          - from: 55
            to: 60
            color: rgb(68, 212, 0)
          - from: 56
            to: 60
            color: rgb(112, 216, 0)
          - from: 61
            to: 65
            color: rgb(158, 219, 0)
          - from: 66
            to: 70
            color: rgb(205, 224, 0)
          - from: 71
            to: 75
            color: rgb(238, 215, 0)
          - from: 76
            to: 80
            color: rgb(231, 159, 0)
          - from: 81
            to: 85
            color: rgb(236, 115, 0)
          - from: 86
            to: 90
            color: rgb(239, 69, 0)
          - from: 91
            to: 100
            color: rgb(239, 69, 0)
        card_mod:
          style: |
            bar-card-card { margin-left: 5px; }

      - type: custom:template-entity-row
        name: 'Storage'
        icon: mdi:micro-sd
        state: "{{ state_attr('sensor.rpi_monitor_raspberrypi','fs_total_gb') }} GB"

      - type: custom:bar-card
        name: 'Storage Used'
        entity: sensor.rpi_used_raspberrypi
        entity_row: true
        icon: mdi:thermometer
        positions:
          icon: outside
          name: outside
          indicator: inside
          value: outside
        direction: right
        height: 15px
        width: 275px
        decimal: 0
        min: 0
        max: 100
        severity:
          - from: 0
            to: 50
            color: rgb(0, 204, 15)
          - from: 5
            to: 55
            color: rgb(25, 208, 0)
          - from: 55
            to: 60
            color: rgb(68, 212, 0)
          - from: 56
            to: 60
            color: rgb(112, 216, 0)
          - from: 61
            to: 65
            color: rgb(158, 219, 0)
          - from: 66
            to: 70
            color: rgb(205, 224, 0)
          - from: 71
            to: 75
            color: rgb(238, 215, 0)
          - from: 76
            to: 80
            color: rgb(231, 159, 0)
          - from: 81
            to: 85
            color: rgb(236, 115, 0)
          - from: 86
            to: 90
            color: rgb(239, 69, 0)
          - from: 91
            to: 100
            color: rgb(239, 69, 0)
        card_mod:
          style: |
            bar-card-card { margin-left: 5px; }

      - type: custom:template-entity-row
        name: 'Interfaces'
        icon: mdi:wifi
        state: >
          {% set iface = namespace(value=[]) %}
          {% if 'e' in state_attr('sensor.rpi_monitor_raspberrypi','ifaces') %}
            {% set iface.value = iface.value + ['Ethernet'] %}
          {% endif %}
          {% if 'w' in state_attr('sensor.rpi_monitor_raspberrypi','ifaces') %}
            {% set iface.value = iface.value + ['WiFi'] %}
          {% endif %}
          {% if 'b' in state_attr('sensor.rpi_monitor_raspberrypi','ifaces') %}
            {% set iface.value = iface.value + ['Bluetooth'] %}
          {% endif %}
          {{ iface.value|join(', ') }}

      - type: custom:template-entity-row
        name: 'IPv4 Address'
        icon: mdi:ip-network-outline
        state: "{{ state_attr('sensor.rpi_monitor_raspberrypi','networking')['eth0']['IP'] }}"
        secondary: "MAC: {{ state_attr('sensor.rpi_monitor_raspberrypi','networking')['eth0']['mac'] }}"

      - entity: device_tracker.pi_hole

      - type: custom:template-entity-row
        name: 'OS'
        icon: mdi:linux
        state: >
          {{ state_attr('sensor.rpi_monitor_raspberrypi','ux_release')|title
             ~ ' ' ~ state_attr('sensor.rpi_monitor_raspberrypi','ux_version') }}

      - type: attribute
        entity: sensor.rpi_monitor_raspberrypi
        attribute: host_name
        name: 'Hostname'
        icon: mdi:console-network-outline

      - type: attribute
        entity: sensor.rpi_monitor_raspberrypi
        attribute: up_time
        name: 'Uptime'
        icon: mdi:clock-check-outline

      - type: attribute
        entity: sensor.rpi_monitor_raspberrypi
        attribute: last_update
        name: 'Updated'
        icon: mdi:update
        format: relative
    card_mod:
      class: basic
      style: | #SWIPE
        ha-card {
            margin: 2px;
          }
  - type: grid
    columns: 3
    cards:
      - !include /config/lovelace/graph/network/rpi_cpu_use_graph.yaml
      - !include /config/lovelace/graph/network/rpi_cpu_temp_graph.yaml
      - !include /config/lovelace/graph/network/rpi_memory_use_graph.yaml
