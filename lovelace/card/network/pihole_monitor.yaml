###############################################################################
## Pi-Hole Monitor Card
###############################################################################
type: entities
title: 'Pi-Hole Monitor'
icon: mdi:check-network
state_color: true
show_header_toggle: false
entities:
  - entity: binary_sensor.pi_hole
    tap_action:
      action: more-info
    double_tap_action:
      action: url
      url_path: http://pi.hole/admin/index.php
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% if is_state('sensor.pi_hole_status','Disconnected') %} var(--entity-critical-color)
            {% elif is_state('sensor.pi_hole_status','Disabled') %} var(--entity-warning-color)
            {% else %} var(--entity-critical-color)
            {% endif %}
          ;
          --paper-item-icon-active-color: var(--entity-ok-color) ;
        }

  - entity: sensor.pi_hole_status

  - entity: device_tracker.pi_hole

  - type: conditional
    conditions:
      - entity: binary_sensor.pi_hole_core_update_available
        state: 'on'
    row:
      type: custom:template-entity-row
      entity: binary_sensor.pi_hole_core_update_available
      state: ''
      secondary: >
        Current: {{ state_attr('binary_sensor.pi_hole_core_update_available','current_version') }}
        {% if is_state('binary_sensor.pi_hole_core_update_available','on') %}
        - Latest: {{ state_attr('binary_sensor.pi_hole_core_update_available','latest_version') }}
        {% endif %}
      active: "{{ is_state('binary_sensor.pi_hole_core_update_available','on') }}"
      card_mod:
        style: |
          :host {
              --paper-item-icon-active-color: var(--entity-warning-color);
              --secondary-text-color: var(--entity-warning-color);
            }

  - type: conditional
    conditions:
      - entity: binary_sensor.pi_hole_web_update_available
        state: 'on'
    row:
      type: custom:template-entity-row
      entity: binary_sensor.pi_hole_web_update_available
      state: ''
      secondary: >
        Current: {{ state_attr('binary_sensor.pi_hole_web_update_available','current_version') }}
        {% if is_state('binary_sensor.pi_hole_web_update_available','on') %}
        - Latest: {{ state_attr('binary_sensor.pi_hole_web_update_available','latest_version') }}
        {% endif %}
      active: "{{ is_state('binary_sensor.pi_hole_web_update_available','on') }}"
      card_mod: #ISSUE card-mod not working in conditional rows
        style: |
          :host {
              --paper-item-icon-active-color: var(--entity-warning-color);
              --secondary-text-color: var(--entity-warning-color);
            }

  - type: conditional
    conditions:
      - entity: binary_sensor.pi_hole_ftl_update_available
        state: 'on'
    row:
      type: custom:template-entity-row
      entity: binary_sensor.pi_hole_ftl_update_available
      state: ''
      secondary: >
        Current: {{ state_attr('binary_sensor.pi_hole_ftl_update_available','current_version') }}
        {% if is_state('binary_sensor.pi_hole_ftl_update_available','on') %}
        - Latest: {{ state_attr('binary_sensor.pi_hole_ftl_update_available','latest_version') }}
        {% endif %}
      active: "{{ is_state('binary_sensor.pi_hole_ftl_update_available','on') }}"
      card_mod:
        style: |
          :host {
              --paper-item-icon-active-color: var(--entity-warning-color);
              --secondary-text-color: var(--entity-warning-color);
            }

  - entity: sensor.pi_hole_seen_clients
  - entity: sensor.pi_hole_domains_blocked

  - type: custom:fold-entity-row
    head:
      entity: sensor.pi_hole_ads_percentage_blocked_today
    padding: 0
    entities:
      - entity: sensor.pi_hole_ads_blocked_today
      - entity: sensor.pi_hole_dns_queries_cached
      - entity: sensor.pi_hole_dns_queries_forwarded
      - entity: sensor.pi_hole_dns_queries_today
      - entity: sensor.pi_hole_dns_unique_clients
      - entity: sensor.pi_hole_dns_unique_domains

  - entity: input_number.pi_hole_disable_time

  - type: buttons
    entities:
      # - entity: binary_sensor.pi_hole #ISSUE doesn't work, better entity
      #   name: Pi-Hole Admin
      #   tap_action:
      #     action: fire-dom-event
      #     browser_mod:
      #       command: popup
      #       deviceID: this
      #       title: 'Pi-Hole Admin'
      #       hide_header: true
      #       large: true
      #       card: !include /config/lovelace/card/network/pihole_admin_widget.yaml

      - entity: switch.pi_hole_enabled
        name: Enable Pi-Hole
    card_mod:
      style:
        hui-buttons-base $: |
          .ha-scrollbar {
            justify-content: center;
          }
card_mod:
  class: basic
