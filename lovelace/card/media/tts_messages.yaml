###############################################################################
## TTS Messages #TODO
###############################################################################
type: vertical-stack
cards:
  - type: entities
    entities:
      - entity: variable.saved_messages
        name: 'Saved Messages'

  - type: buttons
    entities:
      - entity: script.play_saved_messages
        name: 'Play Messages'
        tap_action:
          action: call-service
          service: script.play_saved_messages
          serivce_data:
            skip_none: false

      - entity: script.play_last_message
        name: 'Last Message'
        tap_action:
          action: call-service
          service: script.play_last_message

      - entity: script.clear_saved_messages
        name: 'Delete Messages'
        tap_action:
          action: call-service
          service: script.clear_saved_messages
    card_mod:
      style:
        hui-buttons-base $: |
          .ha-scrollbar {
            justify-content: center;
          }

  - type: markdown
    title: 'Saved Messages'
    content: |
      {%- if states('variable.saved_messages')|int(0) > 0 %}
      {%- set msgnum = namespace(value=0) %}
      {%- for key,value in states.variable.saved_messages.attributes.items() %}
      {%- if loop.index % 2 == 1 %}
      {%- set msgnum.value = msgnum.value + 1 %}
      - **{{ value }}**
      <sup>{{ as_local(state_attr('variable.saved_messages','msg_time' ~ msgnum.value)).strftime('%A, %B %-d at %-I:%M %p') }}</sup>
      {% endif %}
      {% endfor %}
      {% else %} No messages.
      {% endif %}
