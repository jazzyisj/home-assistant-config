type: vertical-stack
cards:
  - type: custom:button-card
    template: presence_button
    entity: binary_sensor.jason_home
    name: Jason
    state_display: >
      [[[
        if (states['input_boolean.home_override_jason'].state == 'on')
          if (states['binary_sensor.jason_home'].state == 'on')
            return 'HOME';
          else
            return 'AWAY';
        else if (states['person.jason'].state == 'home')
          return 'HOME';
        else if (states['person.jason'].state == 'not_home')
          return 'AWAY';
        else
          return states['person.jason'].state.toUpperCase();
      ]]]
    entity_picture: >
      [[[
        if (states['binary_sensor.jason_home'].state == 'on')
          return '/local/images/glance/jason_home.png';
        else if (states['person.jason'].state == 'Work')
          return '/local/images/glance/jason_work.png';
        else
          return '/local/images/glance/jason_away.png';
      ]]]
    styles:
      entity_picture:
        - border-radius: 15px
      card:
        - background-color: >
            [[[
              if (states['input_boolean.home_override_jason'].state == 'on')
                return 'var(--entity-button-warning-color)';
              else
                return 'var(--ha-card-background)';
            ]]]
    tap_action:
      action: fire-dom-event
      browser_mod:
        command: popup
        deviceID: this
        title: 'Jason Presence'
        card: !include /config/lovelace/card/presence/jason_presence.yaml
    double_tap_action:
      action: call-service
      service: input_boolean.turn_off
      service_data:
        entity_id: input_boolean.home_override_jason
    hold_action:
      action: call-service
      service: script.toggle_home
      service_data:
        person: jason
