type: custom:card-templater
entities:
  - input_boolean.jason_home_override
card:
  type: entities
  show_header_toggle: false
  state_color: true
  style: |
    .card-header {
      font-size: 18px;
      font-variant: small-caps;
    }
  entities:
    - type: custom:fold-entity-row
      padding: 15
      head:
        entity: person.jason
      entities:
        - type: custom:fold-entity-row
          open: true
          padding: 15
          group_config:
            secondary_info: last-changed
          head:
            type: custom:template-entity-row
            entity: device_tracker.jason_tracker
            state: "{{ states('device_tracker.jason_tracker')|title }}"
            secondary: "Last Seen: {{ states('sensor.jason_tracker_last_seen') }}"
            style: |
              :host {
                --paper-item-icon-color:
                  {%- if states('device_tracker.jason_tracker') =='home' %} var(--state-icon-active-color)
                  {%- else%} var(--state-icon-color)
                  {%- endif -%}
                  ;
              }
          entities:
            - entity: device_tracker.jphone_bt
              name: Phone Bluetooth
              style: |
                :host {
                  --paper-item-icon-color:
                    {% if states('device_tracker.jphone_bt') =='home' %} var(--state-icon-active-color)
                    {% else%} var(--state-icon-color)
                    {% endif %}
                    ;
                }

            - entity: device_tracker.jphone_ping
              name: Phone Ping
              style: |
                :host {
                  --paper-item-icon-color:
                    {% if states('device_tracker.jphone_ping') =='home' %} var(--state-icon-active-color)
                    {% else%} var(--state-icon-color)
                    {% endif %}
                    ;
                }

            - entity: device_tracker.jphone_wifi2
              name: Phone WIFI - 2Ghz
              style: |
                :host {
                  --paper-item-icon-color:
                    {% if states('device_tracker.jphone_wifi2') =='home' %} var(--state-icon-active-color)
                    {% else%} var(--state-icon-color)
                    {% endif %}
                    ;
                }

            - entity: device_tracker.jphone_wifi5
              name: Phone WIFI - 5Ghz
              style: |
                :host {
                  --paper-item-icon-color:
                    {% if states('device_tracker.jphone_wifi5') =='home' %} var(--state-icon-active-color)
                    {% else%} var(--state-icon-color)
                    {% endif %}
                    ;
                }

            - entity: device_tracker.jphone
              name: Phone Tracker
              style: |
                :host {
                  --paper-item-icon-color:
                    {% if states('device_tracker.jphone') =='home' %} var(--state-icon-active-color)
                    {% else%} var(--state-icon-color)
                    {% endif %}
                    ;
                }

            - entity: device_tracker.google_maps_101131226839468750203
              name: Google Tracker
              icon: mdi:account
              style: |
                :host {
                  --paper-item-icon-color:
                    {% if states('device_tracker.google_maps_101131226839468750203') =='home' %} var(--state-icon-active-color)
                    {% else%} var(--state-icon-color)
                    {% endif %}
                    ;
                }

    - type: custom:fold-entity-row
      open_template: "{{ is_state('input_boolean.jason_home_override','on') }}" #OPEN
      padding: 5
      head:
        entity: binary_sensor.jason_home
        name: Jason Home
        state_color: true
        style: |
          :host {
            --paper-item-icon-color:
              {%- if is_state('input_boolean.jason_home_override','on') %} var(--entity-warning-color)
              {%- elif is_state('binary_sensor.jason_home','on') %} var(--state-icon-active-color)
              {%- else %} var(--state-icon-color)
              {%- endif -%}
              ;
          }
      entities:
        - entity: input_boolean.jason_home
          name: Jason Home
          state_color: true
          style: |
            :host {
              --paper-item-icon-color:
                {%- if is_state('input_boolean.jason_home_override','on') %} var(--entity-warning-color)
                {%- else%} var(--state-icon-color)
                {%- endif -%}
                ;
              --paper-item-icon-active-color:
                {%- if is_state('input_boolean.jason_home_override','on') %} var(--entity-warning-color)
                {%- else%} var(--state-icon-active-color)
                {%- endif -%}
                ;
            }

        - entity: input_boolean.jason_almost_home
          name: Jason Almost Home
          state_color: true

        - entity: input_boolean.jason_home_override
          name: Presence Override
          state_color: true
          style: |
            :host {
              --paper-item-icon-color: var(--state-icon-color);
              --paper-item-icon-active-color: var(--entity-warning-color);
            }


    - type: custom:template-entity-row
      name: Current Address
      icon: mdi:map-marker-radius
      #OPTION sensor.jphone_address
      secondary: "{{ states('sensor.jphone_geocoded_location') }}"
      style: |
        :host {
          --paper-item-icon-color:
            {% if states('sensor.jphone_geocoded_location')|lower in ['unknown','unavailable','none'] %} var(--entity-warning-color)
            {% else %} var(--state-icon-active-color)
            {% endif %}
            ;
        }

    - entity: proximity.jhome
      name: Distance From Home
      style: |
        :host {
          --paper-item-icon-color:
            {% if is_state('proximity.jhome','not_set') %} var(--entity-warning-color)
            {% else %} var(--state-icon-active-color)
            {% endif %}
            ;
        }

    - type: custom:fold-entity-row
      padding: 15
      state_color: true
      head:
        type: custom:template-entity-row
        entity: binary_sensor.jphone_connected
        state: "{{ states('binary_sensor.jphone_connected')|title }}"
        secondary: "Last Update: {{ states('sensor.jphone_last_update') }}"
        state_color: true
        style: |
          :host {
            --paper-item-icon-color:
              {%- if states('device_tracker.jason_tracker') =='home' %} var(--state-icon-active-color)
              {%- else%} var(--state-icon-color)
              {%- endif -%}
              ;
          }
      entities:
        - type: custom:fold-entity-row
          padding: 10
          head:
            entity: binary_sensor.jphone_wifi_state
            name: WIFI Connection
            style: |
              :host {
                --paper-item-icon-color:
                  {% if not is_state('binary_sensor.jphone_wifi_state','off') %} var(--state-icon-active-color)
                  {% else %} var(--state-icon-color)
                  {% endif %}
                  ;
              }
          entities:
            - entity: sensor.jphone_wifi_connection
              style: |
                :host {
                  --paper-item-icon-color:
                    {% if not is_state('sensor.jphone_wifi_connection','<not connected>') %} var(--state-icon-active-color)
                    {% else %} var(--state-icon-color)
                    {% endif %}
                    ;
                }
            - entity: sensor.jphone_public_ip_address
              name: Public IP
            - entity: sensor.jphone_wifi_ip_address
              name: WIFI IP Address
            - entity: sensor.jphone_wifi_signal_strength
              name: WIFI Signal Strength
            - entity: sensor.jphone_wifi_link_speed
              name: WIFI Link Speed
            - entity: sensor.jphone_wifi_bssid
              name: WIFI BSSID
            - entity: sensor.jphone_wifi_frequency
              name: WIFI Frequencey

        - type: custom:fold-entity-row
          padding: 10
          head:
            entity: sensor.jphone_mobile_rx_gb
            name: Phone Data
          entities:
            - entity: sensor.jphone_mobile_rx_gb
              name: Mobile Recieved
            - entity: sensor.jphone_mobile_tx_gb
              name: Mobile Transmitted
            - entity: sensor.jphone_total_rx_gb
              name: Total Recieved
            - entity: sensor.jphone_total_tx_gb
              name: Total Transmitted

        - type: custom:fold-entity-row
          padding: 10
          head:
            entity: binary_sensor.jphone_bluetooth_state
            name: Bluetooth
          entities:
            - entity: sensor.jphone_bluetooth_connection
              name: "Connection(s)"

        - type: custom:fold-entity-row
          padding: 10
          head:
            entity: sensor.jphone_phone_state
            name: Phone State
          entities:
            - entity: sensor.jphone_ringer_mode
            - entity: sensor.jphone_volume_level_ringer
            - entity: sensor.jphone_volume_level_call
            - entity: binary_sensor.jphone_speakerphone
            - entity: sensor.jphone_sim_1
              name: Active Carrier

        - type: custom:fold-entity-row
          padding: 10
          head:
            entity: sensor.jphone_audio_mode
            name: Audio
          entities:
            - entity: sensor.jphone_do_not_disturb_sensor
              name: Do Not Disturb
            - entity: binary_sensor.jphone_mic_muted
            - entity: binary_sensor.jphone_music_active
            - entity: sensor.jphone_volume_level_music
            - entity: binary_sensor.jphone_headphones

        - type: custom:fold-entity-row
          padding: 10
          head:
            entity: sensor.jphone_next_alarm
            name: Next Alarm
          entities:
            - entity: sensor.jphone_volume_level_alarm

        - type: custom:fold-entity-row
          padding: 10
          head:
            entity: sensor.jphone_app_update
            name: Phone App Updated
            tap_action:
              action: none
            double_tap_action:
              action: none
            hold_action:
              action: none
            style: |
              :host {
                --paper-item-icon-color:
                  {%- if is_state('sensor.jphone_app_update','off') %} var(--state-icon-active-color)
                  {%- else %} var(--entity-warning-color)
                  {%- endif -%}
                  ;
              }
          entities:
            - entity: sensor.jphone_current_version
              name: Current Version

            - entity: sensor.ha_companion_latest_version
              name: Latest Version

        - type: custom:fold-entity-row
          padding: 10
          head:
            type: section
            label: Other Sensors
          entities:
            - entity: sensor.jphone_last_reboot
              name: Last Reboot

            - entity: sensor.jphone_internal_storage
              name: Internal Storage

            - entity: sensor.jphone_external_storage
              name: External Storage

            - entity: sensor.jphone_light_sensor
              name: Light Sensor

            - entity: sensor.jphone_pressure_sensor
              name: Pressure Sensor

            - entity: sensor.jphone_proximity_sensor
              name: Proximity Sensor

            - entity: sensor.jphone_steps_sensor
              name: Steps Sensor

            - entity: binary_sensor.jphone_interactive
              name: Interactive

            - entity: binary_sensor.jphone_doze_mode
              name: Doze Mode

            - entity:  binary_sensor.jphone_device_locked
              name: Device Locked

            - entity:  binary_sensor.jphone_device_secure
              name: Device Secure

            - entity:  binary_sensor.jphone_keyguard_locked
              name: Keyguard Locked

            - entity:  binary_sensor.jphone_keyguard_secure
              name: Keyguard Secure

            - entity:  sensor.jphone_current_time_zone
              name: Current Time Zone

            - entity:  sensor.jphone_detected_activity
              name: Detected Activity

            - entity: sensor.jphone_last_notification
              name: Last Notification

            - entity:  sensor.jphone_last_update_trigger
              name: Last Update Trigger

    - type: custom:fold-entity-row
      state_color: true
      padding: 10
      head:
        type: custom:battery-state-card
        entity: sensor.jphone_battery_level
        name: Battery Level
        secondary_info: charging # only appears when charging is detected
        charging_state:
          entity_id: binary_sensor.jphone_is_charging
          state: 'on'
          secondary_info_text: Charging
      entities:
        - entity: binary_sensor.jphone_is_charging
        - entity: sensor.jphone_battery_state
          name: Battery State
        - entity: sensor.jphone_charger_type
          name: Charger Type
        - entity: sensor.jphone_battery_health
          name: Battery Health
        - entity: binary_sensor.jphone_power_save
          name: Power Saving