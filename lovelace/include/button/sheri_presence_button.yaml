type: vertical-stack
cards:
  - type: custom:button-card
    template: presence_button
    entity: binary_sensor.sheri_home
    name: Sheri
    state_display: >
      [[[
        if (states['input_boolean.sheri_home_override'].state == 'on')
            if (states['binary_sensor.sheri_home'].state == 'on')
              return 'OR - Home';
            else
              return 'OR - Away';
        else if (states['device_tracker.sheri_tracker'].state == 'home')
          return 'Home';
        else if (states['device_tracker.sheri_tracker'].state == 'not_home')
          return 'Away';
        else
          return (states['device_tracker.sheri_tracker'].state);
      ]]]
    # check binary presence sensor for home state to detect if override is on
    entity_picture: >
      [[[
        if (states['binary_sensor.sheri_home'].state == 'on')
          return '/local/images/glance/sheri_home.png';
        else if (states['device_tracker.sheri_tracker'].state == 'Work')
          return '/local/images/glance/sheri_work.png';
        else
          return '/local/images/glance/sheri_away.png';
      ]]]
    styles:
      state:
        - font-size: 20px
        - font-weight: bold
      entity_picture:
        - border-radius: 15px
    tap_action:
      action: call-service
      service: browser_mod.popup
      service_data:
        deviceID: this
        title: Sheri Presence
        large: false
        card: !include /config/lovelace/include/card/sheri_presence.yaml
    double_tap_action:
      action: call-service
      service: input_boolean.turn_off
      service_data:
        entity_id: input_boolean.sheri_home_override
    hold_action:
      action: call-service
      service: script.toggle_home_sheri

  - type: conditional
    conditions:
      - entity: binary_sensor.sheri_home
        state: 'off'
    card: !include /config/lovelace/include/bar/sheri_time_home.yaml

  # just to fill hole in UI
  - type: conditional
    conditions:
      - entity: binary_sensor.sheri_home
        state: 'off'
      - entity: binary_sensor.sheri_home
        state: 'on'
    card: !include /config/lovelace/include/bar/sheri_time_home.yaml
    
  - type: conditional
    conditions:
      - entity: binary_sensor.work_commute_active
        state: 'on'
    card: !include /config/lovelace/include/bar/sheri_time_work.yaml      