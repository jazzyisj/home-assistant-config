#######################################################################################################################
## Precipitation Summary Graph
# https://github.com/RomRider/apexcharts-card
# https://apexcharts.com/docs/installation/
#######################################################################################################################
type: custom:apexcharts-card
config_templates: weather_graph
# span:
#   start: day
apex_config:
  title:
    text: Precipitation
yaxis:
  - id: percent
    show: true
    min: 0
    max: 100
    apex_config:
      tickAmount: 5
      decimalsInFloat: 0
      labels:
        show: true
      title:
        text: Perecent
        rotate: -90

  - id: pressure
    show: true
    opposite: true
    min: 980
    max: 1030
    apex_config:
      tickAmount: 5
      decimalsInFloat: 1
      labels:
        show: true
        align: center
      title:
        text: Pressure
        rotate: -90

  - id: intensity
    show: false
    min: 0
    max: 50
    apex_config:
      tickAmount: 5
      decimalsInFloat: 3

  - id: precip
    show: false
    min: 0
    max: 25
    apex_config:
      tickAmount: 5
      decimalsInFloat: 0
# all_series_config:
  # group_by:
  #   func: max
  #   duration: 5min
series:
  - name: Probability
    entity: sensor.precipitation_probability
    yaxis_id: percent
    type: area
    fill_raw: zero
    color: rgb(255, 51, 0)
    color_threshold:
      - value: 0
        opacity: 0.3
      - value: 100
        opacity: 0.6

  - name: Intensity
    entity: sensor.precipitation_intensity
    yaxis_id: intensity
    type: area
    fill_raw: 'null'
    float_precision: 3
    group_by:
      func: max
      duration: 15min
    stroke_width: 0
    opacity: 0.8
    color_threshold:
      - value: 0
        color: rgb(255, 255, 255)
      - value: 0.1
        color: rgb(0, 255, 255)
      - value: 0.5
        color: rgb(0, 0, 238)
      - value: 5
        color: rgb(0, 238, 0)
      - value: 10
        color: rgb(255, 255, 0)
      - value: 25
        color: rgb(255, 153, 51)
      - value: 50
        color: rgb(255, 0, 0)
      - value: 100
        color: rgb(255, 0, 255)

  - name: Clouds
    entity: sensor.cloud_cover
    yaxis_id: percent
    type: area
    color: rgb(128, 128, 128)
    color_threshold:
      - value: 0
        color: rgb(0, 122, 255)
        opacity: 0
      - value: 1.00
        color:  rgb(128, 128, 128)
        opacity: 0.5

  - name: Humidity
    entity: sensor.outdoor_humidity
    yaxis_id: percent
    stroke_width: 3
    opacity: 0.6
    color: rgb(0, 106, 255)

  - name: Pressure
    entity: sensor.barometric_pressure
    yaxis_id: pressure
    float_precision: 1
    stroke_width: 3
    color: '#FFFA00'
    #OPTION color_threshold:
    #   - value: 0.0
    #     color: '#85529D'
    #   - value: 28.0
    #     color: '#AD51A6'
    #   - value: 28.2
    #     color: '#B58AE6'
    #   - value: 28.4
    #     color: '#D388E3'
    #   - value: 28.5
    #     color: '#4A7BE1'
    #   - value: 28.6
    #     color: '#71A4E6'
    #   - value: 28.7
    #     color: '#A2D4F9'
    #   - value: 28.8
    #     color: '#B1E0F4'
    #   - value: 28.9
    #     color: '#BFEDEB'
    #   - value: 29.0
    #     color: '#BCEDDA'
    #   - value: 29.1
    #     color: '#B0F1AD'
    #   - value: 29.2
    #     color: '#BCEAC3'
    #   - value: 29.3
    #     color: '#ADF39B'
    #   - value: 29.4
    #     color: '#A0E78B'
    #   - value: 29.6
    #     color: '#6FAD5A'
    #   - value: 29.8
    #     color: '#5CA530'
    #   - value: 29.9
    #     color: '#ABBF22'
    #   - value: 30.0
    #     color: '#BFC41F'
    #   - value: 30.1
    #     color: '#E9CE1F'
    #   - value: 30.2
    #     color: '#EBD021'
    #   - value: 30.3
    #     color: '#E4B01C'
    #   - value: 30.4
    #     color: '#E59B22'
    #   - value: 30.6
    #     color: '#4D50DB'

  - name: Accum.
    entity: sensor.envcan_precipitation_yesterday
    yaxis_id: precip
    type: column
    # transform: "if (x == 0) return 'null';" #APEX doesn't kill zero values?
    fill_raw: 'null'  # doesn't kill all zero values?
    group_by:
      func: max
      duration: 24h
    show:
      datalabels: true
    stroke_width: 5
    color: rgb(0, 151, 255)


