#######################################################################################################################
## Precipitation Summary Graph
# https://github.com/RomRider/apexcharts-card
# https://apexcharts.com/docs/installation/
#######################################################################################################################

type: custom:apexcharts-card
config_templates: weather_graph
apex_config:
  title:
    text: Precipitation
now:
  show: true
  color: white
yaxis:
  - id: percent
    show: true
    min: 0
    max: 100
    apex_config:
      tickAmount: 5
      decimalsInFloat: 0
      # forceNiceScale: true  #APEX forces max to 120
      labels:
        show: true
        # align: center #APEX this causes render error
      title:
        text: Perecent
        rotate: -90

  - id: pressure
    show: true
    opposite: true
    min: 29.0
    max: 30.5
    apex_config:
      tickAmount: 5
      decimalsInFloat: 1
      labels:
        show: true
        align: center
      title:
        text: Pressure
        rotate: -90

  - id: intensity
    show: false
    min: 0
    max: 0.25

  - id: precip
    show: false
    min: 0
    max: 25

series:
  - entity: sensor.climacell_precipitation_probability
    yaxis_id: percent
    name: Probability
    type: area
    color: '#FF0000'
    stroke_width: 1
    fill_raw: zero
    color_threshold:
      - value: 0
        opacity: 0.3
      - value: 100
        opacity: 0.6

  - entity: sensor.climacell_precipitation_intensity
    yaxis_id: intensity
    name: Intensity
    type: area
    fill_raw: 'null'
    float_precision: 3
    opacity: 0.8
    stroke_width: 0
    group_by:
      func: max
      duration: 1h
    color_threshold:
      - value: 0
        color: '#ffffff'
      - value: 0.002
        color: '#6FFF03'
      - value: 0.009
        color: '#6FFF03'
      - value: 0.05
        color: '#E2FF04'
      - value: 0.19
        color: '#FED903'
      - value: 0.4
        color: '#FFB700'
      - value: 0.7
        color: '#FF8B00'
      - value: 2.0
        color: '#FF4E00'
      - value: 4.7
        color: '#FF0200'

  - entity: sensor.climacell_cloud_cover
    yaxis_id: percent
    name: Clouds
    type: area
    color: '#808080'
    stroke_width: 1
    color_threshold:
      - value: 0
        color: '#007aff'
        opacity: 0
      - value: 1.00
        color: '#808080'
        opacity: 0.5

  - entity: sensor.climacell_humidity
    yaxis_id: percent
    name: Humidity
    type: line
    stroke_width: 3
    opacity: 1
    color: '#0000FF'
    color_threshold:
      - value: 0
        color: '#FFFFFF'
      - value: 100
        color: '#0C00FF'

  - entity: sensor.climacell_pressure
    yaxis_id: pressure
    name: Pressure
    type: line
    float_precision: 1
    color: '#FFFA00'
    opacity: 1
    stroke_width: 3
    color_threshold:
      - value: 0.0
        color: '#85529D'
      - value: 28.0
        color: '#AD51A6'
      - value: 28.2
        color: '#B58AE6'
      - value: 28.4
        color: '#D388E3'
      - value: 28.5
        color: '#4A7BE1'
      - value: 28.6
        color: '#71A4E6'
      - value: 28.7
        color: '#A2D4F9'
      - value: 28.8
        color: '#B1E0F4'
      - value: 28.9
        color: '#BFEDEB'
      - value: 29.0
        color: '#BCEDDA'
      - value: 29.1
        color: '#B0F1AD'
      - value: 29.2
        color: '#BCEAC3'
      - value: 29.3
        color: '#ADF39B'
      - value: 29.4
        color: '#A0E78B'
      - value: 29.6
        color: '#6FAD5A'
      - value: 29.8
        color: '#5CA530'
      - value: 29.9
        color: '#ABBF22'
      - value: 30.0
        color: '#BFC41F'
      - value: 30.1
        color: '#E9CE1F'
      - value: 30.2
        color: '#EBD021'
      - value: 30.3
        color: '#E4B01C'
      - value: 30.4
        color: '#E59B22'
      - value: 30.6
        color: '#4D50DB'

  - entity: sensor.precipitation_yesterday
    yaxis_id: precip
    name: Accum.
    type: column
    # transform: "if (x == 0) return 'null';" #APEX doesn't kill zero values?
    color: '#0094FF'
    group_by:
      func: max
      duration: 24h
      fill: 'null'  #APEX doesn't kill all zero values?
    stroke_width: 5
    show:
      datalabels: true

