type: entities
title: Home Assistant
icon: mdi:home-assistant
entities:
  - type: custom:template-entity-row
    name: "Home Assistant Uptime: {{ states('sensor.ha_uptime') }}"
    secondary: "Last Restart: {{ states('sensor.last_restart_date_time') }}"
    icon: mdi:clock-start

  - type: custom:auto-entities
    filter:
      include:
        - group: group.integration_online_sensors
          options:
            secondary_info: last-changed
            card_mod:
              style: |
                :host {
                  --paper-item-icon-color:
                    {% if is_state(config.entity,'off') %} var(--entity-warning-color)
                    {% else %} var(--entity-ok-color)
                    {% endif %}
                  ;
                }
    sort:
      method: name
      ignore_case: true
    card:
      type: custom:fold-entity-row
      head:
        entity: binary_sensor.integrations_online
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {% if is_state('binary_sensor.integrations_online','off') %} var(--entity-warning-color)
                {% else %} var(--entity-ok-color)
                {% endif %}
              ;
            }
      padding: 5

  - type: custom:fold-entity-row
    head:
      entity: sensor.offline_devices
      card_mod:
        style: |
          :host {
            --paper-item-icon-color:
              {%- if is_state('sensor.offline_devices','0') %} var(--entity-ok-color)
              {%- else %} var(--entity-warning-color)
              {%- endif -%}
            ;
          }
      padding: 0
    entities:
      - type: custom:hui-element
        card_type: markdown
        content: >
          {%- if states('sensor.offline_devices')|int == 0 -%}
            No offline devices.
          {%- else -%}
            {%- for device in expand(state_attr('sensor.offline_devices','entities')) -%}
            - {{ device.name }}{%- if not loop.last -%}{{ '\n' }}{%- endif -%}
            {%- endfor -%}
          {%- endif -%}
        card_mod:
          class: sub_card

  - type: custom:fold-entity-row
    head:
      type: custom:template-entity-row
      entity: sensor.offline_zwave_devices
      name: "{{ 'All ZWave Devices Online' if states('sensor.offline_zwave_devices')|int == 0 else 'Offline ZWave Devices' }}"
      tap_action:
        action: fire-dom-event
        browser_mod:
          command: popup
          deviceID: this
          title: Wired Network Devices
          hide_header: true
          card: !include /config/lovelace/include/card/zwave/zwave_devices.yaml
      card_mod:
        style: |
          :host {
            --paper-item-icon-color:
              {% if states('sensor.offline_zwave_devices')|int > 0 %} var(--entity-warning-color)
              {% else %} var(--entity-ok-color)
              {% endif -%}
            ;
          }
    padding: 0
    entities:
      - type: custom:hui-element
        card_type: markdown
        content: >
          {%- if states('sensor.offline_zwave_devices')|int > 0 -%}
            {%- for device in expand(state_attr('sensor.offline_zwave_devices','entities')) -%}
            - {{ device.name|replace(': Node Status','') }}{%- if not loop.last -%}{{ '\n' }}{%- endif -%}
            {%- endfor -%}
          {%- else -%}
            No offline ZWave devices.
          {%- endif -%}
        card_mod:
          class: sub_card

  - type: custom:fold-entity-row
    head:
      entity: sensor.unavailable_sensors
      card_mod:
        style: |
          :host {
            --paper-item-icon-color:
              {%- if is_state('sensor.unavailable_sensors','0') %} var(--entity-ok-color)
              {%- else %} var(--entity-warning-color)
              {%- endif -%}
              ;
          }
      padding: 0
    entities:
      - type: custom:hui-element
        card_type: markdown
        content: >
          {%- if states('sensor.unavailable_sensors')|int == 0 -%}
            No unavailable entities.
          {%- else -%}
            {%- for sensor in expand(state_attr('sensor.unavailable_sensors','entities')) -%}
            - {{ sensor.name }}{%- if not loop.last -%}{{ '\n' }}{%- endif -%}
            {%- endfor -%}
          {%- endif -%}
        card_mod:
          class: sub_card

  - type: custom:fold-entity-row
    head:
      entity: sensor.unavailable_entities
      tap_action:
        action: none
      double_tap_action:
        action: more-info
      hold_action:
        action: more-info
      card_mod:
        style: |
          :host {
            --paper-item-icon-color:
              {%- if is_state('sensor.unavailable_entities','0') %} var(--entity-ok-color)
              {%- else %} var(--entity-warning-color)
              {%- endif -%}
              ;
          }
      padding: 0
    entities:
      - type: custom:hui-element
        card_type: markdown
        content: >
          {%- if states('sensor.unavailable_entities')|lower not in ['unknown','unavailable','none'] -%}
            {%- if states('sensor.unavailable_entities')|int == 0 -%}
              No unavailable entities.
            {%- else -%}
              {%- for entity in state_attr('sensor.unavailable_entities','entities') -%}
              - {{ entity }}{%- if not loop.last -%}{{ '\n' }}{%- endif -%}
              {%- endfor -%}
            {%- endif -%}
          {%- endif -%}
        card_mod:
          class: sub_card

  - entity: binary_sensor.remote_ui
    card_mod:
        style: |
          :host {
            --paper-item-icon-color:
              {% if is_state('binary_sensor.remote_ui','off') %} var(--entity-critical-color)
              {% else %} var(--entity-ok-color)
              {% endif %}
            ;
          }

  - !include /config/lovelace/include/entity/hass/browser_monitor.yaml

  - entity: sensor.connected_clients

  - type: custom:template-entity-row
    entity: sensor.last_successful_authentication
    state: "{{ state_attr('sensor.last_successful_authentication','Hostname') }}"
    secondary: "User: {{ state_attr('sensor.last_successful_authentication','Username') }}"
    card_mod:
      style: |
        :host {
          --paper-item-icon-color: var(--entity-ok-color);
        }

  - type: custom:template-entity-row
    entity: binary_sensor.system_update
    secondary: "Home Assistant v{{ states('sensor.home_assistant_version') }}"
    tap_action:
      action: fire-dom-event
      browser_mod:
        command: popup
        deviceID: this
        title: Hass System Updates
        card: !include /config/lovelace/include/card/hass/hass_updates.yaml
    double_tap_action:
      action: more-info
    hold_action:
      action: navigate
      navigation_path: /hassio/dashboard
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% if states('sensor.breaking_change_warnings')|int > 0 %} var(--entity-critical-color)
            {% elif is_state('binary_sensor.system_update','on') %}  var(--entity-warning-color)
            {% else %} var(--entity-ok-color)
            {% endif %}
          ;
        }

  - type: custom:template-entity-row
    entity: sensor.snapshot_backup
    name: System Snapshot Backups
    icon: mdi:folder-sync
    state: "{{ 'Problem' if is_state('binary_sensor.snapshots_stale','on') else 'OK' }}"
    secondary: "Snapshots: {{ state_attr('sensor.snapshot_backup','snapshots_in_hassio') }}  -  Latest:{{ state_attr('sensor.snapshot_backup','last_snapshot')|as_timestamp| timestamp_custom('%b %_d,%Y %H:%M %p', true) }}"
    tap_action:
      action: more-info
    double_tap_action:
      action: navigate
      navigation_path: /hassio/snapshots
    hold_action:
      action: navigate
      navigation_path: /hassio/addon/cebe7a76_hassio_google_drive_backup/info
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% if is_state('binary_sensor.snapshots_stale','on') %} var(--entity-critical-color)
            {% elif not is_state('sensor.snapshot_backup','backed_up') %} var(--entity-warning-color)
            {% else %} var(--entity-ok-color)
            {% endif %}
          ;
        }




  - entity: sensor.home_assistant_alerts
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% if 'persistent_notification.hass_alert' in states.persistent_notification|map(attribute='entity_id')|list %} var(--entity-warning-color)
            {% elif states('sensor.home_assistant_alerts')|lower in ['unknown','unavailable','none'] %} var(--entity-warning-color)
            {% else %} var(--entity-ok-color)
            {% endif %}
          ;
        }
    tap_action:
      action: fire-dom-event
      browser_mod:
        command: popup
        deviceID: this
        title: Home Assistant Alerts
        card: !include /config/lovelace/include/markdown/hass_alerts_markdown.yaml

  - type: custom:fold-entity-row
    head:
      entity: sensor.disk_use_percent_home
    padding: 5
    card_mod:
      style: |
        {% if is_state('binary_sensor.disk_use_alert','on') %}
        @keyframes blink {
          50% {
            --paper-item-icon-color: var(--entity-warning-color);
          }
        }
        {% endif %}
        :host {
          --paper-item-icon-color:
            {% if is_state('binary_sensor.disk_use_alert','on') %} var(--entity-critical-color)
            {% elif states('sensor.disk_use_percent_home')|int < 40 %} var(--entity-ok-color)
            {% elif states('sensor.disk_use_percent_home')|int < 50 %} var(--entity-minor-color)
            {% elif states('sensor.disk_use_percent_home')|int < 70 %} var(--entity-warning-color)
            {% elif states('sensor.disk_use_percent_home')|int < 80 %} var(--entity-severe-color)
            {% else %} var(--entity-critical-color)
            {% endif %}
          ;
        }
        {% if is_state('binary_sensor.disk_use_alert','on') %}animation: blink 2s linear infinite;{% endif %}

    entities:
      - type: custom:fold-entity-row
        head:
          entity: sensor.hassio_db
          name: Hassio Database
          card_mod:
            style: |
              :host {
                --paper-item-icon-color:
                  {% if states('sensor.hassio_db')|int > 1000 %} var(--entity-critical-color)
                  {% elif states('sensor.hassio_db')|int > 750 %} var(--entity-warning-color)
                  {% else %} var(--entity-ok-color)
                  {% endif %}
                  ;
              }
        padding: 5
        entities:
          - type: call-service
            service: script.purge_database
            name: Purge Hassio Database
            icon: mdi:database-sync
            action_name: PURGE

      - entity: sensor.home_assistant_log
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {% if states('sensor.home_assistant_log')|int > 100 %} var(--entity-critical-color)
                {% elif states('sensor.home_assistant_log')|int > 50 %} var(--entity-warning-color)
                {% else %} var(--entity-ok-color)
                {% endif %}
                ;
            }

      - type: custom:template-entity-row
        name: Snapshot Backup Disk Use
        icon: mdi:folder-sync
        state: "{{ state_attr('sensor.snapshot_backup','size_in_home_assistant') }}"
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {% if states('sensor.alarm_snapshots')|int > 5 %} var(--entity-warning-color)
                {% else %} var(--state-icon-color)
                {% endif %}
                ;
            }

      - type: custom:fold-entity-row
        head:
          entity: sensor.alarm_snapshots
          name: Alarm Snapshot Disk Use
          card_mod:
            style: |
              :host {
                --paper-item-icon-color:
                  {% if states('sensor.alarm_snapshots')|int > 100 %} var(--entity-warning-color)
                  {% else %} var(--state-icon-color)
                  {% endif %}
                  ;
              }
        padding: 5
        entities:
          - type: call-service
            service: shell_command.alarm_snapshots_purge_all
            icon: mdi:database-sync
            name: Purge Motion Capture
            action_name: PURGE

      - type: custom:fold-entity-row
        head:
          entity: sensor.tts
          name: TTS Cache Disk Use
          card_mod:
            style: |
              :host {
                --paper-item-icon-color:
                  {% if states('sensor.tts')|int > 100 %} var(--entity-warning-color)
                  {% else %} var(--state-icon-color)
                  {% endif %}
                  ;
              }
        padding: 5
        entities:
          - type: call-service
            service: shell_command.tts_purge_all
            icon: mdi:database-sync
            name: Purge TTS Cache
            action_name: PURGE

card_mod:
  class: basic