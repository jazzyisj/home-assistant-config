type: entities
entities:
  - type: custom:fold-entity-row
    head:
      entity: sensor.alarm_clock_manual # don't use entity include - recursive popup
      name: Manual Alarm Time
      icon: mdi:clock
      tap_action:
        action: none
      card_mod:
        style: |
          :host {
            --paper-item-icon-color:
              {% if is_state('sensor.alarm_clock_manual','Off') %} var(--state-icon-color)
              {% else %} var(--state-icon-active-color)
              {% endif %}
              ;
          }
    padding: 0
    entities:
      - !include /config/lovelace/include/entity/alarm_clock/datetime_picker_manual_alarm.yaml

  - type: custom:fold-entity-row
    head:
      type: custom:template-entity-row
      entity: sensor.alarm_clock_manual
      icon: mdi:playlist-music
      name: >
        {% set media_type = states('input_select.alarm_clock_sound_manual')|lower %}
        {% if media_type in ['radio','spotify','youtube'] %}
          {{ states('input_select.alarm_clock_' ~ media_type ~ '_manual') }}
        {% else %} {{ media_type|title }}
        {% endif %}
      secondary: "{{ states('input_select.alarm_clock_media_player_manual') }}"
      state: "{{ states('input_number.alarm_clock_volume_manual') }}%"
      tap_action:
        action: none
    padding: 0
    entities:
      - entity: input_select.alarm_clock_sound_manual
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {% if is_state('sensor.alarm_clock_manual','Off') %} var(--state-icon-color)
                {% else %} var(--state-icon-active-color)
                {% endif %}
                ;
            }

      - type: conditional
        conditions:
          - entity: input_select.alarm_clock_sound_manual
            state: Radio
        row:
          entity: input_select.alarm_clock_radio_manual

      - type: conditional
        conditions:
          - entity: input_select.alarm_clock_sound_manual
            state: Spotify
        row:
          entity: input_select.alarm_clock_spotify_manual

      - type: conditional
        conditions:
          - entity: input_select.alarm_clock_sound_manual
            state: Youtube
        row:
          entity: input_select.alarm_clock_youtube_manual

      - entity: input_select.alarm_clock_media_player_manual
      - entity: input_number.alarm_clock_volume_manual

  - !include /config/lovelace/include/entity/alarm_clock/alarm_clock_common_settings.yaml

  - type: custom:paper-buttons-row
    buttons:
      - entity: input_boolean.alarm_clock_manual
        name: "{{ 'Alarm Set' if is_state('input_boolean.alarm_clock_manual','on') else 'Set Alarm' }}"
        state_icons:
          'on': mdi:alarm-check
          'off': mdi:alarm-off
        state_styles:
          'on':
            button:
              color: var(--state-icon-active-color)
          'off':
            button:
              color: var(--state-icon-color)
        style:
          button:
            background-color: var(--table-row-alternative-background-color)
            border-radius: 40px
            padding: 10px
            font-size: 1.2rem
        tap_action:
          action: toggle

      - entity: switch.alarm_clock_manual
        name: "{{ 'Stop Alarm' if is_state('switch.alarm_clock_manual','on') else 'Test Alarm' }}"
        state_icons:
          'on': mdi:alarm-note
          'off': mdi:alarm-note-off
        state_styles:
          'on':
            button:
              color: var(--state-icon-active-color)
          'off':
            button:
              color: var(--state-icon-color)
        style:
          button:
            background-color: var(--table-row-alternative-background-color)
            border-radius: 40px
            padding: 10px
            font-size: 1.2rem
        tap_action:
          action: call-service
          service: script.alarm_clock_toggle
          service_data:
            alarm_type: manual
            test_play: true
        double_tap_action:
          action: call-service
          service: script.alarm_clock_stop
          service_data:
            reset_volume: true
    card_mod:
      class: basic