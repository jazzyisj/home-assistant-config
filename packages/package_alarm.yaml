###############################################################################
## House Alarm Package
###############################################################################
homeassistant:
  customize:
    alert.alarm_disabled:
      icon: mdi:alarm-light
      category: alarm
    alert.alarm_disarmed:
      icon: mdi:alarm-light
      category: alarm

    timer.alarm_arming:
      type: alarm
    timer.alarm_pending:
      type: alarm
    timer.alarm_triggered_reset:
      type: alarm

input_boolean:
  alarm_automation:
    name: 'Alarm Automation'
    icon: mdi:sync-alert
  alarm_alerts:
    name: 'Alarm Alerts'
    icon: mdi:alert
  alarm_emails:
    name: 'Alarm Emails'
    icon: mdi:email
  alarm_announcements:
    name: 'Alarm Announcements'
    icon: mdi:account-voice
  alarm_auto_arming:
    name: 'Auto Arming'
    icon: mdi:account-arrow-right
  alarm_pending:
    initial: false
  alarm_triggered:
    name: 'Alarm Triggered'
    icon: mdi:alarm-light
    initial: false
  alarm_temp_override:
    initial: false

counter:
  alarm_code_error_count:
    name: 'Alarm Error Count'
    icon: mdi:counter
    initial: 0
    step: 1
    restore: true

input_text:
  current_alarm:
    name: 'Current Alarm'
    icon: mdi:shield-alert
  alarm_disarmed_by:
    name: 'Alarm Disarmed By'
    icon: mdi:account-key

  cam1_snapshot1:
  cam1_snapshot2:
  cam1_snapshot3:
  cam2_snapshot1:
  cam2_snapshot2:
  cam2_snapshot3:
  cam3_snapshot1:
  cam3_snapshot2:
  cam3_snapshot3:
  cam4_snapshot1:
  cam4_snapshot2:
  cam4_snapshot3:

timer:
  alarm_arming:
    name: 'Alarm Arming'
    icon: mdi:progress-clock
  alarm_pending:
    name: 'Alarm Pending'
    icon: mdi:progress-clock
  alarm_triggered_reset:
    name: 'Alarm Triggered Reset'
    icon: mdi:progress-clock
    duration:
      minutes: 5

alert:
  alarm_disarmed:
    name: 'Alarm Disarmed'
    title: 'Alarm Disarmed'
    message: >
      Alarm disarmed - nobody home.
      {%- if is_state('input_boolean.alarm_triggered','on') -%}
      Alarm: {{ states('input_text.current_alarm') }}<br/>
      {%- endif -%}
      Disarmed by: {{ states('input_text.alarm_disarmed_by') }}
    done_message: clear_notification
    entity_id: binary_sensor.alarm_disarmed_alert
    state: 'on'
    repeat: 5
    notifiers: alarm
    data:
      tag: alarm_disarmed_alert
      group: Alarm
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      persistant: true
      sticky: true
      notification_icon: mdi:alarm-light
      icon_url: !secret ALARM_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/alarm
      actions:
        - title: 'Home'
          action: arm_alarm_home_override

        - title: 'Away'
          action: arm_alarm_away_override

        - title: 'Cameras'
          action: URI
          uri: app://com.flir.consumer.flir.lorexcloud

  alarm_disabled:
    name: 'Alarm Disabled'
    title: 'Alarm Disabled'
    message: >
      {%- if is_state('input_boolean.alarm_automation','off') -%} The house alarm has been disabled. {%- endif -%}
      {%- if is_state('input_boolean.alarm_auto_arming','off') -%} House alarm auto arming has been turned off. {%- endif -%}
    done_message: clear_notification
    entity_id: binary_sensor.alarm_disabled_alert
    state: 'on'
    repeat:
      - 120
      - 720
      - 1440
    notifiers: jason
    data:
      tag: alarm_disabled
      group: Alarm
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      persistant: true
      notification_icon: mdi:alarm-light
      icon_url: !secret ALARM_ICON
      ledColor: !secret SEVERE_COLOR
      color: !secret SEVERE_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/alarm
      actions:
        - title: 'Enable'
          action: enable_alarm

        - title: 'Auto Arm'
          action: turn_on_auto_arming

        - title: 'Pause Alert'
          action: pause_alarm_disabled

  garage_disarmed:
    name: 'Garage Disarmed'
    title: 'Garage Disarmed'
    message: >
      Disarmed: {{ states.alarm_control_panel.garage.last_changed|as_timestamp|timestamp_custom('%-I:%M %p',true,none) }}
      Master Status: {{ states('sensor.alarm_status') }}
    done_message: clear_notification
    entity_id: binary_sensor.garage_disarmed_alert
    state: 'on'
    repeat:
      - 30
    notifiers: jason
    data:
      tag: garage_disarmed
      group: Alarm
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      persistant: true
      notification_icon: mdi:alarm-light
      icon_url: !secret ALARM_ICON
      ledColor: !secret SEVERE_COLOR
      color: !secret SEVERE_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/garage
      actions:
        - title: 'Arm Garage'
          action: arm_garage_alarm

        - title: 'Cameras'
          action: URI
          uri: app://com.flir.consumer.flir.lorexcloud

        - action: pause_garage_disarmed
          title: 'Pause'
