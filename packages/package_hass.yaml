#######################################################################################################################
## Package - Hass
#######################################################################################################################
homeassistant:
  customize:
    alert.unavailable_sensor:
      friendly_name: Sensor Offline
      icon: mdi:smoke-detector
      category: hass
    alert.unknown_browser:
      friendly_name: Unknown Browser
      icon: mdi:monitor-dashboard
      category: hass
    alert.device_offline:
      friendly_name: Device Offline
      icon: mdi:router-wireless-off
      category: hass
    alert.integration_connected:
      icon: mdi:api-off
      category: hass
    alert.zwave_network:
      friendly_name: ZWave Device
      icon: mdi:z-wave
      category: hass
    alert.remote_ui:
      friendly_name: Remote UI
      icon: mdi:remote-desktop
      category: hass

    binary_sensor.remote_ui:
      icon: mdi:remote-desktop

    sensor.hassio_db:
      icon: mdi:database

    sensor.uptime:
      friendly_name: Hassio Uptime
      icon: mdi:clock-start

    sensor.browser_jlaptop_chrome_nabucasa:
      friendly_name: Jason - Nabu Casa (Chrome)
      icon: mdi:laptop-windows
      authorized: true
    sensor.browser_jlaptop_chrome_local:
      friendly_name: Jason - Local (Chrome)
      icon: mdi:laptop-windows
      authorized: true
    sensor.browser_jlaptop_chrome_direct:
      friendly_name: Jason - Direct IP (Chrome)
      icon: mdi:laptop-windows
      authorized: true
    sensor.browser_jlaptop_chrome_duckdns:
      friendly_name: Jason - DuckDNS (Chrome)
      icon: mdi:laptop-windows
      authorized: true

    sensor.browser_jwork_chrome_direct:
      friendly_name: Jason - Work (Chrome)
      icon: mdi:laptop-windows
      authorized: true

    sensor.browser_jphone_app_internal:
      friendly_name: Jason - Mobile Internal (Chrome)
      icon: mdi:cellphone-iphone
      authorized: true
    sensor.browser_jphone_app_external:
      friendly_name: Jason - Mobile External (Chrome)
      icon: mdi:cellphone-iphone
      authorized: true
    sensor.browser_sphone_app_internal:
      friendly_name: Sheri - Mobile Internal (Chrome)
      icon: mdi:cellphone-iphone
      authorized: true
    sensor.browser_sphone_app_external:
      friendly_name: Sheri - Mobile External (Chrome)
      icon: mdi:cellphone-iphone
      authorized: true

shell_command:
###################################################################################################
## Shell Commands
## https://www.home-assistant.io/components/shell_command/
###################################################################################################
  tts_purge_all: 'sh shell/tts_purge_all.sh'
  tts_purge_old: 'sh shell/tts_purge_old.sh'
  alarm_snapshots_purge_all: 'sh shell/alarm_snapshots_purge_all.sh'
  alarm_snapshots_purge_old: 'sh shell/alarm_snapshots_purge_old.sh'
  git_update: 'sh shell/gitupdate.sh'

panel_custom:
  - name: zwave-graph-panel
    url_path: zwave-graph
    sidebar_title: Z-Wave Graph
    sidebar_icon: mdi:z-wave
    module_url: /local/zwavegraph3.js
    config:
      # ranker - pick one: network-simplex, tight-tree, longest-path
      ranker: network-simplex
      # edge_visibility - pick one: relevant, all
      edge_visibility: relevant
      # grouping - pick one: z-wave, ungrouped
      grouping: z-wave

input_boolean:
#######################################################################################################################
## Manual Mode
#######################################################################################################################
  manual_mode:
    name: Manual Mode
    icon: mdi:minus-circle

#######################################################################################################################
## Enable Alerts
#######################################################################################################################
  alerts_enabled:
    name: Enable Alerts
    icon: mdi:alert

#######################################################################################################################
## Startup Pending
#######################################################################################################################
  startup_pending:
    name: Startup
    icon: mdi:home-assistant
    initial: true

  supplemental_logging:
    name: Supplemental Logging
    icon: mdi:format-list-bulleted-square

  restart_unlock:
    name: Restart Unlock
    icon: mdi:lock

input_select:
#######################################################################################################################
## Log Level
#######################################################################################################################
  log_level:
    name: Log Level
    icon: mdi:format-indent-decrease
    options:
      - critical
      - fatal
      - error
      - warning
      - warn
      - info
      - debug
      - notset

group:
#######################################################################################################################
## Automation Contols
## - used to show disabled automations in lovelace
#######################################################################################################################
  automation_controls:
    icon: mdi:google-circles-group
    all: true
    entities:
      - input_boolean.ceiling_fan_automation
      - input_boolean.alarm_automation
      - input_boolean.climate_automation
      - input_boolean.garage_climate_automation
      - input_boolean.garage_door_automation
      - input_boolean.light_automation
      - input_boolean.media_player_automation
      - input_boolean.presence_automation
      - input_boolean.schedule_automation
      - input_boolean.sensor_automation
      - input_boolean.system_automation
      - input_boolean.weather_automation
      - input_boolean.vent_fan_automation

#######################################################################################################################
## Occupancy Bypass Automations  #NEW_LIGHT  #NEW_CEILING_FAN
## - used to bypass occupancy mode automation automations
#######################################################################################################################
  occupancy_bypass_automations:
    entities:
      - automation.ceiling_fan_office_fan_auto_off
      - automation.ceiling_fan_upstairs_bedroom_fan_auto_off
      - automation.garage_climate_auto_off
      - automation.garage_door_auto_close
      - automation.alarm_occupancy_mode_control
      - automation.climate_occupancy_mode_control
      - automation.media_player_auto_off

      - automation.presence_occupancy_mode
      - automation.presence_occupancy_notification
      - automation.schedule_manual_wake_up

      - automation.light_back_house_potlights_nobody_home
      - automation.light_back_house_potlights_auto_on
      - automation.light_back_house_potlights_auto_off
      - automation.light_back_yard_garden_light_auto_on
      - automation.light_back_yard_garden_light_auto_off
      - automation.light_back_yard_tree_floodlights_auto_on
      - automation.light_back_yard_tree_floodlights_auto_off
      - automation.light_dining_room_light_nobody_home
      - automation.light_dining_room_light_auto_off
      - automation.light_dining_room_potlights_auto_off
      - automation.light_front_house_potlights_nobody_home
      - automation.light_front_house_potlights_auto_on
      - automation.light_front_house_potlights_auto_on
      - automation.light_front_house_potlights_auto_off
      - automation.light_front_porch_light_nobody_home
      - automation.light_front_porch_light_auto_on
      - automation.light_kitchen_sink_light_auto_off
      - automation.light_kitchen_potlights_auto_off
      - automation.light_living_room_potlights_auto_off
      - automation.light_living_room_cove_light_auto_off
      - automation.light_master_bedroom_light_auto_off
      - automation.light_office_light_auto_off
      - automation.light_office_potlights_auto_off
      - automation.light_outside_garage_lights_nobody_home
      - automation.light_outside_garage_lights_auto_on
      - automation.light_outside_garage_lights_auto_off
      - automation.light_side_entrance_light_auto_off
      - automation.light_upstairs_bathroom_vanity_light_auto_off
      - automation.light_upstairs_bathroom_shower_light_auto_off
      - automation.light_upstairs_bedroom_light_auto_off
      - automation.light_upstairs_bedroom_potlights_auto_off
      - automation.light_upstairs_hallway_potlights_auto_off

#######################################################################################################################
## Integration Connected Sensors
## - used to display offline integrations in alert
## - used for binary_sensor.integration_connected state
#######################################################################################################################
  integration_connected_sensors:
    all: true
    entities:
      - binary_sensor.balboa_connected
      - binary_sensor.dark_sky_connected
      - binary_sensor.flu_connected
      - binary_sensor.myq_connected
      - binary_sensor.google_calendar_connected
      - binary_sensor.google_location_connected
      - binary_sensor.google_traffic_connected
      - binary_sensor.hassio_connected
      - binary_sensor.hyrdrawise_connected
      - binary_sensor.lutron_connected
      - binary_sensor.nest_connected
      - binary_sensor.noaa_connected
      - binary_sensor.openuv_connected
      - binary_sensor.pollen_connected
      - binary_sensor.spotify_connected
      - binary_sensor.waqi_connected

#######################################################################################################################
## Nest Devices
## - used for sensor.offline_devices
#######################################################################################################################
  nest_devices:
    entities:
      - binary_sensor.downstairs_nest_protect_online
      - binary_sensor.upstairs_nest_protect_online
      - binary_sensor.upstairs_thermostat_online

#######################################################################################################################
## Ignored Trackers - used for sensor.online_network_devices
#######################################################################################################################
  ignored_trackers:
    entities:
      - device_tracker.jphone
      - device_tracker.sphone
      - device_tracker.jason_tracker
      - device_tracker.sheri_tracker

      - device_tracker.jphone_bt
      - device_tracker.sphone_bt
      - device_tracker.jlaptop_bt
      - device_tracker.fugoo_speaker_bt
      - device_tracker.sheri_headphones_bt
      - device_tracker.jason_headphones_bt
      - device_tracker.google_maps_101131226839468750203
      - device_tracker.google_maps_115097751563829374630
      - device_tracker.jphone_ping
      - device_tracker.sphone_ping
      - device_tracker.jlaptop_wifi_ping

      - device_tracker.laundry_room_speaker_bt
      - device_tracker.living_room_speaker_bt
      - device_tracker.bathroom_speaker_bt
      - device_tracker.bedroom_display_bt
      - device_tracker.dining_room_display_bt
      - device_tracker.garage_speaker_bt

#######################################################################################################################
## Ignored Sensors
#######################################################################################################################
  ignored_sensors:
    entities: !include /config/include/entities/ignored_entities.yaml

binary_sensor:
#######################################################################################################################
## Uptime Robot  https://uptimerobot.com/  binary_sensor.hassio
#######################################################################################################################
  - platform: uptimerobot
    api_key: !secret UPTIME_API

  - platform: template
    sensors:
#######################################################################################################################
## Startup Complete
## sensor used so we can reverse boolean logic (required to allow startup boolean in glance menus)
#######################################################################################################################
      startup_complete:
        unique_id: startup_complete
        value_template: "{{ is_state('input_boolean.startup_pending','off') }}"

#######################################################################################################################
## Automation Disabled
#######################################################################################################################
      automation_disabled:
        friendly_name: Automation
        unique_id: automation_disabled
        icon_template: mdi:sync-alert
        value_template: "{{ states('group.automation_controls') == 'off' }}"

#######################################################################################################################
## Alert Disabled
#######################################################################################################################
      alert_disabled:
        friendly_name: Alert
        unique_id: alert_disabled
        icon_template: mdi:alert
        value_template: "{{ states.alert|selectattr('state','eq','off')|list|count > 0 }}"

#######################################################################################################################
## Alert Enabled - used in conditions/sensors to prevent tts / mobile app / push alerts
#NOTE all alerts/notifications disabled until startup complete to prevent false triggers
#NOTE  disables alerts in glance menus in lovelace
#######################################################################################################################
      alerts_enabled:
        unique_id: alerts_enabled
        value_template: "{{ is_state('input_boolean.alerts_enabled','on') and is_state('binary_sensor.startup_complete','on') }}"

#######################################################################################################################
## Hassio Connected - Uptime Robot
#NOTE overload sensor - if uptime robot component not connected binary_sensor.hassio is not available to hassio
########################################################################################################################
      hassio_connected:
        friendly_name: Uptime Robot
        unique_id: hassio_connected
        icon_template: "{{ 'mdi:sort-clock-descending' if is_state('binary_sensor.hassio_connected','on') else 'mdi:alert-circle' }}"
        device_class: connectivity
        value_template: "{{ is_state('binary_sensor.hassio','on') }}"

      hassio_connected_alert:
        friendly_name: Uptime Robot
        unique_id: hassio_connected_alert
        icon_template: mdi:alert-circle
        value_template: "{{ is_state('binary_sensor.hassio_connected','off') and is_state('binary_sensor.alerts_enabled','on') }}"

#######################################################################################################################
## Integration Connected
#######################################################################################################################
      integration_connected:
        friendly_name: Integrations
        unique_id: integration_connected
        icon_template: "{{ 'mdi:api' if is_state('binary_sensor.integration_connected','on') else 'mdi:api-off' }}"
        device_class: connectivity
        value_template: "{{ is_state('group.integration_connected_sensors','on') }}"

      integration_connected_alert:
        unique_id: integration_connected_alert
        delay_on:
          minutes: 15
        value_template: "{{ is_state('binary_sensor.integration_connected','off') and is_state('binary_sensor.alerts_enabled','on') }}"

#######################################################################################################################
## ZWave Network
#######################################################################################################################
      zwave_network_alert:
        unique_id: zwave_network_alert
        delay_on:
          minutes: 5
        value_template: "{{ not is_state('sensor.zwave_unavailable_devices','0') and is_state('binary_sensor.alerts_enabled','on') }}"

#######################################################################################################################
## Remote UI
#######################################################################################################################
      remote_ui_alert:
        unique_id: remote_ui_alert
        delay_on:
          minutes: 5
        value_template: "{{ states('binary_sensor.remote_ui') in ['off','unavailable','unknown','none'] and is_state('binary_sensor.alerts_enabled','on') }}"

#######################################################################################################################
## Device Offline
#######################################################################################################################
      device_offline_alert:
        unique_id: device_offline_alert
        delay_on:
          minutes: 15
        value_template: "{{ states('sensor.offline_devices')|int > 0 and is_state('binary_sensor.alerts_enabled','on') }}"

#######################################################################################################################
## Unavailable Sensor
#######################################################################################################################
      unavailable_sensor_alert:
        unique_id: unavailable_sensor_alert
        delay_on:
          minutes: 15
        value_template: "{{ states('sensor.unavailable_sensors')|int > 0 and is_state('binary_sensor.alerts_enabled','on') }}"

#######################################################################################################################
## Unknown Browser Alert
#######################################################################################################################
      unknown_browser_alert:
        unique_id: unknown_browser_alert
        value_template: "{{ states('sensor.unknown_browsers')|int > 0 and is_state('binary_sensor.alerts_enabled','on') }}"

sensor:
#######################################################################################################################
## Authenticated Users Sensor   https://github.com/custom-components/authenticated
#######################################################################################################################
  - platform: authenticated
    enable_notification: true
    exclude:
      - !secret HASSIO_IP
      - !secret JLAPTOP_WIFI_IP
      - !secret JPHONE_IP
      - !secret SPHONE_IP
      - 127.0.0.1
    provider: ipapi  # ipapi, extreme, ipvigilante
    log_location: '/config/home-assistant.log'

#######################################################################################################################
## Github Sensor   https://www.home-assistant.io/components/sensor.github/
#######################################################################################################################
  - platform: github
    access_token: !secret GIT_SENSOR_TOKEN
    repositories:
      - path: 'jazzyisj/home-assistant-config'
        name: Jazzyisj Hassio Git

#######################################################################################################################
## Folder Size Sensors  https://www.home-assistant.io/integrations/folder/
## path must ben in allowlist_external_dirs
#######################################################################################################################
  - platform: folder
    folder: '/config/www/alarm_snapshots'
    filter: '*'

  - platform: folder
    folder: '/config/tts'
    filter: '*'

#######################################################################################################################
## Hassio Database File Size
## https://www.home-assistant.io/integrations/sql/
## https://www.home-assistant.io/integrations/filesize/
## path must ben in allowlist_external_dirs
#######################################################################################################################
  - platform: filesize #OPTION when using sqlite
    file_paths: /config/home-assistant_v2.db

#OPTION - platform: sql
#   db_url: !secret MARIADB_URL
#   queries:
#     - name: Hassio DB
#       query: 'SELECT table_schema "database", Round(Sum(data_length + index_length) / 1048576, 2) "value" FROM information_schema.tables WHERE table_schema="homeassistant" GROUP BY table_schema;'
#       column: 'value'
#       unit_of_measurement: MB

#######################################################################################################################
## Uptime Sensor
#######################################################################################################################
  - platform: uptime

  - platform: template
    sensors:
#######################################################################################################################
## Dummy Sensor - sensor for custom dummy headers
#######################################################################################################################
      dummy:
        value_template: ' '

#######################################################################################################################
## Remote UI Connections
## - state: number of UI browsers active
## - attributes: list of active browsers
#######################################################################################################################
      remote_ui_connected:
        friendly_name: Remote UI Connected
        unique_id: remote_ui_connected
        unit_of_measurement: browsers
        icon_template: mdi:laptop
        value_template: "{{ states.sensor|selectattr('attributes.type','eq','browser_mod')|list|count }}"
        attribute_templates:
          browsers: "{{ states.sensor|selectattr('attributes.type','eq','browser_mod')|map(attribute='name')|join('\n') }}"

#######################################################################################################################
## Unknown Browser
#######################################################################################################################
      unknown_browsers:
        unique_id: unknown_browsers
        value_template: >
          {{ states.sensor|selectattr('attributes.type','eq','browser_mod')
              |selectattr('attributes.authorized','ne',true)|list|count }}
        attribute_templates:
          browsers: >
            {{ states.sensor|selectattr('attributes.type','eq','browser_mod')
              |selectattr('attributes.authorized','ne',true)|map(attribute='entity_id')|list }}

#######################################################################################################################
## HA Uptime Sensor
## display home assistant system uptime in friendly format
#######################################################################################################################
      ha_uptime:
        friendly_name: Home Assistant Uptime
        unique_id: ha_uptime
        icon_template: mdi:clock-start
        value_template: >
          {% set up_time = as_timestamp(now()) - as_timestamp(states('sensor.uptime')) %}
          {% set minutes = (up_time // 60)|int %}
          {% set hours = (minutes // 60) %}
          {% set days = (hours // 24) %}
          {% set weeks = (days // 7) %}
          {% set minutes = (minutes % 60) %}
          {% set hours =  (hours % 24) %}
          {% set days = (days % 7) %}
          {% macro phrase(value, name) %}
            {%- set value = value %}
            {%- set end = 's' if value > 1 else '' %}
            {{- '{} {}{}'.format(value, name, end) if value|int > 0 else '' }}
          {%- endmacro %}
          {% set text = [ phrase(weeks, 'week'), phrase(days, 'day'), phrase(hours, 'hr'), phrase(minutes, 'min') ]|select('!=','')|list|join(', ') %}
          {% set last_comma = text.rfind(',') %}
          {% if last_comma != -1 %}
            {% set text = text[:last_comma] + ' and' + text[last_comma + 1:] %}
          {% endif %}
          {{ text }}

#######################################################################################################################
## Last Restart Date & Time
## display last hass restart date/time in friendly format
#######################################################################################################################
      last_restart_date_time:
        friendly_name: Last Restart Date
        unique_id: last_restart_date_time
        icon_template: mdi:clock-start
        value_template: >
          {% set date = as_timestamp(states('sensor.uptime'))|timestamp_custom('%d') %}
          {% set date = '{:01}'.format(date|int) %}
          {% if date in ('1','21','31') %}{% set date = date ~ 'st' %}
          {% elif now().day in ('2','22') %}{% set date = date ~ 'nd' %}
          {% elif now().day in ('3','23') %}{% set date = date ~ 'rd' %}
          {% else %}{% set date = date ~ 'th' %}
          {% endif %}
          {{ as_timestamp(states('sensor.uptime'))|timestamp_custom('%H:%M on %a') }} {{ date }} {{ as_timestamp(states('sensor.uptime'))|timestamp_custom('%b %Y',true) }}

  #OPTION {{ as_timestamp(states('sensor.uptime'))|timestamp_custom('%a %b %d %Y, %-I:%M:%S %p',true) }}

#######################################################################################################################
## Offline Devices
## - state: number of offline devices
## - attribute: entities: - comma separated list of unavailable device entity id's
## - Nest devices separate, binary sensor shows off state when unavailable
#######################################################################################################################
      offline_devices:
        friendly_name_template: "{{ 'All Devices Online' if is_state('sensor.offline_devices','0') else 'Offline Devices' }}"
        unit_of_measurement: devices
        unique_id: offline_devices
        icon_template: "{{ 'mdi:check-circle' if is_state('sensor.offline_devices','0') else 'mdi:alert-circle' }}"
        value_template:  >
          {% set devices = states|selectattr('domain','in',['alarm_control_panel','cover','light','switch','fan','climate','camera','media_player'])
              |selectattr('state','in',['unavailable','unknown','none'])
              |rejectattr('entity_id','in',state_attr('group.ignored_sensors','entity_id'))
              |map(attribute='entity_id')|list|count %}
          {% set nest_devices = states|selectattr('entity_id','in',state_attr('group.nest_devices','entity_id'))
              |selectattr('state','in',['unavailable','unknown','none','off'])|list|count %}
          {{ devices + nest_devices }}
        attribute_templates:
          entities: >
            {% set devices = states|selectattr('domain','in',['alarm_control_panel','cover','light','switch','fan','climate','camera','media_player'])
                |selectattr('state','in',['unavailable','unknown','none'])
                |rejectattr('entity_id','in',state_attr('group.ignored_sensors','entity_id'))|list %}
            {% set nest_devices = states|selectattr('entity_id','in',state_attr('group.nest_devices','entity_id'))
                |selectattr('state','in',['unavailable','unknown','none','off'])|list %}
            {{ (devices + nest_devices)|map(attribute='entity_id')|list }}

#######################################################################################################################
## ZWave Unavailable Devices
#ISSUE when zwave devices go unavailable they are no longer in the zwave domain??
#######################################################################################################################
      zwave_unavailable_devices:
        friendly_name_template: "{{ 'Zwave Devices All Online' if is_state('sensor.zwave_unavailable_devices','0') else 'ZWave Device Offline'}}"
        unit_of_measurement: devices
        unique_id: zwave_unavailable_devices
        icon_template: "{{ 'mdi:z-wave' if is_state('sensor.zwave_unavailable_devices','0') else 'mdi:alert-circle' }}"
        value_template: "{{ states.zwave|selectattr('state','ne','ready')|list|length }}"
        attribute_templates:
          entities: >
            {{ states.zwave|selectattr('state','ne','ready')|reject('in',state_attr('group.ignored_sensors','entity_id'))|map(attribute='entity_id')|list }}

#######################################################################################################################
## Unavailable Sensors
## state: number of unavailable sensors
## attribute: sensor_entities: - comma separated list of unavailable sensor entity id's
## - sensor entity_id's in ignored_sensors are filtered
#######################################################################################################################
      unavailable_sensors:
        friendly_name_template: "{{ 'Sensors All Available' if is_state('sensor.unavailable_sensors','0') else 'Unavailable Sensors'}}"
        unit_of_measurement: sensors
        unique_id: unavailable_sensors
        icon_template: "{{ 'mdi:check-circle' if is_state('sensor.unavailable_sensors','0') else 'mdi:alert-circle' }}"
        value_template: >
            {{ states|selectattr('domain','in',['sensor','binary_sensor','variable'])|selectattr('state','in',['unavailable','unknown','none'])
                |rejectattr('entity_id','in',state_attr('group.ignored_sensors','entity_id'))|map(attribute='entity_id')|list|count }}
        attribute_templates:
          entities: >
            {{ states|selectattr('domain','in',['sensor','binary_sensor','variable'])|selectattr('state','in',['unavailable','unknown','none'])
                |rejectattr('entity_id','in',state_attr('group.ignored_sensors','entity_id'))|map(attribute='entity_id')|list }}

#######################################################################################################################
## Hass Config
#######################################################################################################################
  - platform: rest
    name: Hass Config
    resource: http://homeassistant:8123/api/config
    value_template: "{{value_json.version}}"
    scan_interval: 3600
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$"
    json_attributes:
      - latitude
      - longitude
      - elevation
      - components
      - unit_system
      - config_dir
      - whitelist_external_dirs
      - allowlist_external_dirs
      - allowlist_external_urls
      - config_source
      - safe_mode
      - state
      - external_url
      - internal_url

# curl http://homeassistant:8123/api/config -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiI2YmQ1NDgzZDhlOWQ0NTY2YTBlNjk0MzI0ZmQ4ZWFlNCIsImlhdCI6MTYwMjYyMzk1MywiZXhwIjoxOTE3OTgzOTUzfQ.3CFjFbHOy_SO2_PpdXJkVPKiD1FfFZ3mHYoDh5QNn34"
#{"latitude": 42.30426767004279, "longitude": -82.92521171271802, "elevation": 190, "unit_system": {"length": "mi", "mass": "lb", "pressure": "psi", "temperature": "\u00b0F", "volume": "gal"}, "location_name": "Home", "time_zone": "America/Toronto", "components": ["cover.zwave", "cover.myq", "sensor.local_ip", "local_ip", "search", "composite", "sensor.mobile_app", "fan.zwave", "sensor.noaa_alerts", "sensor.nws_alerts", "api", "sensor.statistics", "switch.lutron_caseta", "ssdp", "input_text", "sensor.template", "climate.zwave", "homekit_controller", "hacs", "light.zwave", "breaking_changes", "iqvia", "camera.browser_mod", "nws_alerts", "stream", "auth", "camera.generic", "image", "cover.lutron_caseta", "binary_sensor", "proximity", "binary_sensor.template", "zone", "media_player.spotify", "light.lutron_caseta", "sensor", "sensor.systemmonitor", "device_tracker.mobile_app", "cast", "alarm_control_panel", "input_number", "script", "frontend", "sensor.filesize", "device_tracker", "notify.mobile_app", "nest", "binary_sensor.ping", "sensor.waqi", "sensor.upnp", "utility_meter", "notify.group", "sensor.speedtestdotnet", "fan.balboa", "scene.homeassistant", "automation", "sensor.nest", "notify.smtp", "tag", "binary_sensor.cloud", "system_health", "binary_sensor.onvif", "alarm_control_panel.bwalarm", "sensor.browser_mod", "config", "camera.nest", "notify.tts", "group", "sensor.hydrawise", "sensor.darksky", "map", "switch.hydrawise", "notify", "camera.environment_canada", "lock", "rpi_power", "google", "sensor.moon", "camera.onvif", "logger", "binary_sensor.threshold", "sensor.google_travel_time", "spotify", "sensor.onvif", "sensor.spotcast", "homeassistant", "sensor.history_stats", "mobile_app", "websocket_api", "sensor.folder", "media_extractor", "default_config", "history", "spotcast", "switch.zwave", "camera", "media_player.browser_mod", "lock.zwave", "geo_location.gdacs", "binary_sensor.hydrawise", "light.switch", "sensor.command_line", "binary_sensor.nest", "http", "weather", "binary_sensor.workday", "zeroconf", "climate.nest", "speedtestdotnet", "sensor.illuminance", "sensor.github", "light", "sensor.season", "ffmpeg", "switch", "climate.balboa", "flunearyou", "persistent_notification", "binary_sensor.lutron_caseta", "geo_location", "binary_sensor.browser_mod", "updater", "sensor.zwave", "zwave", "light.browser_mod", "shell_command", "calendar", "sun", "media_source", "browser_mod", "sensor.utility_meter", "fan", "sensor.flunearyou", "lutron_caseta", "alexa", "webhook", "input_select", "discovery", "binary_sensor.rpi_power", "binary_sensor.zwave", "switch.flux", "person", "hassio", "media_player.cast", "sensor.breaking_changes", "input_boolean", "balboa", "switch.balboa", "recorder", "rest_command", "sensor.time_date", "hydrawise", "calendar.google", "scene.lutron_caseta", "cloud", "binary_sensor.balboa", "sensor.iqvia", "system_log", "logbook", "tts", "binary_sensor.openuv", "sensor.gdacs", "notify.html5", "myq", "sensor.version", "fan.lutron_caseta", "sensor.openuv", "light.group", "input_datetime", "alert", "sensor.mold_indicator", "onvif", "media_player", "sensor.uptime", "variable", "sensor.integration", "fan.template", "cover", "binary_sensor.mobile_app", "counter", "gdacs", "openuv", "upnp", "binary_sensor.updater", "sensor.authenticated", "sensor.rest", "timer", "lovelace", "device_automation", "sensor.dnsip", "sensor.scrape", "scene", "climate", "onboarding", "blueprint", "sensor.hacs", "stt"], "config_dir": "/config", "whitelist_external_dirs": ["/config", "/config/www/alarm_snapshots", "/config/www/images", "/config/www", "/config/www/alarm_clock_sounds"], "allowlist_external_dirs": ["/config", "/config/www/alarm_snapshots", "/config/www/images", "/config/www", "/config/www/alarm_clock_sounds"], "allowlist_external_urls": [], "version": "2020.12.1", "config_source": "storage", "safe_mode": false, "state": "RUNNING", "external_url": "https://82l1mjsgl3dp23jw4nd1sh0n7ykww05d.ui.nabu.casa/", "internal_url": "http://192.168.1.110:8123"}

#######################################################################################################################
## Hass Core
#######################################################################################################################
  - platform: rest
    resource: http://homeassistant:8123/api/hassio/core/stats
    name: Hass Core Status
    unit_of_measurement: '%'
    value_template: "{{ 'OK' if value_json.result == 'ok' else 'ERROR' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      hass_core_cpu:
        friendly_name: Hass Core CPU
        unique_id: hass_core_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.hass_core_status','cpu_percent')|float)|round(1) }}"

      hass_core_memory:
        friendly_name: Hass Core Memory
        unique_id: hass_core_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.hass_core_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.hass_core_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.hass_core_status','memory_limit')|float/1048576)|round(1) }}"

      hass_core_network:
        friendly_name: Hass Core Network
        unique_id: hass_core_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.hass_core_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.hass_core_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Hass Supervisor
#######################################################################################################################
  - platform: rest
    resource: http://homeassistant:8123/api/hassio/supervisor/stats
    name: Hass Supervisor Status
    unit_of_measurement: '%'
    value_template: "{{ 'OK' if value_json.result == 'ok' else 'ERROR' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      hass_supervisor_cpu:
        friendly_name: Hass Supervisor CPU
        unique_id: hass_supervisor_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.hass_supervisor_status','cpu_percent')|float)|round(1) }}"

      hass_supervisor_memory:
        friendly_name: Hass Supervisor Memory
        unique_id: hass_supervisor_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.hass_supervisor_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.hass_supervisor_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.hass_supervisor_status','memory_limit')|float/1048576)|round(1) }}"

      hass_supervisor_network:
        friendly_name: Hass Supervisor Network
        unique_id: hass_supervisor_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.hass_supervisor_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.hass_supervisor_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Assistant Relay
#######################################################################################################################
#OPTION - platform: command_line
#   name: Assistant Relay Status
#   command: 'curl http://supervisor/addons/6a3d001f_assistant_relay/stats -H "Authorization: Bearer $SUPERVISOR_TOKEN"'
#   value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
#   scan_interval: 60
#   json_attributes:
#     - data

# {"result": "ok", "data": {"cpu_percent": 0.0, "memory_usage": 13029376, "memory_limit": 968667136, "memory_percent": 1.35, "network_rx": 119096767, "network_tx": 12826919, "blk_read": 60043264, "blk_write": 32768}}

  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/6a3d001f_assistant_relay/stats
    name: Assistant Relay Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      assistant_relay_cpu:
        friendly_name: Assistant Relay CPU
        unique_id: assistant_relay_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.assistant_relay_status','cpu_percent')|float)|round(1) }}"

      assistant_relay_memory:
        friendly_name: Assistant Relay Memory
        unique_id: assistant_relay_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.assistant_relay_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.assistant_relay_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.assistant_relay_status','memory_limit')|float/1048576)|round(1) }}"

      assistant_relay_network:
        friendly_name: Assistant Relay Network
        unique_id: assistant_relay_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.assistant_relay_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.assistant_relay_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Cloud IDE
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/a0d7b954_ide/stats
    name: Cloud IDE Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      cloud_ide_cpu:
        friendly_name: Cloud IDE CPU
        unique_id: cloud_ide_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.cloud_ide_status','cpu_percent')|float)|round(1) }}"

      cloud_ide_memory:
        friendly_name: Cloud IDE Memory
        unique_id: cloud_ide_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.cloud_ide_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.cloud_ide_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.cloud_ide_status','memory_limit')|float/1048576)|round(1) }}"

      cloud_ide_network:
        friendly_name: Cloud IDE Network
        unique_id: cloud_ide_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.cloud_ide_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.cloud_ide_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## SSH Terminal
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/a0d7b954_ssh/stats
    name: SSH Terminal Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      ssh_terminal_cpu:
        friendly_name: SSH Terminal CPU
        unique_id: ssh_terminal_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.ssh_terminal_status','cpu_percent')|float)|round(1) }}"

      ssh_terminal_memory:
        friendly_name: SSH Terminal Memory
        unique_id: ssh_terminal_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.ssh_terminal_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.ssh_terminal_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.ssh_terminal_status','memory_limit')|float/1048576)|round(1) }}"

      ssh_terminal_network:
        friendly_name: SSH Terminal Network
        unique_id: ssh_terminal_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.ssh_terminal_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.ssh_terminal_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Config Check
# curl http://homeassistant:8123/api/hassio/addons/core_check_config/stats -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiI2YmQ1NDgzZDhlOWQ0NTY2YTBlNjk0MzI0ZmQ4ZWFlNCIsImlhdCI6MTYwMjYyMzk1MywiZXhwIjoxOTE3OTgzOTUzfQ.3CFjFbHOy_SO2_PpdXJkVPKiD1FfFZ3mHYoDh5QNn34"
#######################################################################################################################
  # - platform: rest
  #   resource:  http://homeassistant:8123/api/hassio/addons/core_check_config/stats
  #   name: Config Check Status
  #   value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
  #   scan_interval: 60
  #   verify_ssl: false
  #   headers:
  #     Authorization: !secret HASS_CONFIG
  #     Content-Type: application/json
  #   json_attributes_path: "$.data"
  #   json_attributes:
  #     - cpu_percent
  #     - memory_usage
  #     - memory_limit
  #     - memory_percent
  #     - network_rx
  #     - network_tx

  # - platform: template
  #   sensors:
  #     config_check_cpu:
  #       friendly_name: Config Check CPU
  #       unique_id: config_check_cpu
  #       unit_of_measurement: '%'
  #       icon_template: mdi:cpu-32-bit
  #       value_template: "{{ (state_attr('sensor.config_check_status','cpu_percent')|float)|round(1) }}"

  #     config_check_memory:
  #       friendly_name: Config Check Memory
  #       unique_id: config_check_memory
  #       unit_of_measurement: '%'
  #       icon_template: mdi:memory
  #       value_template: "{{ (state_attr('sensor.config_check_status','memory_percent')|float)|round(1) }}"
  #       attribute_templates:
  #         memory_usage: "{{ (state_attr('sensor.config_check_status','memory_usage')|float/1048576)|round(1) }}"
  #         memory_limit: "{{ (state_attr('sensor.config_check_status','memory_limit')|float/1048576)|round(1) }}"

  #     config_check_network:
  #       friendly_name: Config Check Network
  #       unique_id: config_check_network
  #       unit_of_measurement: 'MB'
  #       icon_template: mdi:download-network
  #       value_template: "{{ (state_attr('sensor.config_check_status','network_tx')|float/1048576)|round(1) }}"
  #       attribute_templates:
  #         network_rx: "{{ (state_attr('sensor.config_check_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Log Viewer
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/a0d7b954_logviewer/stats
    name: Log Viewer Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      log_viewer_cpu:
        friendly_name: Log Viewer CPU
        unique_id: log_viewer_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.log_viewer_status','cpu_percent')|float)|round(1) }}"

      log_viewer_memory:
        friendly_name: Log Viewer Memory
        unique_id: log_viewer_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.log_viewer_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.log_viewer_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.log_viewer_status','memory_limit')|float/1048576)|round(1) }}"

      log_viewer_network:
        friendly_name: Log Viewer Network
        unique_id: log_viewer_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.log_viewer_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.log_viewer_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Samba
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/core_samba/stats
    name: Samba Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      samba_cpu:
        friendly_name: Samba CPU
        unique_id: samba_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.samba_status','cpu_percent')|float)|round(1) }}"

      samba_memory:
        friendly_name: Samba Memory
        unique_id: samba_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.samba_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.samba_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.samba_status','memory_limit')|float/1048576)|round(1) }}"

      samba_network:
        friendly_name: Samba Network
        unique_id: samba_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.samba_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.samba_status','network_rx')|float/1048576)|round(1) }}"

######################################################################################################################
# Duck DNS
######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/core_duckdns/stats
    name: Duck DNS Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      duck_dns_cpu:
        friendly_name: Duck DNS CPU
        unique_id: duck_dns_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.duck_dns_status','cpu_percent')|float)|round(1) }}"

      duck_dns_memory:
        friendly_name: Duck DNS Memory
        unique_id: duck_dns_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.duck_dns_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.duck_dns_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.duck_dns_status','memory_limit')|float/1048576)|round(1) }}"

      duck_dns_network:
        friendly_name: Duck DNS Network
        unique_id: duck_dns_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.duck_dns_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.duck_dns_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Lutron Cert
# curl http://homeassistant:8123/api/hassio/addons/a0d7b954_lutron-cert/stats -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiI2YmQ1NDgzZDhlOWQ0NTY2YTBlNjk0MzI0ZmQ4ZWFlNCIsImlhdCI6MTYwMjYyMzk1MywiZXhwIjoxOTE3OTgzOTUzfQ.3CFjFbHOy_SO2_PpdXJkVPKiD1FfFZ3mHYoDh5QNn34"
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/a0d7b954_lutron-cert/stats
    name: Lutron Cert Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      lutron_cert_cpu:
        friendly_name: Lutron Cert CPU
        unique_id: lutron_cert_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.lutron_cert_status','cpu_percent')|float)|round(1) }}"

      lutron_cert_memory:
        friendly_name: Lutron Cert Memory
        unique_id: lutron_cert_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.lutron_cert_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.lutron_cert_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.lutron_cert_status','memory_limit')|float/1048576)|round(1) }}"

      lutron_cert_network:
        friendly_name: Lutron Cert Network
        unique_id: lutron_cert_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.lutron_cert_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.lutron_cert_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## FTP
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/a0d7b954_ftp/stats
    name: FTP Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      ftp_cpu:
        friendly_name: FTP CPU
        unique_id: ftp_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.ftp_status','cpu_percent')|float)|round(1) }}"

      ftp_memory:
        friendly_name: FTP Memory
        unique_id: ftp_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.ftp_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.ftp_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.ftp_status','memory_limit')|float/1048576)|round(1) }}"

      ftp_network:
        friendly_name: FTP Network
        unique_id: ftp_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.ftp_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.ftp_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## MariaDB
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/core_mariadb/stats
    name: MariaDB Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      mariadb_cpu:
        friendly_name: MariaDB CPU
        unique_id: mariadb_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.mariadb_status','cpu_percent')|float)|round(1) }}"

      mariadb_memory:
        friendly_name: MariaDB Memory
        unique_id: mariadb_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.mariadb_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.mariadb_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.mariadb_status','memory_limit')|float/1048576)|round(1) }}"

      mariadb_network:
        friendly_name: MariaDB Network
        unique_id: mariadb_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.mariadb_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.mariadb_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## File Editor
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/core_configurator/stats
    name: File Editor Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      file_editor_cpu:
        friendly_name: File Editor CPU
        unique_id: file_editor_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.file_editor_status','cpu_percent')|float)|round(1) }}"

      file_editor_memory:
        friendly_name: File Editor Memory
        unique_id: file_editor_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.file_editor_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.file_editor_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.file_editor_status','memory_limit')|float/1048576)|round(1) }}"

      file_editor_network:
        friendly_name: File Editor Network
        unique_id: file_editor_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.file_editor_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.file_editor_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Mosquito
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/core_mosquitto/stats
    name: Mosquito Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      mosquito_cpu:
        friendly_name: Mosquito CPU
        unique_id: mosquito_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.mosquito_status','cpu_percent')|float)|round(1) }}"

      mosquito_memory:
        friendly_name: Mosquito Memory
        unique_id: mosquito_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.mosquito_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.mosquito_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.mosquito_status','memory_limit')|float/1048576)|round(1) }}"

      mosquito_network:
        friendly_name: Mosquito Network
        unique_id: mosquito_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.mosquito_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.mosquito_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## Google Drive Backup
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/cebe7a76_hassio_google_drive_backup/stats
    name: Google Drive Backup Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      google_drive_backup_cpu:
        friendly_name: Google Drive Backup CPU
        unique_id: google_drive_backup_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.google_drive_backup_status','cpu_percent')|float)|round(1) }}"

      google_drive_backup_memory:
        friendly_name: Google Drive Backup Memory
        unique_id: google_drive_backup_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.google_drive_backup_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.google_drive_backup_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.google_drive_backup_status','memory_limit')|float/1048576)|round(1) }}"

      google_drive_backup_network:
        friendly_name: Google Drive Backup Network
        unique_id: google_drive_backup_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.google_drive_backup_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.google_drive_backup_status','network_rx')|float/1048576)|round(1) }}"

#######################################################################################################################
## NGINX
#######################################################################################################################
  - platform: rest
    resource:  http://homeassistant:8123/api/hassio/addons/core_nginx_proxy/stats
    name: NGINX Status
    value_template: "{{ 'on' if value_json.result == 'ok' else 'off' }}"
    scan_interval: 60
    verify_ssl: false
    headers:
      Authorization: !secret HASS_CONFIG
      Content-Type: application/json
    json_attributes_path: "$.data"
    json_attributes:
      - cpu_percent
      - memory_usage
      - memory_limit
      - memory_percent
      - network_rx
      - network_tx

  - platform: template
    sensors:
      nginx_cpu:
        friendly_name: NGINX CPU
        unique_id: nginx_cpu
        unit_of_measurement: '%'
        icon_template: mdi:cpu-32-bit
        value_template: "{{ (state_attr('sensor.nginx_status','cpu_percent')|float)|round(1) }}"

      nginx_memory:
        friendly_name: NGINX Memory
        unique_id: nginx_memory
        unit_of_measurement: '%'
        icon_template: mdi:memory
        value_template: "{{ (state_attr('sensor.nginx_status','memory_percent')|float)|round(1) }}"
        attribute_templates:
          memory_usage: "{{ (state_attr('sensor.nginx_status','memory_usage')|float/1048576)|round(1) }}"
          memory_limit: "{{ (state_attr('sensor.nginx_status','memory_limit')|float/1048576)|round(1) }}"

      nginx_network:
        friendly_name: NGINX Network
        unique_id: nginx_network
        unit_of_measurement: 'MB'
        icon_template: mdi:download-network
        value_template: "{{ (state_attr('sensor.nginx_status','network_tx')|float/1048576)|round(1) }}"
        attribute_templates:
          network_rx: "{{ (state_attr('sensor.nginx_status','network_rx')|float/1048576)|round(1) }}"

alert:
#######################################################################################################################
## Alert - Unknown Browser
#######################################################################################################################
  system_unknown_browser:
    name: Unknown Browser
    title: Unknown Browser
    message: |
      {%- if states.sensor.unknown_browsers.attributes.browsers is defined -%}
        {%- if states('sensor.unknown_browsers')|int == 0 -%}
          No unknown browsers.
        {%- else -%}
          {%- for browser in state_attr('sensor.unknown_browsers','browsers') -%}
            - {{ browser }}{%- if not loop.last -%}<br>{%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endif -%}
    entity_id: binary_sensor.unknown_browser_alert
    state: 'on'
    repeat:
      - 15
      - 120
    notifiers: mobile_app_jphone
    data:
      subject: Unknown browser accesing Hassio.
      tag: presence_override
      group: System
      channel: Alert
      importance: max
      clickAction: /lovelace/system
      color: !secret WARNING_COLOR
      icon_url: !secret HASSIO_ICON


#######################################################################################################################
## Alert - Integration Connected
#######################################################################################################################
  integration_connected:
    name: Integration Alert
    title: Integration Alert
    message: "- {{ expand('group.integration_connected_sensors')|selectattr('state','eq','off')|map(attribute='name')|join('\n- ') }}"
    entity_id: binary_sensor.integration_connected_alert
    state: 'on'
    repeat: 1440
    notifiers: mobile_app_jphone
    data:
      tag: integration_connected
      group: System
      channel: Alert
      importance: max
      clickAction: /lovelace/system
      color: !secret WARNING_COLOR
      icon_url: !secret OFFLINE_ICON
      actions:
        - action: pause_integration_connected
          title: Pause


#######################################################################################################################
## Alert - Remote UI
#######################################################################################################################
  remote_ui:
    name: Remote UI
    title: Remote UI Alert
    message: Remote UI is disconnected.
    entity_id: binary_sensor.remote_ui_alert
    state: 'on'
    repeat: 1440
    notifiers: mobile_app_jphone
    data:
      tag: remote_ui
      group: System
      channel: Alert
      importance: max
      clickAction: /lovelace/system
      color: !secret WARNING_COLOR
      icon_url: !secret OFFLINE_ICON
      image: !secret OFFLINE_IMAGE
      actions:
        - action: pause_remote_ui
          title: Pause

#######################################################################################################################
## Alert - Unavailable Sensor
#######################################################################################################################
  unavailable_sensor:
    name: Unavailable Sensor
    title: Unavailable Sensors #VERIRY
    message: >
      {%- if states.sensor.unavailable_sensors.attributes.entities is defined -%}
        {%- if states('sensor.unavailable_sensors')|int == 0 -%}
          No unavailable entities.
        {%- else -%}
          {%- for device in state_attr('sensor.unavailable_sensors','entities') -%}
          - {{ state_attr(device,'friendly_name') }}{%- if not loop.last -%}<br>{%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endif -%}
    entity_id: binary_sensor.unavailable_sensor_alert
    state: 'on'
    repeat: 1440
    notifiers: mobile_app_jphone
    data:
      subject: There are unavailable sensors.
      tag: unavailable_sensor
      group: System
      channel: Alert
      importance: max
      clickAction: /lovelace/system
      color: !secret WARNING_COLOR
      icon_url: !secret OFFLINE_ICON
      actions:
        - action: pause_unavailable_sensor
          title: Pause


#######################################################################################################################
## Alert - ZWave Network
#######################################################################################################################
  zwave_network:
    name: ZWave Network
    title: ZWave Network
    message: >
      Offline ZWave Devices:
      <br>{%- if states.zwave|rejectattr('state','eq','ready')|map(attribute='name')|list|count > 0 -%}
      - {{ states.zwave|rejectattr('state','eq','ready')|map(attribute='name')|list|join('<br>- ') }}
      {%- else -%}
          No offline ZWave devices.
      {%- endif -%}
    entity_id: binary_sensor.zwave_network_alert
    state: 'on'
    repeat: 1440
    notifiers: mobile_app_jphone
    data:
      tag: zwave_network
      group: System
      channel: Alert
      importance: max
      clickAction: /lovelace/system
      color: !secret WARNING_COLOR
      icon_url: !secret ZWAVE_ICON
      actions:
        - action: heal_zwave
          title: Heal
        - action: pause_zwave_network
          title: Pause

