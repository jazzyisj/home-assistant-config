###############################################################################
## Package - NOAA Weather Alerts
## https://github.com/dcshoecomp/noaa_alerts
###############################################################################
homeassistant:
  customize:
    alert.noaa_alert:
      friendly_name: 'NOAA Alert'
      icon: mdi:weather-hurricane
      category: weather

input_select:
  previous_noaa_alert_severity:
    name: 'Previous NOAA Alert Severity'
    options:
      - minor
      - moderate
      - severe
      - extreme
      - cleared

sensor:
  - platform: noaa_alerts
    zoneid: MIZ076 # OPTION MIC163

alert:
  noaa_alert:
    name: 'NOAA Alert'
    title: "{{ state_attr('binary_sensor.noaa_weather_alert','title') }}"
    message: >
      {% set type = state_attr('binary_sensor.noaa_weather_alert','type') %}
      {% set title = state_attr('binary_sensor.noaa_weather_alert','title') %}
      {% set severity = state_attr('binary_sensor.noaa_weather_alert','severity') %}
      {% set description = state_attr('binary_sensor.noaa_weather_alert','description') %}
      {% set starts = state_attr('binary_sensor.noaa_weather_alert','starts_text') %}
      {% set ends = state_attr('binary_sensor.noaa_weather_alert','ends_text') %}
      {% set active = state_attr('binary_sensor.noaa_weather_alert','active') %}
      There is a {{ severity }} {{ title|lower }}
      {{- ' in effect at ' ~ starts if active and starts|lower not in ['','unknown','unavailable','none'] }}
      {{- ' until ' ~ ends if ends|lower not in ['','unknown','unavailable','none'] }}.
      {{ description -}}
    entity_id: binary_sensor.noaa_weather_alert
    state: 'on'
    repeat: 720
    can_acknowledge: false
    notifiers: mobile
    data:
      tag: noaa_weather_alert
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      timeout: 86400
      clickAction: /lovelace/weather
      color: !secret WEATHER_COLOR
      icon_url: !secret STORM_ICON
