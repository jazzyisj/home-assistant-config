###############################################################################
## Package - Weatherflow
## https://weatherflow.com/tempest-weather-system/
###############################################################################
homeassistant:
  customize:
    alert.weatherflow_cloud_connected:
      icon: mdi:weather-partly-rainy
      category: weather
    alert.weatherflow_local_connected:
      icon: mdi:weather-partly-rainy
      category: weather

weather:
  #ISSUE default to -1 to prevent round error on startup
  - platform: template
    name: "WeatherFlow Local Daily"
    unique_id: weatherflow_local_daily
    condition_template: &condition "{{ states('sensor.hub_hb_00073766_weather') }}"
    temperature_template: &temp "{{ states('sensor.tempest_st_00057689_temperature')|float(-1) }}"
    apparent_temperature_template: &apparent "{{ states('sensor.tempest_st_00057689_feels_like_temperature')|float(-1) }}"
    dew_point_template: &dew "{{ states('sensor.tempest_st_00057689_dew_point')|float(-1) }}"
    humidity_template: &humidity "{{ states('sensor.tempest_st_00057689_humidity')|int(-1) }}"
    pressure_template: &pressure "{{ states('sensor.tempest_st_00057689_sea_level_pressure')|float(-1) }}"
    wind_speed_template: &wind_speed "{{ states('sensor.tempest_st_00057689_wind_speed_avg')|float(-1) }}"
    wind_gust_speed_template: &wind_gust "{{ states('sensor.tempest_st_00057689_wind_gust')|float(-1) }}"
    wind_bearing_template: &wind_dir "{{ states('sensor.tempest_st_00057689_wind_bearing_avg')|int(-1) }}"
    visibility_template: &visibility "{{ states('sensor.tempest_st_00057689_visibility')|float(-1) }}"
    forecast_template: "{{ state_attr('sensor.hub_hb_00073766_weather','daily_forecast') }}"
    attribution_template: &attrib "{{ state_attr('sensor.hub_hb_00073766_weather','attribution') }}"
    temperature_unit: &temp_unit Â°C
    pressure_unit: &pressure_unit hPa
    wind_speed_unit: &wind_unit km/h
    visibility_unit: &vis_unit km
    precipitation_unit: &precip_unit mm

  - platform: template
    name: "WeatherFlow Local Hourly"
    unique_id: weatherflow_local_hourly
    condition_template: *condition
    temperature_template: *temp
    apparent_temperature_template: *apparent
    dew_point_template: *dew
    humidity_template: *humidity
    pressure_template: *pressure
    wind_speed_template: *wind_speed
    wind_gust_speed_template: *wind_gust
    wind_bearing_template: *wind_dir
    visibility_template: *visibility
    forecast_template: "{{ state_attr('sensor.hub_hb_00073766_weather','hourly_forecast') }}"
    attribution_template: *attrib
    temperature_unit: *temp_unit
    pressure_unit: *pressure_unit
    wind_speed_unit: *wind_unit
    visibility_unit: *vis_unit
    precipitation_unit: *precip_unit

alert:
  weatherflow_cloud_connected:
    name: "Weatherflow Cloud Connected"
    entity_id: binary_sensor.weatherflow_cloud_connected_alert
    state: "on"
    notifiers: log
    skip_first: false
    repeat: 999999
    data:
      tag: weatherflow_cloud_connected

  weatherflow_local_connected:
    name: "Weatherflow Local Connected"
    entity_id: binary_sensor.weatherflow_local_connected_alert
    state: "on"
    notifiers: log
    skip_first: false
    repeat: 999999
    data:
      tag: weatherflow_cloud_connected
