#######################################################################################################################
## Package - Emergency
#NOTE use sensor category
#######################################################################################################################
homeassistant:
  customize:
    alert.emergency_smoke_detected:
      friendly_name: Smoke
      icon: mdi:fire
      category: sensor
    alert.emergency_co_detected:
      friendly_name: CO
      icon: mdi:skull-crossbones
      category: sensor

binary_sensor:
  - platform: template
    sensors:
#######################################################################################################################
## Smoke Detected
# nest protect states: Ok, Warning, Emergency
#######################################################################################################################
      smoke_detected_alert:
        unique_id: smoke_detected_alert
        value_template: >
          {{ is_state('sensor.upstairs_nest_protect_smoke_status','Emergency')
              or is_state('sensor.downstairs_nest_protect_smoke_status','Emergency') }}

#######################################################################################################################
## CO Alert
# nest protect states: Ok, Warning, Emergency
#######################################################################################################################
      co_detected_alert:
        unique_id: co_detected_alert
        value_template: >
          {{ is_state('sensor.upstairs_nest_protect_co_status','Emergency')
              or is_state('sensor.downstairs_nest_protect_co_status','Emergency') }}

#######################################################################################################################
## Emergency Active
#######################################################################################################################
      emergency_active:
        unique_id: emergency_active
        value_template: >
          {{ is_state('binary_sensor.co_detected_alert','on')
              or is_state('binary_sensor.smoke_detected_alert','on') }}

alert:
#######################################################################################################################
## Alert - Smoke Detected
#######################################################################################################################
  emergency_smoke_detected:
    name: Smoke Detected
    title: Smoke Detected Alert
    message: Smoke detected! Leave the house now!
    entity_id: binary_sensor.smoke_detected_alert
    state: 'on'
    repeat:
      - 1
      - 2
      - 5
    can_acknowledge: false
    notifiers: everyone
    data:
      tag: emergency
      group: General
      channel: alarm_stream
      importance: max
      persistent: true
      priority: high #TEST
      ttl: 0 #TEST
      clickAction: /lovelace/sensor
      color: !secret CRITICAL_COLOR
      icon_url: !secret SMOKE_ICON
      image: !secret SMOKE_IMAGE
      actions:
        - title: Cameras
          action: URI
          uri: app://com.flir.consumer.flir.lorexcloud

#######################################################################################################################
## Alert - Carbon Monoxide Detected
#######################################################################################################################
  emergency_co_detected:
    name: Carbon Monoxide Detected
    title: Carbon Monoxide Detected Alert
    message: Carbon monoxide detected! Leave the house now!
    entity_id: binary_sensor.co_detected_alert
    state: 'on'
    repeat:
      - 1
      - 2
      - 5
    can_acknowledge: false
    notifiers: everyone
    data:
      tag: emergency
      group: General
      channel: alarm_stream
      importance: max
      priority: high #TEST
      ttl: 0 #TEST
      persistent: true
      clickAction: /lovelace/sensor
      color: !secret CRITICAL_COLOR
      icon_url: !secret CO_ICON
      image: !secret CO_IMAGE
      actions:
        - title: Cameras
          action: URI
          uri: app://com.flir.consumer.flir.lorexcloud