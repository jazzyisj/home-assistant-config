#######################################################################################################################
## Radio Package
## Inspired by https://community.home-assistant.io/t/chromecast-radio-with-station-and-player-selection
#######################################################################################################################
input_boolean:
  radio_failed:
    initial: false

  radio_on:
    name: Play Radio
    icon: mdi:radio

  radio_pause:
    name: Pause Radio
    icon: mdi:pause-circle
    initial: false

input_text:
  active_media_player_radio:

input_select:
#######################################################################################################################
## Media Player Radio
#######################################################################################################################
  radio_media_player:
    name: Radio Speaker
    icon: mdi:speaker-wireless
    options: !include /config/include/entities/media_player_names.yaml

#######################################################################################################################
## Streaming Radio Stations
#######################################################################################################################
  radio_station:
    name: Radio Station
    icon: mdi:radio-tower
    options: !include /config/include/entities/radio_station_names.yaml

input_number:
#######################################################################################################################
## Radio Volume (percent)
#######################################################################################################################
  radio_volume:
    name: Radio Volume
    icon: mdi:volume-high
    unit_of_measurement: '%'
    min: 0
    max: 100
    step: 5

binary_sensor:
  - platform: template
    sensors:
      radio_on:
        friendly_name: Radio On
        unique_id: radio_on
        icon_template: mdi:radio
        value_template: >
          {{ is_state('input_boolean.radio_on','on')
              or is_state('script.radio_play','on')
              or is_state('script.radio_stop','on') }}

sensor:
  - platform: template
    sensors:
#######################################################################################################################
## Radio Status - used for picture glance state
#######################################################################################################################
      radio_status:
        friendly_name: Radio Status
        unique_id: radio_status
        icon_template: mdi:radio
        value_template: >
          {% if is_state('input_boolean.radio_failed','on') %} failed
          {% elif is_state('binary_sensor.radio_on','off')
               or is_state('binary_sensor.startup_complete','off')%} off
          {% elif is_state('binary_sensor.radio_on','on') %}
              {% if states(states('sensor.radio_media_player')) in ['playing','paused']
                  or is_state('binary_sensor.alarm_clock_active','on')
                  or is_state('binary_sensor.tts_playing','on') %}
                {% if is_state('input_select.media_preset_type_sleep','Radio') and is_state('input_boolean.media_preset_sleep','on') %} sleep
                {% elif is_state('input_select.media_preset_type_wake','Radio') and is_state('input_boolean.media_preset_morning','on') %} morning
                {% else %} on
                {% endif %}
              {% else %} failed
              {% endif %}
          {% else %} off
          {% endif %}

#######################################################################################################################
## Radio Media Player - entity_id of selected media player
#######################################################################################################################
      radio_media_player:
        friendly_name: Radio Media Player
        unique_id: radio_media_player
        icon_template: mdi:animation-play
        value_template: >
          {{ expand('group.media_players')|selectattr('name','eq',states('input_select.radio_media_player'))|map(attribute='entity_id')|join(',') }}