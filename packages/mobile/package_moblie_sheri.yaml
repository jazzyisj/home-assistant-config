###############################################################################
## Mobile App Package - Sheri
# Sheri Headphone BT: '5C:56:A4:32:E7:0E','B8:AD:3E:A5:5B:00'
###############################################################################
homeassistant:
  customize:
    alert.sheri_phone_high_accuracy:
      icon: mdi:crosshairs-gps
      category: mobile
    alert.sheri_phone_bluetooth_connected:
      icon: mdi:phone-bluetooth
      category: mobile
    alert.sheri_phone_bluetooth_device:
      icon: mdi:headphones-bluetooth
      category: mobile
    alert.sheri_phone_ringer_off:
      icon: mdi:phone-ring
      category: mobile
    alert.sheri_phone_bluetooth_off:
      icon: mdi:phone-bluetooth
      category: mobile
    alert.sheri_phone_wifi_off:
      icon: mdi:cellphone-wireless
      category: mobile
    alert.sheri_phone_offline:
      icon: mdi:cellphone-off
      category: mobile
    alert.sheri_phone_battery_low:
      icon: mdi:battery-alert
      category: mobile
    sensor.sphone_battery_level:
      mobile: true

input_boolean:
  sheri_phone_alarm_clock_enabled:
    name: 'Sheri Phone: Alarm Clock'
    icon: mdi:alarm
  sheri_phone_alarm_clock_notifications:
    name: 'Sheri Phone: Alarm Clock Notifications'
    icon: mdi:file-clock
  sheri_phone_tts_enabled:
    name: 'Sheri Phone: TTS Announcements'
    icon: mdi:account-voice

input_number:
  mobile_waketime_volume_sheri:
    name: 'Waketime Alarm Volume'
    icon: mdi:volume-high
    min: 0
    max: 7
    step: 1

switch:
  - platform: template
    switches:
      sheri_phone_bluetooth:
        friendly_name: 'Sheri Phone Bluetooth'
        unique_id: sheri_phone_bluetooth
        icon_template: mdi:phone-bluetooth
        value_template: "{{ is_state('binary_sensor.sphone_bluetooth_state','on') }}"
        turn_on:
          - service: notify.mobile_app_sphone
            data:
              message: command_bluetooth
              title: turn_on
        turn_off:
          - service: notify.mobile_app_sphone
            data:
              message: command_bluetooth
              title: turn_off
        availability_template: "{{ states('binary_sensor.sphone_bluetooth_state') not in ['unknown','unavailable'] }}"

  - platform: template
    switches:
      sheri_phone_high_accuracy:
        friendly_name: 'Sheri Phone High Accuracy'
        unique_id: sheri_phone_high_accuracy
        icon_template: mdi:map-marker-circle
        value_template: "{{ is_state('binary_sensor.sphone_high_accuracy_mode','on') }}"
        turn_on:
          - service: notify.mobile_app_sphone
            data:
              message: command_high_accuracy_mode
              title: turn_on
        turn_off:
          - service: notify.mobile_app_sphone
            data:
              message: command_high_accuracy_mode
              title: turn_off
        availability_template: "{{ states('binary_sensor.sphone_high_accuracy_mode') not in ['unknown','unavailable'] }}"

alert:
  sheri_phone_battery_low:
    name: 'Sheri Phone: Battery Low'
    title: 'S-Phone Battery Low'
    message: >
      Phone Battery: {{ states('sensor.sphone_battery_level') }}%
      <br/>Battery Health: {{ states('sensor.sphone_battery_health')|title }}
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_battery_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: sheri_phone_battery_low
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:battery-alert
      icon_url: !secret BATTERY_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_sheri_phone_battery_low

  sheri_phone_bluetooth_connected:
    name: 'Sheri Phone: Bluetooth Connected'
    title: 'S-Phone Bluetooth Off'
    message: 'Your mobile phone bluetooth is not connected to HASS.'
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_bluetooth_connected_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: sheri_phone_bluetooth_off
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:bluetooth-connect
      icon_url: !secret BLUETOOTH_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_sheri_phone_bluetooth_off

  sheri_phone_bluetooth_device:
    name: 'Sheri Phone: Bluetooth Device'
    title: 'S-Phone Bluetooth Device'
    message: >
      {% if is_state('binary_sensor.sheri_phone_headphones_connected','on')
          or is_state('binary_sensor.sheri_phone_headphones_2_connected','on') %}
          Your headphones are still connected to your phone!
      {% elif is_state('binary_sensor.sheri_phone_jeep_connected','on') %}
          Your jeep is still connected to your phone!
      {% endif %}
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_bluetooth_device
    state: 'on'
    repeat:
      - 30
      - 120
    notifiers: mobile
    data:
      tag: sheri_phone_bluetooth_device
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:headphones-bluetooth
      icon_url: !secret BLUETOOTH_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_sheri_phone_bluetooth_device

  sheri_phone_bluetooth_off:
    name: 'Sheri Phone: Bluetooth Off'
    title: 'S-Phone Bluetooth Off'
    message: 'Your mobile phone bluetooth is off.'
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_bluetooth_off_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: sheri_phone_bluetooth_off
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:bluetooth-connect
      icon_url: !secret BLUETOOTH_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_sheri_phone_bluetooth_off

  sheri_phone_high_accuracy:
    name: 'Sheri Phone: High Accuracy'
    title: 'S-Phone High Accuracy On'
    message: 'High accuracy mode has been on for more than 15 minutes.'
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_high_accuracy_alert
    state: 'on'
    repeat:
      - 15
    notifiers: mobile
    data:
      tag: mobile_accuracy_sheri
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:crosshairs-gps
      icon_url: !secret WIFI_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Turn Off'
          action: turn_off_accuracy_sheri

        - title: 'Pause Alert'
          action: pause_mobile_accuracy_sheri

  sheri_phone_offline:
    name: 'Sheri Phone: Offline'
    title: 'S-Phone Offline'
    message: >
      Phone offline at
      {{ as_local(states.binary_sensor.sheri_phone_connected.last_changed).strftime('%-I:%M %p') }}
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_connected_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: sheri_phone_offline
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:cellphone-off
      icon_url: !secret OFFLINE_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_sheri_phone_offline

  sheri_phone_ringer_off:
    name: 'Sheri Phone: Ringer Off'
    title: 'S-Phone Ringer Off'
    message: 'Your mobile phone ringer is off.'
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_ringer_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: sheri_phone_ringer_off
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:cellphone-sound
      icon_url: !secret RINGER_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_phone_ringer_sheri

  sheri_phone_wifi_connected:
    name: 'Sheri Phone: WIFI Connected'
    title: 'S-Phone WIFI Connected'
    message: 'Your mobile WIFI is not connected to HASS.'
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_wifi_connected_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: sheri_phone_wifi_connected
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:cellphone-wireless
      icon_url: !secret WIFI_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: sheri_phone_wifi_connected

  sheri_phone_wifi_off:
    name: 'Sheri Phone: WIFI Off'
    title: 'S-Phone WIFI Off'
    message: 'Your mobile WIFI is turned off.'
    done_message: clear_notification
    entity_id: binary_sensor.sheri_phone_wifi_off_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: sheri_phone_wifi_off
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:cellphone-wireless
      icon_url: !secret WIFI_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: sheri_phone_wifi_off
