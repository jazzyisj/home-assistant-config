###############################################################################
## Mobile App Package - Jason
# Jason Headphone BT: 00:18:6B:97:9B:B9
###############################################################################
homeassistant:
  customize:
    alert.mobile_high_accuracy_jason:
      icon: mdi:crosshairs-gps
      category: mobile
    alert.mobile_headphones_jason:
      icon: mdi:headphones-bluetooth
      category: mobile
    alert.mobile_ringer_jason:
      icon: mdi:phone-ring
      category: mobile
    alert.mobile_bluetooth_jason:
      icon: mdi:phone-bluetooth
      category: mobile
    alert.mobile_wifi_jason:
      icon: mdi:cellphone-wireless
      category: mobile
    alert.mobile_offline_jason:
      icon: mdi:cellphone-off
      category: mobile
    alert.mobile_battery_jason:
      icon: mdi:battery-alert
      category: mobile
    sensor.jphone_battery_level:
      mobile: true

input_boolean:
  jason_phone_alarm_clock_enabled:
    name: 'Jason Phone: Alarm Clock'
    icon: mdi:alarm
  jason_phone_alarm_clock_notifications:
    name: 'Jason Phone: Alarm Clock Notifications'
    icon: mdi:file-clock
  jason_phone_tts_enabled:
    name: 'Jason Phone: TTS Announcements'
    icon: mdi:account-voice

input_number:
  mobile_waketime_volume_jason:
    name: 'Waketime Alarm Volume'
    icon: mdi:volume-high
    min: 0
    max: 7
    step: 1

alert:
  mobile_battery_jason:
    name: 'Jason: Mobile Low Battery'
    title: 'Mobile Battery Low'
    message: >
      Phone Battery: {{ states('sensor.jphone_battery_level') }}%
      <br/>Battery Health: {{ states('sensor.jphone_battery_health')|title }}
    done_message: clear_notification
    entity_id: binary_sensor.jphone_battery_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: mobile_battery_jason
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:battery-alert
      icon_url: !secret BATTERY_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_mobile_battery_jason

  mobile_bluetooth_jason:
    name: 'Jason: Mobile Bluetooth'
    title: 'Mobile Bluetooth Off'
    message: 'Your mobile phone bluetooth is off.'
    done_message: clear_notification
    entity_id: binary_sensor.jphone_bluetooth_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: mobile_bluetooth_jason
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:bluetooth-connect
      icon_url: !secret BLUETOOTH_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_mobile_bluetooth_jason

  mobile_headphones_jason:
    name: 'Jason: Mobile Headphones'
    title: 'Headphones On'
    message: >
      {% set devices = state_attr('sensor.jphone_bluetooth_connection','connected_paired_devices') %}
      {% set connected = '00:18:6B:97:9B:B9' in devices %}
      Your headphones are on{{ ', and are still connected to your phone!' if connected else '.' }}
    done_message: clear_notification
    entity_id: binary_sensor.jphone_headphones_alert
    state: 'on'
    repeat:
      - 30
      - 120
    notifiers: mobile
    data:
      tag: mobile_headphones_jason
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:headphones-bluetooth
      icon_url: !secret BLUETOOTH_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_mobile_headphones_jason

  mobile_high_accuracy_jason:
    name: 'Jason: Mobile High Accuracy'
    title: 'Mobile High Accuracy On'
    message: 'High accuracy mode has been on for more than 15 minutes.'
    done_message: clear_notification
    entity_id: binary_sensor.jphone_high_accuracy_alert
    state: 'on'
    repeat:
      - 15
    notifiers: mobile
    data:
      tag: mobile_accuracy_jason
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:crosshairs-gps
      icon_url: !secret WIFI_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Turn Off'
          action: turn_off_accuracy_jason

        - title: 'Pause Alert'
          action: pause_mobile_accuracy_jason

  mobile_offline_jason:
    name: 'Jason: Mobile Offline'
    title: 'Phone Offline'
    message: >
      Phone offline at {{ as_local(states.binary_sensor.jason_phone_connected.last_changed).strftime('%-I:%M %p') }}
    done_message: clear_notification
    entity_id: binary_sensor.jason_phone_connected_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: mobile_offline_jason
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:cellphone-off
      icon_url: !secret OFFLINE_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_mobile_offline_jason

  mobile_ringer_jason:
    name: 'Jason: Mobile Ringer Off'
    title: 'Phone Ringer Off'
    message: 'Your mobile phone ringer is off.'
    done_message: clear_notification
    entity_id: binary_sensor.jphone_ringer_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: mobile_ringer_jason
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:cellphone-sound
      icon_url: !secret RINGER_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_mobile_ringer_jason

  mobile_wifi_jason:
    name: 'Jason: Mobile WIFI'
    title: 'Mobile WIFI Off'
    message: >
      {% if is_state('binary_sensor.jason_phone_connected','on')
          and is_state('binary_sensor.jphone_wifi_state','off') %}
        Your mobile WIFI is turned off.
      {% else %}
        Your mobile WIFI is not connected.
      {% endif %}
    done_message: clear_notification
    entity_id: binary_sensor.jason_phone_wifi_alert
    state: 'on'
    repeat:
      - 30
      - 60
    notifiers: mobile
    data:
      tag: mobile_wifi_jason
      group: General
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:cellphone-wireless
      icon_url: !secret WIFI_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/presence
      actions:
        - title: 'Pause Alert'
          action: pause_mobile_wifi_jason
