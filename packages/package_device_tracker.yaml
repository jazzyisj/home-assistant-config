#######################################################################################################################
## Package - Device Tracker https://www.home-assistant.io/components/device_tracker/
#######################################################################################################################
homeassistant:
  customize:
    alert.unknown_network_device:
      icon: mdi:devices
      category: network
    alert.bluetooth_disabled:
      friendly_name: "Bluetooth Off"
      icon: mdi:bluetooth-off
      category: network

    device_tracker.jason_tracker:
      icon: mdi:map-marker-circle
      device_type: location
    device_tracker.sheri_tracker:
      icon: mdi:map-marker-circle
      device_type: location

    device_tracker.jphone:
      device_type: location
    device_tracker.sphone:
      device_type: location

    device_tracker.jphone_bt:
      device_type: bluetooth
    device_tracker.sphone_bt:
      device_type: bluetooth
    device_tracker.jlaptop_bt:
      device_type: bluetooth
    device_tracker.stablet_bt:
      device_type: bluetooth
    device_tracker.fugoo_speaker_bt:
      device_type: bluetooth
    device_tracker.sheri_headphones_bt:
      device_type: bluetooth
    device_tracker.jason_headphones_bt:
      device_type: bluetooth
    device_tracker.laundry_room_speaker_bt:
      device_type: bluetooth
    device_tracker.living_room_speaker_bt:
      device_type: bluetooth
    device_tracker.bathroom_speaker_bt:
      device_type: bluetooth
    device_tracker.bedroom_display_bt:
      device_type: bluetooth
    device_tracker.dining_room_display_bt:
      device_type: bluetooth
    device_tracker.garage_speaker_bt:
      device_type: bluetooth
    device_tracker.living_room_tv_bt:
      device_type: bluetooth
    device_tracker.bedroom_tv_bt:
      device_type: bluetooth

    device_tracker.wan_modem:
      device_type: wired
    device_tracker.jnet_router:
      device_type: wired
    device_tracker.jnet_switch:
      device_type: wired
    device_tracker.wifi_ap_upstairs:
      device_type: wired
    device_tracker.home_assistant:
      device_type: wired
    device_tracker.pi_hole:
      device_type: wired
    device_tracker.lorex_nvr:
      device_type: wired
    device_tracker.myq_bridge:
      device_type: wired
    device_tracker.lutron_bridge:
      device_type: wired
    device_tracker.ip_cam_ch1:
      device_type: wired
    device_tracker.ip_cam_ch11:
      device_type: wired
    device_tracker.ip_cam_ch12:
      device_type: wired

    device_tracker.jason_phone_wifi:
      device_type: wireless
    device_tracker.jason_phone_router_wifi:
      device_type: wireless
    device_tracker.sheri_phone_wifi:
      device_type: wireless
    device_tracker.jason_laptop_wifi:
      device_type: wireless
    device_tracker.jlaptop_wifi_router:
      device_type: wireless
    device_tracker.sheri_tablet_wifi:
      device_type: wireless

    device_tracker.pi_hole_wifi:
      device_type: wireless

    device_tracker.nest_thermostat:
      device_type: wireless
    device_tracker.nest_protect_upstairs:
      device_type: wireless
    device_tracker.nest_protect_downstairs:
      device_type: wireless

    device_tracker.living_room_speaker_wifi:
      device_type: wireless
    device_tracker.bathroom_speaker_wifi:
      device_type: wireless
    device_tracker.laundry_room_speaker_wifi:
      device_type: wireless
    device_tracker.garage_speaker_wifi:
      device_type: wireless
    device_tracker.dining_room_display_wifi:
      device_type: wireless
    device_tracker.bedroom_display_wifi:
      device_type: wireless

    device_tracker.chromecast_living_room:
      device_type: wireless
    device_tracker.chromecast_office:
      device_type: wireless
    device_tracker.chromecast_deck:
      device_type: wireless

    device_tracker.living_room_tv_wifi:
      device_type: wireless
    device_tracker.bedroom_tv_wifi:
      device_type: wireless
    device_tracker.office_tv:
      device_type: wireless

    device_tracker.lg_fridge:
      device_type: wireless
    device_tracker.lg_dishwasher:
      device_type: wireless
    device_tracker.hydrawise_controller:
      device_type: wireless
    device_tracker.balboa_spa:
      device_type: wireless

  # Guest Devices
    device_tracker.dawn_phone_wifi:
      device_type: wireless
    device_tracker.ryan_phone_wifi:
      device_type: wireless
    device_tracker.lucy_phone_wifi:
      device_type: wireless
    device_tracker.dawn_ipad_wifi:
      device_type: wireless
    device_tracker.dalton_phone_wifi:
      device_type: wireless
    device_tracker.chris_phone_wifi:
      device_type: wireless
    device_tracker.jamie_phone_wifi:
      device_type: wireless

device_tracker:
#######################################################################################################################
## Bluetooth Tracker  https://www.home-assistant.io/components/device_tracker.bluetooth_tracker/
#######################################################################################################################
  - platform: bluetooth_tracker

#######################################################################################################################
## GLOBAL DEFAULTS - place after first instantiated tracker
#######################################################################################################################
    consider_home: 60 # seconds after not seen for away state
    interval_seconds: 60
    new_device_defaults:
      track_new_devices: true

#######################################################################################################################
## Composite Device Trackers # https://github.com/pnbruckner/ha-composite-tracker
##  - Away is 'not_home'
##  - Home is 'home' in states
#######################################################################################################################
  - platform: composite
    name: "Jason Tracker"
    time_as: device_or_local
    require_movement: true
    entity_id:
      - device_tracker.jphone
      - device_tracker.jphone_bt
      - binary_sensor.jphone_wifi

  - platform: composite
    name: "Sheri Tracker"
    time_as: device_or_local
    require_movement: true
    entity_id:
      - device_tracker.sphone
      - device_tracker.sphone_bt
      - binary_sensor.sphone_wifi

alert:
  unknown_network_device:
    name: "Unknown Device"
    title: "Unknown Network Device"
    message: >
      {%- if state_attr('sensor.unknown_network_devices','entities')|lower not in ['unknown','unavailable','none'] -%}
        {%- if states('sensor.unknown_network_devices')|int == 0 -%}
          No unknown devices.
        {%- else -%}
          {%- for device in state_attr('sensor.unknown_network_devices','entities') -%}
            {%- if not loop.first and not loop.last %}<br>{% endif %}- {{ device }}
          {%- endfor -%}
        {%- endif -%}
      {%- endif -%}
    entity_id: binary_sensor.unknown_network_device_alert
    state: 'on'
    repeat: 60
    notifiers: jason
    data:
      subject: "There are unknown network devices."
      tag: unknown_network_device
      group: System
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      timeout: 3600
      clickAction: /lovelace/system
      color: !secret WARNING_COLOR
      icon_url: !secret HASSIO_ICON
      actions:
        - action: pause_unknown_network_device
          title: "Pause Alert"

  bluetooth_disabled:
    name: "Bluetooth Disconnected"
    title: "Bluetooth Disconnected Alert"
    message: "Home Assistant Bluetooth is disconnected."
    entity_id: binary_sensor.bluetooth_alert
    state: 'on'
    repeat: 3600
    notifiers: jason
    data:
      tag: bluetooth_disabled
      group: System
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      clickAction: /lovelace/system
      color: !secret WARNING_COLOR
      icon_url: !secret BLUETOOTH_ICON
      actions:
        - action: reboot_server
          title: "Reboot"
        - action: pause_bluetooth_disabled
          title: "Pause Alert"