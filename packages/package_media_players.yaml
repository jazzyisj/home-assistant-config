#######################################################################################################################
## Medie Player Package #NEW_MEDIA_PLAYER

#IDEA {{ states.media_player|selectattr('attributes.speaker_group','eq',true)|map(attribute='entity_id')|list }}
#######################################################################################################################
homeassistant:
  customize:
    group.all_speakers:
      friendly_name: All Speakers
    group.broadcast_speakers:
      friendly_name: Broadcast Speakers
    group.music_speakers:
      friendly_name: Music Speakers
    group.quiet_speakers:
      friendly_name: Quiet Speakers
    group.night_speakers:
      friendly_name: Night Speakers

    media_player.living_room_speaker:
      device_class: speaker
      speaker_group: false
    media_player.dining_room_display:
      device_class: speaker
      speaker_group: false
      cast_display: true
    media_player.bedroom_display:
      device_class: speaker
      speaker_group: false
      cast_display: true
    media_player.bathroom_speaker:
      device_class: speaker
      speaker_group: false
    media_player.laundry_room_speaker:
      device_class: speaker
      speaker_group: false
    media_player.garage_speaker:
      device_class: speaker
      speaker_group: false
    media_player.living_room_tv:
      device_class: tv
      speaker_group: false
      cast_display: true
    media_player.bedroom_tv:
      device_class: tv
      speaker_group: false
      cast_display: true
    media_player.deck_tv:
      device_class: tv
      speaker_group: false
      cast_display: true

    media_player.all_speakers:
      speaker_group: true
    media_player.broadcast_speakers:
      speaker_group: true
    media_player.music_speakers:
      speaker_group: true
    media_player.quiet_speakers:
      speaker_group: true
    media_player.night_speakers:
      speaker_group: true

input_boolean:
  media_player_automation:
    name: Media Player Automation
    icon: mdi:disc-player
    #OPTION initial: true

  mute_all:
    name: Mute All
    icon: mdi:volume-off

  volume_override:
    name: Override Volume Limit
    icon: mdi:volume-low
    initial: false

input_number:
#######################################################################################################################
## Media Player Quiet Volumes
#######################################################################################################################
  media_volume_quiet: #IDEA merge with speaker/tv
    name: Quiet Hours Media Volume
    icon: mdi:volume-high
    unit_of_measurement: '%'
    min: 0
    max: 100
    step: 5

  speaker_quiet_volume:
    name: Speaker Quiet Volume
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  tv_quiet_volume:
    name: TV Quiet Volume
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

#######################################################################################################################
## Media Player Current Volume
#######################################################################################################################
  living_room_speaker_volume:
    name: Living Room Speaker
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  dining_room_display_volume:
    name: Dining Room Display
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  bedroom_display_volume:
    name: Bedroom Display
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  bathroom_speaker_volume:
    name: Bathroom Speaker
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  laundry_room_speaker_volume:
    name: Laundry Room Speaker
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  garage_speaker_volume:
    name: Garage Speaker
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  living_room_tv_volume:
    name: Living Room TV
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  bedroom_tv_volume:
    name: Bedroom TV
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  deck_tv_volume:
    name: Deck TV
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

#######################################################################################################################
## Media Player Volume Default
#######################################################################################################################
  media_volume_default:
    name: Default Radio Volume
    icon: mdi:volume-high
    unit_of_measurement: '%'
    min: 0
    max: 100
    step: 5

  living_room_speaker_default:
    name: Living Room Speaker
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  dining_room_display_default:
    name: Dining Room Display
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5


  bedroom_display_default:
    name: Bedroom Display
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  bathroom_speaker_default:
    name: Bathroom Speaker
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  laundry_room_speaker_default:
    name: Laundry Room Speaker
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  garage_speaker_default:
    name: Garage Speaker
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  living_room_tv_default:
    name: Living Room TV
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  bedroom_tv_default:
    name: Bedroom TV
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

  deck_tv_default:
    name: Deck TV
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5

#######################################################################################################################
## Media Player Volume Balance
#######################################################################################################################
  living_room_speaker_balance:
    name: Living Room Speaker
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

  dining_room_display_balance:
    name: Dining Room Display
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

  bedroom_display_balance:
    name: Bedroom Display
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

  bathroom_speaker_balance:
    name: Bathroom Speaker
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

  laundry_room_speaker_balance:
    name: Laundry Room Speaker
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

  garage_speaker_balance:
    name: Garage Speaker
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

  living_room_tv_balance:
    name: Living Room TV
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

  bedroom_tv_balance:
    name: Bedroom TV
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

  deck_tv_balance:
    name: Deck TV
    icon: mdi:volume-low
    min: -1
    max: 1
    step: 0.05

group:
#######################################################################################################################
## Media Players
## all media players (except spotify)
#######################################################################################################################
  media_players:
    icon: mdi:music-box-multiple
    all: true
    entities: !include /config/include/entities/media_player_entities.yaml

#######################################################################################################################
## Media Players
## individual media players (no groups)
#######################################################################################################################
  media_players_single:
    icon: mdi:music-box-multiple
    all: true
    entities: !include /config/include/entities/media_player_entities_single.yaml

#######################################################################################################################
## Google Speaker Group Media Players - Google Home Speaker Groups
## - used to identify group media players and check group for individual media player states
#######################################################################################################################
  google_speaker_groups:
    icon: mdi:music-box-multiple
    all: true
    entities:
      - media_player.all_speakers
      - media_player.music_speakers
      - media_player.broadcast_speakers
      - media_player.quiet_speakers
      - media_player.night_speakers

#######################################################################################################################
## All Speakers - Entities in corresponding Google Home Speaker Group
#######################################################################################################################
  all_speakers:
    icon: mdi:music-box-multiple
    all: true
    entities:
      - media_player.living_room_speaker
      - media_player.dining_room_display
      - media_player.bedroom_display
      - media_player.bathroom_speaker
      - media_player.laundry_room_speaker
      - media_player.garage_speaker
      - media_player.living_room_tv
#DISABLED      - media_player.bedroom_tv  # still on Gen1 Chromcast, cannot be in google group
#DISABLED      - media_player.deck_tv  # still on Gen1 Chromcast, cannot be in google group

#######################################################################################################################
## Music Speakers - Entities in corresponding Google Home Speaker Group
#######################################################################################################################
  music_speakers:
    icon: mdi:music-box-multiple
    all: true
    entities:
      - media_player.living_room_speaker
      - media_player.dining_room_display
      - media_player.bedroom_display
      - media_player.bathroom_speaker
      - media_player.laundry_room_speaker
      - media_player.garage_speaker

#######################################################################################################################
## Broadcast Speakers - Entities in corresponding Google Home Speaker Group
#######################################################################################################################
  broadcast_speakers:
    icon: mdi:music-box-multiple
    all: true
    entities:
      - media_player.living_room_speaker
      - media_player.dining_room_display
      - media_player.bedroom_display
      - media_player.bathroom_speaker
      - media_player.laundry_room_speaker
      - media_player.garage_speaker

#######################################################################################################################
## Quiet Speakers - Entities in corresponding Google Home Speaker Group
#######################################################################################################################
  quiet_speakers:
    icon: mdi:music-box-multiple
    all: true
    entities:
      - media_player.dining_room_display
      - media_player.laundry_room_speaker
      - media_player.garage_speaker

#######################################################################################################################
## Night Speakers - Entities in corresponding Google Home Speaker Group
#######################################################################################################################
  night_speakers:
    icon: mdi:music-box-multiple
    all: true
    entities:
      - media_player.dining_room_display
      - media_player.garage_speaker

sensor:
  - platform: template
    sensors:
######################################################################################################################
## Media Player Display Sensors - used by conditional media player display cards
## check if media player is on and is active radio/tts/alarm clock player or in player speaker group
######################################################################################################################
      all_speakers:
        unique_id: all_speakers
        value_template: >
          {% set media = 'media_player.all_speakers' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}

          {% if states(media) in ['playing','paused'] %}
            {% if tts == media and is_state('binary_sensor.tts_playing','on') %} tts
            {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
            {% elif spotify == media and is_state('binary_sensor.spotify_active','on') %} spotify
            {% elif radio == media and is_state('binary_sensor.radio_on','on') %} radio
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.all_speakers')|lower not in ['unknown','unavailable','none'] }}"

      broadcast_speakers:
        unique_id: broadcast_speakers
        value_template: >
          {% set media = 'media_player.broadcast_speakers' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}

          {% if states(media) in ['playing','paused'] %}
            {% if tts == media and is_state('binary_sensor.tts_playing','on') %} tts
            {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
            {% elif spotify == media and is_state('binary_sensor.spotify_active','on') %} spotify
            {% elif radio == media and is_state('binary_sensor.radio_on','on') %} radio
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.broadcast_speakers')|lower not in ['unknown','unavailable','none'] }}"

      music_speakers:
        unique_id: music_speakers
        value_template: >
          {% set media = 'media_player.music_speakers' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}

          {% if states(media) in ['playing','paused'] %}
            {% if tts == media and is_state('binary_sensor.tts_playing','on') %} tts
            {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
            {% elif spotify == media and is_state('binary_sensor.spotify_active','on') %} spotify
            {% elif radio == media and is_state('binary_sensor.radio_on','on') %} radio
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.music_speakers')|lower not in ['unknown','unavailable','none'] }}"

      quiet_speakers:
        unique_id: quiet_speakers
        value_template: >
          {% set media = 'media_player.quiet_speakers' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}

          {% if states(media) in ['playing','paused'] %}
            {% if tts == media and is_state('binary_sensor.tts_playing','on') %} tts
            {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
            {% elif spotify == media and is_state('binary_sensor.spotify_active','on') %} spotify
            {% elif radio == media and is_state('binary_sensor.radio_on','on') %} radio
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.quiet_speakers')|lower not in ['unknown','unavailable','none'] }}"

      night_speakers:
        unique_id: night_speakers
        value_template: >
          {% set media = 'media_player.night_speakers' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}

          {% if states(media) in ['playing','paused'] %}
            {% if tts == media and is_state('binary_sensor.tts_playing','on') %} tts
            {% elif alarm == media and is_state('binary_sensor.alarm_clock_active','on') %} alarm_clock
            {% elif spotify == media and is_state('binary_sensor.spotify_active','on') %} spotify
            {% elif radio == media and is_state('binary_sensor.radio_on','on') %} radio
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.night_speakers')|lower not in ['unknown','unavailable','none'] }}"

      living_room_speaker:
        unique_id: living_room_speaker
        value_template: >
          {% set media = 'media_player.living_room_speaker' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.living_room_speaker')|lower not in ['unknown','unavailable','none'] }}"

      dining_room_display:
        unique_id: dining_room_display
        value_template: >
          {% set media = 'media_player.dining_room_display' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.dining_room_display')|lower not in ['unknown','unavailable','none'] }}"

      bedroom_display:
        unique_id: bedroom_display
        value_template: >
          {% set media = 'media_player.bedroom_display' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.bedroom_display')|lower not in ['unknown','unavailable','none'] }}"

      bathroom_speaker:
        unique_id: bathroom_speaker
        value_template: >
          {% set media = 'media_player.bathroom_speaker' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.bathroom_speaker')|lower not in ['unknown','unavailable','none'] }}"

      laundry_room_speaker:
        unique_id: laundry_room_speaker
        value_template: >
          {% set media = 'media_player.laundry_room_speaker' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.laundry_room_speaker')|lower not in ['unknown','unavailable','none'] }}"

      garage_speaker:
        unique_id: garage_speaker
        value_template: >
          {% set media = 'media_player.garage_speaker' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.garage_speaker')|lower not in ['unknown','unavailable','none'] }}"

      living_room_tv:
        unique_id: living_room_tv
        value_template: >
          {% set media = 'media_player.living_room_tv' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.living_room_tv')|lower not in ['unknown','unavailable','none'] }}"

      bedroom_tv:
        unique_id: bedroom_tv
        value_template: >
          {% set media = 'media_player.bedroom_tv' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.bedroom_tv')|lower not in ['unknown','unavailable','none'] }}"

      deck_tv:
        unique_id: deck_tv
        value_template: >
          {% set media = 'media_player.deck_tv' %}
          {% set radio = states('sensor.radio_media_player') %}
          {% set alarm = states('sensor.alarm_clock_media_player') %}
          {% set spotify = states('sensor.spotify_media_player') %}
          {% set tts = states('sensor.tts_media_player') %}
          {% set t_on = is_state('binary_sensor.tts_playing','on') %}
          {% set a_on = is_state('binary_sensor.alarm_clock_active','on') %}
          {% set r_on = is_state('binary_sensor.radio_on','on') %}
          {% set s_on = is_state('binary_sensor.spotify_active','on') %}

          {% if states(media) in ['playing','paused'] %}
            {% if t_on and tts == media %} tts
            {% elif a_on and alarm == media %} alarm_clock
            {% elif s_on and spotify == media %} spotify
            {% elif r_on and radio == media %} radio
            {% elif t_on and tts in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ tts.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'tts_group' if found.value|int == 1 else 'false' }}
            {% elif a_on and alarm in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ alarm.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'alarm_clock_group' if found.value|int == 1 else 'false' }}
            {% elif s_on and spotify in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'spotify_group' if found.value|int == 1 else 'false' }}
            {% elif  r_on and  radio in state_attr('group.google_speaker_groups','entity_id') %}
              {% set found = namespace(value=0) %}
              {% for item in state_attr('group.' ~ radio.split('.')[1],'entity_id') %}
                {% if item == media %}{% set found.value = 1 %}{% endif %}
              {% endfor %}
              {{ 'radio_group' if found.value|int == 1 else 'false' }}
            {% else %} on
            {% endif %}
          {% else %} off
          {% endif %}
        availability_template: "{{ states('media_player.deck_tv')|lower not in ['unknown','unavailable','none'] }}"












