###############################################################################
## Hydrawise Sprinkler Package
###############################################################################
homeassistant:
  customize:
    alert.hydrawise_connected:
      icon: mdi:sprinkler-variant
      category: sprinkler

    switch.front_boulevard_automatic_watering:
      friendly_name: "Front Boulevard Automatic Watering"
      zone_name: "Front Boulevard"
    switch.front_sidewalk_automatic_watering:
      friendly_name: "Front Sidewalk Automatic Watering"
      zone_name: "Front Sidewalk"
    switch.front_house_automatic_watering:
      friendly_name: "Front House Automatic Watering"
      zone_name: "Front House"
    switch.front_garden_automatic_watering:
      friendly_name: "Front Garden Automatic Watering"
      zone_name: "Front Garden"
    switch.side_garden_automatic_watering:
      friendly_name: "Side Garden Automatic Watering"
      zone_name: "Side Garden"
    switch.center_garden_automatic_watering:
      friendly_name: "Center Garden Left Automatic Watering"
      zone_name: "Center Garden Left"
    switch.center_garden_automatic_watering_2:
      friendly_name: "Center Garden Right Automatic Watering"
      zone_name: "Center Garden Right"
    switch.back_grass_lef_automatic_watering:
      friendly_name: "Back Grass Left Automatic Watering"
      zone_name: "Back Grass Left"
    switch.back_grass_rig_automatic_watering:
      friendly_name: "Back Grass Right Automatic Watering"
      zone_name: "Back Grass Right"
    switch.back_grass_cen_automatic_watering:
      friendly_name: "Back Grass Center Automatic Watering"
      zone_name: "Back Grass Center"
    switch.back_garden_ri_automatic_watering:
      friendly_name: "Back Garden Right Automatic Watering"
      zone_name: "Back Garden Right"
    switch.back_garden_le_automatic_watering:
      friendly_name: "Back Garden Left Watering"
      zone_name: "Back Garden Left"

    switch.front_boulevard_manual_watering:
      friendly_name: "Front Boulevard Manual Watering"
      zone_name: "Front Boulevard"
    switch.front_sidewalk_manual_watering:
      friendly_name: "Front Sidewalk Manual Watering"
      zone_name: "Front Sidewalk"
    switch.front_house_manual_watering:
      friendly_name: "Front House Manual Watering"
      zone_name: "Front House"
    switch.front_garden_manual_watering:
      friendly_name: "Front Garden Manual Watering"
      zone_name: "Front Garden"
    switch.side_garden_manual_watering:
      friendly_name: "Side Garden Manual Watering"
      zone_name: "Side Garden"
    switch.center_garden_manual_watering:
      friendly_name: "Center Garden Left Manual Watering"
      zone_name: "Center Garden Left"
    switch.center_garden_manual_watering_2:
      friendly_name: "Center Garden Right Manual Watering"
      zone_name: "Center Garden Right"
    switch.back_grass_lef_manual_watering:
      friendly_name: "Back Grass Left Manual Watering"
      zone_name: "Back Grass Left"
    switch.back_grass_rig_manual_watering:
      friendly_name: "Back Grass Right Manual Watering"
      zone_name: "Back Grass Right"
    switch.back_grass_cen_manual_watering:
      friendly_name: "Back Grass Center Manual Watering"
      zone_name: "Back Grass Center"
    switch.back_garden_ri_manual_watering:
      friendly_name: "Back Garden Right Manual Watering"
      zone_name: "Back Garden Right"
    switch.back_garden_le_manual_watering:
      friendly_name: "Back Garden Left Manual Watering"
      zone_name: "Back Garden Left"

    sensor.front_boulevard_watering_time:
      friendly_name: "Front Boulevard Watering Time"
      zone_name: "Front Boulevard"
    sensor.front_sidewalk_watering_time:
      friendly_name: "Front Sidewalk Watering Time"
      zone_name: "Front Sidewalk"
    sensor.front_house_watering_time:
      friendly_name: "Front House Watering Time"
      zone_name: "Front House"
    sensor.front_garden_watering_time:
      friendly_name: "Front Garden Watering Time"
      zone_name: "Front Garden"
    sensor.side_garden_watering_time:
      friendly_name: "Side Garden Watering Time"
      zone_name: "Side Garden"
    sensor.center_garden_watering_time:
      friendly_name: "Center Garden Left Watering Time"
      zone_name: "Center Garden Left"
    sensor.center_garden_watering_time_2:
      friendly_name: "Center Garden Right Watering Time"
      zone_name: "Center Garden Right"
    sensor.back_grass_lef_watering_time:
      friendly_name: "Side Garden Watering Time"
      zone_name: "Side Garden"
    sensor.back_grass_rig_watering_time:
      friendly_name: "Back Grass Right Watering Time"
      zone_name: "Back Grass Right"
    sensor.back_grass_cen_watering_time:
      friendly_name: "Back Grass Center Watering Time"
      zone_name: "Back Grass Center"
    sensor.back_garden_ri_watering_time:
      friendly_name: "Back Garden Right Watering Time"
      zone_name: "Back Garden Right"
    sensor.back_garden_le_watering_time:
      friendly_name: "Back Garden Left Watering"
      zone_name: "Back Garden Left"

    binary_sensor.front_boulevard_watering:
      friendly_name: "Front Boulevard Watering"
      zone_name: "Front Boulevard"
    binary_sensor.front_sidewalk_watering:
      friendly_name: "Front Sidewalk Watering"
      zone_name: "Front Sidewalk"
    binary_sensor.front_house_watering:
      friendly_name: "Front House Watering"
      zone_name: "Front House"
    binary_sensor.front_garden_watering:
      friendly_name: "Front Garden Watering"
      zone_name: "Front Garden"
    binary_sensor.side_garden_watering:
      friendly_name: "Side Garden Watering"
      zone_name: "Side Garden"
    binary_sensor.center_garden_watering:
      friendly_name: "Center Garden Left Watering"
      zone_name: "Center Garden Left"
    binary_sensor.center_garden_watering_2:
      friendly_name: "Center Garden Right Watering"
      zone_name: "Center Garden Right"
    binary_sensor.back_grass_lef_watering:
      friendly_name: "Back Grass Left Watering"
      zone_name: "Back Grass Left"
    binary_sensor.back_grass_rig_watering:
      friendly_name: "Back Grass Right Watering"
      zone_name: "Back Grass Right"
    binary_sensor.back_grass_cen_watering:
      friendly_name: "Back Grass Center Watering"
      zone_name: "Back Grass Center"
    binary_sensor.back_garden_ri_watering:
      friendly_name: "Back Garden Right Watering"
      zone_name: "Back Garden Right"
    binary_sensor.back_garden_le_watering:
      friendly_name: "Back Garden Left Watering"
      zone_name: "Back Garden Left"

    sensor.front_boulevard_next_cycle:
      friendly_name: "Front Boulevard Next Cycle"
      zone_name: "Front Boulevard"
    sensor.front_sidewalk_next_cycle:
      friendly_name: "Front Sidewalk Next Cycle"
      zone_name: "Front Sidewalk"
    sensor.front_house_next_cycle:
      friendly_name: "Front House Next Cycle"
      zone_name: "Front House"
    sensor.front_garden_next_cycle:
      friendly_name: "Front Garden Next Cycle"
      zone_name: "Front Garden"
    sensor.side_garden_next_cycle:
      friendly_name: "Side Garden Next Cycle"
      zone_name: "Side Garden"
    sensor.center_garden_next_cycle:
      friendly_name: "Center Garden Left Next Cycle"
      zone_name: "Center Garden Left"
    sensor.center_garden_next_cycle_2:
      friendly_name: "Center Garden Right Next Cycle"
      zone_name: "Center Garden Right"
    sensor.back_grass_lef_next_cycle:
      friendly_name: "Back Grass Left Next Cycle"
      zone_name: "Back Grass Left"
    sensor.back_grass_rig_next_cycle:
      friendly_name: "Back Grass Right Next Cycle"
      zone_name: "Back Grass Right"
    sensor.back_grass_cen_next_cycle:
      friendly_name: "Back Grass Center Next Cycle"
      zone_name: "Back Grass Center"
    sensor.back_garden_ri_next_cycle:
      friendly_name: "Back Garden Right Next Cycle"
      zone_name: "Back Garden Right"
    sensor.back_garden_le_next_cycle:
      friendly_name: "Back Garden Left Next Cycle"
      zone_name: "Back Garden Left"

hydrawise:
  access_token: !secret HYRDRAWISE_API
  scan_interval: 300

switch:
  - platform: hydrawise
    monitored_conditions:
      - auto_watering
      - manual_watering
    watering_minutes: 15

  - platform: template
    switches:
      sprinkler_automatic_watering: #ISSUE https://github.com/jazzyisj/home-assistant-config/issues/78
        unique_id: sprinkler_automatic_watering
        friendly_name: "Automatic Watering"
        icon_template: mdi:leak
        value_template: "{{ is_state('group.sprinkler_automatic_watering', 'on') }}"
        availability_template: >
          {{ states.switch|selectattr('entity_id','in',integration_entities('hydrawise'))
              |selectattr('entity_id','contains','_automatic_watering')
              |map(attribute='entity_id')|list|select('has_value')|list|count > 0 }}
        turn_on:
          - service: switch.turn_on
            target:
              entity_id: group.sprinkler_automatic_watering
        turn_off:
          - service: switch.turn_off
            target:
              entity_id: group.sprinkler_automatic_watering

binary_sensor:
  - platform: hydrawise
    monitored_conditions:
      - is_watering
      - status

sensor:
  - platform: hydrawise
    monitored_conditions:
      - watering_time
      - next_cycle

input_boolean:
  sprinkler_alerts:
    name: "Sprinkler Alerts"
    icon: mdi:alert

group:
  sprinkler_next_cycle:
    entities:
      - sensor.front_boulevard_next_cycle
      - sensor.front_sidewalk_next_cycle
      - sensor.front_house_next_cycle
      - sensor.front_garden_next_cycle
      - sensor.side_garden_next_cycle
      - sensor.center_garden_next_cycle
      - sensor.center_garden_next_cycle_2
      - sensor.back_grass_lef_next_cycle
      - sensor.back_grass_rig_next_cycle
      - sensor.back_grass_cen_next_cycle
      - sensor.back_garden_ri_next_cycle
      - sensor.back_garden_le_next_cycle

  sprinkler_current_cycle:
    entities:
      - binary_sensor.front_boulevard_watering
      - binary_sensor.front_sidewalk_watering
      - binary_sensor.front_house_watering
      - binary_sensor.front_garden_watering
      - binary_sensor.side_garden_watering
      - binary_sensor.center_garden_watering
      - binary_sensor.center_garden_watering_2
      - binary_sensor.back_grass_lef_watering
      - binary_sensor.back_grass_rig_watering
      - binary_sensor.back_grass_cen_watering
      - binary_sensor.back_garden_ri_watering
      - binary_sensor.back_garden_le_watering

  sprinkler_automatic_watering:
    entities:
      - switch.front_boulevard_automatic_watering
      - switch.front_sidewalk_automatic_watering
      - switch.front_house_automatic_watering
      - switch.front_garden_automatic_watering
      - switch.side_garden_automatic_watering
      - switch.center_garden_automatic_watering
      - switch.center_garden_automatic_watering_2
      - switch.back_grass_lef_automatic_watering
      - switch.back_grass_rig_automatic_watering
      - switch.back_grass_cen_automatic_watering
      - switch.back_garden_ri_automatic_watering
      - switch.back_garden_le_automatic_watering

alert:
  hydrawise_connected:
    name: "Hyrdawise Connected"
    entity_id: binary_sensor.hydrawise_connected_alert
    state: "on"
    notifiers: log
    skip_first: false
    repeat: 999999
    data:
      tag: hydrawise_connected
