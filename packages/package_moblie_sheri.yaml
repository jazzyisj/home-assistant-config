#######################################################################################################################
## Mobile App Package - Sheri - common elements w/jason
#######################################################################################################################
homeassistant:
  customize:
    alert.mobile_phone_headphones_sheri:
      icon: mdi:headphones
    alert.mobile_phone_ringer_sheri:
      icon: mdi:phone-ring
    alert.mobile_phone_bluetooth_sheri:
      icon: mdi:phone-bluetooth
    alert.mobile_phone_wifi_sheri:
      icon: mdi:cellphone-wireless
    alert.mobile_phone_offline_sheri:
      icon: mdi:cellphone-off
    alert.mobile_phone_battery_sheri:
      icon: mdi:battery-alert

alert:
#######################################################################################################################
## Alert - Phone Offline Sheri
#######################################################################################################################
  mobile_phone_offline_sheri:
    name: "Phone Offline Sheri"
    title: "Phone Offline Sheri Alert "
    message: "Phone offline at {{ as_timestamp(now())|timestamp_custom('%I:%M%p') }}"
    entity_id: binary_sensor.phone_connected_sheri_alert
    state: 'off'
    repeat: 120 # 2h
    can_acknowledge: true
    skip_first: false
    notifiers: sheri
    data:
      actions:
        - action: pause_phone_offline_sheri
          title: Pause
        - action: close_phone_offline_sheri
          title: Close
      tag: phone_offline_sheri
      timestamp: "{{ as_timestamp(now()) }}" #push
      priority: normal
      renotify: false #push
      ttl: 3600
      silent: true #push
      requireInteraction: false #push
      sticky: false #app
      url: /lovelace/presence #push
      clickAction: /lovelace/presence #app
      color: !secret WARNING_COLOR #app
      image: !secret OFFLINE_IMAGE
      icon: !secret OFFLINE_ICON #push
      badge: !secret OFFLINE_BADGE #push

#######################################################################################################################
## Alert - Phone Ringer Sheri
#######################################################################################################################
  mobile_phone_ringer_sheri:
    name: "Phone Ringer Sheri"
    title: "Phone Ringer Sheri Alert"
    message: "Sheri, your mobile phone ringer is off."
    entity_id: binary_sensor.phone_ringer_sheri_alert
    state: 'on'
    repeat: 60 # 1h
    can_acknowledge: true
    skip_first: false
    notifiers: sheri
    data:
      actions:
        - action: pause_phone_ringer_sheri
          title: Pause
        - action: close_phone_ringer_sheri
          title: Close
      tag: phone_ringer_sheri
      priority: normal
      ttl: 3600
      sticky: true #app
      color: !secret WARNING_COLOR #app
      image: !secret OFFLINE_IMAGE #IMAGE

#######################################################################################################################
## Alert - Phone Bluetooth Sheri
#######################################################################################################################
  mobile_phone_bluetooth_sheri:
    name: "Phone Bluetooth Sheri"
    title: "Phone Bluetooth Sheri Alert"
    message: "Sheri, your mobile phone bluetooth is off."
    entity_id: binary_sensor.phone_bluetooth_sheri_alert
    state: 'on'
    repeat: 60 # 1h
    can_acknowledge: true
    skip_first: false
    notifiers: sheri
    data:
      actions:
        - action: pause_phone_bluetooth_sheri
          title: Pause
        - action: close_phone_bluetooth_sheri
          title: Close
      tag: phone_bluetooth_sheri
      priority: normal
      ttl: 3600
      sticky: true #app
      color: !secret WARNING_COLOR #app
      image: !secret OFFLINE_IMAGE #IMAGE

#######################################################################################################################
## Alert - Phone Wifi Sheri
#######################################################################################################################
  mobile_phone_wifi_sheri:
    name: "Phone Wifi Sheri"
    title: "Phone Wifi Sheri Alert"
    message: "Sheri, your mobile phone wifi is off."
    entity_id: binary_sensor.phone_wifi_sheri_alert
    state: 'on'
    repeat: 60 # 1h
    can_acknowledge: true
    skip_first: false
    notifiers: sheri
    data:
      actions:
        - action: pause_phone_wifi_sheri
          title: Pause
        - action: close_phone_wifi_sheri
          title: Close
      tag: phone_wifi_sheri
      priority: normal
      ttl: 3600
      sticky: true #app
      color: !secret WARNING_COLOR #app
      image: !secret OFFLINE_IMAGE #IMAGE

#######################################################################################################################
## Alert - Phone Headphones Sheri
#######################################################################################################################
  mobile_phone_headphones_sheri:
    name: "Phone Headphones Sheri"
    title: "Phone Headphones Sheri Alert"
    message: >
      {% set c = '00:18:6B:97:9B:B9' in state_attr('sensor.sphone_bluetooth_connection','connected_paired_devices') %}
      Your headphones are on{{ ', and are still connected to your phone!' if c else '.' }}
    entity_id: binary_sensor.phone_headphones_sheri_alert
    state: 'on'
    repeat: 60 # 1h
    can_acknowledge: true
    skip_first: false
    notifiers: sheri
    data:
      actions:
        - action: pause_phone_headphones_sheri
          title: Pause
        - action: close_phone_headphones_sheri
          title: Close
      tag: phone_headphones_sheri
      priority: normal
      ttl: 3600
      sticky: true #app
      color: !secret WARNING_COLOR #app
      image: !secret OFFLINE_IMAGE #IMAGE

#######################################################################################################################
## Alert - Phone Battery Sheri
#######################################################################################################################
  mobile_phone_battery_sheri:
    name: "Phone Battery Sheri"
    title: "Phone Battery Sheri Alert"
    message: "Phone Battery: {{ states('sensor.sphone_battery_level') }}%"
    entity_id: binary_sensor.phone_battery_sheri_alert
    state: 'on'
    repeat: 60 # 1h
    can_acknowledge: true
    skip_first: false
    notifiers: sheri
    data:
      actions:
        - action: pause_phone_battery_sheri
          title: Pause
        - action: close_phone_battery_sheri
          title: Close
      tag: phone_battery_sheri
      priority: normal
      ttl: 3600
      sticky: true #app
      color: !secret WARNING_COLOR #app
      image: !secret OFFLINE_IMAGE #IMAGE

sensor:
  - platform: template
    sensors:
#######################################################################################################################
## Phone Last Update
#######################################################################################################################
      sphone_last_update:
        friendly_name: Last Update
        unique_id: sphone_last_update
        icon_template: mdi:cellphone-arrow-down
        value_template: >
          {{ 'unknown' if states('device_tracker.sphone') in ['unknown','unavailable','none']
                else as_timestamp(states.device_tracker.sphone.last_updated)|timestamp_custom('%-H:%M',true) }}

      sphone_address:
        friendly_name: Sheri Location Address
        unique_id: sphone_address
        icon_template: mdi:google-maps
        value_template: "{{ state_attr('device_tracker.google_maps_115097751563829374630','address') }}"

      sphone_alarm_clock:
        friendly_name: Sheri Phone Alarm
        unique_id: sphone_alarm_clock
        icon_template: mdi:alarm
        value_template: >
          {{ 'Off' if states('sensor.sphone_next_alarm') in ['unknown','unavailable','none']
                or (as_timestamp(states('sensor.sphone_next_alarm')) - as_timestamp(now())) > 86400
                  else as_timestamp(states('sensor.sphone_next_alarm'))|timestamp_custom('%H:%M',true) }}

      sphone_alarm_clock_display:
        friendly_name: Sheri Phone Alarm
        unique_id: sheri_phone_connected
        icon_template: mdi:alarm
        value_template: >
          {{ 'Off' if is_state('sensor.sphone_alarm_clock','Off')
                else  as_timestamp(states('sensor.date') ~ ' ' ~ states('sensor.sphone_alarm_clock'))|timestamp_custom('%_I:%M%p',true) }}

binary_sensor:
  - platform: template
    sensors:
#######################################################################################################################
## Phone Connected Sheri - ping, bluetooth are connected or last GPS update less than 15 minutes ago phone is connected
#######################################################################################################################
      sheri_phone_connected:
        friendly_name: Phone Connected Sheri
        unique_id: sheri_phone_connected
        icon_template: "{{ 'mdi:cellphone-wireless' if is_state('binary_sensor.sheri_phone_connected','on') else 'mdi:cellphone-off' }}"
        device_class: connectivity
        value_template: >
          {% if states('device_tracker.sheri_tracker') in ['unknown','unavailable','none'] %} false
          {% else %}
            {% set p = as_timestamp(state_attr('device_tracker.sheri_tracker','last_seen')) %}
            {% set t = as_timestamp(states('sensor.date') ~ ' ' ~ states('sensor.time')) %}
            {% set minutes = (t-p)/60 %}
            {{ is_state('device_tracker.jphone_bt','home')
                or is_state('device_tracker.jphone_ping','home')
                or minutes < 15 }}
          {% endif %}

      phone_connected_sheri_alert:
        unique_id: phone_connected_sheri_alert
        delay_off:
          minutes: 60
        value_template: "(( is_state('binary_sensor.sheri_phone_connected','off') and is_state('binary_sensor.alerts_enabled','on') }}"

#######################################################################################################################
## Phone Ringer Sheri
#######################################################################################################################
      phone_ringer_sheri_alert:
        unique_id: phone_ringer_sheri_alert
        value_template: >
          {{ (is_state('sensor.sphone_do_not_disturb_sensor','priority_only')
              or is_state('sensor.sphone_ringer_mode','off')
              or states('sensor.sphone_volume_level_ringer')|int < 1)
              and states('sensor.time') > states('sensor.waketime_today')
              and not is_state('binary_sensor.quiet_hours','on')
              and not is_state('input_select.occupancy_mode','Night') }}

#######################################################################################################################
## Phone Bluetooth Sheri
#######################################################################################################################
      phone_bluetooth_sheri_alert:
        unique_id: phone_bluetooth_sheri_alert
        value_template: "{{ is_state('binary_sensor.sphone_bluetooth_state','off') and is_state('device_tracker.sphone_bt','not_home') }}"

#######################################################################################################################
## Phone Wifi Sheri
#######################################################################################################################
      phone_wifi_sheri_alert:
        unique_id: phone_wifi_sheri_alert
        value_template: "{{ is_state('binary_sensor.sphone_wifi_state','off') and is_state('device_tracker.sphone_wifi','not_home') }}"

#######################################################################################################################
## Phone Headphone Sheri
#######################################################################################################################
      phone_headphones_sheri_alert:
        unique_id: phone_headphones_sheri_alert
        delay_on:
          minutes: 10 # wait until in house, settled
        value_template: >
          {% set p = is_state('device_tracker.sheri_headphone','home') %}
          {% set c = 'B8:AD:3E:A5:5B:00' in state_attr('sensor.sphone_bluetooth_connection','connected_paired_devices') %}
          {{ is_state('input_boolean.presence_automation','on')
              and is_state('binary_sensor.alerts_enabled','on')
              and is_state('binary_sensor.sheri_home','on')
              and ( p or c )
              and not is_state('alert.phone_mobile_headphone_sheri','off') }}

#######################################################################################################################
## Phone Battery Sheri
#######################################################################################################################
      phone_battery_sheri_alert:
        unique_id: phone_battery_sheri_alert
        value_template: >
          {{ states('sensor.sphone_battery_level')|int < 20 and is_state('binary_sensor.sphone_is_charging','off')
              and is_state('binary_sensor.alerts_enabled','on') }}

automation:
#######################################################################################################################
## Mobile - Phone Offline Alert Sheri
#######################################################################################################################
  - id: mobile_phone_offline_sheri
    alias: "[Mobile] Phone Offline Sheri"
    description: "Play announcement when alert turns on."
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_offline_sheri
        to: 'on'

      # check alert in morning
      - platform: state
        entity_id: input_select.occupancy_mode
        to: Home
        from: Night
        for:
          minutes: 30

      # check alert when arrive home
      - platform: state
        entity_id: binary_sensor.sheri_home
        to: 'on'
        for:
          minutes: 10 # wait until person likely inside

    condition:
      - condition: state
        entity_id:
          - alert.mobile_phone_offline_sheri
          - binary_sensor.sheri_home
        state: 'on'

      - condition: state
        entity_id: input_select.occupancy_mode
        state: Home

    action:
      - repeat:
          sequence:
            - service: script.tts_announcement
              data:
                play_message: "Sheri, your mobile phone is offline at {{ as_timestamp(now())|timestamp_custom('%I:%M%p') }}"
                quiet_play: true

            # wait for alert to turned off/dismissed
            - wait_template: "{{ not is_state('alert.mobile_phone_offline_sheri','on') }}"
              timeout:
                hours: 1

          until:
            - condition: not
              conditions:
                - condition: state
                  entity_id: alert.mobile_phone_offline_sheri
                  state: 'on'

#######################################################################################################################
## Mobile - Phone Ringer Sheri
#######################################################################################################################
  - id: mobile_phone_ringer_sheri
    alias: "[Mobile] Phone Ringer Sheri"
    description: "Play announcement when alert turns on."
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_ringer_sheri
        to: 'on'

      # check alert in morning
      - platform: state
        entity_id: input_select.occupancy_mode
        to: Home
        from: Night
        for:
          minutes: 30

      # check alert when arrive home
      - platform: state
        entity_id: binary_sensor.sheri_home
        to: 'on'
        for:
          minutes: 10 # wait until person likely inside

    condition:
      - condition: state
        entity_id:
          - alert.mobile_phone_ringer_sheri
          - binary_sensor.sheri_home
        state: 'on'

      - condition: state
        entity_id: input_select.occupancy_mode
        state: Home

    action:
      - repeat:
          sequence:
            # always false during quiet hours, no quiet play
            - service: script.tts_announcement
              data:
                play_message: "Sheri, your phone ringer is off."

            # wait for alert to turned off/dismissed
            - wait_template: "{{ not is_state('alert.mobile_phone_ringer_sheri','on') }}"
              timeout:
                hours: 1

          until:
            - condition: not
              conditions:
                - condition: state
                  entity_id: alert.mobile_phone_ringer_sheri
                  state: 'on'

#######################################################################################################################
## Mobile - Phone Bluetooth Sheri
#######################################################################################################################
  - id: mobile_phone_bluetooth_sheri
    alias: "[Mobile] Phone Bluetooth Sheri"
    description: "Play announcement when alert turns on."
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_bluetooth_sheri
        to: 'on'

      # check alert in morning
      - platform: state
        entity_id: input_select.occupancy_mode
        to: Home
        from: Night
        for:
          minutes: 30

      # check alert when arrive home
      - platform: state
        entity_id: binary_sensor.sheri_home
        to: 'on'
        for:
          minutes: 10 # wait until person likely inside

    condition:
      - condition: state
        entity_id:
          - alert.mobile_phone_bluetooth_sheri
          - binary_sensor.sheri_home
        state: 'on'

      - condition: state
        entity_id: input_select.occupancy_mode
        state: Home

    action:
      - repeat:
          sequence:
            - service: script.tts_announcement
              data:
                play_message: "Sheri, your phone bluetooth is off."
                quiet_play: true

            # wait for alert to turned off/dismissed
            - wait_template: "{{ not is_state('alert.mobile_phone_bluetooth_sheri','on') }}"
              timeout:
                hours: 1

          until:
            - condition: not
              conditions:
                - condition: state
                  entity_id: alert.mobile_phone_bluetooth_sheri
                  state: 'on'

#######################################################################################################################
## Mobile - Phone Wifi Sheri
#######################################################################################################################
  - id: mobile_phone_wifi_sheri
    alias: "[Mobile] Phone Wifi Sheri"
    description: "Play announcement when alert turns on."
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_wifi_sheri
        to: 'on'

      # check alert in morning
      - platform: state
        entity_id: input_select.occupancy_mode
        to: Home
        from: Night
        for:
          minutes: 30

      # check alert when arrive home
      - platform: state
        entity_id: binary_sensor.sheri_home
        to: 'on'
        for:
          minutes: 10 # wait until person likely inside

    condition:
      - condition: state
        entity_id:
          - alert.mobile_phone_wifi_sheri
          - binary_sensor.sheri_home
        state: 'on'

      - condition: state
        entity_id: input_select.occupancy_mode
        state: Home

    action:
      - repeat:
          sequence:
            - service: script.tts_announcement
              data:
                play_message: "Sheri, your phone wifi is off."
                quiet_play: true

            # wait for alert to turned off/dismissed
            - wait_template: "{{ not is_state('alert.mobile_phone_wifi_sheri','on') }}"
              timeout:
                hours: 1


          until:
            - condition: not
              conditions:
                - condition: state
                  entity_id: alert.mobile_phone_wifi_sheri
                  state: 'on'

#######################################################################################################################
## Mobile - Phone Headphones Sheri
#######################################################################################################################
  - id: mobile_phone_headphones_sheri
    alias: "[Mobile] Phone Headphones Sheri"
    description: "Play announcement when alert turns on."
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_headphones_sheri
        to: 'on'

      # check alert in morning
      - platform: state
        entity_id: input_select.occupancy_mode
        to: Home
        from: Night
        for:
          minutes: 30

      # check alert when arrive home
      - platform: state
        entity_id: binary_sensor.sheri_home
        to: 'on'
        for:
          minutes: 10 # wait until person likely inside

    condition:
      - condition: state
        entity_id:
          - alert.mobile_phone_headphones_sheri
          - binary_sensor.sheri_home
        state: 'on'

      - condition: state
        entity_id: input_select.occupancy_mode
        state: Home

    action:
      - repeat:
          sequence:
            - service: script.tts_announcement
              data:
                play_message: >
                  {% set c = 'B8:AD:3E:A5:5B:00' in state_attr('sensor.sphone_bluetooth_connection','connected_paired_devices') %}
                  Sheri, I think you've gone senile sweetie. You've left your headphones on again{{ ', and they are still connected to your phone!' if c else '.' }}
                quiet_play: true

            # wait for alert to turned off/dismissed
            - wait_template: "{{ not is_state('alert.mobile_phone_headphones_sheri','on') }}"
              timeout:
                hours: 1

          until:
            - condition: not
              conditions:
                - condition: state
                  entity_id: alert.mobile_phone_headphones_sheri
                  state: 'on'

#######################################################################################################################
## Mobile - Phone Battery Low Sheri
#######################################################################################################################
  - id: mobile_phone_battery_low_sheri
    alias: "[Mobile] Phone Battery Low Sheri"
    description: "Play announcement when alert turns on."
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_battery_sheri
        to: 'on'

      # check alert in morning
      - platform: state
        entity_id: input_select.occupancy_mode
        to: Home
        from: Night
        for:
          minutes: 30

      # check alert when arrive home
      - platform: state
        entity_id: binary_sensor.sheri_home
        to: 'on'
        for:
          minutes: 10 # wait until person likely inside

    condition:
      - condition: state
        entity_id:
          - alert.mobile_phone_battery_sheri
          - binary_sensor.sheri_home
        state: 'on'

      - condition: state
        entity_id: input_select.occupancy_mode
        state: Home

    action:
      - repeat:
          sequence:
            - service: script.tts_announcement
              data:
                play_message: >
                  Attention! Sheri, your phone battery is at {{ states('sensor.sphone_battery_level') }}%. You should plug it in!
                quiet_play: true

            # prevent automation from triggering again for at least 30 minutes
            - delay:
                minutes: 30

            # wait for alert to turned off/dismissed
            - wait_template: "{{ not is_state('alert.mobile_phone_battery_sheri','on') }}"
              timeout:
                hours: 1

          until:
            - condition: not
              conditions:
                - condition: state
                  entity_id: alert.mobile_phone_battery_sheri
                  state: 'on'

#######################################################################################################################
## Mobile - Close Phone Offline Sheri Notifications
#######################################################################################################################
  - id: mobile_close_phone_offline_sheri_notifications
    alias: "[Mobile] Close Phone Offline Sheri Notifications"
    description: "Dismiss notifications on all devices."
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_offline_sheri
        to:
          - idle
          - 'off'

      - platform: event
        event_type: html5_notification.closed
        event_data:
          tag: phone_offline_sheri

      #BUG html5 closed event doesn't work if notification is in tray
      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: close_phone_offline_sheri

      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: pause_phone_offline_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: close_phone_offline_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: pause_phone_offline_sheri

    action:
      - service: script.close_notifications
        data:
          target: mobile_app_sphone
          category: mobile
          tag: phone_offline_sheri
          pause: "{% if trigger.event is defined %}{{ trigger.event.data['action'] == 'pause_pphone_offline_sheri' }}{% endif %}"

#######################################################################################################################
## Mobile - Close Phone Ringer Sheri Notifications
#######################################################################################################################
  - id: mobile_close_phone_ringer_sheri_notifications
    alias: "[Mobile] Close Phone Ringer Sheri Notifications"
    description: "Dismiss notifications on all devices."
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_ringer_sheri
        to:
          - idle
          - 'off'

      - platform: event
        event_type: html5_notification.closed
        event_data:
          tag: phone_ringer_sheri

      #BUG html5 closed event doesn't work if notification is in tray
      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: close_phone_ringer_sheri

      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: pause_phone_ringer_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: close_phone_ringer_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: pause_phone_ringer_sheri

    action:
      - service: script.close_notifications
        data:
          target: mobile_app_sphone
          category: mobile
          tag: phone_ringer_sheri
          pause: "{% if trigger.event is defined %}{{ trigger.event.data['action'] == 'pause_phone_ringer_sheri' }}{% endif %}"

#######################################################################################################################
## Mobile - Close Phone Bluetooth Sheri Notifications
#######################################################################################################################
  - id: mobile_close_phone_bluetooth_sheri_notifications
    alias: "[Mobile] Close Phone Bluetooth Sheri Notifications"
    description: "Dismiss notifications on all devices."
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_bluetooth_sheri
        to:
          - idle
          - 'off'

      - platform: event
        event_type: html5_notification.closed
        event_data:
          tag: phone_bluetooth_sheri

      #BUG html5 closed event doesn't work if notification is in tray
      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: close_phone_bluetooth_sheri

      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: pause_phone_bluetooth_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: close_phone_bluetooth_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: pause_phone_bluetooth_sheri

    action:
      - service: script.close_notifications
        data:
          target: mobile_app_sphone
          category: mobile
          tag: phone_bluetooth_sheri
          pause: "{% if trigger.event is defined %}{{ trigger.event.data['action'] == 'pause_phone_bluetooth_sheri' }}{% endif %}"

#######################################################################################################################
## Mobile - Close Phone Wifi Sheri Notifications
#######################################################################################################################
  - id: mobile_close_phone_wifi_sheri_notifications
    alias: "[Mobile] Close Phone Wifi Sheri Notifications"
    description: "Dismiss notifications on all devices."
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_wifi_sheri
        to:
          - idle
          - 'off'

      - platform: event
        event_type: html5_notification.closed
        event_data:
          tag: phone_wifi_sheri

      #BUG html5 closed event doesn't work if notification is in tray
      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: close_phone_wifi_sheri

      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: pause_phone_wifi_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: close_phone_wifi_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: pause_phone_wifi_sheri

    action:
      - service: script.close_notifications
        data:
          target: mobile_app_sphone
          category: mobile
          tag: phone_wifi_sheri
          pause: "{% if trigger.event is defined %}{{ trigger.event.data['action'] == 'pause_phone_wifi_sheri' }}{% endif %}"

#######################################################################################################################
## Mobile - Close Phone Headphones Sheri Notifications
#######################################################################################################################
  - id: mobile_close_phone_headphones_sheri_notifications
    alias: "[Mobile] Close Phone Headphones Sheri Notifications"
    description: "Dismiss notifications on all devices."
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_headphones_sheri
        to:
          - idle
          - 'off'

      - platform: event
        event_type: html5_notification.closed
        event_data:
          tag: phone_headphones_sheri

      #BUG html5 closed event doesn't work if notification is in tray
      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: close_phone_headphones_sheri

      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: pause_phone_headphones_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: close_phone_headphones_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: pause_phone_headphones_sheri

    action:
      - service: script.close_notifications
        data:
          target: mobile_app_sphone
          category: mobile
          tag: phone_headphones_sheri
          pause: "{% if trigger.event is defined %}{{ trigger.event.data['action'] == 'pause_phone_headphones_sheri' }}{% endif %}"

#######################################################################################################################
## Mobile - Close Phone Battery Sheri Notifications
#IDEA add battery health
#######################################################################################################################
  - id: mobile_close_phone_battery_sheri_notifications
    alias: "[Mobile] Close Phone Battery Sheri Notifications"
    description: "Dismiss notifications on all devices."
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: alert.mobile_phone_battery_sheri
        to:
          - idle
          - 'off'

      - platform: event
        event_type: html5_notification.closed
        event_data:
          tag: phone_battery_sheri

      #BUG html5 closed event doesn't work if notification is in tray
      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: close_phone_battery_sheri

      - platform: event
        event_type: html5_notification.clicked
        event_data:
          action: pause_phone_battery_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: close_phone_battery_sheri

      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: pause_phone_battery_sheri

    action:
      - service: script.close_notifications
        data:
          target: mobile_app_sphone
          category: mobile
          tag: phone_battery_sheri
          pause: "{% if trigger.event is defined %}{{ trigger.event.data['action'] == 'pause_phone_battery_sheri' }}{% endif %}"