#######################################################################################################################
## TTS Announcements Package  https://www.home-assistant.io/components/tts
#NOTE tts (except broadcast) will stop and disconnect any media that is playing on any announcement speaker
# radio, alarm clock, spotify (restarts playlist) will automatically resume
#######################################################################################################################

tts:
#######################################################################################################################
## TTS - Amazon Polly
## https://www.home-assistant.io/components/tts.amazon_polly/
## https://aws.amazon.com/polly/
## https://docs.aws.amazon.com/polly/latest/dg/supported-ssml.html
#######################################################################################################################
  - platform: amazon_polly
    base_url: !secret BASE_URL_IP
    aws_access_key_id: !secret AWS_ACCESS_KEY_ID
    aws_secret_access_key: !secret AWS_POLLY_ACCESS_KEY
    region_name: us-east-1
    #region_name: eu-west-2 #OPTION
    text_type: text
    #text_type: ssml #OPTION
    #voice: Nicole
    voice: Matthew #OPTION
    #voice: Amy #OPTION
    output_format: mp3
    sample_rate: 22050
    engine: standard

#######################################################################################################################
## TTS - Google Translate (Unofficial) - https://www.home-assistant.io/integrations/google_translate/
#######################################################################################################################
  - platform: google_translate
    base_url: !secret BASE_URL_IP
    service_name: google_say

#######################################################################################################################
## TTS - Google Cloud
## https://www.home-assistant.io/integrations/google_cloud/
## https://cloud.google.com/text-to-speech/docs/voices
#######################################################################################################################
  - platform: google_cloud
    key_file: HASSIO-ba9d51703228.json
    encoding: mp3
    #OPTION voice: en-AU-Standard-A # Sheila
    #OPTION voice: en-IN-Standard-D  # Anika
    #OPTION voice: en-GB-Standard-C # Stella
    voice: en-GB-Standard-F # Phoebe
    speed: 0.95
    pitch: 1.0
    #gain: 1.0
    profiles:
      - telephony-class-application
      - medium-bluetooth-speaker-class-device

#######################################################################################################################
## TTS - Microsoft - https://www.home-assistant.io/integrations/microsoft/
#######################################################################################################################
#BUG crashes home assistant!  - platform: microsoft
#     api_key: !secret MSTTS_API
#     language: en-gb
#     gender: Male
#     type: George, Apollo
#     rate: 20
#     volume: -50
#     pitch: high
#     contour: (0, 0) (100, 100)

variable:
#######################################################################################################################
## TTS Variables
#######################################################################################################################
  tts_saved_messages:
    value: 0
    attributes:
      friendly_name: 'Saved Messages'
      icon: mdi:account-voice
    restore: true

input_boolean:
#######################################################################################################################
## Announcements Enabled
#######################################################################################################################
  tts_enabled:
    name: Announcements Enabled
    icon: mdi:account-voice

#######################################################################################################################
## Announcement Playing
#######################################################################################################################
  tts_playing:
    name: TTS Announcement Playing
    initial: false
    icon: mdi:account-voice

input_text:
  active_media_player_tts:

input_select:
#######################################################################################################################
## TTS Media Players  #NEW_MEDIA_PLAYER
#######################################################################################################################
  tts_media_player:
    name: TTS Announcement Media Player
    icon: mdi:speaker-wireless
    options: &announcement_players
      - None # selecting "None" will mute audio announcements
      - Broadcast Speakers
      - Quiet Speakers
      - Night Speakers
      - Living Room Speaker
      - Dining Room Display
      - Bedroom Display
      - Bathroom Speaker
      - Laundry Room Speaker
      - Garage Speaker

  tts_media_player_quiet:
    name: TTS Announcement Media Player Quiet
    icon: mdi:speaker-wireless
    options: *announcement_players

  tts_media_player_night:
    name: TTS Announcement Media Player Night
    icon: mdi:speaker-wireless
    options: *announcement_players

  tts_media_player_alert:
    name: TTS Alert Media Player
    icon: mdi:speaker-wireless
    options: *announcement_players

  tts_cloud_voice:
    name: Nabu Casa Cloud Voice
    icon: mdi:account-voice
    options:
      - English (Australia) en-AU Female
      - English (Australia) en-AU Male
      - English (Canada) en-CA Female
      - English (India) en-IN Female
      - English (Ireland) en-IE Female
      - English (United Kingdom) en-GB Female
      - English (United Kingdom) en-GB Male
      - English (United States) en-US Male
      - English (United States) en-US Female

#######################################################################################################################
## TTS Service
#######################################################################################################################
  tts_service:
    name: TTS Service
    icon: mdi:account-voice
    options:
      - Nabu Casa
      - Google Translate
      - Google Cloud
      - Amazon Polly
      - Broadcast

input_number:
#######################################################################################################################
## Announcement Volumes
#######################################################################################################################
  tts_volume:
    name: Normal Volume
    icon: mdi:volume-high
    min: 0
    max: 100
    step: 5
    unit_of_measurement: '%'

  tts_volume_quiet:
    name: Quiet Volume
    icon: mdi:volume-medium
    min: 0
    max: 100
    step: 5
    unit_of_measurement: '%'

  tts_volume_night:
    name: Night Volume
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5
    unit_of_measurement: '%'

  tts_volume_alert:
    name: Alert Volume
    icon: mdi:volume-low
    min: 0
    max: 100
    step: 5
    unit_of_measurement: '%'

#######################################################################################################################
## TTS Speaker Volumes (float) - media player reset volume #NEW_MEDIA_PLAYER
#######################################################################################################################
  tts_living_room_speaker:
    min: 0
    max: 100
  tts_dining_room_display:
    min: 0
    max: 100
  tts_bedroom_display:
    min: 0
    max: 100
  tts_bathroom_speaker:
    min: 0
    max: 100
  tts_laundry_room_speaker:
    min: 0
    max: 100
  tts_garage_speaker:
    min: 0
    max: 100
  tts_living_room_tv:
    min: 0
    max: 100
  tts_bedroom_tv:
    min: 0
    max: 100
  tts_deck_tv:
    min: 0
    max: 100

binary_sensor:
#######################################################################################################################
## Template Binary Sensors
#######################################################################################################################
  - platform: template
    sensors:
#######################################################################################################################
## Announcement Playing
## - used for lovelace glance cards
## - used for announcement triggers, conditions
## - delay off to allow next message in queue to start
#######################################################################################################################
      tts_playing:
        friendly_name: Announcement Playing
        unique_id: tts_playing
        icon_template: mdi:account-voice
        delay_off:
          seconds: 5
        value_template: "{{ is_state('input_boolean.tts_playing','on') or is_state('script.tts_play','on') }}"

sensor:
  - platform: template
    sensors:
#######################################################################################################################
## Announcement Media Player (selected announcement media player entity id)
#######################################################################################################################
      tts_media_player:
        friendly_name: Announcement Media Player
        unique_id: tts_media_player
        icon_template: mdi:animation-play
        value_template: >
            {% set entities = state_attr('group.tts_media_players','entity_id') %}
            {% if is_state('input_select.occupancy_mode','Night') %}{% set mp = states('input_select.tts_media_player_night') %}
            {% elif is_state('binary_sensor.quiet_hours','on') %}{% set mp = states('input_select.tts_media_player_quiet') %}
            {% else %}{% set mp = states('input_select.tts_media_player') %}
            {% endif %}
            {{ expand('group.media_players')|selectattr('name','eq',mp)|map(attribute='entity_id')|join(',') }}

group:
#######################################################################################################################
## Announcement Media Players #NEW_MEDIA_PLAYER
## must match input_select.tts_media_player definition
#######################################################################################################################
  tts_media_players:
    icon: mdi:account-voice
    all: true
    entities:
      - media_player.broadcast_speakers
      - media_player.quiet_speakers
      - media_player.night_speakers
      - media_player.living_room_speaker
      - media_player.dining_room_display
      - media_player.bedroom_display
      - media_player.laundry_room_speaker
      - media_player.bathroom_speaker
      - media_player.garage_speaker