###############################################################################
## Package - Network
###############################################################################
homeassistant:
  customize:
    alert.unknown_network_device:
      icon: mdi:devices
      category: network
    alert.bluetooth_disabled:
      friendly_name: 'Bluetooth Off'
      icon: mdi:bluetooth-off
      category: network

    binary_sensor.wan_connected:
      device_class: connectivity
      icon: mdi:wan
    sensor.myip:
      friendly_name: 'WAN IPV4'
      icon: mdi:wan

utility_meter:
  wan_upload:
    source: sensor.asuswrt_upload
    cycle: hourly
  wan_download:
    source: sensor.asuswrt_download
    cycle: hourly

  router_received:
    source: sensor.jnet_router_b_sent
    cycle: hourly
  router_sent:
    source: sensor.jnet_router_b_received
    cycle: hourly

input_boolean:
  network_automation:
    name: 'Network Automation'
    icon: mdi:sync-alert
  network_alerts:
    name: 'Network Alerts'
    icon: mdi:alert

binary_sensor:
  - platform: ping # https://www.home-assistant.io/components/binary_sensor.ping/
    name: 'WAN Connected'
    host: 1.1.1.1
    count: 5
    scan_interval: 60

sensor:
  - platform: dnsip

alert:
  unknown_network_device:
    name: 'Unknown Device'
    title: 'Unknown Device'
    message: >
      {%- if state_attr('sensor.unknown_network_devices','entities')|lower not in ['unknown','unavailable','none'] %}
        {%- if states('sensor.unknown_network_devices')|int(0) == 0 %} No unknown devices.
        {%- else %}
          {%- for device in state_attr('sensor.unknown_network_devices','entities') %}
            {%- if not loop.first %}<br>{% endif %}- {{ device }}
          {%- endfor %}
        {%- endif %}
      {%- endif %}
    done_message: clear_notification
    entity_id: binary_sensor.unknown_network_device_alert
    state: 'on'
    repeat: 60
    notifiers: jason
    data:
      subject: 'There are unknown network devices.'
      tag: unknown_network_device
      group: System
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      timeout: 3600
      notification_icon: mdi:server
      icon_url: !secret HASSIO_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-system/network
      actions:
        - title: 'Router'
          action: URI
          uri: app://com.asus.aihome

        - title: 'Pause Alert'
          action: pause_unknown_network_device

  bluetooth_disabled:
    name: 'Bluetooth Disconnected'
    title: 'Bluetooth Disconnected Alert'
    message: 'Home Assistant Bluetooth is disconnected.'
    entity_id: binary_sensor.bluetooth_alert
    state: 'on'
    repeat: 3600
    notifiers: jason
    data:
      tag: bluetooth_disabled
      group: System
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:bluetooth
      icon_url: !secret BLUETOOTH_ICON
      ledColor: !secret SEVERE_COLOR
      color: !secret SEVERE_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/system
      actions:
        - title: 'Reboot'
          action: reboot_server

        - title: 'Pause Alert'
          action: pause_bluetooth_disabled
