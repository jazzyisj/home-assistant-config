###############################################################################
## Package - Low Battery Alert
###############################################################################
homeassistant:
  customize:
    alert.low_battery:
      icon: mdi:battery-alert
      category: system

input_number:
  battery_alert_threshold:
    name: 'Battery Alert Threshold'
    icon: mdi:battery-alert
    min: 0
    max: 100
    step: 1
    unit_of_measurement: '%'

alert:
  low_battery:
    name: 'Low Battery'
    title: 'Low Battery'
    message: |
      {%- set entities = expand(state_attr('binary_sensor.low_battery_alert','entities')) -%}
      {%- for item in entities -%}
      {{- item.name|lower|replace(': battery level','')|title }} - {{ item.state }}%
      {%- if not loop.last %}<br/>{% endif -%}
      {%- endfor -%}
    done_message: clear_notification
    entity_id: binary_sensor.low_battery_alert
    state: 'on'
    repeat: 1440
    notifiers: jason
    data:
      tag: low_battery
      group: System
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:battery-alert
      icon_url: !secret BATTERY_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/system
      actions:
        - title: 'Pause Alert'
          action: pause_low_battery
