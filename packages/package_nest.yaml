#######################################################################################################################
## Nest Package
#######################################################################################################################
homeassistant:
  customize:
    climate.upstairs_thermostat:
      friendly_name: Thermostat

    binary_sensor.upstairs_thermostat_fan:
      friendly_name: HVAC Fan
      icon: mdi:fan
    binary_sensor.upstairs_thermostat_leaf:
      friendly_name: Leaf
      icon: mdi:leaf
    binary_sensor.upstairs_thermostat_locked:
      friendly_name: Locked
      icon: mdi:lock
    binary_sensor.home_away:
      friendly_name: Away Mode
      icon: mdi:home-circle-outline
    binary_sensor.upstairs_thermostat_emergency_heat:
      friendly_name: Emergency Heat
      device_class: problem
    sensor.upstairs_thermostat_temperature:
      friendly_name: Temperature
    sensor.upstairs_thermostat_target:
      friendly_name: Target
    sensor.upstairs_thermostat_operation_mode:
      friendly_name: Mode
      icon: mdi:air-conditioner
    sensor.upstairs_thermostat_hvac_state:
      friendly_name: HVAC State
      icon: mdi:menu-open

    sensor.downstairs_nest_protect_battery_health:
      friendly_name: Downstairs Nest Battery
      icon: mdi:battery
    sensor.downstairs_nest_protect_color_status:
      friendly_name: Downstairs Nest Protect Status
      icon: mdi:circle
    sensor.downstairs_nest_protect_co_status:
      friendly_name: Downstairs CO Status
      icon: mdi:close-octagon
    sensor.downstairs_nest_protect_smoke_status:
      friendly_name: Downstairs Smoke Status
      icon: mdi:smoke-detector
    sensor.upstairs_nest_protect_battery_health:
      friendly_name: Upstairs Nest Battery
      icon: mdi:battery
    sensor.upstairs_nest_protect_color_status:
      friendly_name: Upstairs Nest Protect Status
      icon: mdi:circle
    sensor.upstairs_nest_protect_co_status:
      friendly_name: Upstairs CO Status
      icon: mdi:close-octagon
    sensor.upstairs_nest_protect_smoke_status:
      friendly_name: Upstairs Smoke Status
      icon: mdi:smoke-detector

    alert.sensor_co_detected:
      friendly_name: CO
      icon: mdi:skull-crossbones
      category: sensor
    alert.sensor_smoke_detected:
      friendly_name: Smoke
      icon: mdi:fire
      category: sensor

nest:
  client_id: NEST_CLIENT_ID
  client_secret: NEST_CLIENT_SECRET

binary_sensor:
  - platform: template
    sensors:
#######################################################################################################################
## Protect Offline
#######################################################################################################################
      protect_offline_alert:
        friendly_name: Protect Offline
        unique_id: protect_offline_alert
        icon_template: mdi:smoke-detector
        value_template: "{{ not is_state('binary_sensor.downstairs_nest_protect_online','on') or not is_state('binary_sensor.upstairs_nest_protect_online','on') }}"

#######################################################################################################################
## Smoke Detected
# nest protect states: Ok, Warning, Emergency
#######################################################################################################################
      smoke_detected_alert:
        unique_id: smoke_detected_alert
        value_template: "{{ is_state('sensor.upstairs_nest_protect_smoke_status','Emergency') or is_state('sensor.downstairs_nest_protect_smoke_status','Emergency') }}"

#######################################################################################################################
## CO Alert
# nest protect states: Ok, Warning, Emergency
#######################################################################################################################
      co_detected_alert:
        unique_id: co_detected_alert
        value_template: "{{ is_state('sensor.upstairs_nest_protect_co_status','Emergency') or is_state('sensor.downstairs_nest_protect_co_status','Emergency') }}"

alert:
#######################################################################################################################
## Alert - Smoke Detected
## - no option to turn off alert
#######################################################################################################################
  sensor_smoke_detected:
    name: "Smoke Detected"
    title: "Smoke Detected Alert"
    message: "EMERGENCY: Smoke detected! Leave the house now"
    done_message: "The Smoke Alert has ended."
    entity_id: binary_sensor.smoke_detected_alert
    state: 'on'
    repeat:
      - 1
      - 2
      - 3
      - 4
      - 5
      - 6
      - 7
      - 8
      - 9
      - 10
    can_acknowledge: false
    skip_first: false
    notifiers: everyone
    data:
      tag: smoke_detected
      group: alarm_stream
      channel: Alarm
      importance: max
      vibrationPattern: '200, 100, 200, 100, 200, 100, 400'
      ledColor: !secret CRITICAL_COLOR
      priority: high
      ttl: 0
      timeout: 1440
      persistent: true
      sticky: false
      clickAction: /lovelace/sensor
      color: !secret CRITICAL_COLOR
      icon_url: !secret SMOKE_ICON
      image: !secret SMOKE_IMAGE

      # additional parameters for html5 push
      timestamp: "{{ as_timestamp(now()) }}"
      renotify: true
      silent: true
      requireInteraction: true
      url: /lovelace/sensor
      icon: !secret SMOKE_ICON
      badge: !secret SMOKE_BADGE

#######################################################################################################################
## Alert - Carbon Monoxide Detected
## - no option to turn off alert
#######################################################################################################################
  sensor_co_detected:
    name: "Carbon Monoxide Detected"
    title: "Carbon Monoxide Detected Alert"
    message: "EMERGENCY: Carbon monoxide detected! Leave the house now"
    done_message: "The Carbon Monoxide Alert has ended."
    entity_id: binary_sensor.co_detected_alert
    state: 'on'
    repeat:
      - 1
      - 2
      - 3
      - 4
      - 5
      - 6
      - 7
      - 8
      - 9
      - 10
    can_acknowledge: false
    skip_first: false
    notifiers: everyone
    data:
      tag: co_detected
      group: Alarm
      channel: alarm_stream
      importance: max
      vibrationPattern: '200, 100, 200, 100, 200, 100, 400'
      ledColor: !secret CRITICAL_COLOR
      priority: high
      ttl: 0
      timeout: 1440
      persistent: true
      sticky: false
      clickAction: /lovelace/sensor
      color: !secret CRITICAL_COLOR
      icon_url: !secret CO_ICON
      image: !secret CO_IMAGE

      # additional parameters for html5 push
      timestamp: "{{ as_timestamp(now()) }}"
      renotify: true
      silent: true
      requireInteraction: true
      url: /lovelace/sensor
      icon: !secret CO_ICON
      badge: !secret CO_BADGE
