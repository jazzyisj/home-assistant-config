###############################################################################
## Radio Package
###############################################################################
homeassistant:
  customize:
    alert.radio_failed:
      icon: mdi:radio
      category: media

    light.radio_volume:
      type: volume

    media_player.radio:
      device_class: receiver
      type: master
      alarm_clock_media: true

input_boolean:
  radio:
    initial: false
  radio_failed:
    initial: false
  resume_radio:

input_text:
  active_radio_media_player:
  radio_media_player:
  radio_playlist:

input_number:
  radio_volume:
    name: 'Radio Volume'
    icon: mdi:volume-high
    unit_of_measurement: '%'
    min: 0
    max: 100
    step: 5

  radio_volume_adjustment:
    name: 'Radio Volume Adjustment'
    icon: mdi:volume-high
    min: -1
    max: 1
    step: 0.1

group:
  stored_radio_playlists:
    entities:
      - input_text.radio_playlist
      - input_text.media_preset_radio_wake
      - input_text.media_preset_radio_morning
      - input_text.media_preset_radio_sleep
      - input_text.media_preset_radio_jason
      - input_text.media_preset_radio_sheri
      - input_text.media_preset_radio_guest
      - input_text.media_preset_radio_shower
      - input_text.media_preset_radio_chill
      - input_text.media_preset_radio_company
      - input_text.alarm_clock_radio_auto
      - input_text.alarm_clock_radio_manual
      - input_text.alarm_clock_radio_nap

media_player: #RADIO until streaming radio player
  - platform: universal
    name: 'Radio'
    state_template: >
      {{ states(states('sensor.radio_media_player'))
        if is_state('binary_sensor.radio','on') else 'off' }}
    commands:
      turn_on:
        service: script.media_play
        data:
          media_type: radio
      turn_off:
        service: script.media_stop
        data:
          media_type: radio
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
        data:
          is_volume_muted: "{{ not state_attr(states('sensor.radio_media_player'),'is_volume_muted') }}"
      media_play:
        service: script.media_play
        data:
          media_type: radio
      play_media:
        service: media_player.play_media
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
      media_pause:
        service: media_player.media_pause
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
      clear_playlist:
        service: media_player.clear_playlist
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
      select_source:
        service: media_player.select_source
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
      join:
        service: media_player.join
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
      unjoin:
        service: media_player.unjoin
        target:
          entity_id: "{{ states('sensor.radio_media_player') }}"
    attributes:
      state: "{{ states('binary_sensor.radio') }}"
      #RADIO these don't work - wait for media_player.streaming_radio
      is_volume_muted: "{{ states('sensor.radio_media_player') }}|is_volume_muted"
      volume_level: "{{ states('sensor.radio_media_player') }}|volume_level"
      source: "{{ states('sensor.radio_media_player') }}|source"
      source_list: "{{ states('sensor.radio_media_player') }}|source_list"
      media_content_id: "{{ states('sensor.radio_media_player') }}|media_content_id"
      media_duration: "{{ states('sensor.radio_media_player') }}|media_duration"
      media_position: "{{ states('sensor.radio_media_player') }}|media_position"
      media_position_updated_at: "{{ states('sensor.radio_media_player') }}|media_position_updated_at"
      media_title: "{{ states('sensor.radio_media_player') }}|media_title"
      media_artist: "{{ states('sensor.radio_media_player') }}|media_artist"
      media_album_name: "{{ states('sensor.radio_media_player') }}|media_album_name"
      media_track: "{{ states('sensor.radio_media_player') }}|media_track"
      media_playlist: "{{ states('sensor.radio_media_player') }}|media_playlist"
      app_id: "{{ states('sensor.radio_media_player') }}|app_id"
      app_name: "{{ states('sensor.radio_media_player') }}app_name"
      repeat: "{{ states('sensor.radio_media_player') }}|repeat"
      entity_picture_local: "{{ states('sensor.radio_media_player') }}|entity_picture_local"
      friendly_name: "{{ states('sensor.radio_media_player') }}|friendly_name"
      icon: "{{ states('sensor.radio_media_player') }}|icon"
      entity_picture: "{{ states('sensor.radio_media_player') }}|entity_picture"
      supported_features: "{{ states('sensor.radio_media_player') }}|supported_features"

light: # volume control for media launcher
  - platform: template
    lights:
      radio_volume:
        friendly_name: 'Radio Volume'
        value_template: 'on'
        icon_template: >
          {{ 'mdi:volume-off' if is_state('binary_sensor.radio', 'off')
              or state_attr('media_player.radio', 'is_volume_muted') else 'mdi:volume-high' }}
        turn_on:
          service: "{{ 'media_player.volume_mute' if is_state('binary_sensor.radio','on') else 'script.null_script' }}"
          target:
            entity_id: media_player.radio
          data:
            is_volume_muted: false
        turn_off:
          service: "{{ 'media_player.volume_mute' if is_state('binary_sensor.radio','on') else 'script.null_script' }}"
          target:
            entity_id: media_player.radio
          data:
            is_volume_muted: true
        set_level:
          service: input_number.set_value
          target:
            entity_id: input_number.radio_volume
          data:
            value: '{{ (brightness/255 * 100)|int(0) }}'
        level_template: "{{ (states('input_number.radio_volume')|float/100 * 255)|int(0) }}"

alert:
  radio_failed:
    name: 'Radio Failed'
    title: 'Radio Failed'
    message: 'Radio play has failed.'
    done_message: clear_notification
    entity_id: input_boolean.radio_failed
    state: 'on'
    repeat:
      - 2
      - 720
    skip_first: true
    notifiers: jason
    data:
      tag: radio_failed
      group: System
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:radio
      icon_url: !secret RADIO_ALERT_IMAGE
      ledColor: !secret MINOR_COLOR
      color: !secret MINOR_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/media
      actions:
        - title: 'Reset Radio'
          action: radio_failed_reset

        - title: 'Restart Radio'
          action: radio_restart
