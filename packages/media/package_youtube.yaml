###############################################################################
## Youtube Music Package  https://github.com/KoljaWindeler/ytube_music_player
###############################################################################
homeassistant:
  customize:
    alert.youtube_connected:
      icon: mdi:youtube
      category: media
    light.youtube_volume:
      type: volume
    media_player.youtube:
      device_class: receiver
      type: master
    media_player.ytube_music_player:
      device_class: receiver
    switch.youtube_shuffle:
      assumed_state: false

input_boolean:
  resume_youtube:
  youtube_failed:
    initial: false

input_text:
  youtube_media_player:
  active_youtube_media_player:
  youtube_playlist:
  media_preset_youtube_jason:
  media_preset_youtube_sheri:
  media_preset_youtube_guest:
  media_preset_youtube_wake:
  media_preset_youtube_morning:
  media_preset_youtube_sleep:
  media_preset_youtube_shower:
  media_preset_youtube_chill:
  media_preset_youtube_company:
  alarm_clock_youtube_auto:
  alarm_clock_youtube_manual:
  alarm_clock_youtube_nap:

input_select:
  youtube_media_player:
    name: 'Youtube Player'
    icon: mdi:speaker-wireless
    options: ['none']
  youtube_playlist:
    name: 'Youtube Playlist'
    icon: mdi:format-list-bulleted
    options: ['none']
  youtube_player_source:
    name: 'Source'
    icon: mdi:music-box-multiple
    options:
      - Playlist Radio
      - Playlist
  ytube_music_player_playmode:
    name: 'Shuffle Mode'
    icon: mdi:playlist-music
    options:
      - Shuffle
      - Random
      - Shuffle Random
      - Direct

  ###############################################################################
  ## Youtube Media Presets
  ###############################################################################
  media_preset_youtube_wake:
    name: 'Wake Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none
  media_preset_youtube_morning:
    name: 'Morning Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none
  media_preset_youtube_sleep:
    name: 'Sleep Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none
  media_preset_youtube_jason:
    name: 'Jason Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none
  media_preset_youtube_sheri:
    name: 'Sheri Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none
  media_preset_youtube_guest:
    name: 'Guest Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none
  media_preset_youtube_shower:
    name: 'Shower Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none
  media_preset_youtube_chill:
    name: 'Chill Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none
  media_preset_youtube_company:
    name: 'Company Youtube Playlist'
    icon: mdi:format-list-bulleted
    options:
      - none

input_number:
  youtube_volume:
    name: 'Youtube Volume'
    icon: mdi:volume-high
    unit_of_measurement: '%'
    min: 0
    max: 100
    step: 5

  youtube_volume_adjustment:
    name: 'Youtube Volume Adjustment'
    icon: mdi:volume-high
    min: -1
    max: 1
    step: 0.1

media_player:
  - platform: universal
    name: 'Youtube'
    children:
      - media_player.ytube_music_player
    commands:
      turn_on:
        service: script.media_play
        data:
          media_type: youtube
      turn_off:
        service: script.media_stop
        data:
          media_type: youtube

switch:
  - platform: template
    switches:
      youtube_shuffle:
        friendly_name: 'Youtube Shuffle'
        icon_template: mdi:shuffle
        turn_on:
          - service: media_player.shuffle_set
            target:
              entity_id: media_player.ytube_music_player
            data:
              shuffle: true
        turn_off:
          - service: media_player.shuffle_set
            target:
              entity_id: media_player.ytube_music_player
            data:
              shuffle: false

light: # volume control for media launcher
  - platform: template
    lights:
      youtube_volume:
        friendly_name: 'Youtube Volume'
        value_template: 'on'
        icon_template: >
          {{ 'mdi:volume-off' if is_state('binary_sensor.youtube', 'off')
              or state_attr('media_player.youtube', 'is_volume_muted') else 'mdi:volume-high' }}
        turn_on:
          service: "{{ 'media_player.volume_mute' if is_state('binary_sensor.youtube','on') else 'script.null_script' }}"
          target:
            entity_id: media_player.youtube
          data:
            is_volume_muted: false
        turn_off:
          service: "{{ 'media_player.volume_mute' if is_state('binary_sensor.youtube','on') else 'script.null_script' }}"
          target:
            entity_id: media_player.youtube
          data:
            is_volume_muted: true
        set_level:
          service: input_number.set_value
          target:
            entity_id: input_number.youtube_volume
          data:
            value: '{{ (brightness/255 * 100)|int(0) }}'
        level_template: "{{ (states('input_number.youtube_volume')|float/100 * 255)|int(0) }}"

group:
  youtube_selected_playlists: # must be in same order as stored
    entities: # ytube maintains main playlist
      - input_select.media_preset_youtube_jason
      - input_select.media_preset_youtube_sheri
      - input_select.media_preset_youtube_guest
      - input_select.media_preset_youtube_wake
      - input_select.media_preset_youtube_morning
      - input_select.media_preset_youtube_sleep
      - input_select.media_preset_youtube_shower
      - input_select.media_preset_youtube_chill
      - input_select.media_preset_youtube_company
      - input_select.alarm_clock_youtube_auto
      - input_select.alarm_clock_youtube_manual
      - input_select.alarm_clock_youtube_nap

  youtube_stored_playlists: # must be in same order as selected
    entities: # ytube maintains main playlist
      - input_text.media_preset_youtube_jason
      - input_text.media_preset_youtube_sheri
      - input_text.media_preset_youtube_guest
      - input_text.media_preset_youtube_wake
      - input_text.media_preset_youtube_morning
      - input_text.media_preset_youtube_sleep
      - input_text.media_preset_youtube_shower
      - input_text.media_preset_youtube_chill
      - input_text.media_preset_youtube_company
      - input_text.alarm_clock_youtube_auto
      - input_text.alarm_clock_youtube_manual
      - input_text.alarm_clock_youtube_nap

alert:
  youtube_failed:
    name: 'Youtube Failed'
    title: 'Youtube Failed'
    message: "Youtube play has failed on {{ state_attr('sensor.youtube_media_player','name') }}"
    done_message: clear_notification
    entity_id: input_boolean.youtube_failed
    state: 'on'
    repeat:
      - 2
      - 720
    skip_first: true
    notifiers: jason
    data:
      tag: youtube_failed
      group: System
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      notification_icon: mdi:youtube
      icon_url: !secret YOUTUBE_ICON
      ledColor: !secret MINOR_COLOR
      color: !secret MINOR_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /lovelace-mobile/media
      actions:
        - title: 'Reset Youtube'
          action: youtube_failed_reset

        - title: 'Restart Youtube'
          action: youtube_restart

  youtube_connected:
    name: 'Youtube Connected'
    entity_id: binary_sensor.youtube_connected_alert
    state: 'on'
    notifiers: log
    skip_first: false
    repeat: 999999
    data:
      tag: youtube_connected
