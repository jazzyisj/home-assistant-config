###############################################################################
## Package - Camera
###############################################################################
homeassistant:
  customize:
    alert.frigate_connected:
      icon: mdi:cctv
      category: camera
    alert.lorex_nvr_connected:
      icon: mdi:cctv
      category: camera
    alert.camera_offline:
      icon: mdi:cctv
      category: camera

    sensor.clips:
      friendly_name: "Frigate Clips Disk Use"

    camera.side_drive:
      type: nvr
    camera.side_door:
      type: nvr
    camera.front_door:
      type: nvr
    camera.front_yard:
      type: nvr
    camera.side_gate_front:
      type: nvr
    camera.side_gate_back:
      type: nvr
    camera.back_yard:
      type: nvr
    camera.back_door:
      type: nvr
    camera.patio_door:
      type: nvr
    camera.back_house:
      type: nvr
    camera.garage_inside:
      type: nvr

input_boolean:
  camera_notifications:
    name: "Camera Notifications"

group:
  cameara_detection_controls:
    entities:
      # - switch.front_door_frigate_snapshots # always enabled
      - switch.side_door_frigate_snapshots #TEMP until rest of cams - always enabled
      # - switch.front_door_frigate_detect # always enabled
      - switch.side_door_frigate_detect #TEMP until rest of cams - always enabled

sensor: #CHECK
  - platform: folder
    folder: /media/frigate/clips # path must be in allowlist_external_dirs
    filter: "*"

alert:
  camera_offline:
    name: "Camera Offline"
    title: "Camera Offline"
    message: |
      {{ states.camera
          |selectattr('attributes.type','defined')
          |selectattr('attributes.type','eq','nvr')
          |selectattr('state','ne','idle')
          |map(attribute='name')|join('\n') }}
    done_message: clear_notification
    entity_id: binary_sensor.camera_offline_alert
    state: "on"
    repeat: 60
    notifiers: jason
    data:
      tag: camera_offline
      group: Alarm
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      visibility: public
      notification_icon: mdi:cctv
      icon_url: !secret ALARM_ICON
      ledColor: !secret WARNING_COLOR
      color: !secret WARNING_COLOR
      vibrationPattern: !secret ALERT_VIBRATION
      clickAction: /ui/alarm
      actions:
        - title: "Alarm"
          action: URI
          uri: !secret ALARM_URI

        - title: "Cameras"
          action: URI
          uri: !secret LOREX_URI

        - title: "Alerts Off"
          action: turn_off_camera_alerts

  lorex_nvr_connected:
    name: "Lorex NVR Connected"
    entity_id: binary_sensor.lorex_nvr_connected_alert
    state: "on"
    notifiers: log
    skip_first: false
    repeat: 999999
    data:
      tag: lorex_nvr_connected

  frigate_connected:
    name: "Frigate Connected"
    entity_id: binary_sensor.frigate_connected_alert
    state: "on"
    notifiers: log
    skip_first: false
    repeat: 999999
    data:
      tag: frigate_connected
