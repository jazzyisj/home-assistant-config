#######################################################################################################################
## Camera Package
#######################################################################################################################
homeassistant:
  customize:
    binary_sensor.tamper_detection:
      friendly_name: Tamper Detection 1
    binary_sensor.tamper_detection_2:
      friendly_name: Tamper Detection 2

    binary_sensor.00000_cell_motion_detection:
      friendly_name: Side Drive Motion
    binary_sensor.00000_motion_alarm:
      friendly_name: Side Drive Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00100_cell_motion_detection:
      friendly_name: Side Door Motion
    binary_sensor.00100_motion_alarm:
      friendly_name: Side Door Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00200_cell_motion_detection:
      friendly_name: Front Drive Motion
    binary_sensor.00200_motion_alarm:
      friendly_name: Front Drive Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00300_cell_motion_detection:
      friendly_name: Front Door Motion
    binary_sensor.00300_motion_alarm:
      friendly_name: Front Door Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00400_cell_motion_detection:
      friendly_name: Front Yard Motion
    binary_sensor.00400_motion_alarm:
      friendly_name: Front Yard Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00500_cell_motion_detection:
      friendly_name: Side Gate Front Motion
    binary_sensor.00500_motion_alarm:
      friendly_name: Side Gate Front Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00600_cell_motion_detection:
      friendly_name: Side Gate Rear Motion
    binary_sensor.00600_motion_alarm:
      friendly_name: Side Gate Rear Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00700_cell_motion_detection:
      friendly_name: Back Yard Motion
    binary_sensor.00700_motion_alarm:
      friendly_name: Back Yard Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00800_cell_motion_detection:
      friendly_name: Back Door Motion
    binary_sensor.00800_motion_alarm:
      friendly_name: Back Door Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.00900_cell_motion_detection:
      friendly_name: Patio Door Motion
    binary_sensor.00900_motion_alarm:
      friendly_name: Patio Door Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.01000_cell_motion_detection:
      friendly_name: Back House Motion
    binary_sensor.01000_motion_alarm:
      friendly_name: Back House Motion Alarm
      icon: mdi:motion-sensor
    binary_sensor.01100_cell_motion_detection:
      friendly_name: Garage Inside Motion
    binary_sensor.01100_motion_alarm:
      friendly_name: Garage Inside Motion Alarm
      icon: mdi:motion-sensor

camera:
  - platform: ffmpeg #TEST
    name: "CAMERA TEST FFMPEG"
    input: http://admin:vector@192.168.1.150/cgi-bin/snapshot.cgi?channel=04
    #OPTION rtsp://admin:vector@192.168.1.150:554/cam/realmonitor?channel=04&subtype=1
    #extra_arguments: -q:v 2-32

#ISSUE - stream
# 2021-09-13 03:38:10 INFO (MainThread) [homeassistant.components.stream] Started stream: http://****:****@192.168.1.150/cgi-bin/snapshot.cgi?channel=04
# 2021-09-13 03:38:12 ERROR (stream_worker) [homeassistant.components.stream.worker] Error demuxing stream while finding first packet:
# 2021-09-13 03:38:12 INFO (MainThread) [homeassistant.components.stream] Stopped stream: http://****:****@192.168.1.150/cgi-bin/snapshot.cgi?channel=04

  - platform: generic #TEST
    name: "CAMERA TEST GENERIC"
    still_image_url: http://192.168.1.150/cgi-bin/snapshot.cgi?channel=04
    stream_source: rtsp://192.168.1.150:554/cam/realmonitor?channel=04&subtype=1
    username: admin
    password: vector
    authentication: digest
    content_type: image/jpeg
    verify_ssl: false
    rtsp_transport: http # tcp, udp, udp_multicast, http

#ISSUE - stream
# 2021-09-13 03:36:47 INFO (MainThread) [homeassistant.components.stream] Started stream: rtsp://192.168.1.150:554/cam/realmonitor?channel=04&subtype=1
# 2021-09-13 03:36:47 ERROR (stream_worker) [libav.rtsp] method OPTIONS failed: 401 Unauthorized
# 2021-09-13 03:36:47 ERROR (stream_worker) [homeassistant.components.stream.worker] Error opening stream rtsp://192.168.1.150:554/cam/realmonitor?channel=04&subtype=1
# 2021-09-13 03:36:47 INFO (MainThread) [homeassistant.components.stream] Stopped stream: rtsp://192.168.1.150:554/cam/realmonitor?channel=04&subtype=1
# 2021-09-13 03:37:08 ERROR (MainThread) [aiohttp.server] Error handling request
# Traceback (most recent call last):
#   File "/usr/local/lib/python3.9/site-packages/aiohttp/web_protocol.py", line 422, in _handle_request
#     resp = await self._request_handler(request)
#   File "/usr/local/lib/python3.9/site-packages/aiohttp/web_app.py", line 499, in _handle
#     resp = await handler(request)
#   File "/usr/local/lib/python3.9/site-packages/aiohttp/web_middlewares.py", line 119, in impl
#     return await handler(request)
#   File "/usr/src/homeassistant/homeassistant/components/http/security_filter.py", line 60, in security_filter_middleware
#     return await handler(request)
#   File "/usr/src/homeassistant/homeassistant/components/http/forwarded.py", line 89, in forwarded_middleware
#     return await handler(request)
#   File "/usr/src/homeassistant/homeassistant/components/http/request_context.py", line 24, in request_context_middleware
#     return await handler(request)
#   File "/usr/src/homeassistant/homeassistant/components/http/ban.py", line 78, in ban_middleware
#     return await handler(request)
#   File "/usr/src/homeassistant/homeassistant/components/http/auth.py", line 144, in auth_middleware
#     return await handler(request)
#   File "/usr/src/homeassistant/homeassistant/components/http/view.py", line 135, in handle
#     result = await result
#   File "/usr/src/homeassistant/homeassistant/components/camera/__init__.py", line 590, in get
#     return await self.handle(request, camera)
#   File "/usr/src/homeassistant/homeassistant/components/camera/__init__.py", line 608, in handle
#     image = await _async_get_image(
#   File "/usr/src/homeassistant/homeassistant/components/camera/__init__.py", line 164, in _async_get_image
#     image_bytes = await camera.async_camera_image(
#   File "/usr/src/homeassistant/homeassistant/components/onvif/camera.py", line 131, in async_camera_image
#     image = await self.device.device.get_snapshot(
#   File "/usr/local/lib/python3.9/site-packages/onvif/client.py", line 352, in get_snapshot
#     response = await self._snapshot_client.get(uri, auth=auth)
#   File "/usr/local/lib/python3.9/site-packages/httpx/_client.py", line 1740, in get
#     return await self.request(
#   File "/usr/local/lib/python3.9/site-packages/httpx/_client.py", line 1494, in request
#     response = await self.send(
#   File "/usr/local/lib/python3.9/site-packages/httpx/_client.py", line 1586, in send
#     response = await self._send_handling_auth(
#   File "/usr/local/lib/python3.9/site-packages/httpx/_client.py", line 1616, in _send_handling_auth
#     response = await self._send_handling_redirects(
#   File "/usr/local/lib/python3.9/site-packages/httpx/_client.py", line 1655, in _send_handling_redirects
#     response = await self._send_single_request(request, timeout)
#   File "/usr/local/lib/python3.9/site-packages/httpx/_client.py", line 1699, in _send_single_request
#     ) = await transport.handle_async_request(
#   File "/usr/local/lib/python3.9/site-packages/httpx/_transports/default.py", line 281, in handle_async_request
#     ) = await self._pool.handle_async_request(
#   File "/usr/local/lib/python3.9/site-packages/httpcore/_async/connection_pool.py", line 222, in handle_async_request
#     async with self._connection_acquiry_lock:
#   File "/usr/local/lib/python3.9/site-packages/httpcore/_backends/base.py", line 76, in __aenter__
#     await self.acquire()
#   File "/usr/local/lib/python3.9/site-packages/httpcore/_backends/anyio.py", line 104, in acquire
#     await self._lock.acquire()
#   File "/usr/local/lib/python3.9/site-packages/anyio/_core/_synchronization.py", line 119, in acquire
#     self.acquire_nowait()
#   File "/usr/local/lib/python3.9/site-packages/anyio/_core/_synchronization.py", line 146, in acquire_nowait
#     raise RuntimeError('Attempted to acquire an already held Lock')
# RuntimeError: Attempted to acquire an already held Lock