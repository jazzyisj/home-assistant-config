###############################################################################
## Package - ZWave
###############################################################################
homeassistant:
  customize_glob:
    'sensor.*_node_status':
      type: zwave_node_status

  customize:
    alert.zwave_network:
      icon: mdi:z-wave
      category: hass

    sensor.back_door_lock_node_status:
      node_id: 95
    sensor.back_house_potlights_node_status:
      node_id: 85
    sensor.back_yard_tree_lights_node_status:
      node_id: 42
    sensor.back_yard_garden_light_node_status:
      node_id: 34
    sensor.dining_room_light_node_status:
      node_id: 79
    sensor.dining_room_rgb_light_node_status:
      node_id: 7
    sensor.dining_room_potlights_node_status:
      node_id: 86
    sensor.front_door_lock_node_status:
      node_id: 96
    sensor.front_house_potlights_node_status:
      node_id: 38
    sensor.front_porch_light_node_status:
      node_id: 39
    sensor.garage_door_lock_node_status:
      node_id: 99
    sensor.garage_sensor_node_status:
      node_id: 97
    sensor.kitchen_sink_light_node_status:
      node_id: 26
    sensor.kitchen_potlights_node_status:
      node_id: 98
    sensor.living_room_cove_light_node_status:
      node_id: 35
    sensor.master_bedroom_light_node_status:
      node_id: 45
    sensor.office_fan_node_status:
      node_id: 32
    sensor.office_light_node_status:
      node_id: 16
    sensor.office_potlights_node_status:
      node_id: 15
    sensor.outside_garage_lights_node_status:
      node_id: 41
    sensor.side_door_lock_node_status:
      node_id: 80
    sensor.side_entrance_light_node_status:
      node_id: 84
    sensor.upstairs_bathroom_fan_node_status:
      node_id: 6
    sensor.upstairs_bathroom_sensor_node_status:
      node_id: 24
    sensor.upstairs_bathroom_shower_light_node_status:
      node_id: 14
    sensor.upstairs_bathroom_vanity_light_node_status:
      node_id: 78
    sensor.upstairs_bathroom_vanity_rgb_bulb_1_node_status:
      node_id: 53
    sensor.upstairs_bathroom_vanity_rgb_bulb_2_node_status:
      node_id: 54
    sensor.upstairs_bedroom_fan_node_status:
      node_id: 33
    sensor.upstairs_bedroom_light_node_status:
      node_id: 77
    sensor.upstairs_bedroom_potlights_node_status:
      node_id: 43
    sensor.upstairs_bedroom_light_rgb_bulb_1_node_status:
      node_id: 74
    sensor.upstairs_bedroom_light_rgb_bulb_2_node_status:
      node_id: 75
    sensor.upstairs_hallway_potlights_node_status:
      node_id: 94
    sensor.zwave_hub_node_status:
      node_id: 1

group:
  zwave_devices:
    entities:
      # locks
      - lock.back_door_lock
      - lock.front_door_lock
      - lock.garage_door_lock
      - lock.side_door_lock

      # sensors
      - sensor.garage_sensor_temperature # no 'device' sensor, use temp sensor for device detection
      - sensor.upstairs_bathroom_sensor_temperature

      # fans switches
      - fan.office_fan
      - fan.upstairs_bathroom_fan
      - fan.upstairs_bedroom_fan

      # light switches
      - switch.back_yard_garden_light
      - switch.kitchen_sink_light

      # light dimmers
      - light.back_house_potlights
      - light.back_yard_tree_lights
      - light.dining_room_light
      - light.dining_room_potlights
      - light.front_house_potlights
      - light.front_porch_light
      - light.kitchen_potlights
      - light.living_room_cove_light
      - light.master_bedroom_light
      - light.office_light
      - light.office_potlights
      - light.outside_garage_lights
      - light.side_entrance_light
      - light.upstairs_bathroom_shower_light
      - light.upstairs_bathroom_vanity_light
      - light.upstairs_bedroom_light
      - light.upstairs_bedroom_potlights
      - light.upstairs_hallway_potlights

      # bulbs
      - light.dining_room_rgb_light
      - light.upstairs_bathroom_vanity_rgb_bulb_1
      - light.upstairs_bathroom_vanity_rgb_bulb_2
      - light.upstairs_bedroom_light_rgb_bulb_1
      - light.upstairs_bedroom_light_rgb_bulb_2

alert:
  zwave_network:
    name: 'ZWave Network'
    title: 'ZWave Network Alert'
    message: |
      {%- if is_state('binary_sensor.zwave_network','off') %}
        The Z-Wave network is offline.
      {%- else %}
        {%- set sensors = states.sensor|selectattr('attributes.type','eq','zwave_node_status')|selectattr('state','ne','alive')|list %}
        {%- for item in sensors %}
            {%- if not loop.first -%}<br/>{%- endif %}
            {{- item.name|replace(': Node Status','')|title }}
        {%- endfor %}
      {%- endif %}
    done_message: clear_notification
    entity_id: binary_sensor.zwave_network_alert
    state: 'on'
    repeat: 1440
    notifiers: jason
    data:
      tag: zwave_device
      group: Alert
      channel: Alert
      importance: max
      ttl: 0
      priority: high
      color: !secret CRITICAL_COLOR
      icon_url: !secret ZWAVE_ICON
      actions:
        - title: 'Pause Alert'
          action: pause_zwave_network_alert
