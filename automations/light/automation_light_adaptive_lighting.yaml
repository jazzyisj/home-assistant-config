###############################################################################
## Light - Adaptive Lighting On
###############################################################################
- id: light_adaptive_lighting_on
  alias: '[Light] Adaptive Lighting On'
  description: 'Turn on adaptive lighting.'
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_triggered
      to: 'off'

    #BUGFIX turn adaptive lighting back on
    - platform: state
      id: occupancy
      entity_id: input_select.occupancy_mode
      to: Night
      for: 90
  condition:
    - condition: template
      alias: 'Occupancy override is off if occupancy trigger'
      value_template: >
        {{ is_state('input_boolean.occupancy_override','off')
            if trigger.id == 'occupancy' else true }}
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.adaptive_lighting

    - if:
        - condition: state
          entity_id: input_select.occupancy_mode
          state: Night
      then:
        - delay: 300

        - service: switch.turn_on
          target:
            entity_id: group.adaptive_lighting_sleep_switches

###############################################################################
## Light - Adaptive Lighting Off
###############################################################################
- id: light_adaptive_lighting_off
  alias: '[Light] Adaptive Lighting Off'
  description: 'Turn off adaptive lighting.'
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_triggered
      to: 'on'

    #BUGFIX stop lights from switching back on
    - platform: state
      id: occupancy
      entity_id: input_select.occupancy_mode
      to: Night
  action:
    - service: switch.turn_off
      target:
        entity_id: switch.adaptive_lighting
