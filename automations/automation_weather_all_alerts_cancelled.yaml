#######################################################################################################################
## Weather - All Weather Alerts Cancelled
#######################################################################################################################
- id: weather_all_weather_alerts_cancelled
  alias: "[Weather] All Weather Alerts Cancelled"
  description: "Play announcement when all weather alerts have been cancelled."
  initial_state: true
  mode: single
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: binary_sensor.weather_alert_active
      to: 'off'

  action:
    - service: variable.set_variable 
      data:
        variable: current_dark_sky_alert_severity
        value: cleared

    - service: variable.set_variable 
      data:
        variable: previous_dark_sky_alert_severity
        value: cleared

    - service: variable.set_variable 
      data:
        variable: current_noaa_alert_severity
        value: cleared

    - service: variable.set_variable 
      data:
        variable: previous_noaa_alert_severity
        value: cleared

    - service: input_boolean.turn_off
      entity_id: input_boolean.display_weather_alerts

    - service: script.close_notifications
      data:
        target: mobile_app_jphone
        tag: weather_alert

    - service: script.tts_announcement
      data:
        play_message: "All active weather alerts have been cancelled."