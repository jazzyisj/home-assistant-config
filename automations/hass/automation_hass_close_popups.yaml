###############################################################################
## Hass - Close Popups
#BUGFIX no other way to close popups
###############################################################################
- id: hass_close_popups
  alias: "[Hass] Close Popups"
  description: "Close all popups, more info dialogs."
  max_exceeded: silent
  trigger:
    - platform: state
      id: alarm
      entity_id: alarm_control_panel.master

    - platform: state
      id: occupancy
      entity_id: input_select.occupancy_mode
  condition:
    - condition: template
      alias: "Occupany override off if occupancy trigger"
      value_template: >
        {{ is_state('input_boolean.occupancy_override','off')
            if trigger.id == 'occupancy' else true }}
  action:
    - service: browser_mod.close_popup
      data:
        deviceID: !include /config/include/browsers.yaml

    - delay: 5 # prevent recursive calls
