###############################################################################
## Hass - Kiosk Reset Dashboard
###############################################################################
- id: hass_kiosk_reset_dashboard
  alias: '[Hass] Kiosk Reset Dashboard'
  description: 'Reset dashboard to home page.'
  mode: restart
  trigger:
    - platform: state
      id: page
      entity_id: sensor.fire_tablet_current_page
      to: ~
      for: 15

    - platform: state
      id: app
      entity_id: sensor.fire_tablet_foreground_app
      to: ~
      for: 15

    - platform: time
      id: time
      at: input_datetime.day_reset
  condition:
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.fire_tablet_current_page
          state: http://192.168.1.100:8123/lovelace-kiosk/home
  action:
    - wait_template: "{{ is_state('binary_sensor.kiosk_motion','off') }}"
      timeout: 300

    - choose:
        - conditions: "{{ trigger.id == 'page' }}"
          sequence:
            - choose:
                - conditions: "{{ states('sensor.fire_tablet_current_page')[:26] == 'http://192.168.1.100:8123/' }}"
                  sequence:
                    - service: browser_mod.navigate
                      data:
                        navigation_path: /lovelace-kiosk/home
                        deviceID: browser_kiosk_internal
              default:
                - service: button.press
                  target:
                    entity_id: button.fire_tablet_load_start_url

        - conditions: "{{ trigger.id in ['app','time'] }}"
          sequence:
            - service: button.press
              target:
                entity_id: button.fire_tablet_restart_browser
