#######################################################################################################################
## Weather - New GDACS Alert
#######################################################################################################################
- id: weather_new_gdacs_alert
  alias: "[Weather] New GDACS Alert"
  description: "Turn on display gdacs alert boolean."
  trigger:
    - platform: template
      value_template: "{{ is_state_attr('binary_sensor.gdacs_alert_active','last_alert_date',states('sensor.date')) }}"
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.display_gdacs_alerts

    - service: notify.mobile
      data:
        title: "GDACS Alert"
        message: |
          {{ state_attr('binary_sensor.gdacs_alert_active','last_alert_desc') }}
          Issued: {{ state_attr('binary_sensor.gdacs_alert_active','last_alert_date') }}
        data:
          subject:  "{{ state_attr('binary_sensor.gdacs_alert_active','last_alert') }}"
          tag: gdacs_alert
          group: General
          channel: Alert
          importance: max
          ttl: 0
          priority: high
          clickAction: /lovelace/weather
          color: !secret WARNING_COLOR
          icon_url: !secret ASTHMA_ICON #IMAGE
          actions:
            - action: turn_off_gdacs_display
              title: "Pause Alert"

#######################################################################################################################
## Weather - Pause GDACS Alert
#######################################################################################################################
- id: weather_turn_off_gdacs_display
  alias: "[Weather] Turn Off GDACS Display"
  description: "Pause alert."
  max_exceeded: silent
  trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: turn_off_gdacs_display

    - platform: state
      entity_id: input_boolean.display_gdacs_alerts
      to: 'off'
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.display_gdacs_alerts

    - service: notify.mobile
      data:
        message: clear_notification
        data:
          tag: gdacs_alert