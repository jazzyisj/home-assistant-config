#######################################################################################################################
## Spotify - Media Player Changed
## - sensor.spotify_media_player doesn't populate until spotify media player is actually playing
## - sensor.spotify_media_player clears during tts etc
#######################################################################################################################
- id: spotify_media_player_changed
  alias: "[Spotify] Media Player Changed"
  description: Store spotify media player entity id.
  initial_state: true
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.spotify_media_player
  condition:
    - condition: state  # will get cleared if player turned off for tts etc.
      entity_id: input_boolean.resume_spotify
      state: 'off'
    - "{{ states(trigger.entity_id) in expand(state_attr('sensor.media_players','players'))|map(attribute='entity_id')|list }}"
  action:
    - service: input_text.set_value
      data:
        entity_id: input_text.active_spotify_media_player
        value: "{{ states('sensor.spotify_media_player') }}"



