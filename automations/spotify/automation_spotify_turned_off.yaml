#######################################################################################################################
## Spotify - Turned Off
#######################################################################################################################
- id: spotify_turned_off
  alias: "[Spotify] Turned Off"
  description: Turn off Spotify.
  initial_state: true
  mode: single
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: input_boolean.spotify_on
      to: 'off'

    # spotify media player all off
    - platform: state
      entity_id: binary_sensor.spotify_active
      to: 'off'
      for:
        seconds: 30

    # pause on too long
    - platform: template
      value_template: "{{ is_state(states('sensor.spotify_media_player'),'paused') }}"
      for:
        minutes: 5

  action:
    - service: script.spotify_stop