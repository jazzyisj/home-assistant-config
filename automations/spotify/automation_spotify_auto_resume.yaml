#######################################################################################################################
## Spotify - Auto Resume
#######################################################################################################################
- id: spotify_auto_resume
  alias: "[Spotify] Auto Resume"
  description: Restart radio after announcement, alarm clock, or spotify settings are changed.
  initial_state: true
  mode: single
  trigger:
    - platform: state
      entity_id:
        - input_select.spotify_media_player
        - input_select.spotify_playlist

    # resume after an announcement
    - platform: state
      entity_id: binary_sensor.tts_playing
      to: 'off'

    # resume after an alarm clock
    - platform: state
      entity_id: binary_sensor.alarm_clock_active
      to: 'off'

  condition:
    - condition: state
      entity_id: input_boolean.spotify_on
      state: 'on'

    # spotify has been started somewhere else
    - condition: state
      entity_id: script.spotify_play
      state: 'off'

    - condition: not
      conditions:
        - condition: state
          entity_id: alarm_control_panel.house
          state:
            - triggered # media players are playing alert
            - warning # media players are auto paused

    - !include /config/include/template/spotify_not_tts_player_condition.yaml
    - !include /config/include/template/spotify_not_alarm_clock_player_condition.yaml

  action:
    - choose:
        - conditions: "{{ trigger.entity_id == 'input_select.spotify_playlist') }}"
          sequence:
            - service: spotcast.start
              data:
                device_name: "{{ states('sensor.spotify_spotcast_device') }}"
                uri: !include /config/include/template/spotify_playlist_selection.yaml
                force_playback: true

        - conditions: "{{ trigger.entity_id == 'input_select.spotify_media_player') }}"
          sequence:
            - service: spotcast.start
              data:
                device_name: :"{{ states('input_select.spotify_media_player') }}"
                force_playback: true

      default:
        - service: spotcast.start
          data:
            device_name: "{{ states('sensor.spotify_spotcast_device') }}"
            force_playback: true





