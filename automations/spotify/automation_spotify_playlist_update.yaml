#######################################################################################################################
## Spotify - Playlist Update
#######################################################################################################################

- id: spotify_playlist_selection_update_hassio
  alias: "[Spotify] Playlist Selection Update Hassio"
  description: Update spotify playlist input.
  initial_state: false #SPOTIFY just circular right now
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.spotcast_hassio
      attribute: playing
  action:
    - service: input_select.select_option
      target:
        entity_id: input_select.spotify_playlist_hassio
      data:
        option: "{{ state_attr('sensor.spotcast_hassio','playing') }}"

- id: spotify_playlist_selection_update_jazzyisj
  alias: "[Spotify] Playlist Selection Update JazzisJ"
  description: Update spotify playlist input.
  initial_state: false #SPOTIFY just circular right now
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.spotcast_jazzyisj
      attribute: playing
  action:
    - service: input_select.select_option
      target:
        entity_id: input_select.spotify_playlist_jazzyisj
      data:
        option: "{{ state_attr('sensor.spotcast_jazzyisj','playing') }}"

- id: spotify_playlist_selection_update_sherigagnon
  alias: "[Spotify] Playlist Selection Update SheriGagnon"
  description: Update spotify playlist input.
  initial_state: false #SPOTIFY just circular right now
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.spotcast_sherigagnon
      attribute: playing
  action:
    - service: input_select.select_option
      target:
        entity_id: input_select.spotify_playlist_sherigagnon
      data:
        option: "{{ state_attr('sensor.spotcast_sherigagnon','playing') }}"

- id: spotify_playlist_update_hassio
  alias: "[Spotify] Playlist Update Hassio"
  description: Update spotify playlist input.
  initial_state: true
  mode: restart
  trigger:
    - platform: homeassistant #SPOTIFY probably unecessary because spotcast would update sensor playlists attribute on startup?
      event: start
    - platform: state
      entity_id: sensor.spotcast_hassio
      attribute: playlists
  condition: "{{ state_attr('sensor.spotcast_hassio','playlists')|lower not in ['unknown','unavailable','none'] }}"
  action:
    - service: input_select.set_options
      target:
        entity_id: input_select.spotify_playlist_hassio
      data:
        options: >
            [{% for item in state_attr('sensor.spotcast_hassio','playlists')|from_json -%}
              "{{- item.name }}"{{ ',' if not loop.last -}}{% endfor %}]

- id: spotify_playlist_update_jazzyisj
  alias: "[Spotify] Playlist Update JazzyisJ"
  description: Update spotify playlist input.
  initial_state: false
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.spotcast_jazzyisj
      attribute: playlists
  action:
    - service: input_select.set_options
      target:
        entity_id: input_select.spotify_playlist_jazzyisj
      data:
        options: >
          [{% for item in state_attr('sensor.spotcast_jazzyisj','playlists')|from_json -%}
            "{{- item.name }}"{{ ',' if not loop.last -}}{% endfor %}]

- id: spotify_playlist_update_sherigagnon
  alias: "[Spotify] Playlist Update SheriGagnon"
  description: Update spotify playlist input.
  initial_state: false
  mode: restart
  trigger:
    - platform: state
      entity_id: sensor.spotcast_sherigagnon
      attribute: playlists
  action:
    - service: input_select.set_options
      target:
        entity_id: input_select.spotify_playlist_sherigagnon
      data:
        options: >
          [{% for item in state_attr('sensor.spotcast_sherigagnon','playlists')|from_json -%}
            "{{- item.name }}"{{ ',' if not loop.last -}}{% endfor %}]