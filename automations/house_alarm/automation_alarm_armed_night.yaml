#######################################################################################################################
## Alarm - Armed Night
#######################################################################################################################
- id: alarm_armed_night
  alias: "[Alarm] Armed Night"
  description: Activate night occupancy mode and play announcement.
  initial_state: true
  mode: single
  trigger:
    - platform: state
      entity_id: alarm_control_panel.house
      to: armed_night

  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.previous_alarm_state
        option: "{{ trigger.from_state.state }}"

    - choose:
        conditions:
          - condition: state
            entity_id: input_boolean.alarm_auto_arming
            state: 'on'

          - condition: state
            entity_id: input_boolean.alarm_automation
            state: 'on'

          - condition: not
            conditions:
              - condition: state
                entity_id: input_select.occupancy_mode
                state: Night
          
        sequence:
          # if Away selected, alarm will rearm in armed_away
          - service: input_select.select_option
            data:
              entity_id: input_select.occupancy_mode
              option: "{{ 'Night' if is_state('binary_sensor.someone_home','on') else 'Away' }}"

