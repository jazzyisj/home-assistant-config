#######################################################################################################################
## Alarm - Disarm Alarm Mobile
#NOTE only for almost home/arrived home notifications
#######################################################################################################################
- id: alarm_disarm_mobile
  alias: "[Alarm] Disarm Mobile"
  description: Wait for phone to unlock then disarm alarm.
  initial_state: true
  mode: single
  trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: disarm_alarm_jphone

    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: disarm_alarm_sphone

    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: disarm_alarm_override  #TEMP for alarm triggered disarm

  action:
    - service: script.turn_on
      data:
        entity_id: script.disarm_alarm_auto
        variables:
          mobile: >
            {% if trigger.event.data['action'] == 'disarm_alarm_jphone' %} jphone
            {% elif trigger.event.data['action'] == 'disarm_alarm_sphone' %} sphone
            {% elif trigger.event.data['action'] == 'disarm_alarm_override' %} OVERRIDE
            {% endif %}
          override: "{{ true if trigger.event.data['action'] == 'disarm_alarm_override' else false }}"