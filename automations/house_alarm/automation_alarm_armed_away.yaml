######################################################################################################################
# Alarm - Armed Away
######################################################################################################################
- id: alarm_armed_away
  alias: "[Alarm] Armed Away"
  description: Select away occupancy mode.
  initial_state: true
  mode: single
  trigger:
    - platform: state
      entity_id: alarm_control_panel.house
      to: armed_away

  action:
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ trigger.from_state.state not in ['pending','warning'] }}"

          sequence:
            - service: input_select.select_option
              data:
                entity_id: input_select.previous_alarm_state
                option: "{{ trigger.from_state.state }}"

    - choose:
        conditions:
          - condition: state
            entity_id: input_boolean.alarm_auto_arming
            state: 'on'

          # do not set to away if already in vacation mode
          - condition: not
            conditions:
              - condition: state
                entity_id: input_select.occupancy_mode
                state: Vacation

          - condition: state
            entity_id: input_boolean.alarm_automation
            state: 'on'

        sequence:
          - service: input_select.select_option
            data:
              entity_id: input_select.occupancy_mode
              option: Away

