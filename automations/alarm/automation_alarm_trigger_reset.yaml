######################################################################################################################
# Alarm - Triggered Reset
######################################################################################################################
- id: alarm_triggered_reset
  alias: "[Alarm] Triggered Reset"
  description: Reset alarm triggered state.
  initial_state: true
  max_exceeded: silent # recursive call
  trigger:
    - platform: state
      id: 'boolean'
      entity_id: input_boolean.alarm_triggered
      to: 'off'

    - platform: event
      id: 'finished'
      event_type: timer.finished
      event_data:
        entity_id: timer.alarm_triggered_reset

    - platform: event
      id: 'cancelled'
      event_type: timer.finished
      event_data:
        entity_id: timer.alarm_triggered_reset

  action:
    - choose:
        - conditions: "{{ trigger.id == 'boolean' and not is_state('timer.alarm_triggered_reset','idle') }}"
          sequence:
            - service: timer.finish # recursive call
              entity_id: timer.alarm_triggered_reset

      default:
        - service: input_boolean.turn_off
          entity_id: input_boolean.alarm_triggered



