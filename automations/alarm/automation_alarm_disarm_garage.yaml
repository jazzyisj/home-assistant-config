###############################################################################
## Alarm - Disarm Garage
###############################################################################
- id: alarm_disarm_garage
  alias: "[Alarm] Disarm Garage"
  description: "Disarm alarm garage zone and turn on override."
  max_exceeded: silent
  variables:
    person: >
      {% if trigger.id == 'lock' %}{% set to_state = trigger.to_state.state %}
      {% else %}{% set action = trigger.event.data['action'] %}
      {% endif %}
      {% if action == 'disarm_garage_alarm_jason' or to_state == 'Unlocked (Jason)' %} jason
      {% elif to_state == 'Unlocked (Keypad)' %} hassio
      {% endif %}
  trigger:
    - platform: state
      id: lock
      entity_id: sensor.garage_door_lock_status
      to: #LOCK_USER
        - Unlocked (Jason)
        - Unlocked (Keypad)
      not_from:
        - unknown
        - unavailable

    - platform: event
      id: mobile
      event_type: mobile_app_notification_action
      event_data:
        action: disarm_garage_alarm_jason
  condition:
    - condition: state
      entity_id: input_boolean.alarm_enabled
      state: "on"
  action:
    - service: script.disarm_alarm
      data:
        zone: garage
        person: "{{ person }}"

###############################################################################
## Alarm - Garage Alarm Override
###############################################################################
- id: alarm_garage_alarm_override
  alias: "[Alarm] Garage Alarm Override"
  description: "Turn on garage alarm override."
  trigger:
    - platform: event
      id: mobile
      event_type: mobile_app_notification_action
      event_data:
        action: garage_alarm_override
  condition:
    - condition: state
      entity_id: input_boolean.alarm_enabled
      state: "on"
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.garage_alarm_override

    - if:
        - not:
            - condition: state
              entity_id: alarm_control_panel.garage
              state: disarmed
      then:
        - service: script.disarm_alarm
          data:
            zone: garage
            person: jason
