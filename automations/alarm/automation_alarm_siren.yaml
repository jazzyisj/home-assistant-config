###############################################################################
## Alarm - Siren
###############################################################################
- id: alarm_siren
  alias: "[Alarm] Siren"
  description: "Turn alarm siren on/off."
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_triggered
      to:
        - "on"
        - "off"
  condition:
    - condition: state
      entity_id: input_boolean.alarm_enabled
      state: "on"
  action:
    - if:
        - condition: state
          entity_id: input_boolean.alarm_triggered
          state: "on"
      then:
        - service: switch.turn_on
          target:
            entity_id:
              - switch.charlie_crate_camera_power
              - switch.living_room_camera_power

        - parallel:
            - sequence:
                - wait_template: "{{ has_value('siren.charlie_crate_camera_alarm') }}"
                  timeout: 60
                  continue_on_timeout: false

                - service: siren.turn_on
                  target:
                    entity_id: siren.charlie_crate_camera_alarm

            - sequence:
                - wait_template: "{{ has_value('siren.living_room_camera_alarm') }}"
                  timeout: 60
                  continue_on_timeout: false

                - service: siren.turn_on
                  target:
                    entity_id: siren.living_room_camera_alarm
      else:
        - service: siren.turn_off
          target:
            entity_id:
              - siren.charlie_crate_camera_alarm
              - siren.living_room_camera_alarm
