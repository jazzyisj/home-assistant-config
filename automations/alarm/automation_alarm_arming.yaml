###############################################################################
## Alarm - Arming
###############################################################################
- id: alarm_arming
  alias: '[Alarm] Arming'
  description: 'Start/cancel alarm arming timer.'
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: alarm_control_panel.master
      to: arming

    - platform: state
      entity_id:
        - alarm_control_panel.house
        - alarm_control_panel.garage
      to: arming
      for: 1 # let master trigger first

    - platform: state
      entity_id:
        - alarm_control_panel.master
        - alarm_control_panel.house
        - alarm_control_panel.garage
      from: arming
  action:
    - choose:
        - conditions: "{{ is_state(trigger.entity_id,'arming') }}"
          sequence:
            - service: timer.start
              target:
                entity_id: timer.alarm_arming
              data:
                duration:
                  seconds: "{{ state_attr('alarm_control_panel.' ~ trigger.entity_id.split('.')[1],'delay')|int(-1) }}"
      default:
        - service: timer.cancel
          target:
            entity_id: timer.alarm_arming
