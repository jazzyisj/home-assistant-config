#######################################################################################################################
## Schedule - Water Plants Notification
#######################################################################################################################
- id: schedule_water_plants_notification
  alias: "[Schedule] Water Plants Notification"
  description: "Reminder to water plants."
  initial_state: true
  mode: single
  trigger:
    - platform: template
      value_template: >
        {{ is_state('sensor.time','18:00') if is_state('sensor.current_shift','Days')
            and is_state('binary_sensor.work_today','on') else is_state('sensor.time','12:00') }}

  condition:
    - condition: state
      entity_id:
        - input_boolean.schedule_automation
        - binary_sensor.alerts_enabled
      state: 'on'

    - condition: time
      weekday:
        - sun
        - wed

  action:
    - service: !include /config/include/template/notify_jason_template.yaml
      data:
        title: "Water Plants"
        message: "Don't forget to water the plants."
        data:
          actions:
            - action: close_water_plants
              title: Close
          tag: water_plants
          timestamp: "{{ as_timestamp(now()) }}" #push
          priority: normal
          renotify: false
          ttl: 43200
          silent: true #push
          requireInteraction: false #push
          sticky: false #app
          url: /lovelace/schedule #push
          clickAction: /lovelace/schedule #app
          color: !secret NOTIFY_COLOR #app
          image: !secret PLANTS_IMAGE
          icon: !secret PLANTS_ICON #push
          badge: !secret PLANTS_BADGE #push

#######################################################################################################################
## Schedule - Close Water Plants Notifications
#######################################################################################################################
- id: schedule_close_water_plants_notifications
  alias: "[Schedule] Close Water Plants Notifications"
  description: "Dismiss notifications on all devices."
  initial_state: true
  mode: single
  max_exceeded: silent
  trigger:
    - platform: event
      event_type: html5_notification.closed
      event_data:
        tag: water_plants

    #BUG html5 closed event doesn't work if notification is in tray
    - platform: event
      event_type: html5_notification.clicked
      event_data:
        action: close_water_plants

    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: close_water_plants

  action:
    - service: script.close_notifications
      data:
        target: mobile_app_jphone
        category: schedule
        tag: water_plants
        pause: false