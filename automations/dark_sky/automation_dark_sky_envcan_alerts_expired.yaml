#######################################################################################################################
## Dark Sky - EnvCan Alerts Expired
#######################################################################################################################
- id: dark_sky_envcan_alerts_expired
  alias: "[Dark Sky] EnvCan Alerts Expired"
  description: Close all EnvCan alert notifications, reset severity values.
  initial_state: true
  mode: single
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: binary_sensor.dark_sky_alert_active
      to: 'off'

  action:
    - service: input_text.set_value
      data:
        entity_id: input_text.current_dark_sky_alert_severity
        value: cleared

    - service: input_text.set_value
      data:
        entity_id: input_text.previous_dark_sky_alert_severity
        value: cleared

    - service: script.close_notifications
      data:
        target: mobile
        tag: darksky_alert

    - delay:
        seconds: 180 # prevent recursive triggers