#######################################################################################################################
## Radio - Play Failed
#######################################################################################################################
- id: radio_play_failed
  alias: "[Radio] Play Failed"
  description: Send notification when radio play failed.
  initial_state: true
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.radio_failed
      to: 'on'

  condition:
    - condition: state
      entity_id: input_boolean.radio_on
      state: 'on'

  action:
    - service: script.radio_stop

    - choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.alerts_enabled
              state: 'on'

          sequence:
            # delay to allow occupant to reset radio before notification
            - delay:
                minutes: 5

            - condition: state
              entity_id: input_boolean.radio_failed
              state: 'on'

            - service: notify.mobile_app_jphone
              data:
                title: Radio Play Failed
                message: "{{ play_message }}"
                data:
                  tag: radio_play_failed
                  group: System
                  channel: General
                  importance: max
                  timeout: 600
                  clickAction: /lovelace/media
                  color: !secret WARNING_COLOR
                  icon_url: !secret ALERT_ICON
                  image: !secret RADIO_ALERT_IMAGE

    # delay before resetting radio failed
    - delay:
        hours: 1

    - service: input_boolean.turn_off
      entity_id: input_boolean.radio_failed