###############################################################################
## Lock - Set Alarm Mode
###############################################################################
- id: lock_set_alarm_mode
  alias: '[Lock] Set Alarm Mode'
  description: 'Set door locks alarm mode.'
  mode: restart
  variables: #ZWAVE device ready (state locked/unlocked)
    locks: >
      {{ expand('group.locks')|selectattr('state','in',['locked','unlocked'])
          |map(attribute='entity_id')|list }}
  trigger:
    - platform: state
      entity_id: alarm_control_panel.master
      to:
        - armed_home
        - armed_night
        - armed_away
        - disarmed
  condition:
    - condition: state
      entity_id: input_boolean.lock_automation
      state: 'on'

    - "{{ is_state('input_boolean.alarm_temp_override','off') if trigger.to_state == 'disarmed' else true }}"
  action:
    - delay: 30 #ZWAVE let LED change, locks slow

    - choose:
        - conditions:
            - condition: state
              entity_id: alarm_control_panel.master
              state: disarmed
          sequence:
            - service: zwave_js.set_config_parameter
              target:
                entity_id: '{{ locks }}'
              data:
                parameter: Alarm Mode
                value: Alarm Off

        - conditions:
            - condition: state
              entity_id: alarm_control_panel.master
              state: armed_home
          sequence:
            - service: zwave_js.set_config_parameter
              target:
                entity_id: '{{ locks }}'
              data:
                parameter: Alarm Mode
                value: Alert

            - service: zwave_js.set_config_parameter
              target:
                entity_id: '{{ locks }}'
              data:
                parameter: Alarm Alert Sensitivity
                value: Less Sensitive

        - conditions:
            - condition: state
              entity_id: alarm_control_panel.master
              state: armed_night
          sequence:
            - service: zwave_js.set_config_parameter
              target:
                entity_id: '{{ locks }}'
              data:
                parameter: Alarm Mode
                value: Forced Entry

            - service: zwave_js.set_config_parameter
              target:
                entity_id: '{{ locks }}'
              data:
                parameter: Alarm Kick Sensitivity
                value: Most Sensitive

        - conditions:
            - condition: state
              entity_id: alarm_control_panel.master
              state: armed_away
          sequence:
            - service: zwave_js.set_config_parameter
              target:
                entity_id: '{{ locks }}'
              data:
                parameter: Alarm Mode
                value: Forced Entry

            - service: zwave_js.set_config_parameter
              target:
                entity_id: '{{ locks }}'
              data:
                parameter: Alarm Kick Sensitivity
                value: Most Sensitive
