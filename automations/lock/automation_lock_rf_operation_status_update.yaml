###############################################################################
## Lock - RF Operation Status Update
#TEMP https://github.com/jazzyisj/home-assistant-config/issues/36
###############################################################################
- id: lock_rf_operation_status_update
  alias: '[Lock] RF Operation Status Update'
  description: 'Update lock status for RF Operations.'
  mode: parallel
  variables:
    lock: "{{ trigger.entity_id.split('.')[1] }}"
  trigger:
    - platform: state
      entity_id:
        - lock.side_door_lock
        - lock.back_door_lock
        - lock.garage_door_lock
        - lock.front_door_lock
      to:
        - locked
        - unlocked
      from:
        - locked
        - unlocked
      for: 5 # allow automation.lock_status_update to run
  action:
    - choose:
        - conditions: >
            {{ trigger.to_state.state == 'locked'
                and 'Unlocked (' in states('sensor.' ~ lock ~ '_status') }}
          sequence:
            - service: input_text.set_value
              target:
                entity_id: 'input_text.{{ lock }}_status'
              data:
                value: 'Locked (Hassio)'

        - conditions: >
            {{ trigger.to_state.state == 'unlocked'
                and 'Locked (' in states('sensor.' ~ lock ~ '_status') }}
          sequence:
            - service: input_text.set_value
              target:
                entity_id: 'input_text.{{ lock }}_status'
              data:
                value: 'Unlocked (Hassio)'
