#######################################################################################################################
## Presence - Someone Arrives Home
#######################################################################################################################
- id: presence_someone_arrives_home
  alias: "[Presence] Someone Arrives Home"
  description: "Detect who arrived home and run arrive home script."
  initial_state: true
  mode: parallel
  variables:
    first_home: >
      {{ (trigger.entity_id == 'input_boolean.guest_home' and is_state('binary_sensor.owner_home','off'))
          or (trigger.entity_id == 'binary_sensor.jason_home' and is_state('binary_sensor.sheri_home','off') and is_state('input_boolean.guest_home','off'))
          or (trigger.entity_id == 'binary_sensor.sheri_home' and is_state('binary_sensor.jason_home','off') and is_state('input_boolean.guest_home','off')) }}
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.jason_home
        - binary_sensor.sheri_home
        - input_boolean.guest_home
      to: 'on'

  condition:
    # jason_home / sheri_home always off as startup
    - condition: state
      entity_id: variable.startup_complete
      state: 'true'

  action:
    - service: script.scene_someone_arrives_home
      data:
        trigger_entity: "{{ trigger.entity_id }}"
        first_home: "{{ first_home }}"
