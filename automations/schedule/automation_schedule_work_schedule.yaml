###############################################################################
## Schedule - Work Schedule Changed
###############################################################################
- id: schedule_work_schedule_changed
  alias: '[Schedule] Work Schedule Changed'
  description: 'Reset work schedule settings, send notification.'
  mode: queued
  max: 5
  trigger:
    - platform: state
      entity_id: input_boolean.work_schedule
      to: ~
  condition:
    - condition: state
      entity_id: input_boolean.schedule_automation
      state: 'on'
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_boolean.work_schedule
              state: 'on'
          sequence:
            - service: input_boolean.turn_off
              entity_id: input_boolean.work_shift_override
      default:
        - service: input_boolean.turn_off
          target:
            entity_id:
              - input_boolean.saturday_workday
              - input_boolean.sunday_workday

        - service: input_select.select_option
          target:
            entity_id: input_select.current_work_shift
          data:
            option: 'Off'

    - service: notify.jason
      data:
        title: 'Work Schedule Changed'
        message: |
          Work Schedule: {{ states('binary_sensor.work_schedule')|title }}
          Current Shift: {{ states('sensor.work_shift_today')|title }}
        data:
          tag: work_schedule
          group: General
          channel: General
          importance: max
          ttl: 0
          priority: high
          timeout: 86400
          notification_icon: mdi:factory
          icon_url: !secret WORK_ICON
          image: !secret WORK_IMAGE
          ledColor: !secret NOTIFY_COLOR
          color: !secret NOTIFY_COLOR
          vibrationPattern: !secret GENERAL_VIBRATION
          clickAction: /lovelace-mobile/presence
          actions:
            - title: "Work {{ 'Off' if is_state('input_boolean.work_schedule','on') else 'On' }}"
              action: work_schedule_toggle

            - title: 'Days'
              action: set_day_shift

            - title: 'Afts'
              action: set_aft_shift

###############################################################################
## Schedule - Work Schedule Toggle
###############################################################################
- id: schedule_work_schedule_toggle
  alias: '[Schedule] Work Schedule Toggle'
  description: 'Toggle work schedule.'
  max_exceeded: silent
  trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: work_schedule
  action:
    - service: input_boolean.toggle
      target:
        entity_id: input_boolean.work_schedule

###############################################################################
## Schedule - Set Day Shift
###############################################################################
- id: schedule_set_day_shift
  alias: '[Schedule] Set Day Shift'
  description: 'Set day work shift.'
  max_exceeded: silent
  trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: set_day_shift
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.work_shift_override

    - service: input_select.select_option
      target:
        entity_id: input_select.current_work_shift
      data:
        option: Days

###############################################################################
## Schedule - Set Afternoon Shift
###############################################################################
- id: schedule_set_afternoon_shift
  alias: '[Schedule] Set Afternoon Shift'
  description: 'Set afternoon work shift.'
  max_exceeded: silent
  trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: set_aft_shift
  action:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.work_shift_override

    - service: input_select.select_option
      target:
        entity_id: input_select.current_work_shift
      data:
        option: Afternoons

###############################################################################
## Schedule - Work Setting Reset
###############################################################################
- id: schedule_work_setting_reset
  alias: '[Schedule] Work Setting Reset'
  description: 'Turn work day off if work schedule off.'
  trigger:
    - platform: state
      entity_id:
        - input_boolean.saturday_workday
        - input_boolean.sunday_workday
        - input_boolean.work_shift_override
      to: 'on'
      from: 'off'
  condition:
    - condition: state
      entity_id: input_boolean.work_schedule
      state: 'off'
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: '{{ trigger.entity_id }}'

    - service: browser_mod.toast
      data:
        message: 'Work day schedule cannot be enabled.  Work schedule is turned off.'
