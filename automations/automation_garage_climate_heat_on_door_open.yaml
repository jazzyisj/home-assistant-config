#######################################################################################################################
## Garage Climate - Heat On Door Open
#######################################################################################################################
- id:  garage_climate_heat_on_door_open
  alias: "[Garage Climate] Heat On Door Open"
  description: "Turn garage heat back off until garage door closed."
  initial_state: true
  mode: single
  trigger:
    - entity_id: climate.garage_thermostat
      platform: state
      to: heat

  condition:
    - condition: state
      entity_id:
        - input_boolean.garage_climate_automation
        - binary_sensor.garage_door_open
      state: 'on'

  action:
    # turn off garage heat, do not turn off boolean switch here or heat won't turn on when door closes
    - service: script.garage_climate_off

    - service: script.tts_announcement
      data:
        play_message: "The heat will turn on when the garage door closes."

    # wait 15 min for door to close to try again, if door still isn't closed cancel
    - wait_template: "{{ is_state('binary_sensor.garage_door_open','off') }}"
      timeout:
        minutes: 15
      continue_on_timeout: false

    - service: script.garage_climate_on