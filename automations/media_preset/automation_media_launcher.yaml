#######################################################################################################################
## Media Launcher
#######################################################################################################################
- id: media_preset_media_launcher_control
  alias: "[Media Preset] Media Launcher Control"
  description: Control media launcher function
  initial_state: true
  mode: restart
  trigger:
    - platform: state
      entity_id:
        - input_boolean.radio
        - input_boolean.spotify

        - input_boolean.media_launcher_radio
        - input_boolean.media_launcher_spotify

        - input_boolean.media_launcher_preset_jason
        - input_boolean.media_launcher_preset_sheri
        - input_boolean.media_launcher_preset_wake
        - input_boolean.media_launcher_preset_morning
        - input_boolean.media_launcher_preset_sleep
        - input_boolean.media_launcher_preset_company
        - input_boolean.media_launcher_preset_shower

        - input_boolean.media_preset_jason
        - input_boolean.media_preset_sheri
        - input_boolean.media_preset_wake
        - input_boolean.media_preset_morning
        - input_boolean.media_preset_sleep
        - input_boolean.media_preset_company
        - input_boolean.media_preset_shower
      to: 'on'
  action:
    - choose:
        - conditions: "{{ 'input_boolean.media_preset' in trigger.entity_id }}"
          sequence:
            - service: input_boolean.turn_on
              data:
                entity_id: "input_boolean.media_launcher_{{ states('input_select.media_preset_type_' ~ trigger.entity_id[27:])|lower }}"

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_radio' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_spotify
                - input_boolean.media_launcher_preset_jason
                - input_boolean.media_launcher_preset_sheri
                - input_boolean.media_launcher_preset_wake
                - input_boolean.media_launcher_preset_morning
                - input_boolean.media_launcher_preset_sleep
                - input_boolean.media_launcher_preset_company
                - input_boolean.media_launcher_preset_shower

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_spotify' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_radio
                - input_boolean.media_launcher_preset_jason
                - input_boolean.media_launcher_preset_sheri
                - input_boolean.media_launcher_preset_wake
                - input_boolean.media_launcher_preset_morning
                - input_boolean.media_launcher_preset_sleep
                - input_boolean.media_launcher_preset_company
                - input_boolean.media_launcher_preset_shower

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_preset_jason' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_radio
                - input_boolean.media_launcher_spotify
                - input_boolean.media_launcher_preset_sheri
                - input_boolean.media_launcher_preset_wake
                - input_boolean.media_launcher_preset_morning
                - input_boolean.media_launcher_preset_sleep
                - input_boolean.media_launcher_preset_company
                - input_boolean.media_launcher_preset_shower

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_preset_sheri' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_radio
                - input_boolean.media_launcher_spotify
                - input_boolean.media_launcher_preset_jason
                - input_boolean.media_launcher_preset_wake
                - input_boolean.media_launcher_preset_morning
                - input_boolean.media_launcher_preset_sleep
                - input_boolean.media_launcher_preset_company
                - input_boolean.media_launcher_preset_shower

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_preset_wake' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_radio
                - input_boolean.media_launcher_spotify
                - input_boolean.media_launcher_preset_jason
                - input_boolean.media_launcher_preset_sheri
                - input_boolean.media_launcher_preset_morning
                - input_boolean.media_launcher_preset_sleep
                - input_boolean.media_launcher_preset_company
                - input_boolean.media_launcher_preset_shower

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_preset_morning' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_radio
                - input_boolean.media_launcher_spotify
                - input_boolean.media_launcher_preset_jason
                - input_boolean.media_launcher_preset_sheri
                - input_boolean.media_launcher_preset_wake
                - input_boolean.media_launcher_preset_sleep
                - input_boolean.media_launcher_preset_company
                - input_boolean.media_launcher_preset_shower

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_preset_sleep' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_radio
                - input_boolean.media_launcher_spotify
                - input_boolean.media_launcher_preset_jason
                - input_boolean.media_launcher_preset_sheri
                - input_boolean.media_launcher_preset_wake
                - input_boolean.media_launcher_preset_morning
                - input_boolean.media_launcher_preset_company
                - input_boolean.media_launcher_preset_shower

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_preset_company' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_radio
                - input_boolean.media_launcher_spotify
                - input_boolean.media_launcher_preset_jason
                - input_boolean.media_launcher_preset_sheri
                - input_boolean.media_launcher_preset_wake
                - input_boolean.media_launcher_preset_morning
                - input_boolean.media_launcher_preset_sleep
                - input_boolean.media_launcher_preset_shower

        - conditions: "{{ trigger.entity_id == 'input_boolean.media_launcher_preset_shower' }}"
          sequence:
            - service: input_boolean.turn_off
              entity_id:
                - input_boolean.media_launcher_radio
                - input_boolean.media_launcher_spotify
                - input_boolean.media_launcher_preset_jason
                - input_boolean.media_launcher_preset_sheri
                - input_boolean.media_launcher_preset_wake
                - input_boolean.media_launcher_preset_morning
                - input_boolean.media_launcher_preset_sleep
                - input_boolean.media_launcher_preset_company

#ISSUE how do we turn off booleans after window is closed so it opens next time in default view (radio)
#BUGFIX hacky fix - turn radio boolean on after a few seconds, will go back to default radio view but most times user would have closed by now anyway
#BUG didn't work with script --- not required, call media type when opening launcher
    - delay: 60

    - service: input_boolean.turn_on
      data: # switch back to default view (spotify if on else radio)
        entity_id: >
          {% if is_state('input_boolean.spotify','on') %} input_boolean.media_launcher_spotify
          {% else %} input_boolean.media_launcher_radio
          {% endif %}

    - service: input_select.select_option
      data: # switch back to default selection (hassio if on else jason/sheri if on else hassio)
        entity_id: input_select.spotify_account
        option: >
          {% if is_state('media_player.spotify_jazzyisj','playing') %} Hassio
          {% elif is_state('media_player.spotify_jazzyisj','playing') %} Jason
          {% elif is_state('media_player.spotify_sherigagnon','playing') %} Sheri
          {% else %} Hassio
          {% endif %}
