###############################################################################
## Presence - Charlie Home Alone On
###############################################################################
- id: presence_charlie_home_alone_on
  alias: "[Presence] Charlie Home Alone On"
  description: "Charlie home alone, music, lights."
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: input_select.occupancy_mode
      to: Away
      for:
        minutes: 5

    - platform: state
      entity_id: input_boolean.charlie_home_alone
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.charlie_home_alone
      state: "on"
  action:
    - service: automation.turn_off
      target:
        entity_id: automation.fan_in_use_timer

    - service: fan.turn_on
      target:
        entity_id: fan.office_fan
      data:
        percentage: 25
      continue_on_error: true

    - service: automation.turn_on
      target:
        entity_id: automation.fan_in_use_timer

    - if: "{{ is_state('binary_sensor.someone_home','off') }}"
      then:
        - service: switch.turn_on
          target:
            entity_id: switch.charlie_crate_camera_power

    - if: "{{ is_state('input_boolean.media_preset_enabled_charlie','on') }}"
      then:
        - service: script.media_play
          data:
            preset: charlie

###############################################################################
## Presence - Turn Off Charlie Home Alone
###############################################################################
- id: presence_turn_off_charlie_home_alone
  alias: "[Presence] Turn Off Charlie Home Alone"
  description: "Turn off Charlie home alone boolean."
  trigger:
    - platform: state
      entity_id: input_select.occupancy_mode
      to: Home
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.charlie_home_alone

###############################################################################
## Presence - Charlie Home Alone Off
###############################################################################
- id: presence_charlie_home_alone_off
  alias: "[Presence] Charlie Home Alone Off"
  description: "Turn off Charlie home alone, music, lights."
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: input_boolean.charlie_home_alone
      to: "off"
  action:
    - service: automation.turn_off
      target:
        entity_id: automation.fan_in_use_timer

    - service: fan.turn_off
      target:
        entity_id: fan.office_fan
      continue_on_error: true

    - service: automation.turn_on
      target:
        entity_id: automation.fan_in_use_timer

    - if: "{{ is_state('binary_sensor.someone_home','on') }}"
      then:
        - service: switch.turn_off
          target:
            entity_id: switch.charlie_crate_camera_power

    - if: "{{ is_state('input_boolean.media_preset_enabled_charlie','on') }}"
      then:
        - service: media_player.turn_off
          target:
            entity_id: media_player.office_speaker
