###################################################################################################
## Turn Jason Almost Home Off
###################################################################################################
- id: turn_jason_almost_home_off
  alias: "Turn Jason Almost Home Off"
  description: "Turn Jason almost home boolean off."
  triggers:
    - trigger: state
      id: check
      entity_id: input_boolean.jason_almost_home
      to: "on"

    - trigger: state
      entity_id: binary_sensor.jason_home
      to: "on"
      not_from:
        - unknown
        - unavailable
  actions:
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.jason_almost_home

    - if: #TEST
        - condition: state
          entity_id: input_boolean.occupancy_notifications
          state: "on"
      then:
        - action: notify.jason
          data:
            message: clear_notification
            data:
              tag: jason_heading_home"

###################################################################################################
## Jason Heading Home
###################################################################################################
- id: jason_heading_home #TEST
  alias: "Jason Heading Home"
  description: "Send notification."
  triggers:
    - trigger: state
      entity_id: binary_sensor.jason_heading_home
      to: "on"
  actions:
    - action: notify.jason
      data:
        message: "Jason is heading home. Get a beer ready for him!"
        data:
          tag: jason_heading_home
          group: Presence
          visibility: public
          timeout: 600
          notification_icon: mdi:home-account
          icon_url: !secret ARRIVE_HOME_ICON
          clickAction: /ui-mobile/jason-presence
