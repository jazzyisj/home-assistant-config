###############################################################################
## Presence - Arrive Home Notification
###############################################################################
- id: presence_arrive_home_notification
  alias: "[Presence] Arrive Home Notification"
  description: "Send notification to disarm alarm when someone almost home."
  mode: parallel
  variables:
    person: >
      {% if trigger.entity_id in ['binary_sensor.jason_home','input_boolean.jason_almost_home'] %} jason
      {% elif trigger.entity_id in ['binary_sensor.sheri_home','input_boolean.sheri_almost_home'] %} sheri
      {% endif %}
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.jason_home
        - binary_sensor.sheri_home
      to: "on"
      from: "off"

    - platform: state
      entity_id:
        - input_boolean.jason_almost_home
        - input_boolean.sheri_almost_home
      to: "on"
      from: "off"
  condition:
    - condition: state
      entity_id: input_boolean.presence_alerts
      state: "on"
  action:
    - service: script.arriving_home_notification
      data:
        person: "{{ person }}"
