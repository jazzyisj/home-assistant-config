###############################################################################
## Presence - Arrive Home Notification
###############################################################################
- id: presence_arrive_home_notification
  alias: '[Presence] Arrive Home Notification'
  description: 'Send notification to disarm alarm when someone almost home.'
  mode: parallel
  max: 5
  variables:
    person: >
      {% if trigger.entity_id in ['person.jason','input_boolean.jason_almost_home'] %} jason
      {% elif trigger.entity_id in ['person.sheri','input_boolean.sheri_almost_home'] %} sheri
      {% endif %}
  trigger:
    - platform: state #VERIFY
      entity_id:
        - person.jason
        - person.sheri
      to: 'home'

    - platform: state
      entity_id:
        - input_boolean.jason_almost_home
        - input_boolean.sheri_almost_home
      to: 'on'
  condition:
    - condition: state
      entity_id:
        - input_boolean.alarm_automation
        - input_boolean.presence_automation
      state: 'on'
  action:
    - service: script.arriving_home_notification
      data:
        person: '{{ person }}'
