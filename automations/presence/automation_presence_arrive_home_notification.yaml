###############################################################################
## Presence - Arrive Home Notification
###############################################################################
- id: presence_arrive_home_notification
  alias: "[Presence] Arrive Home Notification"
  description: "Send notification when someone almost home."
  mode: parallel
  variables:
    person: >
      {% if 'jason' in trigger.entity_id %} jason
      {% elif 'sheri' in trigger.entity_id %} sheri
      {% endif %}
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.jason_home
        - binary_sensor.sheri_home
      to: "on"
      not_from:
        - unknown
        - unavailable

    - platform: state
      entity_id:
        - input_boolean.jason_almost_home
        - input_boolean.sheri_almost_home
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.occupancy_notifications
      state: "on"
  action:
    - service: script.arriving_home_notification
      data:
        person: "{{ person }}"
