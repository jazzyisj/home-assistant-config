###############################################################################
## Camera - Person Detected Alert

#IDEA - limit notifications
# FRONT DOOR
#   - mobile: always
#   - tts: night

# SIDE DOOR
#   - mobile: nobody home, night
#   - tts: night

###############################################################################
- id: camera_person_detected_alert
  alias: '[Camera] Person Detected Alert'
  description: 'Notifcation of Side Drive camera event.'
  max_exceeded: silent
  trigger:
    - platform: mqtt
      topic: frigate/events
  condition:
    - condition: state
      alias: 'Camera alerts are on'
      entity_id: input_boolean.camera_notifications
      state: 'on'
  action:
    - service: notify.jason
      data_template:
        title: "{{ trigger.payload_json['after']['camera']|replace('_',' ')|title }}"
        message: "A {{ trigger.payload_json['after']['label'] }} was detected."
        data:
          tag: "{{ trigger.payload_json['after']['id'] }}"
          group: Alarm
          channel: Alert
          importance: max
          ttl: 0
          priority: high
          when: "{{ trigger.payload_json['after']['start_time']|int }}"
          notification_icon: mdi:cctv
          icon_url: !secret ALARM_ICON
          image: "{{ states('input_text.base_url') }}/api/frigate/notifications/{{ trigger.payload_json['after']['id'] }}/thumbnail.jpg?format=android"
          ledColor: !secret WARNING_COLOR
          color: !secret WARNING_COLOR
          vibrationPattern: !secret ALERT_VIBRATION
          clickAction: /ccab4aaf_frigate/dashboard
          actions:
            - title: 'Alarm'
              action: URI
              uri: app://com.thanksmister.iot.mqtt.alarmpanel

            - title: 'Cameras'
              action: URI
              uri: app://com.flir.consumer.flir.lorexcloud

    - delay: 30
