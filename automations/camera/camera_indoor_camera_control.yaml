###################################################################################################
## Indoor Camera Control
###################################################################################################
- id: indoor_camera_control
  alias: "Indoor Camera Control"
  description: "Turn indoor cameras on and off."
  mode: restart
  triggers:
    - trigger: state
      entity_id: input_boolean.startup_pending
      to: "off" # both cams not always ready when wyze connected turns on

    - trigger: state
      entity_id:
        - binary_sensor.wyze_integration_connected
        - binary_sensor.someone_home
        - input_boolean.alarm_triggered
      to:
        - "on"
        - "off"
      not_from:
        - unknown
        - unavailable
      for: 1 # allow groups to populate at startup avoid turning on/off

    - trigger: state
      entity_id:
        - group.indoor_cameras
        - group.indoor_camera_switches
      attribute: entity_id
      to:
  actions:
    - wait_template: "{{ state_attr('group.indoor_camera_switches', 'entity_id') != none }}"
      timeout:
        minutes: 5

    - variables:
        entities: "{{ state_attr('group.indoor_camera_switches', 'entity_id') }}"

    - if: "{{ entities == none or entities | count == 0 }}"
      then:
        - stop: "No valid entities."
      else:
        - if: >
            {{ is_state('binary_sensor.someone_home', 'on')
                and is_state('input_boolean.alarm_triggered', 'off') }}
          then:
            - action: switch.turn_off
              target:
                entity_id: "{{ entities }}"
          else:
            - action: switch.turn_on
              target:
                entity_id: "{{ entities }}"
