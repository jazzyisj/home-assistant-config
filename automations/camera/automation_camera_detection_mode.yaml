###############################################################################
## Camera - Detection Mode
###############################################################################
- id: camera_detection_mode
  alias: "[Camera] Detection Mode"
  description: "Control camera detection mode."
  mode: queued
  variables:
    state: "{{ states('alarm_control_panel.master') }}"
  trigger:
    - platform: homeassistant
      event: start

    - platform: state
      entity_id: alarm_control_panel.master
      to:
        - disarmed
        - armed_home
        - armed_night
        - armed_away
  action:
    - wait_template: "{{ is_state('binary_sensor.frigate_connected','on') }}"
      timeout:
        minutes: 5
      continue_on_timeout: false

    - choose:
        - conditions: "{{ state == 'disarmed' }}"
          sequence:
            - service: switch.turn_on
              target:
                entity_id:
                  - switch.front_door_frigate_detect
                  - switch.front_door_frigate_motion

            - service: switch.turn_off
              target:
                entity_id:
                  - switch.side_drive_frigate_detect
                  - switch.side_door_frigate_detect
                  - switch.front_drive_frigate_detect
                  # - switch.front_yard_frigate_detect
                  # - switch.side_gate_front_frigate_detect
                  # - switch.side_gate_back_frigate_detect
                  # - switch.back_yard_frigate_detect #DISABLED
                  - switch.back_door_frigate_detect
                  - switch.patio_door_frigate_detect
                  - switch.back_house_frigate_detect
                  - switch.garage_inside_frigate_detect

                  # - switch.side_drive_frigate_motion
                  - switch.side_door_frigate_motion
                  - switch.front_drive_frigate_motion
                  - switch.front_yard_frigate_motion
                  # - switch.side_gate_front_frigate_motion
                  # - switch.side_gate_back_frigate_motion
                  # - switch.back_yard_frigate_motion
                  - switch.back_door_frigate_motion
                  - switch.patio_door_frigate_motion
                  - switch.back_house_frigate_motion
                  - switch.garage_inside_frigate_motion

                  - group.frigate_contrast_controls

        - conditions: "{{ state == 'armed_home' }}"
          sequence:
            - service: switch.turn_on
              target:
                entity_id:
                  - switch.side_drive_frigate_detect
                  - switch.side_door_frigate_detect
                  - switch.front_door_frigate_detect
                  - switch.front_drive_frigate_detect
                  # - switch.front_yard_frigate_detect
                  - switch.garage_inside_frigate_detect

                  - switch.side_drive_frigate_motion
                  - switch.side_door_frigate_motion
                  - switch.front_door_frigate_motion
                  - switch.front_drive_frigate_motion
                  - switch.front_yard_frigate_motion
                  - switch.garage_inside_frigate_motion

            - service: switch.turn_off
              target:
                entity_id:
                  # - switch.side_gate_front_frigate_detect
                  # - switch.side_gate_back_frigate_detect
                  # - switch.back_yard_frigate_detect
                  - switch.back_door_frigate_detect
                  - switch.patio_door_frigate_detect
                  - switch.back_house_frigate_detect

                  # - switch.side_gate_front_frigate_motion
                  # - switch.side_gate_back_frigate_motion
                  # - switch.back_yard_frigate_motion
                  - switch.back_door_frigate_motion
                  - switch.patio_door_frigate_motion
                  - switch.back_house_frigate_motion

                  - group.frigate_contrast_controls

        - conditions: "{{ state in ['armed_night','armed_away'] }}"
          sequence:
            - service: switch.turn_on
              target:
                entity_id:
                  - group.frigate_detection_controls
                  - group.frigate_motion_controls

            - if: "{{ state == 'armed_night'}}"
              then:
                - service: switch.turn_on
                  target:
                    entity_id: group.frigate_contrast_controls
              else:
                - service: switch.turn_off
                  target:
                    entity_id: group.frigate_contrast_controls
