###############################################################################
## Camera - Restart Wyze
#ISSUE Wyze cams go offline when powered off for a while
###############################################################################
- id: camera_restart_wyze
  alias: "[Camera] Restart Wyze"
  description: "Restart Wyze addon."
  max_exceeded: silent
  trigger:
    - platform: homeassistant
      event: start

    - platform: state
      entity_id: binary_sensor.wyze_connected
      to: "off"
  condition:
    - condition: state
      entity_id: binary_sensor.wyze_connected
      state: "off"
  action:
    # allow wyze mqtt entities to register on startup
    - if: "{{ trigger.id == 'startup' }}"
      then:
        - delay: 300

    - repeat:
        while: "{{ is_state('binary_sensor.wyze_connected','off') }}"
        sequence:
          - service: hassio.addon_restart
            data:
              addon: 7094bb28_docker-wyze-bridge

          - wait_template: "{{ is_state('binary_sensor.wyze_connected','on') }}"
