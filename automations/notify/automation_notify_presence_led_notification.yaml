###############################################################################
## Notify - Presence LED Notification
###############################################################################
- id: notify_presence_led_notification
  alias: "[Notify] Presence LED Notification"
  description: "Set LED notification."
  mode: queued
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.jason_home
        - binary_sensor.sheri_home
        - input_boolean.jason_almost_home
        - input_boolean.sheri_almost_home
        - alert.jason_phone_offline
        - alert.sheri_phone_offline
      to: ~
      for: 15 # prevent trigger on temporary state changes

    - platform: template
      value_template: >
        {{ expand( 'proximity.jphone_home' )|selectattr('state', 'is_number')|selectattr('state','lt','4')
            |selectattr('attributes.dir_of_travel', 'eq', 'towards')|list|count > 0 }}

    - platform: template
      value_template: >
        {{ expand( 'proximity.sphone_home' )|selectattr('state', 'is_number')|selectattr('state','lt','4')
            |selectattr('attributes.dir_of_travel', 'eq', 'towards')|list|count > 0 }}
  action:
    - service: script.presence_led
