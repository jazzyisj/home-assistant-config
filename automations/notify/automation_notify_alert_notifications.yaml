###############################################################################
## Notify - Alert Notifications
###############################################################################
- id: notify_alert_notifications
  alias: "[Notify] Alert Notifications"
  description: "Display persistent notification with alert."
  mode: parallel
  variables:
    title: >
      {% set t = trigger.entity_id %}
      {% if t == 'alert.calendar_empty' %} Calendar Empty
      {% endif %}
    message: >
      {% set t = trigger.entity_id %}
      {% if t == 'alert.calendar_empty' %}
        {%- if state_attr('binary_sensor.calendar_empty_alert','entity_id') != none %}
          {%- set calendars = state_attr('binary_sensor.calendar_empty_alert','entity_id') %}
          {%- for item in calendars %}
            {%- if not loop.first %}<br>{% endif %}
            The {{ item }} calendar is empty or not connected.
          {%- endfor %}
        {%- endif -%}
      {% endif %}
  trigger:
    - platform: state
      entity_id:
        - alert.calendar_empty
      to: "on"
      not_from:
        - unknown
        - unavailable
  action:
    - service: persistent_notification.create
      data:
        title: "{{ title }}"
        message: "{{ message }}"
        notification_id: "{{ trigger.entity_id.split('.')[1] }}"
