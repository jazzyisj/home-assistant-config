#######################################################################################################################
## Climate - Occupancy Mode Control
#######################################################################################################################
- id: climate_occupancy_mode_control #OCC
  alias: '[Climate] Occupancy Mode Control'
  description: 'Set climate modes according to occupancy mode.'
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: input_select.occupancy_mode
      to:
        - Home
        - Night
        - Guest
        - Away
        - Vacation
      for:
        seconds: 5 # prevent trigger on quick changes in state (eg guest-> home-> guest)

    - platform: state
      entity_id: input_boolean.hvac_presence_override
      to: 'on'

  condition:
    - condition: state
      entity_id:
        - input_boolean.climate_automation
        - input_boolean.climate_occupancy_control
      state: 'on'

    - condition: not
      conditions:
        - condition: state
          entity_id: alert.hvac_window_door_open
          state: 'on'
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_select.occupancy_mode
              state:
                - Home
                - Guest

            - condition: state
              entity_id: input_boolean.hvac_presence_override
              state: 'on'
          sequence:
            - service: input_boolean.turn_off
              entity_id: input_boolean.hvac_presence_override

    - service: script.set_thermostat_temperature
