#######################################################################################################################
## Zwave - LED notification
#######################################################################################################################
- id: zwave_led_notification
  alias: "[Zwave] LED Notification"
  description: "Display LED notification for alarm state."
  initial_state: true
  mode: queued
  max: 10
  trigger:
    # house alarm triggers
    - platform: state
      entity_id: alarm_control_panel.house

    # presence alert triggers
    - platform: state
      entity_id:
        - binary_sensor.jason_home
        - binary_sensor.sheri_home
        - input_boolean.guest_home
      to: 'on'

    - platform: numeric_state
      entity_id:
        - proximity.jhome
        - proximity.shome
      below: 4 # km #TEST

    # weather alert triggers
    - platform: state
      entity_id: binary_sensor.weather_alert_active_led
      to: 'on'

    # garage alert triggers
    - platform: state
      entity_id: binary_sensor.garage_door_open

  condition:
    # jason_home / sheri_home, garage door always off as startup
    - condition: state
      entity_id: binary_sensor.startup_complete
      state: 'on'

    # if proximity trigger only run when person heading towards home
    - condition: template
      value_template: >
        {{ state_attr(trigger.entity_id,'dir_of_travel') == 'towards' if trigger.entity_id in ['proximity.jhome','proximity.shome'] else true }}

  action:
    - service: script.zwave_led_notification
      data:
        trigger: "{{ trigger.entity_id }}"