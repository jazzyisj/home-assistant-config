###############################################################################
## Spotify Sheri - Playlist Selection Update
###############################################################################
- id: spotify_sheri_playlist_selection_update
  alias: '[Spotify] Sheri Playlist Selection Update'
  description: 'Update playlist selection when changed in media player.'
  mode: restart
  variables:
    playlist: "{{ state_attr(trigger.entity_id,'media_playlist') }}"
  trigger:
    - platform: state
      entity_id: media_player.spotify_sheri
      attribute: media_playlist
  condition:
    - condition: template
      alias: 'Valid playlist'
      value_template: "{{ playlist in state_attr('select.spotify_sheri_playlist','options') }}"

    - condition: template
      alias: 'Playlist is not a category'
      value_template: "{{ playlist not in state_attr('sensor.spotify_categories','categories') }}"
  action:
    - service: automation.turn_off
      target:
        entity_id: automation.media_auto_resume # triggered by select.spotify_sheri_playlist
      data:
        stop_actions: false

    - service: select.select_option
      target:
        entity_id: select.spotify_sheri_playlist
      data:
        option: '{{ playlist }}'

    - service: automation.turn_on
      target:
        entity_id: automation.media_auto_resume
