###############################################################################
## Spotify Jason - Playlist Selection Update
###############################################################################
- id: spotify_jason_playlist_selection_update
  alias: '[Spotify] Jason Playlist Selection Update'
  description: 'Update playlist selection when changed in media player.'
  mode: restart
  variables:
    playlist: "{{ state_attr(trigger.entity_id,'media_playlist') }}"
  trigger:
    - platform: state
      entity_id: media_player.spotify_jazzyisj
      attribute: media_playlist
  condition:
    - condition: template
      alias: ''
      value_template: "{{ playlist in state_attr('select.spotify_jason_playlist','options') }}"

    - condition: template
      alias: 'Playlist is not a category'
      value_template: "{{ playlist not in state_attr('sensor.spotify_categories','categories') }}"
  action:
    - service: automation.turn_off
      target:
        entity_id: automation.media_auto_resume # triggered by select.spotify_jason_playlist
      data:
        stop_actions: false

    - service: select.select_option
      target:
        entity_id: select.spotify_jason_playlist
      data:
        option: '{{ playlist }}'

    - service: automation.turn_on
      target:
        entity_id: automation.media_auto_resume
