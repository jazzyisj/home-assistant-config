###############################################################################
## Alarm Clock - Off
###############################################################################
- id: alarm_clock_off
  alias: '[Alarm Clock] Off'
  description: 'Turn off alarm clock.'
  max_exceeded: silent
  trigger:
    - platform: event
      event_type: timer.cancelled
      event_data:
        entity_id: timer.alarm_clock_nap

    - platform: event
      event_type: timer.cancelled
      event_data:
        entity_id: timer.alarm_clock_snooze

    - platform: event
      id: action
      event_type: mobile_app_notification_action
      event_data:
        action: turn_off_alarm_clock

    - platform: event
      id: action
      event_type: mobile_app_notification_action
      event_data:
        action: alarm_clock_failed_reset
  condition:
    - condition: template
      alias: 'Mobile notification action or play/stop is not running'
      value_template: >
        {{ trigger.id == 'action' or (is_state('script.alarm_clock_play','off')
            and is_state('script.alarm_clock_stop','off')) }}

    - condition: state
      entity_id: binary_sensor.alarm_clock
      state: 'on'
  action:
    - service: script.turn_on
      target:
        entity_id: script.alarm_clock_stop
      data:
        variables:
          alarm_type: "{{ state_attr('binary_sensor.alarm_clock','alarm_type') }}"
