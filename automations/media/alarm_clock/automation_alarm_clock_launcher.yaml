#######################################################################################################################
## Alarm Clock Launcher Control
#NOTE if open on more than one browser open booleans will affect card in all browsers
#######################################################################################################################
- id: alarm_clock_launcher_control
  alias: "[Alarm Clock] Launcher Control"
  description: "Control alarm clock launcher display."
  mode: restart
  variables:
    launchers: >
      {{ ['input_boolean.alarm_clock_launcher_auto','input_boolean.alarm_clock_launcher_manual',
            'input_boolean.alarm_clock_launcher_nap','input_boolean.alarm_clock_launcher_other'] }}
    preset: "{% if trigger.id == 'preset' %}{{ trigger.entity_id[20:] }}{% endif %}"
  trigger:
    - platform: state
      id: launcher
      entity_id:
        - input_boolean.alarm_clock_launcher_auto
        - input_boolean.alarm_clock_launcher_manual
        - input_boolean.alarm_clock_launcher_nap
        - input_boolean.alarm_clock_launcher_other
  action:
    - service: automation.turn_off
      target:
        entity_id: "{{ this.entity_id }}"
      data:
        stop_actions: false

    - choose:
        - conditions: "{{ trigger.id == 'launcher' }}"
          sequence:
            - service: input_boolean.turn_off
              target:
                entity_id: "{{ expand(launchers)|rejectattr('entity_id','eq',trigger.entity_id)|map(attribute='entity_id')|list }}"

        - conditions: "{{ trigger.id == 'media' }}"
          sequence:
            - service: input_boolean.turn_off
              target:
                entity_id: >
                  {{ expand(launchers)|rejectattr('entity_id','eq',trigger.entity_id[29:])
                  |map(attribute='entity_id')|list }}

    - service: automation.turn_on
      target:
        entity_id: "{{ this.entity_id }}"

    - delay: 90

    - service: automation.turn_off
      target:
        entity_id: "{{ this.entity_id }}"
      data:
        stop_actions: false

    - service: input_boolean.turn_off
      target:
        entity_id: "{{ expand(launchers)|map(attribute='entity_id')|list }}"

    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.alarm_clock_show_card

    - service: input_select.select_option
      target:
        entity_id: input_select.alarm_clock_selection
      data:
        option: Jason Phone # set back to deafult

    - service: automation.turn_on
      target:
        entity_id: "{{ this.entity_id }}"
