###############################################################################
## Media Player - Volume Reset
###############################################################################
- id: media_player_volume_reset
  alias: "[Media Player] Volume Reset"
  description: "Reset media player volumes when home mode or quiet time change."
  mode: queued
  trigger:
    - platform: state
      id: quiet
      entity_id: binary_sensor.quiet_time
      to:
        - "on"
        - "off"
      not_from:
        - unknown
        - unavailable

    - platform: template
      id: mass
      value_template: >
        {{ is_state('binary_sensor.mass_media', 'off')
            and is_state('input_boolean.tts', 'off') }}
      for: 15

    # reset volumes at day_reset, force reset to unmute players
    - platform: time
      id: time
      at: input_datetime.day_reset
  action:
    - service: script.media_player_reset_volumes
      data:
        force_reset: "{{ trigger.id == 'time' }}"
