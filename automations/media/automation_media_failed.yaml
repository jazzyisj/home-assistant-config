#######################################################################################################################
## Media Failed
#######################################################################################################################
- id: media_failed
  alias: "[Media] Failed"
  description: "Stop failed media, play TTS announcement."
  mode: parallel # more than one media type can fail
  variables:
    media_type: "{{ trigger.entity_id[14:-7] if trigger.id == 'failed' else trigger.id }}"
  trigger:
    - platform: state
      id: failed
      entity_id:
          - input_boolean.radio_failed
          - input_boolean.spotify_failed
          - input_boolean.spotify_jason_failed
          - input_boolean.spotify_sheri_failed
          - input_boolean.youtube_failed
      to: 'on'
  action:
    - service: script.media_stop
      data:
        media_type: "{{ media_type }}"

    - service: script.tts_play
      data:
        message: "Attention! The {{ media_type|replace('_',' ')|title }} media player has failed to play!"
        min_volume: 30

#######################################################################################################################
## Media Player - Media Failed Reset
#######################################################################################################################
- id: media_failed_reset
  alias: "[Media] Failed Reset"
  description: "Reset media failed."
  mode: parallel
  variables:
    media_type: >
      {% if trigger.id in ['radio','spotify','spotify_jason','spotify_sheri','youtube'] %}
        {{ trigger.event.data['action'][0:-13] }}
      {% else %}
        {{ trigger.entity_id[14:-7] }}
      {% endif %}
  trigger:
    - platform: event
      id: radio
      event_type: mobile_app_notification_action
      event_data:
        action: radio_failed_reset

    - platform: event
      id: spotify
      event_type: mobile_app_notification_action
      event_data:
        action: spotify_failed_reset

    - platform: event
      id: spotify_jason
      event_type: mobile_app_notification_action
      event_data:
        action: spotify_jason_failed_reset

    - platform: event
      id: spotify_sheri
      event_type: mobile_app_notification_action
      event_data:
        action: spotify_sheri_failed_reset

    - platform: event
      id: youtube
      event_type: mobile_app_notification_action
      event_data:
        action: youtube_failed_reset

    - platform: state
      id: boolean
      entity_id:
        - input_boolean.radio_failed
        - input_boolean.spotify_failed
        - input_boolean.spotify_jason_failed
        - input_boolean.spotify_sheri_failed
        - input_boolean.youtube_failed
      to: 'on'
      for:
        hours: 1
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: "input_boolean.{{ media_type }}_failed"
