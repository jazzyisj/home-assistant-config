###############################################################################
# Bedroom Chromecast On
###############################################################################
- id: media_bedroom_chromecast_on
  alias: '[Media] Bedroom Chromecast On'
  description: 'Turn TV on, select chromecast input.'
  trigger:
    - platform: state
      entity_id: media_player.bedroom_chromecast
      to:
        - 'idle'
        - 'playing'
      from:
        - 'off'
        - 'idle'

    - platform: state
      entity_id: media_player.bedroom_chromecast
      to: 'playing'
      from: 'paused'
  condition:
    - condition: state
      entity_id: input_boolean.media_player_automation
      state: 'on'

    - condition: not
      conditions:
        - condition: state
          entity_id: media_player.bedroom_tv
          state: 'on'

        - condition: state
          entity_id: media_player.bedroom_tv
          attribute: source
          state: HDMI 2
  action:
    - choose:
        - conditions:
            - condition: not
              conditions:
                - condition: state
                  entity_id: media_player.bedroom_tv
                  state: 'on'
          sequence:
            - service: media_player.turn_on
              target:
                entity_id: media_player.bedroom_tv

    - wait_template: "{{ is_state('media_player.bedroom_tv','on') }}"
      timeout: 30
      continue_on_timeout: false

    - delay: 1 # allow source to populate?  gets skipped sometimes w/o delay

    - choose:
        - conditions:
            - condition: not
              conditions:
                - condition: state
                  entity_id: media_player.bedroom_tv
                  attribute: source
                  state: HDMI 2
          sequence:
            - service: media_player.select_source
              target:
                entity_id: media_player.bedroom_tv
              data:
                source: HDMI 2 # chromecast

###############################################################################
# Bedroom Chromecast Off
#ISSUE source doesn't change when changed on TV
###############################################################################
# - id: media_bedroom_chromecast_off
#   alias: '[Media] Bedroom Chromecast Off'
#   description: 'Turn off TV if still on Chromecast input.'
#   trigger:
#     - platform: state
#       entity_id: media_player.bedroom_chromecast
#       to: 'off'
#   condition:
#     - condition: state
#       entity_id: media_player.bedroom_tv
#       attribute: source
#       state: HDMI 2
#   action:
#     - service: media_player.turn_off
#       target:
#         entity_id: media_player.bedroom_tv
