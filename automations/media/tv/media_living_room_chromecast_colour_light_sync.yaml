###############################################################################
## Media - Living Room Chromecast Light Color Sync
###############################################################################
- id: media_living_room_chromecast_light_color_sync
  alias: "[Media] Living Room Chromecast Light Color Sync"
  description: "Sync RGB Light to media player picture entity color."
  mode: queued
  trigger:
    - platform: state
      id: player
      entity_id:
        - media_player.living_room_chromecast
        - media_player.living_room_tv
      attribute: entity_picture

    - platform: state
      id: light
      entity_id: light.dining_room_light_rgb #TEMP until TV, living room LEDs
      to: "on"
  condition:
    - condition: state
      entity_id:
        - input_boolean.media_color_light_sync
        - light.dining_room_light_rgb
      state: "on"

    - condition: template
      value_template: "{{ state_attr(trigger.entity_id, 'entity_picture') != none }}"

    - condition: template
      value_template: >
        {{ iif(is_state('input_boolean.tts', 'on'), 'media_player.dining_room_hub'
            not in state_attr('sensor.tts_media_player', 'entity_id'), true) }}
  action:
    - service: color_extractor.turn_on
      target:
        entity_id: light.dining_room_light_rgb
      data:
        color_extract_url: >
          {{ state_attr('media_player.living_room_' ~
              iif(is_state('media_player.living_room_chromecast','off'),'tv','chromecast'),'entity_picture') }}
        brightness_pct: 80
        transition: 5
