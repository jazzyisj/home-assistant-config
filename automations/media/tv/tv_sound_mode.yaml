###################################################################################################
## TV Sound Mode
## modes - aiSoundPlus, standard, movie, news, sports, music, game
###################################################################################################
- id: tv_sound_mode
  alias: "TV Sound Mode"
  description: "Set TV sound mode."
  mode: parallel
  variables:
    mode: >
      {% if state_attr(trigger.entity_id, 'source') in ['HDMI 2', 'Spotify - Music and Podcasts'] %} music
      {% else %} aiSoundPlus
      {% endif %}
  triggers:
    - trigger: state
      entity_id:
        - media_player.bedroom_tv
        - media_player.deck_tv
        - media_player.living_room_tv
      attribute: source
      to: ~
  conditions:
    - condition: template
      alias: "TV is not off or unavailable"
      value_template: "{{ states(trigger.entity_id) not in ['off', 'unknown', 'unavailable'] }}"
  actions:
    - action: script.tv_sound_mode
      data:
        entity_id: "{{ trigger.entity_id }}"
        sound_mode: "{{ mode }}"
