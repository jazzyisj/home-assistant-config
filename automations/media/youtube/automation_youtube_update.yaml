###############################################################################
## Youtube - Playlist Selection Update
###############################################################################
- id: youtube_playlist_selection_update
  alias: '[Youtube] Playlist Selection Update'
  description: 'Update youtube playlist input selection.'
  mode: restart
  variables:
    playlist: "{{ state_attr('media_player.youtube','current_playlist_title') }}"
  trigger:
    - platform: state
      entity_id: media_player.youtube
      attribute: current_playlist_title
  condition:
    - condition: template
      alias: 'Valid playlist'
      value_template: "{{ playlist in state_attr('input_select.youtube_player_playlist','options') }}"

    - condition: template
      alias: 'Alarm clock media player is not youtube media player'
      value_template: >
        {% if is_state('binary_sensor.alarm_clock','on') %}
          {{ states('select.alarm_clock_sound_manual') != 'Youtube' }}
        {% else %} true
        {% endif %}
  action:
    - service: automation.turn_off
      target:
        entity_id: automation.media_auto_resume
      data:
        stop_actions: false

    - service: input_select.select_option
      target:
        entity_id: input_select.youtube_player_playlist
      data:
        option: '{{ playlist }}'

    - service: automation.turn_on
      target:
        entity_id: automation.media_auto_resume

###############################################################################
## Youtube - Store Playlist Selection
###############################################################################
- id: youtube_store_playlist_selection
  alias: '[Youtube] Store Playlist Selection'
  description: 'Store current youtube playlist selection.'
  mode: restart
  trigger:
    - platform: state
      entity_id: input_select.youtube_player_playlist
      to: ~

    - platform: state
      entity_id: input_boolean.startup_pending
      to: 'off'
      for: 5 # allow selection lists to update
  condition: "{{ states('input_select.youtube_player_playlist') not in ['loading','unknown','unavailable'] }}"
  action:
    - service: input_text.set_value
      target:
        entity_id: input_text.youtube_player_playlist
      data:
        value: "{{ states('input_select.youtube_player_playlist') }}"

###############################################################################
## Youtube - Store Media Player Selection
###############################################################################
- id: youtube_store_media_player_selection
  alias: '[Youtube] Store Media Player Selection'
  description: 'Store current youtube media player selection.'
  mode: restart
  trigger:
    - platform: state
      entity_id: input_select.youtube_player_speaker
      to: ~

    - platform: state
      entity_id: input_boolean.startup_pending
      to: 'off'
      for: 5 # allow selection lists top update
  condition: "{{ states('input_select.youtube_player_speaker') not in ['loading','unknown','unavailable'] }}"
  action:
    - service: input_text.set_value
      target:
        entity_id: input_text.youtube_media_player
      data:
        value: "{{ states('input_select.youtube_player_speaker') }}"

###############################################################################
## Youtube - Update Selection Lists
###############################################################################
- id: youtube_update_selection_lists
  alias: '[Youtube] Update Selection Lists'
  description: 'Update youtube playlist/media player selections.'
  mode: restart
  trigger:
    - platform: state
      entity_id: input_boolean.startup_pending
      to: 'off'
  action:
    - service: button.press
      target:
        entity_id: button.update_youtube_lists
