###############################################################################
## Youtube - Playlist Selection Update
###############################################################################
- id: youtube_playlist_selection_update
  alias: '[Youtube] Playlist Selection Update'
  description: 'Update youtube playlist input selection.'
  mode: restart
  variables:
    entity: "{{ 'select.youtube_playlist' }}"
    playlist: "{{ state_attr(trigger.entity_id,'media_playlist') }}"
  trigger:
    - platform: state
      entity_id: media_player.youtube_hassio
      attribute: media_playlist
  condition:
    - condition: template
      alias: 'Valid playlist'
      value_template: "{{ playlist in state_attr(entity,'options') }}"

    - condition: template
      alias: 'Alarm clock media player is not youtube media player'
      value_template: >
        {% if is_state('binary_sensor.alarm_clock','off') %}
          {% set atype = state_attr('binary_sensor.alarm_clock','alarm_type') %}
          {{ states('select.alarm_clock_sound_manual') != 'Youtube' }}
        {% else %} true
        {% endif %}
  action:
    - service: automation.turn_off
      target:
        entity_id: automation.media_auto_resume # triggered by select.youtube_playlist
      data:
        stop_actions: false

    - service: select.select_option
      target:
        entity_id: '{{ entity }}'
      data:
        option: '{{ playlist }}'

    - service: automation.turn_on
      target:
        entity_id: automation.media_auto_resume
