###############################################################################
## Shelly - OTA Update Error
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update available for device Indoor Sump
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update on beta channel available for device Indoor Sump
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update available for device Garage Furnace
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update on beta channel available for device Garage Furnace
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update available for device House Energy Monitor
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update on beta channel available for device House Energy Monitor
#INFO Start OTA update of device Hot Tub Energy Monitor  from '20210429-104036/v1.10.4-2-g9a159c1fb-release-1.10' to '20220209-094734/v1.11.8-g8c7bb8d'
#VERIFY message when OTA update done
###############################################################################
- id: sensor_ota_update_error
  alias: "[Sensor] Shelly OTA Update Error"
  description: "Notify on Shelly OTA update error."
  mode: queued
  variables:
    msg: "{{ trigger.event.data.message[0] }}"
    shelly_error: >
      {{ 'No OTA update available for device' in msg
          or 'No OTA update on beta channel available for device' in msg
          or 'Start OTA update of device' in msg }}
  trigger:
    - platform: event
      event_type: system_log_event
      event_data:
        level: WARNING
  condition: "{{ shelly_error }}"
  action:
    - service: browser_mod.toast
      data:
        duration: 30000
        message: "{{ msg }}"

    - service: persistent_notification.create
      data:
        title: "Shelly OTA Firmware"
        message: "{{ msg }}"
