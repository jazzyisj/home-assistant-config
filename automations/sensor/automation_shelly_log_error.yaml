###############################################################################
## Shelly - OTA Update Error
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update available for device Indoor Sump
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update on beta channel available for device Indoor Sump
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update available for device Garage Furnace
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update on beta channel available for device Garage Furnace
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update available for device House Energy Monitor
#WARNING (MainThread) [homeassistant.components.shelly] No OTA update on beta channel available for device House Energy Monitor

#TODO message when OTA update done

###############################################################################
- id: sensor_ota_update_error
  alias: '[Sensor] Shelly OTA Update Error'
  description: 'Notify on Shelly OTA update error.'
  mode: queued
  variables:
    msg: '{{ trigger.event.data.message[0] }}'
    shelly_error: >
      {{ 'No OTA update available for device' in msg
          or 'No OTA update on beta channel available for device' in msg }}
  trigger:
    - platform: event
      event_type: system_log_event
      event_data:
        level: WARNING
  condition: '{{ shelly_error }}'
  action:
    - service: browser_mod.toast
      data:
        duration: 30000
        message: '{{ msg }}'

    - service: persistent_notification.create
      data:
        title: 'Shelly OTA Warning'
        message: '{{ msg }}'
