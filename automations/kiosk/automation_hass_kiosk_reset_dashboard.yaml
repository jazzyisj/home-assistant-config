###############################################################################
## Hass - Kiosk Reset Dashboard
###############################################################################
- id: hass_kiosk_reset_dashboard
  alias: "[Hass] Kiosk Reset Dashboard"
  description: "Reset dashboard to home page."
  mode: restart
  trigger:
    - platform: state
      id: page
      entity_id: sensor.fire_tablet_current_page
      to: ~
      for: 300

    - platform: state
      id: app
      entity_id: sensor.fire_tablet_foreground_app
      to: ~
      for: 300
  condition:
    - condition: state
      entity_id: binary_sensor.kiosk_online
      state: "on"

    - not:
        - condition: state
          entity_id: sensor.fire_tablet_current_page
          state: http://192.168.1.100:8123/ui-kiosk/home
  action:
    - wait_template: >
        {{ is_state('binary_sensor.kiosk_internal','off')
            and is_state('input_boolean.alarm_triggered','off') }}
      timeout: 900

    - if: "{{ trigger.id == 'page' }}"
      then:
        - if: "{{ states('sensor.fire_tablet_current_page')[:26] == 'http://192.168.1.100:8123/' }}"
          then:
            - service: browser_mod.navigate
              data:
                path: /lovelace-kiosk/home
                browser_id: kiosk_internal
          else:
            - service: button.press
              target:
                entity_id: button.fire_tablet_load_start_url

      else:
        - service: button.press
          target:
            entity_id: button.fire_tablet_restart_browser
