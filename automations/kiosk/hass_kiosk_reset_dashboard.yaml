###############################################################################
## Hass - Kiosk Reset Dashboard
###############################################################################
- id: hass_kiosk_reset_dashboard
  alias: "[Hass] Kiosk Reset Dashboard"
  description: "Reset dashboard to home page."
  mode: queued
  trigger:
    - platform: state
      id: page
      entity_id: sensor.kiosk_tablet_current_page
      from: http://homeassistant.local:8123/ui-kiosk/home
      for: 300

    - platform: state
      id: app
      entity_id: sensor.kiosk_tablet_foreground_app
      from: de.ozerov.fully
      for: 300
  condition:
    - condition: state
      entity_id: binary_sensor.fully_kiosk_connected
      state: "on"
  action:
    - wait_template: >
        {{ is_state('binary_sensor.kiosk_motion', 'off')
            and is_state('input_boolean.alarm_triggered', 'off') }}
      timeout: 600

    - if: "{{ states('sensor.kiosk_tablet_foreground_app') != 'de.ozerov.fully' }}"
      then:
        - service: button.press
          target:
            entity_id: button.kiosk_tablet_bring_to_foreground

    - if: "{{ states('sensor.kiosk_tablet_current_page')[:31] == 'http://homeassistant.local:8123' }}"
      then:
        - service: browser_mod.navigate
          data:
            path: /ui-kiosk/home
            browser_id: kiosk
