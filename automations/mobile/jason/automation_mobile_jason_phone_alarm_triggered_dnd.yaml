###############################################################################
## Mobile - Jason Phone Alarm Triggered DND
###############################################################################
- id: mobile_jason_phone_alarm_triggered_dnd
  alias: '[Mobile] Jason Phone Alarm Triggered DND'
  description: 'Set DND and alarm volume when alarm triggered.'
  trigger:
    - platform: state
      entity_id: input_boolean.alarm_triggered
      to: ~
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_boolean.alarm_triggered
              state: 'on'
          sequence:
            - service: notify.mobile_app_jphone
              data:
                message: command_dnd
                title: 'off'

            - service: notify.mobile_app_jphone
              data:
                message: command_volume_level
                title: 7
                data:
                  channel: alarm_stream # volume 0 - 7
      default:
        - service: notify.mobile_app_jphone
          data:
            message: command_volume_level
            title: "{{ states('input_number.mobile_waketime_volume_jason')|int(7) }}"
            data:
              channel: alarm_stream

        - choose:
            - conditions:
                - condition: state
                  entity_id: input_select.occupancy_mode
                  state: Night
              sequence:
                - service: notify.mobile_app_jphone
                  data:
                    message: command_dnd
                    title: priority_only
