###############################################################################
## Mobile - Quiet Time Jason
###############################################################################
- id: mobile_quiet_time_jason
  alias: '[Mobile] Quiet Time Jason'
  description: 'Adjust mobile volumes durning quiet times.'
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: binary_sensor.quiet_time #RELOAD triggers on template reload
      to: ~
  condition:
    - condition: state
      entity_id: binary_sensor.jason_home
      state: 'on'

    - condition: template
      alias: 'To/from state not unknown/unavailable' # prevent trigger on template reload
      value_template: >
        {{ trigger.to_state.state not in ['unknown','unavailable']
            and trigger.from_state.state not in ['unknown','unavailable'] }}
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.quiet_time
              state: 'on'
          sequence:
            - service: notify.mobile_app_jphone
              data:
                message: command_volume_level
                title: 8
                data:
                  channel: music_stream # volume 0 - 25

            - service: notify.mobile_app_jphone
              data:
                message: command_volume_level
                title: 2
                data:
                  channel: notification_stream # volume 0 - 7
      default:
        - service: notify.mobile_app_jphone
          data:
            message: command_volume_level
            title: 15
            data:
              channel: music_stream

        - service: notify.mobile_app_jphone
          data:
            message: command_volume_level
            title: 5
            data:
              channel: notification_stream
