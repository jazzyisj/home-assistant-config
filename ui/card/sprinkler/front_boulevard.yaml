###############################################################################
## Sprinkler - Front Boulevard
###############################################################################
type: custom:mushroom-template-card
entity: valve.front_boulevard_manual_watering
picture: /local/images/background/sprinkler/back_garden_left.png #IMAGE
badge_icon: >
  {% set next = states('sensor.front_boulevard_next_cycle') %}
  {% if is_state('binary_sensor.front_boulevard_watering', 'on') %} mdi:water
  {% elif next != 'unknown' and next | as_datetime - now() > timedelta(days=8) %} mdi:water-off
  {% else %} mdi:autorenew
  {% endif %}
badge_color: >
  {% set next = states('sensor.front_boulevard_next_cycle') %}
  {% if is_state('binary_sensor.front_boulevard_watering', 'on') %} blue
  {% elif next != 'unknown' and next | as_datetime - now() > timedelta(days=8) %} orange
  {% else %} green
  {% endif %}
primary: "Front Boulevard"
layout: horizontal
fill_container: false
secondary: |
  {%- from 'speech.jinja' import plural_qty %}
  {%- set next = states('sensor.front_boulevard_next_cycle') -%}
  {%- set mins = states('sensor.front_boulevard_watering_time') | int(-1) -%}
  {%- if mins > 0 %}{{ plural_qty('MINUTE', mins, false) }} REMAINING
  {%- elif next != 'unknown' and next | as_datetime - now() > timedelta(days=8) -%} SUSPENDED
  {%- else %}{{ states('sensor.front_boulevard_next_cycle') | as_timestamp | timestamp_custom('%A - %B %d, %Y at %-I:%M %p', true, 'unknown') }}
  {%- endif -%}
multiline_secondary: true
tap_action:
  action: fire-dom-event
  browser_mod:
    service: browser_mod.popup
    data:
      content: !include /config/ui/card/sprinkler/front_boulevard_detail.yaml
      timeout: 100000
      card_mod:
        style:
          ha-dialog$: |
            div.mdc-dialog__scrim {
              backdrop-filter: grayscale(100%) brightness(25%) !important;
              -webkit-backdrop-filter: grayscale(100%) brightness(25%) !important;
            }
            div.mdc-dialog div.mdc-dialog__container div.mdc-dialog__surface {
              background: transparent !important;
            }
double_tap_action:
  action: valve.close_valve
  data:
    entity_id: valve.front_boulevard_manual_watering
hold_action:
  action: toggle
card_mod:
  style: |
    ha-card {
      background:
        {% set next = states('sensor.front_boulevard_next_cycle') %}
        {% if is_state('binary_sensor.front_boulevard_watering', 'on') %} var(--entity-button-active-color)
        {% elif next != 'unknown' and next | as_datetime - now() > timedelta(days=8) %} var(--secondary-background-color)
        {% else %} var(--ha-card-background)
        {% endif %}
      ;
    }
