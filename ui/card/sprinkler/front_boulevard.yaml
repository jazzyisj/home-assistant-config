###############################################################################
## Sprinkler - Front Boulevard
###############################################################################
type: custom:mushroom-template-card
entity: switch.front_boulevard_manual_watering
picture: /local/images/background/sprinkler/back_garden_left.png #IMAGE
badge_icon: >
  {% set next = states('sensor.front_boulevard_next_cycle') %}
  {% if is_state('binary_sensor.front_boulevard_watering', 'on') %} mdi:water
  {% elif next != 'unknown' and next|as_datetime - now() > timedelta(days=8) %} mdi:water-off
  {% else %} mdi:autorenew
  {% endif %}
badge_color: >
  {% set next = states('sensor.front_boulevard_next_cycle') %}
  {% if is_state('binary_sensor.front_boulevard_watering', 'on') %} blue
  {% elif next != 'unknown' and next|as_datetime - now() > timedelta(days=8) %} orange
  {% else %} green
  {% endif %}
primary: "Front Boulevard"
layout: horizontal
fill_container: false
secondary: |
  {%- set next = states('sensor.front_boulevard_next_cycle') -%}
  {%- set mins = states('sensor.front_boulevard_watering_time')|int(-1) -%}
  {%- if mins > 0 %}{{ mins }} MINUTE{{ iif(mins == 1, '', 'S') }} REMAINING
  {%- elif next != 'unknown' and next|as_datetime - now() > timedelta(days=8) -%} SUSPENDED
  {%- else %}{{ states('sensor.front_boulevard_next_cycle')|as_timestamp|timestamp_custom('%A - %B %d, %Y at %-I:%M %p', true, 'unknown') }}
  {%- endif -%}
multiline_secondary: true
tap_action:
  action: fire-dom-event
  browser_mod:
    service: browser_mod.popup
    data:
      content: !include /config/ui/card/sprinkler/front_boulevard_detail.yaml
      timeout: 100000
double_tap_action:
  action: switch.turn_off
  data:
    entity_id: switch.front_boulevard_manual_watering
hold_action:
  action: toggle
card_mod:
  style: |
    ha-card {
      background:
        {% set next = states('sensor.front_boulevard_next_cycle') %}
        {% if is_state('binary_sensor.front_boulevard_watering', 'on') %} var(--entity-button-active-color)
        {% elif next != 'unknown' and next|as_datetime - now() > timedelta(days=8) %} var(--secondary-background-color)
        {% else %} var(--ha-card-background)
        {% endif %}
      ;
    }
