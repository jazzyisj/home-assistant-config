###############################################################################
## Server Monitor
###############################################################################
type: entities
title: "Server Monitor"
icon: mdi:server
state_color: true
show_header_toggle: false
entities:
  - entity: sensor.last_boot

  - entity: sensor.local_ip
    name: "IPV4"
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% if states('sensor.local_ip') != 'unknown' %} var(--state-icon-color)
            {% else %} var(--entity-severe-color)
            {% endif %}
          ;
        }

  - type: custom:bar-card
    name: "Processor Temp"
    entity: sensor.cpu_temperature
    entity_row: true
    icon: mdi:thermometer
    positions:
      icon: outside
      name: outside
      indicator: inside
      value: outside
    direction: right
    height: 15px
    width: 60%
    decimal: 0
    min: 0
    max: 100
    severity: !include /config/ui/bar/include/processor_temp_bar_color.yaml
    card_mod:
      class: bar_sub_card
      style: |
        :host {
          --paper-item-icon-color:
            {% set status = states('sensor.cpu_temp_status') %}
            {% if status == 'critical' %} var(--entity-critical-color)
            {% elif status == 'severe' %} var(--entity-severe-color)
            {% elif status == 'warning' %} var(--entity-warning-color)
            {% elif status == 'minor' %} var(--entity-minor-color)
            {% else %} var(--state-icon-color)
            {% endif %}
          ;
        }

  - type: custom:fold-entity-row
    padding: 5
    head:
      type: custom:bar-card
      name: "Processor Use"
      entity: sensor.processor_use_percent
      entity_row: true
      icon: mdi:cpu-32-bit
      positions:
        icon: outside
        name: outside
        indicator: inside
        value: outside
      direction: right
      height: 15px
      width: 56%
      decimal: 0
      min: 0
      max: 100
      severity: !include /config/ui/bar/include/processor_use_bar_color.yaml
      card_mod:
        class: bar_sub_card
        style: |
          :host {
            --paper-item-icon-color:
              {% set status = states('sensor.processor_use_status') %}
              {% if status == 'critical' %} var(--entity-critical-color)
              {% elif status == 'severe' %} var(--entity-severe-color)
              {% elif status == 'warning' %} var(--entity-warning-color)
              {% elif status == 'minor' %} var(--entity-minor-color)
              {% else %} var(--state-icon-color)
              {% endif %}
            ;
          }
    entities:
      - entity: sensor.load_1m
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {% set load = states('sensor.load_1m')|float(-1) %}
                {% if load > 3 %} var(--entity-critical-color)
                {% elif load > 2 %} var(--entity-severe-color)
                {% elif load > 1.5 %} var(--entity-warning-color)
                {% elif load > 1 %} var(--entity-minor-color)
                {% else %} var(--state-icon-color)
                {% endif %}
              ;
            }

      - entity: sensor.load_5m
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {% set load = states('sensor.load_5m')|float(-1) %}
                {% if load > 3 %} var(--entity-critical-color)
                {% elif load > 2 %} var(--entity-severe-color)
                {% elif load > 1.5 %} var(--entity-warning-color)
                {% elif load > 1 %} var(--entity-minor-color)
                {% else %} var(--state-icon-color)
                {% endif %}
              ;
            }

      - entity: sensor.load_15m
        card_mod:
          style: |
            :host {
              --paper-item-icon-color:
                {% set load = states('sensor.load_15m')|float(-1) %}
                {% if load > 3 %} var(--entity-critical-color)
                {% elif load > 2 %} var(--entity-severe-color)
                {% elif load > 1.5 %} var(--entity-warning-color)
                {% elif load > 1 %} var(--entity-minor-color)
                {% else %} var(--state-icon-color)
                {% endif %}
              ;
            }

  - type: custom:bar-card
    name: "Memory Use"
    entity: sensor.memory_use_percent
    entity_row: true
    icon: mdi:thermometer
    positions:
      icon: outside
      name: outside
      indicator: inside
      value: outside
    direction: right
    height: 15px
    width: 60%
    decimal: 0
    min: 0
    max: 100
    severity: !include /config/ui/bar/include/memory_use_bar_color.yaml
    card_mod:
      class: bar_sub_card
      style: |
        :host {
          --paper-item-icon-color:
            {% set status = states('sensor.memory_use_status') %}
            {% if status == 'critical' %} var(--entity-critical-color)
            {% elif status == 'severe' %} var(--entity-severe-color)
            {% elif status == 'warning' %} var(--entity-warning-color)
            {% elif status == 'minor' %} var(--entity-minor-color)
            {% else %} var(--state-icon-color)
            {% endif %}
          ;
        }

  - type: custom:bar-card
    name: "Swap Use"
    entity: sensor.swap_use_percent
    entity_row: true
    icon: mdi:thermometer
    positions:
      icon: outside
      name: outside
      indicator: inside
      value: outside
    direction: right
    height: 15px
    width: 60%
    decimal: 0
    min: 0
    max: 100
    severity: !include /config/ui/bar/include/memory_use_bar_color.yaml
    card_mod:
      class: bar_sub_card
      style: |
        :host {
          --paper-item-icon-color:
            {% set status = states('sensor.memory_use_status') %}
            {% if status == 'critical' %} var(--entity-critical-color)
            {% elif status == 'severe' %} var(--entity-severe-color)
            {% elif status == 'warning' %} var(--entity-warning-color)
            {% elif status == 'minor' %} var(--entity-minor-color)
            {% else %} var(--state-icon-color)
            {% endif %}
          ;
        }

  #IDEA this is actually hass disk use (/home) should have server based total disk use sensor?
  - !include /config/ui/card/include/disk_use_entity.yaml

  - type: custom:auto-entities
    filter:
      template: "{{ states.alert|selectattr('attributes.category','eq','system')|map(attribute='entity_id')|list }}"
    sort:
      method: name
      ignore_case: true
    card:
      type: custom:fold-entity-row
      padding: 5
      head:
        entity: input_boolean.system_alerts
        card_mod:
          style: |
            :host {
              --paper-item-icon-color: var(--entity-warning-color);
              --paper-item-icon-active-color:
                {% if states.alert|selectattr('attributes.category','eq','system')
                    |selectattr('state','ne','idle')|list|count > 0 %} var(--entity-severe-color)
                {% else %} var(--state-active-color)
                {% endif %}
              ;
            }

  - type: custom:auto-entities
    filter:
      include:
        - entity_id: "automation.system_*"
    sort:
      method: name
      ignore_case: true
    card:
      type: custom:fold-entity-row
      padding: 5
      head:
        entity: sensor.dummy
        name: "System Automations"
        icon: mdi:sync-alert
        state: ""
        tap_action:
          action: none
card_mod:
  class: basic_swipe
