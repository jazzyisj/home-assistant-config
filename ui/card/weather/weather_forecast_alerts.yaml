###############################################################################
## Weather Card Alerts
###############################################################################
type: glance
show_state: false
show_name: false
state_color: true
columns: 8
entities:
  #IDEA to weather card temp
  - type: custom:template-entity-row
    entity: sensor.outdoor_temperature_trend
    # icon: #BUG icon template not working in glance card #BUGFIX do icon in template entity
    state: >
      {% if is_state('binary_sensor.outdoor_high_temperature_alert', 'on') %} High Temp
      {% elif is_state('binary_sensor.outdoor_low_temperature_alert', 'on') %} Low Temp
      {% else %} {{ states('sensor.outdoor_temperature_trend') }}
      {% endif %}
    double_tap_action:
      action: navigate
      navigation_path: outdoor-temp
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% if is_state('binary_sensor.outdoor_high_temperature_alert', 'on') %} var(--entity-high-temp-color)
            {% elif is_state('binary_sensor.outdoor_low_temperature_alert', 'on') %} var(--entity-low-temp-color)
            {% else %} var(--state-icon-color);
            {% endif %}
          ;
        }

  - entity: binary_sensor.rain_today
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          content: !include /config/ui/card/weather/rain_alert.yaml
          timeout: 120000
          card_mod:
            style:
              ha-dialog$: |
                div.mdc-dialog__scrim {
                  backdrop-filter: grayscale(100%) brightness(25%) !important;
                  -webkit-backdrop-filter: grayscale(100%) brightness(25%) !important;
                }
                div.mdc-dialog__surface {
                  background: transparent !important;
                }
    double_tap_action:
      action: navigate
      navigation_path: rain-radar
    hold_action:
      action: call-service
      service: alert.toggle
      data:
        entity_id: alert.rain_alert
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% if is_state('binary_sensor.rain','on') %} var(--entity-cooling-color)
            {% elif not is_state('alert.rain_alert','idle') %} var(--entity-warning-color)
            {% else %} var(--state-icon-color)
            {% endif %}
          ;
          --state-binary_sensor-active-color:
            {% if is_state('binary_sensor.rain','on') %} var(--entity-cooling-color)
            {% elif not is_state('alert.rain_alert','idle') %} var(--entity-warning-color)
            {% else %} var(--entity-minor-color)
            {% endif %}
          ;
        }

  - type: custom:template-entity-row
    entity: sensor.lightning_count
    icon: mdi:flash
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% set lcount = states('sensor.lightning_count')|int(-1) %}
            {% if lcount > 0 %} var(--entity-warning-color)
            {% elif lcount == 0 %} var(--state-icon-color)
            {% else %} var(--entity-disabled-color)
            {% endif %}
          ;
        }
    tap_action:
      action: more-info
    double_tap_action:
      action: navigate
      navigation_path: storm-radar

  - entity: binary_sensor.strong_wind_alert
    card_mod:
      style: |
        :host {
          --paper-item-icon-color: var(--state-icon-color);
          --state-binary_sensor-active-color: var(--entity-warning-color);
        }
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          content: !include /config/ui/card/weather/wind_conditions.yaml
          timeout: 120000
          card_mod:
            style:
              ha-dialog$: |
                div.mdc-dialog__scrim {
                  backdrop-filter: grayscale(100%) brightness(25%) !important;
                  -webkit-backdrop-filter: grayscale(100%) brightness(25%) !important;
                }
                div.mdc-dialog__surface {
                  background: transparent !important;
                }
    double_tap_action:
      action: navigate
      navigation_path: wind-radar
    hold_action:
      action: call-service
      service: alert.toggle
      data:
        entity_id: alert.strong_wind

  - entity: sensor.allergy_risk_today
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% set level = states('sensor.allergy_index_today')|float(-1) %}
            {% if level < 0 %} var(--entity-disabled-color)
            {% elif level < 2.5 %} var(--state-icon-color)
            {% elif level < 4.9 %} var(--entity-minor-color)
            {% elif level < 7.3 %} var(--entity-warning-color)
            {% elif level < 9.7 %} var(--entity-severe-color)
            {% else %} var(--entity-critical-color)
            {% endif %}
          ;
        }
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          content: !include /config/ui/card/weather/allergy_index.yaml
          timeout: 100000
          card_mod:
            style:
              ha-dialog$: |
                div.mdc-dialog__scrim {
                  backdrop-filter: grayscale(100%) brightness(25%) !important;
                  -webkit-backdrop-filter: grayscale(100%) brightness(25%) !important;
                }
                div.mdc-dialog__surface {
                  background: transparent !important;
                }
    double_tap_action:
      action: url
      url_path: !secret POLLEN
    hold_action:
      action: call-service
      service: alert.toggle
      data:
        entity_id: alert.allergy_risk

  - entity: sensor.asthma_risk_today
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% set level = states('sensor.asthma_index_today')|float(-1) %}
            {% if level < 0 %} var(--entity-disabled-color)
            {% elif level < 2.5 %} var(--state-icon-color)
            {% elif level < 4.9 %} var(--entity-minor-color)
            {% elif level < 7.3 %} var(--entity-warning-color)
            {% elif level < 9.7 %} var(--entity-severe-color)
            {% else %} var(--entity-critical-color)
            {% endif %}
          ;
        }
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          content: !include /config/ui/card/weather/asthma_index.yaml
          timeout: 100000
          card_mod:
            style:
              ha-dialog$: |
                div.mdc-dialog__scrim {
                  backdrop-filter: grayscale(100%) brightness(25%) !important;
                  -webkit-backdrop-filter: grayscale(100%) brightness(25%) !important;
                }
                div.mdc-dialog__surface {
                  background: transparent !important;
                }
    double_tap_action:
      action: navigate
      navigation_path: asthma
    hold_action:
      action: call-service
      service: alert.toggle
      data:
        entity_id: alert.asthma_risk

  - entity: sensor.cold_flu_index_today
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% set level = states('sensor.cold_flu_index_today')|float(-1) %}
            {% if level < 0 %} var(--entity-disabled-color)
            {% elif level < 2.5 %} var(--state-icon-color)
            {% elif level < 4.9 %} var(--entity-minor-color)
            {% elif level < 7.3 %} var(--entity-warning-color)
            {% elif level < 9.7 %} var(--entity-severe-color)
            {% else %} var(--entity-critical-color)
            {% endif %}
          ;
        }
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          content: !include /config/ui/card/weather/flu_index.yaml
          timeout: 100000
          card_mod:
            style:
              ha-dialog$: |
                div.mdc-dialog__scrim {
                  backdrop-filter: grayscale(100%) brightness(25%) !important;
                  -webkit-backdrop-filter: grayscale(100%) brightness(25%) !important;
                }
                div.mdc-dialog__surface {
                  background: transparent !important;
                }
    double_tap_action:
      action: navigate
      navigation_path: flu
    hold_action:
      action: call-service
      service: alert.toggle
      data:
        entity_id: alert.flu_risk

  - entity: sensor.air_quality_index
    card_mod:
      style: |
        :host {
          --paper-item-icon-color:
            {% set level = states('sensor.air_quality_index')|float(-1) %}
            {% if level < 0 %} var(--entity-disabled-color)
            {% elif level < 51 %} var(--state-icon-color)
            {% elif level < 101 %} var(--entity-minor-color)
            {% elif level < 151 %} var(--entity-severe-color)
            {% elif level < 201 %} var(--entity-critical-color)
            {% elif level < 301 %} rgb(142, 66, 149)
            {% else %} rgb(124, 4, 37)
            {% endif %}
          ;
        }
    tap_action:
      action: fire-dom-event
      browser_mod:
        service: browser_mod.popup
        data:
          content: !include /config/ui/card/weather/air_quality_index.yaml
          timeout: 100000
          card_mod:
            style:
              ha-dialog$: |
                div.mdc-dialog__scrim {
                  backdrop-filter: grayscale(100%) brightness(25%) !important;
                  -webkit-backdrop-filter: grayscale(100%) brightness(25%) !important;
                }
                div.mdc-dialog__surface {
                  background: transparent !important;
                }
    double_tap_action:
      action: navigate
      navigation_path: waqi
    hold_action:
      action: call-service
      service: alert.toggle
      data:
        entity_id: alert.air_quality
card_mod:
  class: sub_card
  style: |
    ha-card {
      padding: 0px;
      margin: 0px;
    }
    .entities.no-header {
      padding: 0px !important;
    }
