###############################################################################
## Precipitation Today Entity
###############################################################################
type: conditional
conditions:
  - condition: state
    entity: binary_sensor.precipitation_likely_today
    state: "on"
row:
  type: custom:fold-entity-row
  padding: 10
  head:
    type: custom:template-entity-row
    entity: binary_sensor.precipitation_likely_today
    name: "Precipitation Likely Today"
    icon: mdi:weather-snowy-rainy
    state: >
      {% if has_value('sensor.precipitation_start') %}
        {{ state_attr('sensor.precipitation_start', '12hour') }}
      {% elif states('sensor.precipitation_probability_today') | int(-1) > 30 %}
        {{ states('sensor.precipitation_probability_today', with_unit=true) }}
      {% endif %}
    secondary: >
      {% if is_number(states('sensor.precipitation_expected_today')) %}
        Expected: {{ '%0.1f' | format(states('sensor.precipitation_expected_today') | float(-1)) }} mm
      {% endif %}
    active: "{{ is_state('binary_sensor.precipitation_likely_today', 'on') }}" #BUG not working
    card_mod: #BUGFIX #BUG not working in conditional row
      style: |
        :host {
          --paper-item-icon-color:
            {% if is_state('binary_sensor.precipitation_likely_today', 'on') %} var(--state-active-color)
            {% else %} var(--state-icon-color)
            {% endif %}
          ;
        }
  entities: !include /config/ui/card/weather/include/precipitation_entities.yaml