###################################################################################################
## Light Controls
###################################################################################################
type: vertical-stack
cards:
  - type: heading
    icon: mdi:lightbulb-group
    heading: "Light Controls"
    heading_style: subtitle
    card_mod:
      style: |
        {% from 'hass.jinja' import subtitle_style %}
        {{ subtitle_style() }}

  - type: grid
    columns: 2
    square: false
    cards:
      - type: tile
        entity: script.turn_light_on
        name: "Lights On"
        hide_state: true
        layout: horizontal
        fill_container: false
        color: green
        tap_action: &light_settings
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: "Light Settings"
              content: !include /config/ui/card/light/light_settings.yaml
        hold_action: &light_on
          action: perform-action
          perform_action: script.turn_light_on
          data:
            override: true
            cancel_timer: true
        icon_tap_action: *light_on
        icon_hold_action:
          action: perform-action
          perform_action: script.turn_light_on
          data:
            profile: default_max
            override: true
        card_mod:
          style: |
            ha-card {
              --tile-color: var(--entity-ok-color) !important;
            }

      - type: tile
        entity: script.turn_light_off
        name: "Lights Off"
        hide_state: true
        icon_color: orange
        layout: horizontal
        fill_container: false
        tap_action: *light_settings
        hold_action: &light_off
          action: perform-action
          perform_action: script.turn_light_off
        icon_tap_action: *light_off
        icon_hold_action: *light_off
        card_mod:
          style: |
            ha-card {
              --tile-color: var(--entity-critical-color) !important;
            }

      - type: tile
        entity: switch.adaptive_lighting
        tap_action:
          action: more-info
        double_tap_action: &adaptive_graph
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: "Adaptive Lighting"
              size: wide
              content:
                type: vertical-stack
                cards:
                  - !include /config/ui/graph/light/adaptive_brightness.yaml
                  - !include /config/ui/graph/light/adaptive_colour.yaml
        hold_action: &adaptive
          action: navigate
          navigation_path: /config/integrations/integration/adaptive_lighting
        icon_tap_action:
          action: toggle
        icon_double_tap_action: *adaptive_graph
        icon_hold_action: *adaptive
        card_mod: #BUGFIX - adaptive rgb tupple/list
          style: |
            ha-card {
              --tile-color:
                {%- if is_state('switch.adaptive_lighting', 'on') %}
                  {%- if is_state('input_select.occupancy_mode', 'Night') %}
                  var(--presence-night-color)
                  {%- else %}
                  rgb{{ state_attr('switch.adaptive_lighting_rgb_lights', 'rgb_color') }}
                  {%- endif %}
                {%- else %} var(--state-inactive-color)
                {%- endif %} !important;
            }

      - type: tile
        entity: sensor.illuminance_status
        name: "Illuminance Lighting"
        tap_action:
          action: more-info
        hold_action: &illuminace_settings
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: "Illuminance Lighting"
              content: !include /config/ui/card/light/illuminance_settings.yaml
        icon_tap_action: *illuminace_settings
        icon_hold_action: *illuminace_settings
        card_mod:
          style: |
            ha-card {
              --tile-color:
                {%- if is_state('sensor.illuminance_status', 'Nightime') %} var(--state-active-color)
                {%- elif is_state('sensor.illuminance_status', 'Daytime') %} rgb(227, 233, 152)
                {%- else %} var(--state-inactive-color)
                {%- endif %} !important;
            }

  - type: grid
    columns: 2
    square: false
    cards:
      - type: tile
        entity: scene.evening
        name: "Evening Lights"
        hide_state: true
        tap_action:
          action: more-info
        hold_action: &evening
          action: perform-action
          perform_action: scene.turn_on
          target:
            entity_id: scene.evening
        icon_tap_action: *evening
        icon_hold_action: *evening

      - type: tile
        entity: switch.company_scene
        hide_state: true
        tap_action:
          action: more-info
        double_tap_action: &company_off
          action: perform-action
          perform_action: switch.turn_off
          target:
            entity_id: switch.company_scene
        hold_action: &company_settings
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: "Company Scene"
              content: !include /config/ui/card/scene/company_scene.yaml
        icon_tap_action:
          action: perform-action
          perform_action: switch.toggle
          target:
            entity_id: switch.company_scene
        icon_double_tap_action: *company_off
        icon_hold_action: *company_settings
        card_mod:
          style: |
            {% from 'hass.jinja' import scene_tile_style %}
            {{ scene_tile_style('company') }}

      - type: tile
        entity: switch.movie_scene
        hide_state: true
        tap_action:
          action: more-info
        double_tap_action: &movie_off
          action: perform-action
          perform_action: switch.turn_off
          target:
            entity_id: switch.movie_scene
        hold_action: &movie_settings
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: "Movie Scene"
              content: !include /config/ui/card/scene/movie_scene.yaml
        icon_tap_action:
          action: perform-action
          perform_action: switch.toggle
          target:
            entity_id: switch.movie_scene
        icon_double_tap_action: *movie_off
        icon_hold_action: *movie_settings
        card_mod:
          style: |
            {% from 'hass.jinja' import scene_tile_style %}
            {{ scene_tile_style('movie') }}

      - type: tile
        entity: switch.chill_scene
        tap_action:
          action: more-info
        double_tap_action: &chill_off
          action: perform-action
          perform_action: switch.turn_off
          target:
            entity_id: switch.chill_scene
        hold_action: &chill_settings
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: "Chill Scene"
              content: !include /config/ui/card/scene/chill_scene.yaml
        icon_tap_action:
          action: perform-action
          perform_action: switch.toggle
          target:
            entity_id: switch.chill_scene
        icon_double_tap_action: *chill_off
        icon_hold_action: *chill_settings
        card_mod:
          style: |
            {% from 'hass.jinja' import scene_tile_style %}
            {{ scene_tile_style('chill') }}

      - type: tile
        entity: switch.shower_scene
        tap_action:
          action: more-info
        double_tap_action: &shower_off
          action: perform-action
          perform_action: switch.turn_off
          target:
            entity_id: switch.shower_scene
        hold_action: &shower_settings
          action: fire-dom-event
          browser_mod:
            service: browser_mod.popup
            data:
              title: "Shower Scene"
              content: !include /config/ui/card/scene/shower_scene.yaml
        icon_tap_action:
          action: perform-action
          perform_action: switch.toggle
          target:
            entity_id: switch.shower_scene
        icon_double_tap_action: *shower_off
        icon_hold_action: *shower_settings

      - type: tile
        entity: switch.chill_scene #TEMP fill space in UI
        tap_action:
          action: more-info
        double_tap_action: *chill_off
        hold_action: *chill_settings
        icon_tap_action:
          action: perform-action
          perform_action: switch.toggle
          target:
            entity_id: switch.chill_scene
        icon_double_tap_action: *chill_off
        icon_hold_action: *chill_settings
        card_mod:
          style: |
            {% from 'hass.jinja' import scene_tile_style %}
            {{ scene_tile_style('chill') }}