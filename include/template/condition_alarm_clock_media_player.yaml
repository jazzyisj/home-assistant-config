condition: template
alias: Alarm clock is on and trigger is alarm_clock media player or in the alarm clock speaker group
# sensor.alarm_clock_media_player only populated if and alarm clock switch is on
# no binary_sensor.alarm_clock - prevents trigger with test play
value_template: >
  {% set alarm = states('sensor.alarm_clock_media_player') %}
  {% if is_state_attr(alarm,'type','group') %}
    {% if alarm == trigger.entity_id %}{% set found.value = 1 %}
    {% else %}
      {% set found = namespace(value=0) %}
      {% set alarm_group = state_attr('sensor.alarm_clock_media_player','players') %}
      {% for item in alarm_group %}{% if item == trigger.entity_id %}{% set found.value = 1 %}{% endif %}{% endfor %}
    {% endif %}
    {{ found.value|int(0) == 1 }}
  {% else %}
    {{ alarm == trigger.entity_id }}
  {% endif %}