#######################################################################################################################
## Spotify - Media Player Condition
# false if spotify not playing or script.spotify_play/stop are on (no triggers turning on/off)
# true if spotify is on and trigger entity is current spotify media player (or in current speaker group)
#######################################################################################################################
condition: template
value_template: >
  {% set spotify = states('input_text.active_spotify_player') %}
  {% if is_state('input_boolean.spotify_on','off') or is_state('script.spotify_play','on') %} false
  {% elif spotify in state_attr('group.google_speaker_groups','entity_id') %}
    {% set found = namespace(value=0) %}
    {% for spotify_player in state_attr('group.' ~ spotify.split('.')[1],'entity_id') %}
      {% if trigger.entity_id == spotify_player %}{% set found.value = 1 %}{% endif %}
    {% endfor %}
    {{ found.value|int == 1 }}
  {% else %}{{ trigger.entity_id == spotify }}
  {% endif %}