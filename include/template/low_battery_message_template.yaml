  {%- set t = states('input_number.battery_alert_threshold')|int -%}
  {%- set b = states.zwave|selectattr('attributes.battery_level','defined')
      |rejectattr('state','!=','ready')|selectattr('attributes.battery_level','>=',t) -%}
  {%- for i in b -%}
    {%- set ns.m = ns.m ~ '- ' ~ i.name ~ ' (' ~ '%0.0f'|format(i.attributes.battery_level|float)|string ~ '%)\n' -%}
  {%- endfor -%}
  {%- set nb = expand('group.nest_batteries')|selectattr('state','eq','Replace') -%}
  {%- for i in nb -%}{%- set ns.m = ns.m ~ '- ' ~ i.name ~ '\n' -%}{%- endfor -%}
  {{ ns.m }}