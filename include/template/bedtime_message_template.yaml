|
  {%- set time = states('sensor.time') -%}
  {%- set wake = states('sensor.waketime_today') -%}
  {%- set bed = states('sensor.bedtime_today') -%}
  {%- set src = state_attr('sensor.alarm_clock_next_alarm','alarm_source') -%}

  {%- if is_state('input_boolean.bedtime_delayed','on') -%}
    It's almost bedtime but you've elected to stay up late tonight. Turn the bedtime delay off if you've changed your mind.
  {%- else -%}
    It's almost time to head to bed!  Turn on the bedtime delay to let me know if you'll be staying up past your bed time.
  {%- endif %}

  {% if not is_state('sensor.next_alarm','off') and (is_state('input_boolean.alarm_clock_auto_workdays','on') or is_state('input_boolean.alarm_clock_auto_weekends','on')) -%}
     Tomorrow's alarm is set for {{ as_timestamp(states('sensor.date') ~ ' ' ~ states('sensor.alarm_clock_next_alarm'))|timestamp_custom('%_I:%M %p',true) }}
    by
    {%- if src == 'auto' %} the auto alarm clock
    {%- elif src == 'manual' %} the standard alarm clock
    {%- elif src == 'jphone' %} Jason's mobile phone.
    {%- elif src == 'sphone' %} Sheri's mobile phone.
    {%- else %} something has gone wrong so damned if I know.
    {%- endif -%}
    , and it will ring on the
    {%- if src == manual %}{{ states('input_select.alarm_clock_media_player_manual') }}.
    {%- else %} {{ states('input_select.alarm_clock_media_player_auto') }}.
    {% endif -%}
  {%- else %} There is no alarm set for tomorrow morning.
  {%- endif -%}

  {% if is_state('binary_sensor.owner_home','on')
      and ((time > wake and is_state('binary_sensor.work_tomorrow','on') and is_state('input_boolean.workday_morning','off'))
      or (time < wake and is_state('binary_sensor.work_today','on') and is_state('input_boolean.workday_morning','off'))
      or (time > wake and is_state('binary_sensor.work_tomorrow','off') and is_state('input_boolean.weekend_morning','off'))
      or (time < wake and is_state('binary_sensor.work_today','off') and is_state('input_boolean.weekend_morning','off'))
      or ( is_state('binary_sensor.somebody_home','on') and is_state('input_boolean.guest_morning','off'))) -%}

    Just a heads up, the morning routine has been disabled.  Don't forget to wake up the house and disarm the alarm in the morning!
  {%- endif -%}

  {% if is_state('binary_sensor.jason_home','on') -%}
    {%- if states('sensor.jphone_battery_level') in ['unknown','unavailable','none'] -%}
      {% set bed = false %}
    {%- else -%}
      {%- set blev = states('sensor.jphone_battery_level')|int %}
      {%- set bed = blev < 50 and not is_state('binary_sensor.jphone_is_charging','on') -%}
    {%- endif -%}
    {%- if bed -%} Jason you need to plug in your phone. The battery level is {{ blev }} percent. {% endif -%}
  {%- endif %}

  {% if is_state('binary_sensor.sheri_home','on') -%}
    {%- if states('sensor.sphone_battery_level') in ['unknown','unavailable','none'] -%}
      {%- set bed = false %}
    {%- else %}
      {%- set blev = states('sensor.sphone_battery_level')|int %}
      {%- set bed = blev < 50 and not is_state('binary_sensor.sphone_is_charging','on') -%}
    {%- endif %}
    {%- if bed -%} Sheri, you should plug in your phone, the battery is down to {{ blev }} percent. {% endif -%}
  {%- endif %}

  The weather forecast is calling for {{ states('sensor.dark_sky_daily_summary') }}

  {% if (time > wake and is_state('binary_sensor.garbage_tomorrow','on'))
      or (time < wake and is_state('calendar.garbage','on')) %}
    One last thing,.  Did you remember to take out the garbage today?
  {%- endif %}

  {% if (time > wake and is_state('binary_sensor.recycle_tomorrow','on'))
      or (time < wake and is_state('calendar.recycle','on')) %}
      One last thing,.  Did you remember to take out the recycle today?
  {%- endif -%}

  {% if (time > wake and is_state('binary_sensor.yardwaste_tomorrow','on'))
      or (time < wake and is_state('calendar.yardwaste','on')) %}
      One last thing,.  Did you remember to take out the yard waste today?
  {%- endif -%}