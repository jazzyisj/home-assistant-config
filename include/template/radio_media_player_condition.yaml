#######################################################################################################################
## Radio Media Player Condition
# radio is on and the trigger entity is the current radio media player or in radio speaker group
# false if script.radio_play on so no triggers when media players turn on/off
# startup stops trigger during restart/shutdown when players go offline

#use input_boolean.radio_on for test so not triggered during radio play/stop
#######################################################################################################################
condition: template
value_template: >
  {% set radio = states('sensor.radio_media_player') %}
  {% if is_state('input_boolean.radio_on','off') or is_state('binary_sensor.startup_complete','off') %} false
  {% elif is_state_attr(radio,'speaker_group',true) %}
    {% set found = namespace(value=0) %}
    {% set radio_group = states.media_player|selectattr('attributes.' ~ radio.split('.')[1],'eq',true)|map(attribute='entity_id')|list %}
    {% for radio_player in radio_group %}
      {% if trigger.entity_id == radio_player %}{% set found.value = 1 %}{% endif %}
    {% endfor %}
    {{ found.value|int == 1 }}
  {% else %}{{ trigger.entity_id == radio }}
  {% endif %}
