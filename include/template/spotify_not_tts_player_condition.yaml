#######################################################################################################################
## Spotify - Not TTS Player Condition
# true if tts not playing
# true if spotify media player (or group memeber) is not a tts media player (or group member)
#######################################################################################################################
condition: template
value_template: >
  {% if is_state('binary_sensor.alarm_clock_active','off') %} true
  {% else %}
    {% set spotify = states('input_text.active_media_player_spotify') %}
    {% set tts = states('sensor.tts_media_player') %}
    {% set spotify_group = states.media_player|selectattr('attributes.' ~ spotify.split('.')[1],'eq',true)|map(attribute='entity_id')|list %}
    {% set tts_group = states.media_player|selectattr('attributes.' ~ tts.split('.')[1],'eq',true)|map(attribute='entity_id')|list %}
    {% set groups = states.media_player|selectattr('attributes.speaker_group','eq',true)|map(attribute='entity_id')|list %}
    {% set found = namespace(value=0) %}
    {% if spotify in groups %}
      {% for spotify_player in spotify_group %}
        {% if tts in groups %}
          {% for tts_player in tts_group %}
            {% if spotify_player == tts_player %}{% set found.value = 1 %}{% endif %}
          {% endfor %}
        {% elif spotify_player == tts %}
          {% set found.value = 1 %}
        {% endif %}
      {% endfor %}
    {% else %}
      {% if tts in groups %}
        {% for tts_player in tts_group %}
          {% if spotify == tts_player %}{% set found.value = 1 %}{% endif %}
        {% endfor %}
      {% elif spotify == tts %}
        {% set found.value = 1 %}
      {% endif %}
    {% endif %}
    {{ found.value|int == 0 }}
  {% endif %}